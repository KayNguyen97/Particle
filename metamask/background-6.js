LavaPack.loadBundle([[98,{lodash:3497},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");r.default={version:6,migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=6;try{const e=function(e){const t=e.KeyringController,r={...e,PreferencesController:{selectedAddress:t.selectedAccount}};return delete r.KeyringController.selectedAccount,r}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #6${e.stack}`)}return Promise.resolve(t)}}}}},{package:"$root$",file:"app/scripts/migrations/006.js"}],[99,{lodash:3497},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");r.default={version:7,migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=7;try{const e=function(e){const t={...e,TransactionManager:{transactions:e.transactions||[],gasMultiplier:e.gasMultiplier||1}};return delete t.transactions,delete t.gasMultiplier,t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #7${e.stack}`)}return Promise.resolve(t)}}}}},{package:"$root$",file:"app/scripts/migrations/007.js"}],[4,{"../../shared/constants/app":4138,"../../shared/constants/metametrics":4148,"../../shared/modules/browser-runtime.utils":4174,"../../shared/modules/mv3.utils":4187,"../../shared/modules/object.utils":4189,"./first-time-state":27,"./lib/createStreamSink":42,"./lib/ens-ipfs/setup":48,"./lib/get-first-preferred-lang-code":50,"./lib/getObjStructure":51,"./lib/local-store":54,"./lib/migrator":57,"./lib/network-store":58,"./lib/notification-manager":59,"./lib/setup-initial-state-hooks":81,"./lib/setupSentry":82,"./lib/util":92,"./metamask-controller":93,"./migrations":215,"./platforms/extension":216,"@metamask/controller-utils":1081,"@metamask/obs-store":1468,"@metamask/utils":2002,"debounce-stream":2797,"end-of-stream":2836,"eth-rpc-errors":2885,events:2956,"extension-port-stream":2959,loglevel:3503,pump:3681,"webextension-polyfill":4122},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.loadStateFromPersistence=le,r.setupController=ue,r.statePersistenceEvents=void 0,e("./lib/setup-initial-state-hooks");var n=L(e("events")),a=L(e("end-of-stream")),o=L(e("pump")),s=L(e("debounce-stream")),i=L(e("loglevel")),l=L(e("webextension-polyfill")),c=e("@metamask/obs-store"),u=e("@metamask/utils"),d=e("@metamask/controller-utils"),p=L(e("extension-port-stream")),f=e("eth-rpc-errors"),m=e("../../shared/constants/app"),E=e("../../shared/constants/metametrics"),g=e("../../shared/modules/browser-runtime.utils"),T=e("../../shared/modules/mv3.utils"),C=e("../../shared/modules/object.utils"),b=L(e("./migrations")),v=L(e("./lib/migrator")),M=L(e("./platforms/extension")),h=L(e("./lib/local-store")),_=(L(e("./lib/network-store")),e("./lib/setupSentry")),S=L(e("./lib/createStreamSink")),w=R(e("./lib/notification-manager")),O=R(e("./metamask-controller")),A=L(e("./first-time-state")),N=L(e("./lib/get-first-preferred-lang-code")),y=L(e("./lib/getObjStructure")),P=L(e("./lib/ens-ipfs/setup")),k=e("./lib/util");function I(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(I=function(e){return e?r:t})(e)}function R(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=I(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=a?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(n,o,s):n[o]=e[o]}return n.default=e,r&&r.set(e,n),n}function L(e){return e&&e.__esModule?e:{default:e}}const j=new h.default;global.stateHooks.getMostRecentPersistedState=()=>j.mostRecentRetrievedState;const{sentry:U}=global,D={...A.default},F={[m.ENVIRONMENT_TYPE_POPUP]:!0,[m.ENVIRONMENT_TYPE_NOTIFICATION]:!0,[m.ENVIRONMENT_TYPE_FULLSCREEN]:!0},x=["trezor-connect"];i.default.setLevel("info",!1);const V=new M.default,B=new w.default;let G=0,Y=!1,$=!1;const K={},q={};let H,Q;const z={};const J=new URL("https://metamask.github.io/phishing-warning/v3.0.3/"),W=1e3,X=r.statePersistenceEvents=new n.default,{promise:Z,resolve:ee,reject:te}=(0,k.deferredPromise)(),re=async()=>{const e=await l.default.tabs.query({url:"<all_urls>",windowType:"normal"}).then((e=>((0,g.checkForLastErrorAndLog)(),e))).catch((()=>{(0,g.checkForLastErrorAndLog)()}));for(const t of e)l.default.tabs.sendMessage(t.id,{name:m.EXTENSION_MESSAGES.READY}).then((()=>{(0,g.checkForLastErrorAndLog)()})).catch((()=>{(0,g.checkForLastErrorAndLog)()}))};let ne,ae;function oe(){const e=(new Date).toISOString();l.default.storage.session.set({timestamp:e})}async function se(){try{const e=await le(),t=e.data,r=await(0,N.default)();let n;if(T.isManifestV3){const e=2e3;oe(),setInterval(oe,e);const t=await l.default.storage.session.get(["isFirstMetaMaskControllerSetup"]);n=(null==t?void 0:t.isFirstMetaMaskControllerSetup)===undefined,await l.default.storage.session.set({isFirstMetaMaskControllerSetup:n})}ue(t,r,{},n,e.meta),T.isManifestV3||await async function(){let e;try{const t=new URL("https://metamask.github.io/phishing-warning/v3.0.3/");let r,n;t.hash="#extensionStartup",e=window.document.createElement("iframe"),e.setAttribute("src",t.href),e.setAttribute("sandbox","allow-scripts allow-same-origin");const a=new Promise(((e,t)=>{r=e,n=t}));e.addEventListener("load",r),window.document.body.appendChild(e),setTimeout((()=>n(new ie)),W),await a}catch(e){e instanceof ie?console.warn("Phishing warning page timeout; page not guaranteed to work offline."):console.error("Failed to initialize phishing warning page",e)}finally{e&&e.remove()}}(),await re(),i.default.info("MetaMask initialization complete."),ee()}catch(e){te(e)}}l.default.runtime.onConnect.addListener((async(...e)=>{await Z,ne(...e)})),l.default.runtime.onConnectExternal.addListener((async(...e)=>{await Z,ae(...e)}));class ie extends Error{constructor(){super("Timeout failed")}}async function le(){const e=new v.default({migrations:b.default});if(e.on("error",console.warn),Q=await j.get()||e.generateInitialState(D),Q&&!Q.data&&(Q=e.generateInitialState(D),U.captureMessage("MetaMask - Empty vault found - unable to recover")),e.on("error",(e=>{const t=(0,y.default)(Q);U.captureException(e,{extra:{vaultStructure:t}})})),Q=await e.migrateData(Q),!Q)throw new Error("MetaMask - migrator returned undefined");if(!(0,u.isObject)(Q.meta))throw new Error(`MetaMask - migrator metadata has invalid type '${typeof Q.meta}'`);if("number"!=typeof Q.meta.version)throw new Error(`MetaMask - migrator metadata version has invalid type '${typeof Q.meta.version}'`);if(!(0,u.isObject)(Q.data))throw new Error(`MetaMask - migrator data has invalid type '${typeof Q.data}'`);return j.setMetadata(Q.meta),j.set(Q.data),Q}function ce(e,t,r){if(!(0,u.hasProperty)(t.permissions,"eth_accounts"))return;const n=Object.keys(r.store.getState().identities).length,a=t.permissions.eth_accounts.caveats;if(a){const t=a[0].value.length;H.metaMetricsController.trackEvent({event:E.MetaMetricsEventName.DappViewed,category:E.MetaMetricsEventCategory.InpageProvider,referrer:{url:e},properties:{is_first_visit:!1,number_of_accounts:n,number_of_accounts_connected:t}})}}function ue(e,t,r,n,u){var g;H=new O.default({infuraProjectId:"b6bf7d3508c941499b10025c0776eaf8",showUserConfirmation:de,initState:e,initLangCode:t,platform:V,notificationManager:B,browser:l.default,getRequestAccountTabIds:()=>q,getOpenMetamaskTabsIds:()=>K,localStore:j,overrides:r,isFirstMetaMaskControllerSetup:n,currentMigrationVersion:u.version,featureFlags:{}}),(0,P.default)({getCurrentChainId:()=>H.networkController.state.providerConfig.chainId,getIpfsGateway:H.preferencesController.getIpfsGateway.bind(H.preferencesController),getUseAddressBarEnsResolution:()=>H.preferencesController.store.getState().useAddressBarEnsResolution,provider:H.provider}),(0,o.default)((0,c.storeAsStream)(H.store),(0,s.default)(1e3),(0,S.default)((async e=>{await j.set(e),X.emit("state-persisted",e)})),(e=>{i.default.error("MetaMask - Persistence pipeline failed",e)})),g=H,global.stateHooks.getSentryAppState=function(){const e=g.memStore.getState();return(0,C.maskObject)(e,_.SENTRY_BACKGROUND_STATE)};const b=()=>G>0||Boolean(Object.keys(K).length)||Y,v=(e,t)=>{if(!1===e)H.onClientClosed();else{if(t===m.ENVIRONMENT_TYPE_FULLSCREEN&&Boolean(Object.keys(K).length))return;H.onEnvironmentTypeClosed(t)}};function M(){let e="";const t=h();t&&(e=String(t)),T.isManifestV3?(l.default.action.setBadgeText({text:e}),l.default.action.setBadgeBackgroundColor({color:"#037DD6"})):(l.default.browserAction.setBadgeText({text:e}),l.default.browserAction.setBadgeBackgroundColor({color:"#037DD6"}))}function h(){let e=H.appStateController.waitingForUnlock.length+H.approvalController.getTotalApprovalCount();return H.preferencesController.getUseRequestQueue()&&(e+=H.queuedRequestController.state.queuedRequestCount),e}ne=async e=>{var t;const n=e.name;if(x.includes(e.name))return;let o=!1;const s=(0,k.getPlatform)(),i=null!==(t=e.sender)&&void 0!==t&&t.url?new URL(e.sender.url):null;if(o=s===m.PLATFORM_FIREFOX?F[n]:(null==i?void 0:i.origin)===`chrome-extension://${l.default.runtime.id}`,o){var c;const t=(null==r||null===(c=r.getPortStream)||void 0===c?void 0:c.call(r,e))||new p.default(e);if(H.isClientOpen=!0,H.setupTrustedCommunication(t,e.sender),n===m.ENVIRONMENT_TYPE_POPUP&&(G+=1,(0,a.default)(t,(()=>{G-=1;const e=b();H.isClientOpen=e,v(e,m.ENVIRONMENT_TYPE_POPUP)}))),n===m.ENVIRONMENT_TYPE_NOTIFICATION&&(Y=!0,(0,a.default)(t,(()=>{Y=!1;const e=b();H.isClientOpen=e,v(e,m.ENVIRONMENT_TYPE_NOTIFICATION)}))),n===m.ENVIRONMENT_TYPE_FULLSCREEN){const r=e.sender.tab.id;K[r]=!0,(0,a.default)(t,(()=>{delete K[r];const e=b();H.isClientOpen=e,v(e,m.ENVIRONMENT_TYPE_FULLSCREEN)}))}}else if(i&&i.origin===J.origin&&i.pathname===J.pathname){var u;const t=(null==r||null===(u=r.getPortStream)||void 0===u?void 0:u.call(r,e))||new p.default(e);H.setupPhishingCommunication({connectionStream:t})}else{if(e.sender&&e.sender.tab&&e.sender.url){const t=e.sender.tab.id,r=new URL(e.sender.url),{origin:n}=r;Object.keys(z).includes(t)||(z[t]=n);const a=H.permissionController.state.subjects[n],o=a!==undefined,s="New Tab"!==e.sender.tab.title;o&&s&&ce(n,a,H.preferencesController),e.onMessage.addListener((e=>{e.data&&e.data.method===m.MESSAGE_TYPE.ETH_REQUEST_ACCOUNTS&&(q[n]=t)}))}ae(e)}},ae=e=>{var t;const n=(null==r||null===(t=r.getPortStream)||void 0===t?void 0:t.call(r,e))||new p.default(e);H.setupUntrustedCommunication({connectionStream:n,sender:e.sender})},null!=r&&r.registerConnectListeners&&r.registerConnectListeners(ne,ae),M(),H.decryptMessageController.hub.on(O.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE,M),H.encryptionPublicKeyController.hub.on(O.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE,M),H.signatureController.hub.on(O.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE,M),H.appStateController.on(O.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE,M),H.controllerMessenger.subscribe(O.METAMASK_CONTROLLER_EVENTS.APPROVAL_STATE_CHANGE,M),H.controllerMessenger.subscribe(O.METAMASK_CONTROLLER_EVENTS.QUEUED_REQUEST_STATE_CHANGE,M),H.txController.initApprovals(),B.on(w.NOTIFICATION_MANAGER_EVENTS.POPUP_CLOSED,(({automaticallyClosed:e})=>{e?h()>0&&de():(H.signatureController.rejectUnapproved(E.REJECT_NOTIFICATION_CLOSE_SIG),H.decryptMessageController.rejectUnapproved(E.REJECT_NOTIFICATION_CLOSE),H.encryptionPublicKeyController.rejectUnapproved(E.REJECT_NOTIFICATION_CLOSE),Object.values(H.approvalController.state.pendingApprovals).forEach((({id:e,type:t})=>{switch(t){case d.ApprovalType.SnapDialogAlert:case d.ApprovalType.SnapDialogPrompt:H.approvalController.accept(e,null);break;case d.ApprovalType.SnapDialogConfirmation:case m.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.confirmAccountCreation:case m.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.confirmAccountRemoval:case m.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.showSnapAccountRedirect:H.approvalController.accept(e,!1);break;default:H.approvalController.reject(e,f.ethErrors.provider.userRejectedRequest())}}))),M()})),Object.values(H.snapController.state.snaps).some((e=>!e.preinstalled))&&H.snapController.updateBlockedSnaps()}async function de(){const e=await V.getActiveTabs(),t=Boolean(e.find((e=>K[e.id]))),r=e.length>0&&e[0].extData&&e[0].extData.indexOf("vivaldi_tab")>-1;if(!$&&(r||0===G)&&!t){$=!0;try{const e=H.appStateController.getCurrentPopupId();await B.showPopup((e=>H.appStateController.setCurrentPopupId(e)),e)}finally{$=!1}}}const pe=()=>{if(H)return H.metaMetricsController.updateTraits({[E.MetaMetricsUserTrait.InstallDateExt]:(new Date).toISOString().split("T")[0]}),void H.metaMetricsController.addEventBeforeMetricsOptIn({category:E.MetaMetricsEventCategory.App,event:E.MetaMetricsEventName.AppInstalled,properties:{}});setTimeout((()=>{pe()}),1e3)};async function fe(){Boolean(await j.get())||(pe(),V.openExtensionInBrowser()),l.default.tabs.onActivated.addListener((e=>{if(H){const{tabId:t}=e,r=z[t];if(r){const e=H.permissionController.state.subjects[r];e!==undefined&&ce(r,e,H.preferencesController)}}}))}(async function(){await fe(),se().catch(i.default.error)})()}}},{package:"$root$",file:"app/scripts/background.js"}]],[4],{});