import{a as Bs}from"./chunk-Z4JATHZR.js";import{a as H,b as Cs}from"./chunk-KTHMEYYS.js";import{a as Mt}from"./chunk-GT57MMCB.js";import{D as Dc,p as Mc,q as Wc,u as xs,v as qs,y as Fc}from"./chunk-RYNAOZ73.js";import{c as y,m as a,n as c,o as p}from"./chunk-6V2G2Z5W.js";var Rs=y(Wt=>{"use strict";a();p();Object.defineProperty(Wt,"__esModule",{value:!0});var en=xs(),Gc=qs();function jc(e){let t=en("sha256").update(e).digest();try{return en("rmd160").update(t).digest()}catch{return en("ripemd160").update(t).digest()}}Wt.hash160=jc;function Vc(e,t){return Gc("sha512",e).update(t).digest()}Wt.hmacSHA512=Vc});var Ms=y((Od,Ls)=>{a();p();var ge=qs(),Xc=c.Buffer.alloc(1,1),Ks=c.Buffer.alloc(1,0);function $c(e,t,r,n,s){let i=c.Buffer.alloc(32,0),o=c.Buffer.alloc(32,1);i=ge("sha256",i).update(o).update(Ks).update(t).update(e).update(s||"").digest(),o=ge("sha256",i).update(o).digest(),i=ge("sha256",i).update(o).update(Xc).update(t).update(e).update(s||"").digest(),o=ge("sha256",i).update(o).digest(),o=ge("sha256",i).update(o).digest();let u=o;for(;!n(u)||!r(u);)i=ge("sha256",i).update(o).update(Ks).digest(),o=ge("sha256",i).update(o).digest(),o=ge("sha256",i).update(o).digest(),u=o;return u}Ls.exports=$c});var oe=y((vd,js)=>{a();p();var Yc=Fc(),zc=Dc().ec,tn=new zc("secp256k1"),Qc=Ms(),Ft=c.Buffer.alloc(32,0),Dt=c.Buffer.from("fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141","hex"),Ws=c.Buffer.from("fffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f","hex"),Z=tn.curve.n,Jc=Z.shrn(1),jt=tn.curve.g,Vt="Expected Private",qe="Expected Point",Xt="Expected Tweak",Fs="Expected Hash",Zc="Expected Signature",ea="Expected Extra Data (32 bytes)";function Et(e){return c.Buffer.isBuffer(e)&&e.length===32}function $t(e){return Et(e)?e.compare(Dt)<0:!1}function _e(e){if(!c.Buffer.isBuffer(e)||e.length<33)return!1;let t=e[0],r=e.slice(1,33);if(r.compare(Ft)===0||r.compare(Ws)>=0)return!1;if((t===2||t===3)&&e.length===33){try{Ce(e)}catch{return!1}return!0}let n=e.slice(33);return n.compare(Ft)===0||n.compare(Ws)>=0?!1:t===4&&e.length===65}function Ds(e){return e[0]!==4}function ta(e){return _e(e)?Ds(e):!1}function Se(e){return Et(e)?e.compare(Ft)>0&&e.compare(Dt)<0:!1}function ra(e){let t=e.slice(0,32),r=e.slice(32,64);return c.Buffer.isBuffer(e)&&e.length===64&&t.compare(Dt)<0&&r.compare(Dt)<0}function Yt(e,t){return e===void 0&&t!==void 0?Ds(t):e===void 0?!0:e}function Y(e){return new Yc(e)}function Gt(e){return e.toArrayLike(c.Buffer,"be",32)}function Ce(e){return tn.curve.decodePoint(e)}function rt(e,t){return c.Buffer.from(e._encode(t))}function na(e,t,r){if(!_e(e))throw new TypeError(qe);if(!_e(t))throw new TypeError(qe);let n=Ce(e),s=Ce(t),i=n.add(s);if(i.isInfinity())return null;let o=Yt(r,e);return rt(i,o)}function sa(e,t,r){if(!_e(e))throw new TypeError(qe);if(!$t(t))throw new TypeError(Xt);let n=Yt(r,e),s=Ce(e);if(t.compare(Ft)===0)return rt(s,n);let i=Y(t),o=jt.mul(i),u=s.add(o);return u.isInfinity()?null:rt(u,n)}function ia(e,t){if(!_e(e))throw new TypeError(qe);let r=Ce(e);if(r.isInfinity())throw new TypeError(qe);return rt(r,t)}function oa(e,t){if(!Se(e))throw new TypeError(Vt);let r=Y(e),n=jt.mul(r);if(n.isInfinity())return null;let s=Yt(t);return rt(n,s)}function ua(e,t,r){if(!_e(e))throw new TypeError(qe);if(!$t(t))throw new TypeError(Xt);let n=Yt(r,e),s=Ce(e),i=Y(t),o=s.mul(i);return o.isInfinity()?null:rt(o,n)}function ca(e,t){if(!Se(e))throw new TypeError(Vt);if(!$t(t))throw new TypeError(Xt);let r=Y(e),n=Y(t),s=Gt(r.add(n).umod(Z));return Se(s)?s:null}function aa(e,t){if(!Se(e))throw new TypeError(Vt);if(!$t(t))throw new TypeError(Xt);let r=Y(e),n=Y(t),s=Gt(r.sub(n).umod(Z));return Se(s)?s:null}function pa(e,t){return Gs(e,t)}function fa(e,t,r){return Gs(e,t,r)}function Gs(e,t,r){if(!Et(e))throw new TypeError(Fs);if(!Se(t))throw new TypeError(Vt);if(r!==void 0&&!Et(r))throw new TypeError(ea);let n=Y(t),s=Y(e),i,o;Qc(e,t,function(l){let d=Y(l),h=jt.mul(d);return!(h.isInfinity()||(i=h.x.umod(Z),i.isZero()===0)||(o=d.invm(Z).mul(s.add(n.mul(i))).umod(Z),o.isZero()===0))},Se,r),o.cmp(Jc)>0&&(o=Z.sub(o));let f=c.Buffer.allocUnsafe(64);return Gt(i).copy(f,0),Gt(o).copy(f,32),f}function ha(e,t,r){if(!Et(e))throw new TypeError(Fs);if(!_e(t))throw new TypeError(qe);if(!ra(r))throw new TypeError(Zc);let n=Ce(t),s=Y(r.slice(0,32)),i=Y(r.slice(32,64));if(s.gtn(0)<=0||i.gtn(0)<=0)return!1;let o=Y(e),u=i.invm(Z),f=o.mul(u).umod(Z),l=s.mul(u).umod(Z),d=jt.mulAdd(f,n,l);return d.isInfinity()?!1:d.x.umod(Z).eq(s)}js.exports={isPoint:_e,isPointCompressed:ta,isPrivate:Se,pointAdd:na,pointAddScalar:sa,pointCompress:ia,pointFromScalar:oa,pointMultiply:ua,privateAdd:ca,privateSub:aa,sign:pa,signWithEntropy:fa,verify:ha}});var Ys=y(nt=>{"use strict";a();p();Object.defineProperty(nt,"__esModule",{value:!0});var rn=Rs(),Xs=Mt(),re=oe(),K=H(),la=Cs(),nn=K.BufferN(32),da=K.compile({wif:K.UInt8,bip32:{public:K.UInt32,private:K.UInt32}}),Jt={wif:128,bip32:{public:76067358,private:76066276}},Vs=2147483648,wa=Math.pow(2,31)-1;function ya(e){return K.String(e)&&e.match(/^(m\/)?(\d+'?\/)*\d+'?$/)!==null}function ga(e){return K.UInt32(e)&&e<=wa}var zt=class{constructor(t,r,n,s,i=0,o=0,u=0){this.__D=t,this.__Q=r,this.chainCode=n,this.network=s,this.__DEPTH=i,this.__INDEX=o,this.__PARENT_FINGERPRINT=u,K(da,s),this.lowR=!1}get depth(){return this.__DEPTH}get index(){return this.__INDEX}get parentFingerprint(){return this.__PARENT_FINGERPRINT}get publicKey(){return this.__Q===void 0&&(this.__Q=re.pointFromScalar(this.__D,!0)),this.__Q}get privateKey(){return this.__D}get identifier(){return rn.hash160(this.publicKey)}get fingerprint(){return this.identifier.slice(0,4)}isNeutered(){return this.__D===void 0}neutered(){return Qt(this.publicKey,this.chainCode,this.network,this.depth,this.index,this.parentFingerprint)}toBase58(){let t=this.network,r=this.isNeutered()?t.bip32.public:t.bip32.private,n=c.Buffer.allocUnsafe(78);return n.writeUInt32BE(r,0),n.writeUInt8(this.depth,4),n.writeUInt32BE(this.parentFingerprint,5),n.writeUInt32BE(this.index,9),this.chainCode.copy(n,13),this.isNeutered()?this.publicKey.copy(n,45):(n.writeUInt8(0,45),this.privateKey.copy(n,46)),Xs.encode(n)}toWIF(){if(!this.privateKey)throw new TypeError("Missing private key");return la.encode(this.network.wif,this.privateKey,!0)}derive(t){K(K.UInt32,t);let r=t>=Vs,n=c.Buffer.allocUnsafe(37);if(r){if(this.isNeutered())throw new TypeError("Missing private key for hardened child key");n[0]=0,this.privateKey.copy(n,1),n.writeUInt32BE(t,33)}else this.publicKey.copy(n,0),n.writeUInt32BE(t,33);let s=rn.hmacSHA512(this.chainCode,n),i=s.slice(0,32),o=s.slice(32);if(!re.isPrivate(i))return this.derive(t+1);let u;if(this.isNeutered()){let f=re.pointAddScalar(this.publicKey,i,!0);if(f===null)return this.derive(t+1);u=Qt(f,o,this.network,this.depth+1,t,this.fingerprint.readUInt32BE(0))}else{let f=re.privateAdd(this.privateKey,i);if(f==null)return this.derive(t+1);u=sn(f,o,this.network,this.depth+1,t,this.fingerprint.readUInt32BE(0))}return u}deriveHardened(t){return K(ga,t),this.derive(t+Vs)}derivePath(t){K(ya,t);let r=t.split("/");if(r[0]==="m"){if(this.parentFingerprint)throw new TypeError("Expected master, got child");r=r.slice(1)}return r.reduce((n,s)=>{let i;return s.slice(-1)==="'"?(i=parseInt(s.slice(0,-1),10),n.deriveHardened(i)):(i=parseInt(s,10),n.derive(i))},this)}sign(t,r){if(!this.privateKey)throw new Error("Missing private key");if(r===void 0&&(r=this.lowR),r===!1)return re.sign(t,this.privateKey);{let n=re.sign(t,this.privateKey),s=c.Buffer.alloc(32,0),i=0;for(;n[0]>127;)i++,s.writeUIntLE(i,0,6),n=re.signWithEntropy(t,this.privateKey,s);return n}}verify(t,r){return re.verify(t,this.publicKey,r)}};function _a(e,t){let r=Xs.decode(e);if(r.length!==78)throw new TypeError("Invalid buffer length");t=t||Jt;let n=r.readUInt32BE(0);if(n!==t.bip32.private&&n!==t.bip32.public)throw new TypeError("Invalid network version");let s=r[4],i=r.readUInt32BE(5);if(s===0&&i!==0)throw new TypeError("Invalid parent fingerprint");let o=r.readUInt32BE(9);if(s===0&&o!==0)throw new TypeError("Invalid index");let u=r.slice(13,45),f;if(n===t.bip32.private){if(r.readUInt8(45)!==0)throw new TypeError("Invalid private key");let l=r.slice(46,78);f=sn(l,u,t,s,o,i)}else{let l=r.slice(45,78);f=Qt(l,u,t,s,o,i)}return f}nt.fromBase58=_a;function $s(e,t,r){return sn(e,t,r)}nt.fromPrivateKey=$s;function sn(e,t,r,n,s,i){if(K({privateKey:nn,chainCode:nn},{privateKey:e,chainCode:t}),r=r||Jt,!re.isPrivate(e))throw new TypeError("Private key not in range [1, n)");return new zt(e,void 0,t,r,n,s,i)}function Sa(e,t,r){return Qt(e,t,r)}nt.fromPublicKey=Sa;function Qt(e,t,r,n,s,i){if(K({publicKey:K.BufferN(33),chainCode:nn},{publicKey:e,chainCode:t}),r=r||Jt,!re.isPoint(e))throw new TypeError("Point is not on the curve");return new zt(void 0,e,t,r,n,s,i)}function Ea(e,t){if(K(K.Buffer,e),e.length<16)throw new TypeError("Seed should be at least 128 bits");if(e.length>64)throw new TypeError("Seed should be at most 512 bits");t=t||Jt;let r=rn.hmacSHA512(c.Buffer.from("Bitcoin seed","utf8"),e),n=r.slice(0,32),s=r.slice(32);return $s(n,s,t)}nt.fromSeed=Ea});var zs=y(st=>{"use strict";a();p();Object.defineProperty(st,"__esModule",{value:!0});var Zt=Ys();st.fromSeed=Zt.fromSeed;st.fromBase58=Zt.fromBase58;st.fromPublicKey=Zt.fromPublicKey;st.fromPrivateKey=Zt.fromPrivateKey});var z=y(mt=>{"use strict";a();p();Object.defineProperty(mt,"__esModule",{value:!0});mt.bitcoin={messagePrefix:`Bitcoin Signed Message:
`,bech32:"bc",bip32:{public:76067358,private:76066276},pubKeyHash:0,scriptHash:5,wif:128};mt.regtest={messagePrefix:`Bitcoin Signed Message:
`,bech32:"bcrt",bip32:{public:70617039,private:70615956},pubKeyHash:111,scriptHash:196,wif:239};mt.testnet={messagePrefix:`Bitcoin Signed Message:
`,bech32:"tb",bip32:{public:70617039,private:70615956},pubKeyHash:111,scriptHash:196,wif:239}});var Qs=y(er=>{"use strict";a();p();Object.defineProperty(er,"__esModule",{value:!0});function ma(e,t,r){t=t||4,r=r===void 0?!0:r;let n=e.length;if(n===0)return 0;if(n>t)throw new TypeError("Script number overflow");if(r&&(e[n-1]&127)===0&&(n<=1||(e[n-2]&128)===0))throw new Error("Non-minimally encoded script number");if(n===5){let i=e.readUInt32LE(0),o=e.readUInt8(4);return o&128?-((o&-129)*4294967296+i):o*4294967296+i}let s=0;for(let i=0;i<n;++i)s|=e[i]<<8*i;return e[n-1]&128?-(s&~(128<<8*(n-1))):s}er.decode=ma;function Ta(e){return e>2147483647?5:e>8388607?4:e>32767?3:e>127?2:e>0?1:0}function ba(e){let t=Math.abs(e),r=Ta(t),n=c.Buffer.allocUnsafe(r),s=e<0;for(let i=0;i<r;++i)n.writeUInt8(t&255,i),t>>=8;return n[r-1]&128?n.writeUInt8(s?128:0,r-1):s&&(n[r-1]|=128),n}er.encode=ba});var ee=y(P=>{"use strict";a();p();Object.defineProperty(P,"__esModule",{value:!0});var E=H(),ka=Math.pow(2,31)-1;function Oa(e){return E.UInt32(e)&&e<=ka}P.UInt31=Oa;function Js(e){return E.String(e)&&!!e.match(/^(m\/)?(\d+'?\/)*\d+'?$/)}P.BIP32Path=Js;Js.toJSON=()=>"BIP32 derivation path";function Ia(e){return(E.Buffer(e.publicKey)||typeof e.getPublicKey=="function")&&typeof e.sign=="function"}P.Signer=Ia;var Pa=21*1e14;function va(e){return E.UInt53(e)&&e<=Pa}P.Satoshi=va;P.ECPoint=E.quacksLike("Point");P.Network=E.compile({messagePrefix:E.oneOf(E.Buffer,E.String),bip32:{public:E.UInt32,private:E.UInt32},pubKeyHash:E.UInt8,scriptHash:E.UInt8,wif:E.UInt8});P.Buffer256bit=E.BufferN(32);P.Hash160bit=E.BufferN(20);P.Hash256bit=E.BufferN(32);P.Number=E.Number;P.Array=E.Array;P.Boolean=E.Boolean;P.String=E.String;P.Buffer=E.Buffer;P.Hex=E.Hex;P.maybe=E.maybe;P.tuple=E.tuple;P.UInt8=E.UInt8;P.UInt32=E.UInt32;P.Function=E.Function;P.BufferN=E.BufferN;P.Null=E.Null;P.oneOf=E.oneOf});var si=y(tr=>{"use strict";a();p();Object.defineProperty(tr,"__esModule",{value:!0});var Zs=ee(),ni=Bs(),Aa=H(),ei=c.Buffer.alloc(1,0);function ti(e){let t=0;for(;e[t]===0;)++t;return t===e.length?ei:(e=e.slice(t),e[0]&128?c.Buffer.concat([ei,e],1+e.length):e)}function ri(e){e[0]===0&&(e=e.slice(1));let t=c.Buffer.alloc(32,0),r=Math.max(0,32-e.length);return e.copy(t,r),t}function Na(e){let t=e.readUInt8(e.length-1),r=t&-129;if(r<=0||r>=4)throw new Error("Invalid hashType "+t);let n=ni.decode(e.slice(0,-1)),s=ri(n.r),i=ri(n.s);return{signature:c.Buffer.concat([s,i],64),hashType:t}}tr.decode=Na;function Ua(e,t){Aa({signature:Zs.BufferN(64),hashType:Zs.UInt8},{signature:e,hashType:t});let r=t&-129;if(r<=0||r>=4)throw new Error("Invalid hashType "+t);let n=c.Buffer.allocUnsafe(1);n.writeUInt8(t,0);let s=ti(e.slice(0,32)),i=ti(e.slice(32,64));return c.Buffer.concat([ni.encode(s,i),n])}tr.encode=Ua});var rr=y((Yd,Ha)=>{Ha.exports={OP_FALSE:0,OP_0:0,OP_PUSHDATA1:76,OP_PUSHDATA2:77,OP_PUSHDATA4:78,OP_1NEGATE:79,OP_RESERVED:80,OP_TRUE:81,OP_1:81,OP_2:82,OP_3:83,OP_4:84,OP_5:85,OP_6:86,OP_7:87,OP_8:88,OP_9:89,OP_10:90,OP_11:91,OP_12:92,OP_13:93,OP_14:94,OP_15:95,OP_16:96,OP_NOP:97,OP_VER:98,OP_IF:99,OP_NOTIF:100,OP_VERIF:101,OP_VERNOTIF:102,OP_ELSE:103,OP_ENDIF:104,OP_VERIFY:105,OP_RETURN:106,OP_TOALTSTACK:107,OP_FROMALTSTACK:108,OP_2DROP:109,OP_2DUP:110,OP_3DUP:111,OP_2OVER:112,OP_2ROT:113,OP_2SWAP:114,OP_IFDUP:115,OP_DEPTH:116,OP_DROP:117,OP_DUP:118,OP_NIP:119,OP_OVER:120,OP_PICK:121,OP_ROLL:122,OP_ROT:123,OP_SWAP:124,OP_TUCK:125,OP_CAT:126,OP_SUBSTR:127,OP_LEFT:128,OP_RIGHT:129,OP_SIZE:130,OP_INVERT:131,OP_AND:132,OP_OR:133,OP_XOR:134,OP_EQUAL:135,OP_EQUALVERIFY:136,OP_RESERVED1:137,OP_RESERVED2:138,OP_1ADD:139,OP_1SUB:140,OP_2MUL:141,OP_2DIV:142,OP_NEGATE:143,OP_ABS:144,OP_NOT:145,OP_0NOTEQUAL:146,OP_ADD:147,OP_SUB:148,OP_MUL:149,OP_DIV:150,OP_MOD:151,OP_LSHIFT:152,OP_RSHIFT:153,OP_BOOLAND:154,OP_BOOLOR:155,OP_NUMEQUAL:156,OP_NUMEQUALVERIFY:157,OP_NUMNOTEQUAL:158,OP_LESSTHAN:159,OP_GREATERTHAN:160,OP_LESSTHANOREQUAL:161,OP_GREATERTHANOREQUAL:162,OP_MIN:163,OP_MAX:164,OP_WITHIN:165,OP_RIPEMD160:166,OP_SHA1:167,OP_SHA256:168,OP_HASH160:169,OP_HASH256:170,OP_CODESEPARATOR:171,OP_CHECKSIG:172,OP_CHECKSIGVERIFY:173,OP_CHECKMULTISIG:174,OP_CHECKMULTISIGVERIFY:175,OP_NOP1:176,OP_NOP2:177,OP_CHECKLOCKTIMEVERIFY:177,OP_NOP3:178,OP_CHECKSEQUENCEVERIFY:178,OP_NOP4:179,OP_NOP5:180,OP_NOP6:181,OP_NOP7:182,OP_NOP8:183,OP_NOP9:184,OP_NOP10:185,OP_PUBKEYHASH:253,OP_PUBKEY:254,OP_INVALIDOPCODE:255}});var ui=y((zd,oi)=>{a();p();var Ee=rr();function ii(e){return e<Ee.OP_PUSHDATA1?1:e<=255?2:e<=65535?3:5}function xa(e,t,r){var n=ii(t);return n===1?e.writeUInt8(t,r):n===2?(e.writeUInt8(Ee.OP_PUSHDATA1,r),e.writeUInt8(t,r+1)):n===3?(e.writeUInt8(Ee.OP_PUSHDATA2,r),e.writeUInt16LE(t,r+1)):(e.writeUInt8(Ee.OP_PUSHDATA4,r),e.writeUInt32LE(t,r+1)),n}function qa(e,t){var r=e.readUInt8(t),n,s;if(r<Ee.OP_PUSHDATA1)n=r,s=1;else if(r===Ee.OP_PUSHDATA1){if(t+2>e.length)return null;n=e.readUInt8(t+1),s=2}else if(r===Ee.OP_PUSHDATA2){if(t+3>e.length)return null;n=e.readUInt16LE(t+1),s=3}else{if(t+5>e.length)return null;if(r!==Ee.OP_PUSHDATA4)throw new Error("Unexpected opcode");n=e.readUInt32LE(t+1),s=5}return{opcode:r,number:n,size:s}}oi.exports={encodingLength:ii,encode:xa,decode:qa}});var hi=y((Zd,fi)=>{a();p();var ci=rr(),pi={};for(on in ci)ai=ci[on],pi[ai]=on;var ai,on;fi.exports=pi});var S=y(I=>{"use strict";a();p();Object.defineProperty(I,"__esModule",{value:!0});var li=Qs(),Ca=si(),me=ee(),Ba=Bs(),Ra=oe(),un=ui(),Tt=H();I.OPS=rr();var Ka=hi(),di=I.OPS.OP_RESERVED;function La(e){return me.Number(e)&&(e===I.OPS.OP_0||e>=I.OPS.OP_1&&e<=I.OPS.OP_16||e===I.OPS.OP_1NEGATE)}function Ma(e){return me.Buffer(e)||La(e)}function wi(e){return me.Array(e)&&e.every(Ma)}I.isPushOnly=wi;function nr(e){if(e.length===0)return I.OPS.OP_0;if(e.length===1){if(e[0]>=1&&e[0]<=16)return di+e[0];if(e[0]===129)return I.OPS.OP_1NEGATE}}function yi(e){return c.Buffer.isBuffer(e)}function Wa(e){return me.Array(e)}function sr(e){return c.Buffer.isBuffer(e)}function gi(e){if(yi(e))return e;Tt(me.Array,e);let t=e.reduce((s,i)=>sr(i)?i.length===1&&nr(i)!==void 0?s+1:s+un.encodingLength(i.length)+i.length:s+1,0),r=c.Buffer.allocUnsafe(t),n=0;if(e.forEach(s=>{if(sr(s)){let i=nr(s);if(i!==void 0){r.writeUInt8(i,n),n+=1;return}n+=un.encode(r,s.length,n),s.copy(r,n),n+=s.length}else r.writeUInt8(s,n),n+=1}),n!==r.length)throw new Error("Could not decode chunks");return r}I.compile=gi;function cn(e){if(Wa(e))return e;Tt(me.Buffer,e);let t=[],r=0;for(;r<e.length;){let n=e[r];if(n>I.OPS.OP_0&&n<=I.OPS.OP_PUSHDATA4){let s=un.decode(e,r);if(s===null||(r+=s.size,r+s.number>e.length))return null;let i=e.slice(r,r+s.number);r+=s.number;let o=nr(i);o!==void 0?t.push(o):t.push(i)}else t.push(n),r+=1}return t}I.decompile=cn;function Fa(e){return yi(e)&&(e=cn(e)),e.map(t=>{if(sr(t)){let r=nr(t);if(r===void 0)return t.toString("hex");t=r}return Ka[t]}).join(" ")}I.toASM=Fa;function Da(e){return Tt(me.String,e),gi(e.split(" ").map(t=>I.OPS[t]!==void 0?I.OPS[t]:(Tt(me.Hex,t),c.Buffer.from(t,"hex"))))}I.fromASM=Da;function Ga(e){return e=cn(e),Tt(wi,e),e.map(t=>sr(t)?t:t===I.OPS.OP_0?c.Buffer.allocUnsafe(0):li.encode(t-di))}I.toStack=Ga;function ja(e){return Ra.isPoint(e)}I.isCanonicalPubKey=ja;function _i(e){let t=e&-129;return t>0&&t<4}I.isDefinedHashType=_i;function Va(e){return!c.Buffer.isBuffer(e)||!_i(e[e.length-1])?!1:Ba.check(e.slice(0,-1))}I.isCanonicalScriptSignature=Va;I.number=li;I.signature=Ca});var Te=y(ir=>{"use strict";a();p();Object.defineProperty(ir,"__esModule",{value:!0});function Xa(e,t,r){Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get(){let n=r.call(this);return this[t]=n,n},set(n){Object.defineProperty(this,t,{configurable:!0,enumerable:!0,value:n,writable:!0})}})}ir.prop=Xa;function $a(e){let t;return()=>(t!==void 0||(t=e()),t)}ir.value=$a});var mi=y(an=>{"use strict";a();p();Object.defineProperty(an,"__esModule",{value:!0});var Ya=z(),or=S(),Si=Te(),ue=H(),Ei=or.OPS;function za(e,t){return e.length!==t.length?!1:e.every((r,n)=>r.equals(t[n]))}function Qa(e,t){if(!e.data&&!e.output)throw new TypeError("Not enough data");t=Object.assign({validate:!0},t||{}),ue({network:ue.maybe(ue.Object),output:ue.maybe(ue.Buffer),data:ue.maybe(ue.arrayOf(ue.Buffer))},e);let r=e.network||Ya.bitcoin,n={name:"embed",network:r};if(Si.prop(n,"output",()=>{if(!!e.data)return or.compile([Ei.OP_RETURN].concat(e.data))}),Si.prop(n,"data",()=>{if(!!e.output)return or.decompile(e.output).slice(1)}),t.validate&&e.output){let s=or.decompile(e.output);if(s[0]!==Ei.OP_RETURN)throw new TypeError("Output is invalid");if(!s.slice(1).every(ue.Buffer))throw new TypeError("Output is invalid");if(e.data&&!za(e.data,n.data))throw new TypeError("Data mismatch")}return Object.assign(n,e)}an.p2data=Qa});var ki=y(pn=>{"use strict";a();p();Object.defineProperty(pn,"__esModule",{value:!0});var Ja=z(),it=S(),be=Te(),ot=it.OPS,L=H(),Ti=oe(),ur=ot.OP_RESERVED;function bi(e,t){return e.length!==t.length?!1:e.every((r,n)=>r.equals(t[n]))}function Za(e,t){if(!e.input&&!e.output&&!(e.pubkeys&&e.m!==void 0)&&!e.signatures)throw new TypeError("Not enough data");t=Object.assign({validate:!0},t||{});function r(f){return it.isCanonicalScriptSignature(f)||(t.allowIncomplete&&f===ot.OP_0)!==void 0}L({network:L.maybe(L.Object),m:L.maybe(L.Number),n:L.maybe(L.Number),output:L.maybe(L.Buffer),pubkeys:L.maybe(L.arrayOf(Ti.isPoint)),signatures:L.maybe(L.arrayOf(r)),input:L.maybe(L.Buffer)},e);let s={network:e.network||Ja.bitcoin},i=[],o=!1;function u(f){o||(o=!0,i=it.decompile(f),s.m=i[0]-ur,s.n=i[i.length-2]-ur,s.pubkeys=i.slice(1,-2))}if(be.prop(s,"output",()=>{if(!!e.m&&!!s.n&&!!e.pubkeys)return it.compile([].concat(ur+e.m,e.pubkeys,ur+s.n,ot.OP_CHECKMULTISIG))}),be.prop(s,"m",()=>{if(!!s.output)return u(s.output),s.m}),be.prop(s,"n",()=>{if(!!s.pubkeys)return s.pubkeys.length}),be.prop(s,"pubkeys",()=>{if(!!e.output)return u(e.output),s.pubkeys}),be.prop(s,"signatures",()=>{if(!!e.input)return it.decompile(e.input).slice(1)}),be.prop(s,"input",()=>{if(!!e.signatures)return it.compile([ot.OP_0].concat(e.signatures))}),be.prop(s,"witness",()=>{if(!!s.input)return[]}),be.prop(s,"name",()=>{if(!(!s.m||!s.n))return`p2ms(${s.m} of ${s.n})`}),t.validate){if(e.output){if(u(e.output),!L.Number(i[0]))throw new TypeError("Output is invalid");if(!L.Number(i[i.length-2]))throw new TypeError("Output is invalid");if(i[i.length-1]!==ot.OP_CHECKMULTISIG)throw new TypeError("Output is invalid");if(s.m<=0||s.n>16||s.m>s.n||s.n!==i.length-3)throw new TypeError("Output is invalid");if(!s.pubkeys.every(f=>Ti.isPoint(f)))throw new TypeError("Output is invalid");if(e.m!==void 0&&e.m!==s.m)throw new TypeError("m mismatch");if(e.n!==void 0&&e.n!==s.n)throw new TypeError("n mismatch");if(e.pubkeys&&!bi(e.pubkeys,s.pubkeys))throw new TypeError("Pubkeys mismatch")}if(e.pubkeys){if(e.n!==void 0&&e.n!==e.pubkeys.length)throw new TypeError("Pubkey count mismatch");if(s.n=e.pubkeys.length,s.n<s.m)throw new TypeError("Pubkey count cannot be less than m")}if(e.signatures){if(e.signatures.length<s.m)throw new TypeError("Not enough signatures provided");if(e.signatures.length>s.m)throw new TypeError("Too many signatures provided")}if(e.input){if(e.input[0]!==ot.OP_0)throw new TypeError("Input is invalid");if(s.signatures.length===0||!s.signatures.every(r))throw new TypeError("Input has invalid signature(s)");if(e.signatures&&!bi(e.signatures,s.signatures))throw new TypeError("Signature mismatch");if(e.m!==void 0&&e.m!==e.signatures.length)throw new TypeError("Signature count mismatch")}}return Object.assign(s,e)}pn.p2ms=Za});var Pi=y(fn=>{"use strict";a();p();Object.defineProperty(fn,"__esModule",{value:!0});var ep=z(),ct=S(),ut=Te(),ce=H(),Oi=ct.OPS,Ii=oe();function tp(e,t){if(!e.input&&!e.output&&!e.pubkey&&!e.input&&!e.signature)throw new TypeError("Not enough data");t=Object.assign({validate:!0},t||{}),ce({network:ce.maybe(ce.Object),output:ce.maybe(ce.Buffer),pubkey:ce.maybe(Ii.isPoint),signature:ce.maybe(ct.isCanonicalScriptSignature),input:ce.maybe(ce.Buffer)},e);let r=ut.value(()=>ct.decompile(e.input)),n=e.network||ep.bitcoin,s={name:"p2pk",network:n};if(ut.prop(s,"output",()=>{if(!!e.pubkey)return ct.compile([e.pubkey,Oi.OP_CHECKSIG])}),ut.prop(s,"pubkey",()=>{if(!!e.output)return e.output.slice(1,-1)}),ut.prop(s,"signature",()=>{if(!!e.input)return r()[0]}),ut.prop(s,"input",()=>{if(!!e.signature)return ct.compile([e.signature])}),ut.prop(s,"witness",()=>{if(!!s.input)return[]}),t.validate){if(e.output){if(e.output[e.output.length-1]!==Oi.OP_CHECKSIG)throw new TypeError("Output is invalid");if(!Ii.isPoint(s.pubkey))throw new TypeError("Output pubkey is invalid");if(e.pubkey&&!e.pubkey.equals(s.pubkey))throw new TypeError("Pubkey mismatch")}if(e.signature&&e.input&&!e.input.equals(s.input))throw new TypeError("Signature mismatch");if(e.input){if(r().length!==1)throw new TypeError("Input is invalid");if(!ct.isCanonicalScriptSignature(s.signature))throw new TypeError("Input has invalid signature")}}return Object.assign(s,e)}fn.p2pk=tp});var ne=y(Be=>{"use strict";a();p();Object.defineProperty(Be,"__esModule",{value:!0});var cr=xs();function vi(e){try{return cr("rmd160").update(e).digest()}catch{return cr("ripemd160").update(e).digest()}}Be.ripemd160=vi;function rp(e){return cr("sha1").update(e).digest()}Be.sha1=rp;function ar(e){return cr("sha256").update(e).digest()}Be.sha256=ar;function np(e){return vi(ar(e))}Be.hash160=np;function sp(e){return ar(ar(e))}Be.hash256=sp});var Ui=y(ln=>{"use strict";a();p();Object.defineProperty(ln,"__esModule",{value:!0});var hn=ne(),ip=z(),at=S(),ae=Te(),Q=H(),ke=at.OPS,Ai=oe(),Ni=Mt();function op(e,t){if(!e.address&&!e.hash&&!e.output&&!e.pubkey&&!e.input)throw new TypeError("Not enough data");t=Object.assign({validate:!0},t||{}),Q({network:Q.maybe(Q.Object),address:Q.maybe(Q.String),hash:Q.maybe(Q.BufferN(20)),output:Q.maybe(Q.BufferN(25)),pubkey:Q.maybe(Ai.isPoint),signature:Q.maybe(at.isCanonicalScriptSignature),input:Q.maybe(Q.Buffer)},e);let r=ae.value(()=>{let o=Ni.decode(e.address),u=o.readUInt8(0),f=o.slice(1);return{version:u,hash:f}}),n=ae.value(()=>at.decompile(e.input)),s=e.network||ip.bitcoin,i={name:"p2pkh",network:s};if(ae.prop(i,"address",()=>{if(!i.hash)return;let o=c.Buffer.allocUnsafe(21);return o.writeUInt8(s.pubKeyHash,0),i.hash.copy(o,1),Ni.encode(o)}),ae.prop(i,"hash",()=>{if(e.output)return e.output.slice(3,23);if(e.address)return r().hash;if(e.pubkey||i.pubkey)return hn.hash160(e.pubkey||i.pubkey)}),ae.prop(i,"output",()=>{if(!!i.hash)return at.compile([ke.OP_DUP,ke.OP_HASH160,i.hash,ke.OP_EQUALVERIFY,ke.OP_CHECKSIG])}),ae.prop(i,"pubkey",()=>{if(!!e.input)return n()[1]}),ae.prop(i,"signature",()=>{if(!!e.input)return n()[0]}),ae.prop(i,"input",()=>{if(!!e.pubkey&&!!e.signature)return at.compile([e.signature,e.pubkey])}),ae.prop(i,"witness",()=>{if(!!i.input)return[]}),t.validate){let o=c.Buffer.from([]);if(e.address){if(r().version!==s.pubKeyHash)throw new TypeError("Invalid version or Network mismatch");if(r().hash.length!==20)throw new TypeError("Invalid address");o=r().hash}if(e.hash){if(o.length>0&&!o.equals(e.hash))throw new TypeError("Hash mismatch");o=e.hash}if(e.output){if(e.output.length!==25||e.output[0]!==ke.OP_DUP||e.output[1]!==ke.OP_HASH160||e.output[2]!==20||e.output[23]!==ke.OP_EQUALVERIFY||e.output[24]!==ke.OP_CHECKSIG)throw new TypeError("Output is invalid");let u=e.output.slice(3,23);if(o.length>0&&!o.equals(u))throw new TypeError("Hash mismatch");o=u}if(e.pubkey){let u=hn.hash160(e.pubkey);if(o.length>0&&!o.equals(u))throw new TypeError("Hash mismatch");o=u}if(e.input){let u=n();if(u.length!==2)throw new TypeError("Input is invalid");if(!at.isCanonicalScriptSignature(u[0]))throw new TypeError("Input has invalid signature");if(!Ai.isPoint(u[1]))throw new TypeError("Input has invalid pubkey");if(e.signature&&!e.signature.equals(u[0]))throw new TypeError("Signature mismatch");if(e.pubkey&&!e.pubkey.equals(u[1]))throw new TypeError("Pubkey mismatch");let f=hn.hash160(u[1]);if(o.length>0&&!o.equals(f))throw new TypeError("Hash mismatch")}}return Object.assign(i,e)}ln.p2pkh=op});var qi=y(dn=>{"use strict";a();p();Object.defineProperty(dn,"__esModule",{value:!0});var Hi=ne(),up=z(),pe=S(),se=Te(),A=H(),pr=pe.OPS,xi=Mt();function cp(e,t){return e.length!==t.length?!1:e.every((r,n)=>r.equals(t[n]))}function ap(e,t){if(!e.address&&!e.hash&&!e.output&&!e.redeem&&!e.input)throw new TypeError("Not enough data");t=Object.assign({validate:!0},t||{}),A({network:A.maybe(A.Object),address:A.maybe(A.String),hash:A.maybe(A.BufferN(20)),output:A.maybe(A.BufferN(23)),redeem:A.maybe({network:A.maybe(A.Object),output:A.maybe(A.Buffer),input:A.maybe(A.Buffer),witness:A.maybe(A.arrayOf(A.Buffer))}),input:A.maybe(A.Buffer),witness:A.maybe(A.arrayOf(A.Buffer))},e);let r=e.network;r||(r=e.redeem&&e.redeem.network||up.bitcoin);let n={network:r},s=se.value(()=>{let u=xi.decode(e.address),f=u.readUInt8(0),l=u.slice(1);return{version:f,hash:l}}),i=se.value(()=>pe.decompile(e.input)),o=se.value(()=>{let u=i();return{network:r,output:u[u.length-1],input:pe.compile(u.slice(0,-1)),witness:e.witness||[]}});if(se.prop(n,"address",()=>{if(!n.hash)return;let u=c.Buffer.allocUnsafe(21);return u.writeUInt8(n.network.scriptHash,0),n.hash.copy(u,1),xi.encode(u)}),se.prop(n,"hash",()=>{if(e.output)return e.output.slice(2,22);if(e.address)return s().hash;if(n.redeem&&n.redeem.output)return Hi.hash160(n.redeem.output)}),se.prop(n,"output",()=>{if(!!n.hash)return pe.compile([pr.OP_HASH160,n.hash,pr.OP_EQUAL])}),se.prop(n,"redeem",()=>{if(!!e.input)return o()}),se.prop(n,"input",()=>{if(!(!e.redeem||!e.redeem.input||!e.redeem.output))return pe.compile([].concat(pe.decompile(e.redeem.input),e.redeem.output))}),se.prop(n,"witness",()=>{if(n.redeem&&n.redeem.witness)return n.redeem.witness;if(n.input)return[]}),se.prop(n,"name",()=>{let u=["p2sh"];return n.redeem!==void 0&&u.push(n.redeem.name),u.join("-")}),t.validate){let u=c.Buffer.from([]);if(e.address){if(s().version!==r.scriptHash)throw new TypeError("Invalid version or Network mismatch");if(s().hash.length!==20)throw new TypeError("Invalid address");u=s().hash}if(e.hash){if(u.length>0&&!u.equals(e.hash))throw new TypeError("Hash mismatch");u=e.hash}if(e.output){if(e.output.length!==23||e.output[0]!==pr.OP_HASH160||e.output[1]!==20||e.output[22]!==pr.OP_EQUAL)throw new TypeError("Output is invalid");let l=e.output.slice(2,22);if(u.length>0&&!u.equals(l))throw new TypeError("Hash mismatch");u=l}let f=l=>{if(l.output){let d=pe.decompile(l.output);if(!d||d.length<1)throw new TypeError("Redeem.output too short");let h=Hi.hash160(l.output);if(u.length>0&&!u.equals(h))throw new TypeError("Hash mismatch");u=h}if(l.input){let d=l.input.length>0,h=l.witness&&l.witness.length>0;if(!d&&!h)throw new TypeError("Empty input");if(d&&h)throw new TypeError("Input and witness provided");if(d){let w=pe.decompile(l.input);if(!pe.isPushOnly(w))throw new TypeError("Non push-only scriptSig")}}};if(e.input){let l=i();if(!l||l.length<1)throw new TypeError("Input too short");if(!c.Buffer.isBuffer(o().output))throw new TypeError("Input is invalid");f(o())}if(e.redeem){if(e.redeem.network&&e.redeem.network!==r)throw new TypeError("Network mismatch");if(e.input){let l=o();if(e.redeem.output&&!e.redeem.output.equals(l.output))throw new TypeError("Redeem.output mismatch");if(e.redeem.input&&!e.redeem.input.equals(l.input))throw new TypeError("Redeem.input mismatch")}f(e.redeem)}if(e.witness&&e.redeem&&e.redeem.witness&&!cp(e.redeem.witness,e.witness))throw new TypeError("Witness and redeem.witness mismatch")}return Object.assign(n,e)}dn.p2sh=ap});var lr=y((Iw,Ri)=>{"use strict";a();p();var hr="qpzry9x8gf2tvdw0s3jn54khce6mua7l",wn={};for(bt=0;bt<hr.length;bt++){if(fr=hr.charAt(bt),wn[fr]!==void 0)throw new TypeError(fr+" is ambiguous");wn[fr]=bt}var fr,bt;function pt(e){var t=e>>25;return(e&33554431)<<5^-(t>>0&1)&996825010^-(t>>1&1)&642813549^-(t>>2&1)&513874426^-(t>>3&1)&1027748829^-(t>>4&1)&705979059}function Ci(e){for(var t=1,r=0;r<e.length;++r){var n=e.charCodeAt(r);if(n<33||n>126)throw new Error("Invalid prefix ("+e+")");t=pt(t)^n>>5}for(t=pt(t),r=0;r<e.length;++r){var s=e.charCodeAt(r);t=pt(t)^s&31}return t}function pp(e,t,r){if(r=r||90,e.length+7+t.length>r)throw new TypeError("Exceeds length limit");e=e.toLowerCase();for(var n=Ci(e),s=e+"1",i=0;i<t.length;++i){var o=t[i];if(o>>5!==0)throw new Error("Non 5-bit word");n=pt(n)^o,s+=hr.charAt(o)}for(i=0;i<6;++i)n=pt(n);for(n^=1,i=0;i<6;++i){var u=n>>(5-i)*5&31;s+=hr.charAt(u)}return s}function fp(e,t){if(t=t||90,e.length<8)throw new TypeError(e+" too short");if(e.length>t)throw new TypeError("Exceeds length limit");var r=e.toLowerCase(),n=e.toUpperCase();if(e!==r&&e!==n)throw new Error("Mixed-case string "+e);e=r;var s=e.lastIndexOf("1");if(s===-1)throw new Error("No separator character for "+e);if(s===0)throw new Error("Missing prefix for "+e);var i=e.slice(0,s),o=e.slice(s+1);if(o.length<6)throw new Error("Data too short");for(var u=Ci(i),f=[],l=0;l<o.length;++l){var d=o.charAt(l),h=wn[d];if(h===void 0)throw new Error("Unknown character "+d);u=pt(u)^h,!(l+6>=o.length)&&f.push(h)}if(u!==1)throw new Error("Invalid checksum for "+e);return{prefix:i,words:f}}function Bi(e,t,r,n){for(var s=0,i=0,o=(1<<r)-1,u=[],f=0;f<e.length;++f)for(s=s<<t|e[f],i+=t;i>=r;)i-=r,u.push(s>>i&o);if(n)i>0&&u.push(s<<r-i&o);else{if(i>=t)throw new Error("Excess padding");if(s<<r-i&o)throw new Error("Non-zero padding")}return u}function hp(e){return Bi(e,8,5,!0)}function lp(e){return Bi(e,5,8,!1)}Ri.exports={decode:fp,encode:pp,toWords:hp,fromWords:lp}});var Li=y(_n=>{"use strict";a();p();Object.defineProperty(_n,"__esModule",{value:!0});var yn=ne(),dp=z(),wr=S(),Oe=Te(),D=H(),Ki=wr.OPS,gn=oe(),dr=lr(),wp=c.Buffer.alloc(0);function yp(e,t){if(!e.address&&!e.hash&&!e.output&&!e.pubkey&&!e.witness)throw new TypeError("Not enough data");t=Object.assign({validate:!0},t||{}),D({address:D.maybe(D.String),hash:D.maybe(D.BufferN(20)),input:D.maybe(D.BufferN(0)),network:D.maybe(D.Object),output:D.maybe(D.BufferN(22)),pubkey:D.maybe(gn.isPoint),signature:D.maybe(wr.isCanonicalScriptSignature),witness:D.maybe(D.arrayOf(D.Buffer))},e);let r=Oe.value(()=>{let i=dr.decode(e.address),o=i.words.shift(),u=dr.fromWords(i.words);return{version:o,prefix:i.prefix,data:c.Buffer.from(u)}}),n=e.network||dp.bitcoin,s={name:"p2wpkh",network:n};if(Oe.prop(s,"address",()=>{if(!s.hash)return;let i=dr.toWords(s.hash);return i.unshift(0),dr.encode(n.bech32,i)}),Oe.prop(s,"hash",()=>{if(e.output)return e.output.slice(2,22);if(e.address)return r().data;if(e.pubkey||s.pubkey)return yn.hash160(e.pubkey||s.pubkey)}),Oe.prop(s,"output",()=>{if(!!s.hash)return wr.compile([Ki.OP_0,s.hash])}),Oe.prop(s,"pubkey",()=>{if(e.pubkey)return e.pubkey;if(!!e.witness)return e.witness[1]}),Oe.prop(s,"signature",()=>{if(!!e.witness)return e.witness[0]}),Oe.prop(s,"input",()=>{if(!!s.witness)return wp}),Oe.prop(s,"witness",()=>{if(!!e.pubkey&&!!e.signature)return[e.signature,e.pubkey]}),t.validate){let i=c.Buffer.from([]);if(e.address){if(n&&n.bech32!==r().prefix)throw new TypeError("Invalid prefix or Network mismatch");if(r().version!==0)throw new TypeError("Invalid address version");if(r().data.length!==20)throw new TypeError("Invalid address data");i=r().data}if(e.hash){if(i.length>0&&!i.equals(e.hash))throw new TypeError("Hash mismatch");i=e.hash}if(e.output){if(e.output.length!==22||e.output[0]!==Ki.OP_0||e.output[1]!==20)throw new TypeError("Output is invalid");if(i.length>0&&!i.equals(e.output.slice(2)))throw new TypeError("Hash mismatch");i=e.output.slice(2)}if(e.pubkey){let o=yn.hash160(e.pubkey);if(i.length>0&&!i.equals(o))throw new TypeError("Hash mismatch");if(i=o,!gn.isPoint(e.pubkey)||e.pubkey.length!==33)throw new TypeError("Invalid pubkey for p2wpkh")}if(e.witness){if(e.witness.length!==2)throw new TypeError("Witness is invalid");if(!wr.isCanonicalScriptSignature(e.witness[0]))throw new TypeError("Witness has invalid signature");if(!gn.isPoint(e.witness[1])||e.witness[1].length!==33)throw new TypeError("Witness has invalid pubkey");if(e.signature&&!e.signature.equals(e.witness[0]))throw new TypeError("Signature mismatch");if(e.pubkey&&!e.pubkey.equals(e.witness[1]))throw new TypeError("Pubkey mismatch");let o=yn.hash160(e.witness[1]);if(i.length>0&&!i.equals(o))throw new TypeError("Hash mismatch")}}return Object.assign(s,e)}_n.p2wpkh=yp});var Fi=y(En=>{"use strict";a();p();Object.defineProperty(En,"__esModule",{value:!0});var Mi=ne(),gp=z(),Ie=S(),fe=Te(),N=H(),Wi=Ie.OPS,_p=oe(),yr=lr(),Sn=c.Buffer.alloc(0);function Sp(e,t){return e.length!==t.length?!1:e.every((r,n)=>r.equals(t[n]))}function gr(e){return!!(c.Buffer.isBuffer(e)&&e.length===65&&e[0]===4&&_p.isPoint(e))}function Ep(e,t){if(!e.address&&!e.hash&&!e.output&&!e.redeem&&!e.witness)throw new TypeError("Not enough data");t=Object.assign({validate:!0},t||{}),N({network:N.maybe(N.Object),address:N.maybe(N.String),hash:N.maybe(N.BufferN(32)),output:N.maybe(N.BufferN(34)),redeem:N.maybe({input:N.maybe(N.Buffer),network:N.maybe(N.Object),output:N.maybe(N.Buffer),witness:N.maybe(N.arrayOf(N.Buffer))}),input:N.maybe(N.BufferN(0)),witness:N.maybe(N.arrayOf(N.Buffer))},e);let r=fe.value(()=>{let o=yr.decode(e.address),u=o.words.shift(),f=yr.fromWords(o.words);return{version:u,prefix:o.prefix,data:c.Buffer.from(f)}}),n=fe.value(()=>Ie.decompile(e.redeem.input)),s=e.network;s||(s=e.redeem&&e.redeem.network||gp.bitcoin);let i={network:s};if(fe.prop(i,"address",()=>{if(!i.hash)return;let o=yr.toWords(i.hash);return o.unshift(0),yr.encode(s.bech32,o)}),fe.prop(i,"hash",()=>{if(e.output)return e.output.slice(2);if(e.address)return r().data;if(i.redeem&&i.redeem.output)return Mi.sha256(i.redeem.output)}),fe.prop(i,"output",()=>{if(!!i.hash)return Ie.compile([Wi.OP_0,i.hash])}),fe.prop(i,"redeem",()=>{if(!!e.witness)return{output:e.witness[e.witness.length-1],input:Sn,witness:e.witness.slice(0,-1)}}),fe.prop(i,"input",()=>{if(!!i.witness)return Sn}),fe.prop(i,"witness",()=>{if(e.redeem&&e.redeem.input&&e.redeem.input.length>0&&e.redeem.output&&e.redeem.output.length>0){let o=Ie.toStack(n());return i.redeem=Object.assign({witness:o},e.redeem),i.redeem.input=Sn,[].concat(o,e.redeem.output)}if(!!e.redeem&&!!e.redeem.output&&!!e.redeem.witness)return[].concat(e.redeem.witness,e.redeem.output)}),fe.prop(i,"name",()=>{let o=["p2wsh"];return i.redeem!==void 0&&o.push(i.redeem.name),o.join("-")}),t.validate){let o=c.Buffer.from([]);if(e.address){if(r().prefix!==s.bech32)throw new TypeError("Invalid prefix or Network mismatch");if(r().version!==0)throw new TypeError("Invalid address version");if(r().data.length!==32)throw new TypeError("Invalid address data");o=r().data}if(e.hash){if(o.length>0&&!o.equals(e.hash))throw new TypeError("Hash mismatch");o=e.hash}if(e.output){if(e.output.length!==34||e.output[0]!==Wi.OP_0||e.output[1]!==32)throw new TypeError("Output is invalid");let u=e.output.slice(2);if(o.length>0&&!o.equals(u))throw new TypeError("Hash mismatch");o=u}if(e.redeem){if(e.redeem.network&&e.redeem.network!==s)throw new TypeError("Network mismatch");if(e.redeem.input&&e.redeem.input.length>0&&e.redeem.witness&&e.redeem.witness.length>0)throw new TypeError("Ambiguous witness source");if(e.redeem.output){if(Ie.decompile(e.redeem.output).length===0)throw new TypeError("Redeem.output is invalid");let u=Mi.sha256(e.redeem.output);if(o.length>0&&!o.equals(u))throw new TypeError("Hash mismatch");o=u}if(e.redeem.input&&!Ie.isPushOnly(n()))throw new TypeError("Non push-only scriptSig");if(e.witness&&e.redeem.witness&&!Sp(e.witness,e.redeem.witness))throw new TypeError("Witness and redeem.witness mismatch");if(e.redeem.input&&n().some(gr)||e.redeem.output&&(Ie.decompile(e.redeem.output)||[]).some(gr))throw new TypeError("redeem.input or redeem.output contains uncompressed pubkey")}if(e.witness&&e.witness.length>0){let u=e.witness[e.witness.length-1];if(e.redeem&&e.redeem.output&&!e.redeem.output.equals(u))throw new TypeError("Witness and redeem.output mismatch");if(e.witness.some(gr)||(Ie.decompile(u)||[]).some(gr))throw new TypeError("Witness contains uncompressed pubkey")}}return Object.assign(i,e)}En.p2wsh=Ep});var kt=y(he=>{"use strict";a();p();Object.defineProperty(he,"__esModule",{value:!0});var mp=mi();he.embed=mp.p2data;var Tp=ki();he.p2ms=Tp.p2ms;var bp=Pi();he.p2pk=bp.p2pk;var kp=Ui();he.p2pkh=kp.p2pkh;var Op=qi();he.p2sh=Op.p2sh;var Ip=Li();he.p2wpkh=Ip.p2wpkh;var Pp=Fi();he.p2wsh=Pp.p2wsh});var Sr=y(ve=>{"use strict";a();p();Object.defineProperty(ve,"__esModule",{value:!0});var Di=z(),Pe=kt(),vp=S(),mn=ee(),_r=lr(),Gi=Mt(),Ap=H();function ji(e){let t=Gi.decode(e);if(t.length<21)throw new TypeError(e+" is too short");if(t.length>21)throw new TypeError(e+" is too long");let r=t.readUInt8(0),n=t.slice(1);return{version:r,hash:n}}ve.fromBase58Check=ji;function Vi(e){let t=_r.decode(e),r=_r.fromWords(t.words.slice(1));return{version:t.words[0],prefix:t.prefix,data:c.Buffer.from(r)}}ve.fromBech32=Vi;function Np(e,t){Ap(mn.tuple(mn.Hash160bit,mn.UInt8),arguments);let r=c.Buffer.allocUnsafe(21);return r.writeUInt8(t,0),e.copy(r,1),Gi.encode(r)}ve.toBase58Check=Np;function Up(e,t,r){let n=_r.toWords(e);return n.unshift(t),_r.encode(r,n)}ve.toBech32=Up;function Hp(e,t){t=t||Di.bitcoin;try{return Pe.p2pkh({output:e,network:t}).address}catch{}try{return Pe.p2sh({output:e,network:t}).address}catch{}try{return Pe.p2wpkh({output:e,network:t}).address}catch{}try{return Pe.p2wsh({output:e,network:t}).address}catch{}throw new Error(vp.toASM(e)+" has no matching Address")}ve.fromOutputScript=Hp;function xp(e,t){t=t||Di.bitcoin;let r,n;try{r=ji(e)}catch{}if(r){if(r.version===t.pubKeyHash)return Pe.p2pkh({hash:r.hash}).output;if(r.version===t.scriptHash)return Pe.p2sh({hash:r.hash}).output}else{try{n=Vi(e)}catch{}if(n){if(n.prefix!==t.bech32)throw new Error(e+" has an invalid prefix");if(n.version===0){if(n.data.length===20)return Pe.p2wpkh({hash:n.data}).output;if(n.data.length===32)return Pe.p2wsh({hash:n.data}).output}}}throw new Error(e+" has no matching Script")}ve.toOutputScript=xp});var mr=y(ft=>{"use strict";a();p();Object.defineProperty(ft,"__esModule",{value:!0});var Xi=z(),Re=ee(),le=oe(),qp=Wc(),Ae=H(),$i=Cs(),Tn=Ae.maybe(Ae.compile({compressed:Re.maybe(Re.Boolean),network:Re.maybe(Re.Network)})),Er=class{constructor(t,r,n){this.__D=t,this.__Q=r,this.lowR=!1,n===void 0&&(n={}),this.compressed=n.compressed===void 0?!0:n.compressed,this.network=n.network||Xi.bitcoin,r!==void 0&&(this.__Q=le.pointCompress(r,this.compressed))}get privateKey(){return this.__D}get publicKey(){return this.__Q||(this.__Q=le.pointFromScalar(this.__D,this.compressed)),this.__Q}toWIF(){if(!this.__D)throw new Error("Missing private key");return $i.encode(this.network.wif,this.__D,this.compressed)}sign(t,r){if(!this.__D)throw new Error("Missing private key");if(r===void 0&&(r=this.lowR),r===!1)return le.sign(t,this.__D);{let n=le.sign(t,this.__D),s=c.Buffer.alloc(32,0),i=0;for(;n[0]>127;)i++,s.writeUIntLE(i,0,6),n=le.signWithEntropy(t,this.__D,s);return n}}verify(t,r){return le.verify(t,this.publicKey,r)}};function bn(e,t){if(Ae(Re.Buffer256bit,e),!le.isPrivate(e))throw new TypeError("Private key not in range [1, n)");return Ae(Tn,t),new Er(e,void 0,t)}ft.fromPrivateKey=bn;function Cp(e,t){return Ae(le.isPoint,e),Ae(Tn,t),new Er(void 0,e,t)}ft.fromPublicKey=Cp;function Bp(e,t){let r=$i.decode(e),n=r.version;if(Re.Array(t)){if(t=t.filter(s=>n===s.wif).pop(),!t)throw new Error("Unknown network version")}else if(t=t||Xi.bitcoin,n!==t.wif)throw new Error("Invalid network version");return bn(r.privateKey,{compressed:r.compressed,network:t})}ft.fromWIF=Bp;function Rp(e){Ae(Tn,e),e===void 0&&(e={});let t=e.rng||qp,r;do r=t(32),Ae(Re.Buffer256bit,r);while(!le.isPrivate(r));return bn(r,e)}ft.makeRandom=Rp});var Tr=y((Gw,zi)=>{"use strict";a();p();var kn=Mc().Buffer,Kp=9007199254740991;function On(e){if(e<0||e>Kp||e%1!==0)throw new RangeError("value out of range")}function Ot(e,t,r){if(On(e),t||(t=kn.allocUnsafe(Yi(e))),!kn.isBuffer(t))throw new TypeError("buffer must be a Buffer instance");return r||(r=0),e<253?(t.writeUInt8(e,r),Ot.bytes=1):e<=65535?(t.writeUInt8(253,r),t.writeUInt16LE(e,r+1),Ot.bytes=3):e<=4294967295?(t.writeUInt8(254,r),t.writeUInt32LE(e,r+1),Ot.bytes=5):(t.writeUInt8(255,r),t.writeUInt32LE(e>>>0,r+1),t.writeUInt32LE(e/4294967296|0,r+5),Ot.bytes=9),t}function It(e,t){if(!kn.isBuffer(e))throw new TypeError("buffer must be a Buffer instance");t||(t=0);var r=e.readUInt8(t);if(r<253)return It.bytes=1,r;if(r===253)return It.bytes=3,e.readUInt16LE(t+1);if(r===254)return It.bytes=5,e.readUInt32LE(t+1);It.bytes=9;var n=e.readUInt32LE(t+1),s=e.readUInt32LE(t+5),i=s*4294967296+n;return On(i),i}function Yi(e){return On(e),e<253?1:e<=65535?3:e<=4294967295?5:9}zi.exports={encode:Ot,decode:It,encodingLength:Yi}});var Pt=y(Ne=>{"use strict";a();p();Object.defineProperty(Ne,"__esModule",{value:!0});var ht=ee(),Qi=H(),br=Tr();function Ji(e,t){if(typeof e!="number")throw new Error("cannot write a non-number as a number");if(e<0)throw new Error("specified a negative value for writing an unsigned value");if(e>t)throw new Error("RangeError: value out of range");if(Math.floor(e)!==e)throw new Error("value has a fractional component")}function Zi(e,t){let r=e.readUInt32LE(t),n=e.readUInt32LE(t+4);return n*=4294967296,Ji(n+r,9007199254740991),n+r}Ne.readUInt64LE=Zi;function eo(e,t,r){return Ji(t,9007199254740991),e.writeInt32LE(t&-1,r),e.writeUInt32LE(Math.floor(t/4294967296),r+4),r+8}Ne.writeUInt64LE=eo;function Lp(e){if(e.length<1)return e;let t=e.length-1,r=0;for(let n=0;n<e.length/2;n++)r=e[n],e[n]=e[t],e[t]=r,t--;return e}Ne.reverseBuffer=Lp;function Mp(e){let t=c.Buffer.allocUnsafe(e.length);return e.copy(t),t}Ne.cloneBuffer=Mp;var In=class{constructor(t,r=0){this.buffer=t,this.offset=r,Qi(ht.tuple(ht.Buffer,ht.UInt32),[t,r])}writeUInt8(t){this.offset=this.buffer.writeUInt8(t,this.offset)}writeInt32(t){this.offset=this.buffer.writeInt32LE(t,this.offset)}writeUInt32(t){this.offset=this.buffer.writeUInt32LE(t,this.offset)}writeUInt64(t){this.offset=eo(this.buffer,t,this.offset)}writeVarInt(t){br.encode(t,this.buffer,this.offset),this.offset+=br.encode.bytes}writeSlice(t){if(this.buffer.length<this.offset+t.length)throw new Error("Cannot write slice out of bounds");this.offset+=t.copy(this.buffer,this.offset)}writeVarSlice(t){this.writeVarInt(t.length),this.writeSlice(t)}writeVector(t){this.writeVarInt(t.length),t.forEach(r=>this.writeVarSlice(r))}};Ne.BufferWriter=In;var Pn=class{constructor(t,r=0){this.buffer=t,this.offset=r,Qi(ht.tuple(ht.Buffer,ht.UInt32),[t,r])}readUInt8(){let t=this.buffer.readUInt8(this.offset);return this.offset++,t}readInt32(){let t=this.buffer.readInt32LE(this.offset);return this.offset+=4,t}readUInt32(){let t=this.buffer.readUInt32LE(this.offset);return this.offset+=4,t}readUInt64(){let t=Zi(this.buffer,this.offset);return this.offset+=8,t}readVarInt(){let t=br.decode(this.buffer,this.offset);return this.offset+=br.decode.bytes,t}readSlice(t){if(this.buffer.length<this.offset+t)throw new Error("Cannot read slice out of bounds");let r=this.buffer.slice(this.offset,this.offset+t);return this.offset+=t,r}readVarSlice(){return this.readSlice(this.readVarInt())}readVector(){let t=this.readVarInt(),r=[];for(let n=0;n<t;n++)r.push(this.readVarSlice());return r}};Ne.BufferReader=Pn});var vt=y(Nn=>{"use strict";a();p();Object.defineProperty(Nn,"__esModule",{value:!0});var Ue=Pt(),Ke=ne(),to=S(),Wp=S(),b=ee(),Le=H(),kr=Tr();function lt(e){let t=e.length;return kr.encodingLength(t)+t}function Fp(e){let t=e.length;return kr.encodingLength(t)+e.reduce((r,n)=>r+lt(n),0)}var An=c.Buffer.allocUnsafe(0),ro=[],vn=c.Buffer.from("0000000000000000000000000000000000000000000000000000000000000000","hex"),no=c.Buffer.from("0000000000000000000000000000000000000000000000000000000000000001","hex"),Dp=c.Buffer.from("ffffffffffffffff","hex"),Gp={script:An,valueBuffer:Dp};function jp(e){return e.value!==void 0}var T=class{constructor(){this.version=1,this.locktime=0,this.ins=[],this.outs=[]}static fromBuffer(t,r){let n=new Ue.BufferReader(t),s=new T;s.version=n.readInt32();let i=n.readUInt8(),o=n.readUInt8(),u=!1;i===T.ADVANCED_TRANSACTION_MARKER&&o===T.ADVANCED_TRANSACTION_FLAG?u=!0:n.offset-=2;let f=n.readVarInt();for(let d=0;d<f;++d)s.ins.push({hash:n.readSlice(32),index:n.readUInt32(),script:n.readVarSlice(),sequence:n.readUInt32(),witness:ro});let l=n.readVarInt();for(let d=0;d<l;++d)s.outs.push({value:n.readUInt64(),script:n.readVarSlice()});if(u){for(let d=0;d<f;++d)s.ins[d].witness=n.readVector();if(!s.hasWitnesses())throw new Error("Transaction has superfluous witness data")}if(s.locktime=n.readUInt32(),r)return s;if(n.offset!==t.length)throw new Error("Transaction has unexpected data");return s}static fromHex(t){return T.fromBuffer(c.Buffer.from(t,"hex"),!1)}static isCoinbaseHash(t){Le(b.Hash256bit,t);for(let r=0;r<32;++r)if(t[r]!==0)return!1;return!0}isCoinbase(){return this.ins.length===1&&T.isCoinbaseHash(this.ins[0].hash)}addInput(t,r,n,s){return Le(b.tuple(b.Hash256bit,b.UInt32,b.maybe(b.UInt32),b.maybe(b.Buffer)),arguments),b.Null(n)&&(n=T.DEFAULT_SEQUENCE),this.ins.push({hash:t,index:r,script:s||An,sequence:n,witness:ro})-1}addOutput(t,r){return Le(b.tuple(b.Buffer,b.Satoshi),arguments),this.outs.push({script:t,value:r})-1}hasWitnesses(){return this.ins.some(t=>t.witness.length!==0)}weight(){let t=this.byteLength(!1),r=this.byteLength(!0);return t*3+r}virtualSize(){return Math.ceil(this.weight()/4)}byteLength(t=!0){let r=t&&this.hasWitnesses();return(r?10:8)+kr.encodingLength(this.ins.length)+kr.encodingLength(this.outs.length)+this.ins.reduce((n,s)=>n+40+lt(s.script),0)+this.outs.reduce((n,s)=>n+8+lt(s.script),0)+(r?this.ins.reduce((n,s)=>n+Fp(s.witness),0):0)}clone(){let t=new T;return t.version=this.version,t.locktime=this.locktime,t.ins=this.ins.map(r=>({hash:r.hash,index:r.index,script:r.script,sequence:r.sequence,witness:r.witness})),t.outs=this.outs.map(r=>({script:r.script,value:r.value})),t}hashForSignature(t,r,n){if(Le(b.tuple(b.UInt32,b.Buffer,b.Number),arguments),t>=this.ins.length)return no;let s=to.compile(to.decompile(r).filter(u=>u!==Wp.OPS.OP_CODESEPARATOR)),i=this.clone();if((n&31)===T.SIGHASH_NONE)i.outs=[],i.ins.forEach((u,f)=>{f!==t&&(u.sequence=0)});else if((n&31)===T.SIGHASH_SINGLE){if(t>=this.outs.length)return no;i.outs.length=t+1;for(let u=0;u<t;u++)i.outs[u]=Gp;i.ins.forEach((u,f)=>{f!==t&&(u.sequence=0)})}n&T.SIGHASH_ANYONECANPAY?(i.ins=[i.ins[t]],i.ins[0].script=s):(i.ins.forEach(u=>{u.script=An}),i.ins[t].script=s);let o=c.Buffer.allocUnsafe(i.byteLength(!1)+4);return o.writeInt32LE(n,o.length-4),i.__toBuffer(o,0,!1),Ke.hash256(o)}hashForWitnessV0(t,r,n,s){Le(b.tuple(b.UInt32,b.Buffer,b.Satoshi,b.UInt32),arguments);let i=c.Buffer.from([]),o,u=vn,f=vn,l=vn;if(s&T.SIGHASH_ANYONECANPAY||(i=c.Buffer.allocUnsafe(36*this.ins.length),o=new Ue.BufferWriter(i,0),this.ins.forEach(h=>{o.writeSlice(h.hash),o.writeUInt32(h.index)}),f=Ke.hash256(i)),!(s&T.SIGHASH_ANYONECANPAY)&&(s&31)!==T.SIGHASH_SINGLE&&(s&31)!==T.SIGHASH_NONE&&(i=c.Buffer.allocUnsafe(4*this.ins.length),o=new Ue.BufferWriter(i,0),this.ins.forEach(h=>{o.writeUInt32(h.sequence)}),l=Ke.hash256(i)),(s&31)!==T.SIGHASH_SINGLE&&(s&31)!==T.SIGHASH_NONE){let h=this.outs.reduce((w,q)=>w+8+lt(q.script),0);i=c.Buffer.allocUnsafe(h),o=new Ue.BufferWriter(i,0),this.outs.forEach(w=>{o.writeUInt64(w.value),o.writeVarSlice(w.script)}),u=Ke.hash256(i)}else if((s&31)===T.SIGHASH_SINGLE&&t<this.outs.length){let h=this.outs[t];i=c.Buffer.allocUnsafe(8+lt(h.script)),o=new Ue.BufferWriter(i,0),o.writeUInt64(h.value),o.writeVarSlice(h.script),u=Ke.hash256(i)}i=c.Buffer.allocUnsafe(156+lt(r)),o=new Ue.BufferWriter(i,0);let d=this.ins[t];return o.writeUInt32(this.version),o.writeSlice(f),o.writeSlice(l),o.writeSlice(d.hash),o.writeUInt32(d.index),o.writeVarSlice(r),o.writeUInt64(n),o.writeUInt32(d.sequence),o.writeSlice(u),o.writeUInt32(this.locktime),o.writeUInt32(s),Ke.hash256(i)}getHash(t){return t&&this.isCoinbase()?c.Buffer.alloc(32,0):Ke.hash256(this.__toBuffer(void 0,void 0,t))}getId(){return Ue.reverseBuffer(this.getHash(!1)).toString("hex")}toBuffer(t,r){return this.__toBuffer(t,r,!0)}toHex(){return this.toBuffer(void 0,void 0).toString("hex")}setInputScript(t,r){Le(b.tuple(b.Number,b.Buffer),arguments),this.ins[t].script=r}setWitness(t,r){Le(b.tuple(b.Number,[b.Buffer]),arguments),this.ins[t].witness=r}__toBuffer(t,r,n=!1){t||(t=c.Buffer.allocUnsafe(this.byteLength(n)));let s=new Ue.BufferWriter(t,r||0);s.writeInt32(this.version);let i=n&&this.hasWitnesses();return i&&(s.writeUInt8(T.ADVANCED_TRANSACTION_MARKER),s.writeUInt8(T.ADVANCED_TRANSACTION_FLAG)),s.writeVarInt(this.ins.length),this.ins.forEach(o=>{s.writeSlice(o.hash),s.writeUInt32(o.index),s.writeVarSlice(o.script),s.writeUInt32(o.sequence)}),s.writeVarInt(this.outs.length),this.outs.forEach(o=>{jp(o)?s.writeUInt64(o.value):s.writeSlice(o.valueBuffer),s.writeVarSlice(o.script)}),i&&this.ins.forEach(o=>{s.writeVector(o.witness)}),s.writeUInt32(this.locktime),r!==void 0?t.slice(r,s.offset):t}};T.DEFAULT_SEQUENCE=4294967295;T.SIGHASH_ALL=1;T.SIGHASH_NONE=2;T.SIGHASH_SINGLE=3;T.SIGHASH_ANYONECANPAY=128;T.ADVANCED_TRANSACTION_MARKER=0;T.ADVANCED_TRANSACTION_FLAG=1;Nn.Transaction=T});var io=y((Zw,so)=>{a();p();so.exports=function(t,r){if(!Array.isArray(t))throw TypeError("Expected values Array");if(typeof r!="function")throw TypeError("Expected digest Function");for(var n=t.length,s=t.concat();n>1;){for(var i=0,o=0;o<n;o+=2,++i){var u=s[o],f=o+1===n?u:s[o+1],l=c.Buffer.concat([u,f]);s[i]=r(l)}n=i}return s[0]}});var co=y(qn=>{"use strict";a();p();Object.defineProperty(qn,"__esModule",{value:!0});var Or=Pt(),Un=ne(),Vp=vt(),Xp=ee(),$p=io(),Yp=H(),Hn=Tr(),xn=new TypeError("Cannot compute merkle root for zero transactions"),oo=new TypeError("Cannot compute witness commit for non-segwit block"),de=class{constructor(){this.version=1,this.prevHash=void 0,this.merkleRoot=void 0,this.timestamp=0,this.witnessCommit=void 0,this.bits=0,this.nonce=0,this.transactions=void 0}static fromBuffer(t){if(t.length<80)throw new Error("Buffer too small (< 80 bytes)");let r=new Or.BufferReader(t),n=new de;if(n.version=r.readInt32(),n.prevHash=r.readSlice(32),n.merkleRoot=r.readSlice(32),n.timestamp=r.readUInt32(),n.bits=r.readUInt32(),n.nonce=r.readUInt32(),t.length===80)return n;let s=()=>{let u=Vp.Transaction.fromBuffer(r.buffer.slice(r.offset),!0);return r.offset+=u.byteLength(),u},i=r.readVarInt();n.transactions=[];for(let u=0;u<i;++u){let f=s();n.transactions.push(f)}let o=n.getWitnessCommit();return o&&(n.witnessCommit=o),n}static fromHex(t){return de.fromBuffer(c.Buffer.from(t,"hex"))}static calculateTarget(t){let r=((t&4278190080)>>24)-3,n=t&8388607,s=c.Buffer.alloc(32,0);return s.writeUIntBE(n,29-r,3),s}static calculateMerkleRoot(t,r){if(Yp([{getHash:Xp.Function}],t),t.length===0)throw xn;if(r&&!uo(t))throw oo;let n=t.map(i=>i.getHash(r)),s=$p(n,Un.hash256);return r?Un.hash256(c.Buffer.concat([s,t[0].ins[0].witness[0]])):s}getWitnessCommit(){if(!uo(this.transactions))return null;let t=this.transactions[0].outs.filter(n=>n.script.slice(0,6).equals(c.Buffer.from("6a24aa21a9ed","hex"))).map(n=>n.script.slice(6,38));if(t.length===0)return null;let r=t[t.length-1];return r instanceof c.Buffer&&r.length===32?r:null}hasWitnessCommit(){return this.witnessCommit instanceof c.Buffer&&this.witnessCommit.length===32||this.getWitnessCommit()!==null}hasWitness(){return zp(this.transactions)}weight(){let t=this.byteLength(!1,!1),r=this.byteLength(!1,!0);return t*3+r}byteLength(t,r=!0){return t||!this.transactions?80:80+Hn.encodingLength(this.transactions.length)+this.transactions.reduce((n,s)=>n+s.byteLength(r),0)}getHash(){return Un.hash256(this.toBuffer(!0))}getId(){return Or.reverseBuffer(this.getHash()).toString("hex")}getUTCDate(){let t=new Date(0);return t.setUTCSeconds(this.timestamp),t}toBuffer(t){let r=c.Buffer.allocUnsafe(this.byteLength(t)),n=new Or.BufferWriter(r);return n.writeInt32(this.version),n.writeSlice(this.prevHash),n.writeSlice(this.merkleRoot),n.writeUInt32(this.timestamp),n.writeUInt32(this.bits),n.writeUInt32(this.nonce),t||!this.transactions||(Hn.encode(this.transactions.length,r,n.offset),n.offset+=Hn.encode.bytes,this.transactions.forEach(s=>{let i=s.byteLength();s.toBuffer(r,n.offset),n.offset+=i})),r}toHex(t){return this.toBuffer(t).toString("hex")}checkTxRoots(){let t=this.hasWitnessCommit();return!t&&this.hasWitness()?!1:this.__checkMerkleRoot()&&(t?this.__checkWitnessCommit():!0)}checkProofOfWork(){let t=Or.reverseBuffer(this.getHash()),r=de.calculateTarget(this.bits);return t.compare(r)<=0}__checkMerkleRoot(){if(!this.transactions)throw xn;let t=de.calculateMerkleRoot(this.transactions);return this.merkleRoot.compare(t)===0}__checkWitnessCommit(){if(!this.transactions)throw xn;if(!this.hasWitnessCommit())throw oo;let t=de.calculateMerkleRoot(this.transactions,!0);return this.witnessCommit.compare(t)===0}};qn.Block=de;function uo(e){return e instanceof Array&&e[0]&&e[0].ins&&e[0].ins instanceof Array&&e[0].ins[0]&&e[0].ins[0].witness&&e[0].ins[0].witness instanceof Array&&e[0].ins[0].witness.length>0}function zp(e){return e instanceof Array&&e.some(t=>typeof t=="object"&&t.ins instanceof Array&&t.ins.some(r=>typeof r=="object"&&r.witness instanceof Array&&r.witness.length>0))}});var C=y(te=>{"use strict";a();p();Object.defineProperty(te,"__esModule",{value:!0});var Qp;(function(e){e[e.UNSIGNED_TX=0]="UNSIGNED_TX",e[e.GLOBAL_XPUB=1]="GLOBAL_XPUB"})(Qp=te.GlobalTypes||(te.GlobalTypes={}));te.GLOBAL_TYPE_NAMES=["unsignedTx","globalXpub"];var Jp;(function(e){e[e.NON_WITNESS_UTXO=0]="NON_WITNESS_UTXO",e[e.WITNESS_UTXO=1]="WITNESS_UTXO",e[e.PARTIAL_SIG=2]="PARTIAL_SIG",e[e.SIGHASH_TYPE=3]="SIGHASH_TYPE",e[e.REDEEM_SCRIPT=4]="REDEEM_SCRIPT",e[e.WITNESS_SCRIPT=5]="WITNESS_SCRIPT",e[e.BIP32_DERIVATION=6]="BIP32_DERIVATION",e[e.FINAL_SCRIPTSIG=7]="FINAL_SCRIPTSIG",e[e.FINAL_SCRIPTWITNESS=8]="FINAL_SCRIPTWITNESS",e[e.POR_COMMITMENT=9]="POR_COMMITMENT",e[e.TAP_KEY_SIG=19]="TAP_KEY_SIG",e[e.TAP_SCRIPT_SIG=20]="TAP_SCRIPT_SIG",e[e.TAP_LEAF_SCRIPT=21]="TAP_LEAF_SCRIPT",e[e.TAP_BIP32_DERIVATION=22]="TAP_BIP32_DERIVATION",e[e.TAP_INTERNAL_KEY=23]="TAP_INTERNAL_KEY",e[e.TAP_MERKLE_ROOT=24]="TAP_MERKLE_ROOT"})(Jp=te.InputTypes||(te.InputTypes={}));te.INPUT_TYPE_NAMES=["nonWitnessUtxo","witnessUtxo","partialSig","sighashType","redeemScript","witnessScript","bip32Derivation","finalScriptSig","finalScriptWitness","porCommitment","tapKeySig","tapScriptSig","tapLeafScript","tapBip32Derivation","tapInternalKey","tapMerkleRoot"];var Zp;(function(e){e[e.REDEEM_SCRIPT=0]="REDEEM_SCRIPT",e[e.WITNESS_SCRIPT=1]="WITNESS_SCRIPT",e[e.BIP32_DERIVATION=2]="BIP32_DERIVATION",e[e.TAP_INTERNAL_KEY=5]="TAP_INTERNAL_KEY",e[e.TAP_TREE=6]="TAP_TREE",e[e.TAP_BIP32_DERIVATION=7]="TAP_BIP32_DERIVATION"})(Zp=te.OutputTypes||(te.OutputTypes={}));te.OUTPUT_TYPE_NAMES=["redeemScript","witnessScript","bip32Derivation","tapInternalKey","tapTree","tapBip32Derivation"]});var po=y(Me=>{"use strict";a();p();Object.defineProperty(Me,"__esModule",{value:!0});var ao=C(),ef=e=>[...Array(e).keys()];function tf(e){if(e.key[0]!==ao.GlobalTypes.GLOBAL_XPUB)throw new Error("Decode Error: could not decode globalXpub with key 0x"+e.key.toString("hex"));if(e.key.length!==79||![2,3].includes(e.key[46]))throw new Error("Decode Error: globalXpub has invalid extended pubkey in key 0x"+e.key.toString("hex"));if(e.value.length/4%1!==0)throw new Error("Decode Error: Global GLOBAL_XPUB value length should be multiple of 4");let t=e.key.slice(1),r={masterFingerprint:e.value.slice(0,4),extendedPubkey:t,path:"m"};for(let n of ef(e.value.length/4-1)){let s=e.value.readUInt32LE(n*4+4),i=!!(s&2147483648),o=s&2147483647;r.path+="/"+o.toString(10)+(i?"'":"")}return r}Me.decode=tf;function rf(e){let t=c.Buffer.from([ao.GlobalTypes.GLOBAL_XPUB]),r=c.Buffer.concat([t,e.extendedPubkey]),n=e.path.split("/"),s=c.Buffer.allocUnsafe(n.length*4);e.masterFingerprint.copy(s,0);let i=4;return n.slice(1).forEach(o=>{let u=o.slice(-1)==="'",f=2147483647&parseInt(u?o.slice(0,-1):o,10);u&&(f+=2147483648),s.writeUInt32LE(f,i),i+=4}),{key:r,value:s}}Me.encode=rf;Me.expected="{ masterFingerprint: Buffer; extendedPubkey: Buffer; path: string; }";function nf(e){let t=e.extendedPubkey,r=e.masterFingerprint,n=e.path;return c.Buffer.isBuffer(t)&&t.length===78&&[2,3].indexOf(t[45])>-1&&c.Buffer.isBuffer(r)&&r.length===4&&typeof n=="string"&&!!n.match(/^m(\/\d+'?)*$/)}Me.check=nf;function sf(e,t,r){let n=t.extendedPubkey.toString("hex");return r.has(n)?!1:(r.add(n),e.filter(s=>s.extendedPubkey.equals(t.extendedPubkey)).length===0)}Me.canAddToArray=sf});var fo=y(Cn=>{"use strict";a();p();Object.defineProperty(Cn,"__esModule",{value:!0});var of=C();function uf(e){return{key:c.Buffer.from([of.GlobalTypes.UNSIGNED_TX]),value:e.toBuffer()}}Cn.encode=uf});var lo=y(We=>{"use strict";a();p();Object.defineProperty(We,"__esModule",{value:!0});var ho=C();function cf(e){if(e.key[0]!==ho.InputTypes.FINAL_SCRIPTSIG)throw new Error("Decode Error: could not decode finalScriptSig with key 0x"+e.key.toString("hex"));return e.value}We.decode=cf;function af(e){return{key:c.Buffer.from([ho.InputTypes.FINAL_SCRIPTSIG]),value:e}}We.encode=af;We.expected="Buffer";function pf(e){return c.Buffer.isBuffer(e)}We.check=pf;function ff(e,t){return!!e&&!!t&&e.finalScriptSig===void 0}We.canAdd=ff});var yo=y(Fe=>{"use strict";a();p();Object.defineProperty(Fe,"__esModule",{value:!0});var wo=C();function hf(e){if(e.key[0]!==wo.InputTypes.FINAL_SCRIPTWITNESS)throw new Error("Decode Error: could not decode finalScriptWitness with key 0x"+e.key.toString("hex"));return e.value}Fe.decode=hf;function lf(e){return{key:c.Buffer.from([wo.InputTypes.FINAL_SCRIPTWITNESS]),value:e}}Fe.encode=lf;Fe.expected="Buffer";function df(e){return c.Buffer.isBuffer(e)}Fe.check=df;function wf(e,t){return!!e&&!!t&&e.finalScriptWitness===void 0}Fe.canAdd=wf});var _o=y(De=>{"use strict";a();p();Object.defineProperty(De,"__esModule",{value:!0});var go=C();function yf(e){if(e.key[0]!==go.InputTypes.NON_WITNESS_UTXO)throw new Error("Decode Error: could not decode nonWitnessUtxo with key 0x"+e.key.toString("hex"));return e.value}De.decode=yf;function gf(e){return{key:c.Buffer.from([go.InputTypes.NON_WITNESS_UTXO]),value:e}}De.encode=gf;De.expected="Buffer";function _f(e){return c.Buffer.isBuffer(e)}De.check=_f;function Sf(e,t){return!!e&&!!t&&e.nonWitnessUtxo===void 0}De.canAdd=Sf});var Eo=y(Ge=>{"use strict";a();p();Object.defineProperty(Ge,"__esModule",{value:!0});var So=C();function Ef(e){if(e.key[0]!==So.InputTypes.PARTIAL_SIG)throw new Error("Decode Error: could not decode partialSig with key 0x"+e.key.toString("hex"));if(!(e.key.length===34||e.key.length===66)||![2,3,4].includes(e.key[1]))throw new Error("Decode Error: partialSig has invalid pubkey in key 0x"+e.key.toString("hex"));return{pubkey:e.key.slice(1),signature:e.value}}Ge.decode=Ef;function mf(e){let t=c.Buffer.from([So.InputTypes.PARTIAL_SIG]);return{key:c.Buffer.concat([t,e.pubkey]),value:e.signature}}Ge.encode=mf;Ge.expected="{ pubkey: Buffer; signature: Buffer; }";function Tf(e){return c.Buffer.isBuffer(e.pubkey)&&c.Buffer.isBuffer(e.signature)&&[33,65].includes(e.pubkey.length)&&[2,3,4].includes(e.pubkey[0])&&bf(e.signature)}Ge.check=Tf;function bf(e){if(!c.Buffer.isBuffer(e)||e.length<9||e[0]!==48||e.length!==e[1]+3||e[2]!==2)return!1;let t=e[3];if(t>33||t<1||e[3+t+1]!==2)return!1;let r=e[3+t+2];return!(r>33||r<1||e.length!==3+t+2+r+2)}function kf(e,t,r){let n=t.pubkey.toString("hex");return r.has(n)?!1:(r.add(n),e.filter(s=>s.pubkey.equals(t.pubkey)).length===0)}Ge.canAddToArray=kf});var To=y(je=>{"use strict";a();p();Object.defineProperty(je,"__esModule",{value:!0});var mo=C();function Of(e){if(e.key[0]!==mo.InputTypes.POR_COMMITMENT)throw new Error("Decode Error: could not decode porCommitment with key 0x"+e.key.toString("hex"));return e.value.toString("utf8")}je.decode=Of;function If(e){return{key:c.Buffer.from([mo.InputTypes.POR_COMMITMENT]),value:c.Buffer.from(e,"utf8")}}je.encode=If;je.expected="string";function Pf(e){return typeof e=="string"}je.check=Pf;function vf(e,t){return!!e&&!!t&&e.porCommitment===void 0}je.canAdd=vf});var ko=y(Ve=>{"use strict";a();p();Object.defineProperty(Ve,"__esModule",{value:!0});var bo=C();function Af(e){if(e.key[0]!==bo.InputTypes.SIGHASH_TYPE)throw new Error("Decode Error: could not decode sighashType with key 0x"+e.key.toString("hex"));return e.value.readUInt32LE(0)}Ve.decode=Af;function Nf(e){let t=c.Buffer.from([bo.InputTypes.SIGHASH_TYPE]),r=c.Buffer.allocUnsafe(4);return r.writeUInt32LE(e,0),{key:t,value:r}}Ve.encode=Nf;Ve.expected="number";function Uf(e){return typeof e=="number"}Ve.check=Uf;function Hf(e,t){return!!e&&!!t&&e.sighashType===void 0}Ve.canAdd=Hf});var Po=y(Xe=>{"use strict";a();p();Object.defineProperty(Xe,"__esModule",{value:!0});var Oo=C();function xf(e){if(e.key[0]!==Oo.InputTypes.TAP_KEY_SIG||e.key.length!==1)throw new Error("Decode Error: could not decode tapKeySig with key 0x"+e.key.toString("hex"));if(!Io(e.value))throw new Error("Decode Error: tapKeySig not a valid 64-65-byte BIP340 signature");return e.value}Xe.decode=xf;function qf(e){return{key:c.Buffer.from([Oo.InputTypes.TAP_KEY_SIG]),value:e}}Xe.encode=qf;Xe.expected="Buffer";function Io(e){return c.Buffer.isBuffer(e)&&(e.length===64||e.length===65)}Xe.check=Io;function Cf(e,t){return!!e&&!!t&&e.tapKeySig===void 0}Xe.canAdd=Cf});var Ao=y($e=>{"use strict";a();p();Object.defineProperty($e,"__esModule",{value:!0});var vo=C();function Bf(e){if(e.key[0]!==vo.InputTypes.TAP_LEAF_SCRIPT)throw new Error("Decode Error: could not decode tapLeafScript with key 0x"+e.key.toString("hex"));if((e.key.length-2)%32!==0)throw new Error("Decode Error: tapLeafScript has invalid control block in key 0x"+e.key.toString("hex"));let t=e.value[e.value.length-1];if((e.key[1]&254)!==t)throw new Error("Decode Error: tapLeafScript bad leaf version in key 0x"+e.key.toString("hex"));let r=e.value.slice(0,-1);return{controlBlock:e.key.slice(1),script:r,leafVersion:t}}$e.decode=Bf;function Rf(e){let t=c.Buffer.from([vo.InputTypes.TAP_LEAF_SCRIPT]),r=c.Buffer.from([e.leafVersion]);return{key:c.Buffer.concat([t,e.controlBlock]),value:c.Buffer.concat([e.script,r])}}$e.encode=Rf;$e.expected="{ controlBlock: Buffer; leafVersion: number, script: Buffer; }";function Kf(e){return c.Buffer.isBuffer(e.controlBlock)&&(e.controlBlock.length-1)%32===0&&(e.controlBlock[0]&254)===e.leafVersion&&c.Buffer.isBuffer(e.script)}$e.check=Kf;function Lf(e,t,r){let n=t.controlBlock.toString("hex");return r.has(n)?!1:(r.add(n),e.filter(s=>s.controlBlock.equals(t.controlBlock)).length===0)}$e.canAddToArray=Lf});var Ho=y(Ye=>{"use strict";a();p();Object.defineProperty(Ye,"__esModule",{value:!0});var No=C();function Mf(e){if(e.key[0]!==No.InputTypes.TAP_MERKLE_ROOT||e.key.length!==1)throw new Error("Decode Error: could not decode tapMerkleRoot with key 0x"+e.key.toString("hex"));if(!Uo(e.value))throw new Error("Decode Error: tapMerkleRoot not a 32-byte hash");return e.value}Ye.decode=Mf;function Wf(e){return{key:c.Buffer.from([No.InputTypes.TAP_MERKLE_ROOT]),value:e}}Ye.encode=Wf;Ye.expected="Buffer";function Uo(e){return c.Buffer.isBuffer(e)&&e.length===32}Ye.check=Uo;function Ff(e,t){return!!e&&!!t&&e.tapMerkleRoot===void 0}Ye.canAdd=Ff});var qo=y(ze=>{"use strict";a();p();Object.defineProperty(ze,"__esModule",{value:!0});var xo=C();function Df(e){if(e.key[0]!==xo.InputTypes.TAP_SCRIPT_SIG)throw new Error("Decode Error: could not decode tapScriptSig with key 0x"+e.key.toString("hex"));if(e.key.length!==65)throw new Error("Decode Error: tapScriptSig has invalid key 0x"+e.key.toString("hex"));if(e.value.length!==64&&e.value.length!==65)throw new Error("Decode Error: tapScriptSig has invalid signature in key 0x"+e.key.toString("hex"));let t=e.key.slice(1,33),r=e.key.slice(33);return{pubkey:t,leafHash:r,signature:e.value}}ze.decode=Df;function Gf(e){let t=c.Buffer.from([xo.InputTypes.TAP_SCRIPT_SIG]);return{key:c.Buffer.concat([t,e.pubkey,e.leafHash]),value:e.signature}}ze.encode=Gf;ze.expected="{ pubkey: Buffer; leafHash: Buffer; signature: Buffer; }";function jf(e){return c.Buffer.isBuffer(e.pubkey)&&c.Buffer.isBuffer(e.leafHash)&&c.Buffer.isBuffer(e.signature)&&e.pubkey.length===32&&e.leafHash.length===32&&(e.signature.length===64||e.signature.length===65)}ze.check=jf;function Vf(e,t,r){let n=t.pubkey.toString("hex")+t.leafHash.toString("hex");return r.has(n)?!1:(r.add(n),e.filter(s=>s.pubkey.equals(t.pubkey)&&s.leafHash.equals(t.leafHash)).length===0)}ze.canAddToArray=Vf});var Qe=y(Ut=>{"use strict";a();p();Object.defineProperty(Ut,"__esModule",{value:!0});var Xf=9007199254740991;function Bn(e){if(e<0||e>Xf||e%1!==0)throw new RangeError("value out of range")}function At(e,t,r){if(Bn(e),t||(t=c.Buffer.allocUnsafe(Co(e))),!c.Buffer.isBuffer(t))throw new TypeError("buffer must be a Buffer instance");return r||(r=0),e<253?(t.writeUInt8(e,r),Object.assign(At,{bytes:1})):e<=65535?(t.writeUInt8(253,r),t.writeUInt16LE(e,r+1),Object.assign(At,{bytes:3})):e<=4294967295?(t.writeUInt8(254,r),t.writeUInt32LE(e,r+1),Object.assign(At,{bytes:5})):(t.writeUInt8(255,r),t.writeUInt32LE(e>>>0,r+1),t.writeUInt32LE(e/4294967296|0,r+5),Object.assign(At,{bytes:9})),t}Ut.encode=At;function Nt(e,t){if(!c.Buffer.isBuffer(e))throw new TypeError("buffer must be a Buffer instance");t||(t=0);let r=e.readUInt8(t);if(r<253)return Object.assign(Nt,{bytes:1}),r;if(r===253)return Object.assign(Nt,{bytes:3}),e.readUInt16LE(t+1);if(r===254)return Object.assign(Nt,{bytes:5}),e.readUInt32LE(t+1);{Object.assign(Nt,{bytes:9});let n=e.readUInt32LE(t+1),i=e.readUInt32LE(t+5)*4294967296+n;return Bn(i),i}}Ut.decode=Nt;function Co(e){return Bn(e),e<253?1:e<=65535?3:e<=4294967295?5:9}Ut.encodingLength=Co});var Pr=y(He=>{"use strict";a();p();Object.defineProperty(He,"__esModule",{value:!0});var Ir=Qe();He.range=e=>[...Array(e).keys()];function $f(e){if(e.length<1)return e;let t=e.length-1,r=0;for(let n=0;n<e.length/2;n++)r=e[n],e[n]=e[t],e[t]=r,t--;return e}He.reverseBuffer=$f;function Yf(e){let t=e.map(Bo);return t.push(c.Buffer.from([0])),c.Buffer.concat(t)}He.keyValsToBuffer=Yf;function Bo(e){let t=e.key.length,r=e.value.length,n=Ir.encodingLength(t),s=Ir.encodingLength(r),i=c.Buffer.allocUnsafe(n+t+s+r);return Ir.encode(t,i,0),e.key.copy(i,n),Ir.encode(r,i,n+t),e.value.copy(i,n+t+s),i}He.keyValToBuffer=Bo;function Ro(e,t){if(typeof e!="number")throw new Error("cannot write a non-number as a number");if(e<0)throw new Error("specified a negative value for writing an unsigned value");if(e>t)throw new Error("RangeError: value out of range");if(Math.floor(e)!==e)throw new Error("value has a fractional component")}function zf(e,t){let r=e.readUInt32LE(t),n=e.readUInt32LE(t+4);return n*=4294967296,Ro(n+r,9007199254740991),n+r}He.readUInt64LE=zf;function Qf(e,t,r){return Ro(t,9007199254740991),e.writeInt32LE(t&-1,r),e.writeUInt32LE(Math.floor(t/4294967296),r+4),r+8}He.writeUInt64LE=Qf});var Mo=y(Je=>{"use strict";a();p();Object.defineProperty(Je,"__esModule",{value:!0});var Ko=C(),Lo=Pr(),vr=Qe();function Jf(e){if(e.key[0]!==Ko.InputTypes.WITNESS_UTXO)throw new Error("Decode Error: could not decode witnessUtxo with key 0x"+e.key.toString("hex"));let t=Lo.readUInt64LE(e.value,0),r=8,n=vr.decode(e.value,r);r+=vr.encodingLength(n);let s=e.value.slice(r);if(s.length!==n)throw new Error("Decode Error: WITNESS_UTXO script is not proper length");return{script:s,value:t}}Je.decode=Jf;function Zf(e){let{script:t,value:r}=e,n=vr.encodingLength(t.length),s=c.Buffer.allocUnsafe(8+n+t.length);return Lo.writeUInt64LE(s,r,0),vr.encode(t.length,s,8),t.copy(s,8+n),{key:c.Buffer.from([Ko.InputTypes.WITNESS_UTXO]),value:s}}Je.encode=Zf;Je.expected="{ script: Buffer; value: number; }";function eh(e){return c.Buffer.isBuffer(e.script)&&typeof e.value=="number"}Je.check=eh;function th(e,t){return!!e&&!!t&&e.witnessUtxo===void 0}Je.canAdd=th});var Fo=y(Ze=>{"use strict";a();p();Object.defineProperty(Ze,"__esModule",{value:!0});var Wo=C(),Rn=Qe();function rh(e){if(e.key[0]!==Wo.OutputTypes.TAP_TREE||e.key.length!==1)throw new Error("Decode Error: could not decode tapTree with key 0x"+e.key.toString("hex"));let t=0,r=[];for(;t<e.value.length;){let n=e.value[t++],s=e.value[t++],i=Rn.decode(e.value,t);t+=Rn.encodingLength(i),r.push({depth:n,leafVersion:s,script:e.value.slice(t,t+i)}),t+=i}return{leaves:r}}Ze.decode=rh;function nh(e){let t=c.Buffer.from([Wo.OutputTypes.TAP_TREE]),r=[].concat(...e.leaves.map(n=>[c.Buffer.of(n.depth,n.leafVersion),Rn.encode(n.script.length),n.script]));return{key:t,value:c.Buffer.concat(r)}}Ze.encode=nh;Ze.expected="{ leaves: [{ depth: number; leafVersion: number, script: Buffer; }] }";function sh(e){return Array.isArray(e.leaves)&&e.leaves.every(t=>t.depth>=0&&t.depth<=128&&(t.leafVersion&254)===t.leafVersion&&c.Buffer.isBuffer(t.script))}Ze.check=sh;function ih(e,t){return!!e&&!!t&&e.tapTree===void 0}Ze.canAdd=ih});var Ln=y(Kn=>{"use strict";a();p();Object.defineProperty(Kn,"__esModule",{value:!0});var oh=e=>[...Array(e).keys()],uh=e=>e.length===33&&[2,3].includes(e[0])||e.length===65&&e[0]===4;function ch(e,t=uh){function r(u){if(u.key[0]!==e)throw new Error("Decode Error: could not decode bip32Derivation with key 0x"+u.key.toString("hex"));let f=u.key.slice(1);if(!t(f))throw new Error("Decode Error: bip32Derivation has invalid pubkey in key 0x"+u.key.toString("hex"));if(u.value.length/4%1!==0)throw new Error("Decode Error: Input BIP32_DERIVATION value length should be multiple of 4");let l={masterFingerprint:u.value.slice(0,4),pubkey:f,path:"m"};for(let d of oh(u.value.length/4-1)){let h=u.value.readUInt32LE(d*4+4),w=!!(h&2147483648),q=h&2147483647;l.path+="/"+q.toString(10)+(w?"'":"")}return l}function n(u){let f=c.Buffer.from([e]),l=c.Buffer.concat([f,u.pubkey]),d=u.path.split("/"),h=c.Buffer.allocUnsafe(d.length*4);u.masterFingerprint.copy(h,0);let w=4;return d.slice(1).forEach(q=>{let R=q.slice(-1)==="'",j=2147483647&parseInt(R?q.slice(0,-1):q,10);R&&(j+=2147483648),h.writeUInt32LE(j,w),w+=4}),{key:l,value:h}}let s="{ masterFingerprint: Buffer; pubkey: Buffer; path: string; }";function i(u){return c.Buffer.isBuffer(u.pubkey)&&c.Buffer.isBuffer(u.masterFingerprint)&&typeof u.path=="string"&&t(u.pubkey)&&u.masterFingerprint.length===4}function o(u,f,l){let d=f.pubkey.toString("hex");return l.has(d)?!1:(l.add(d),u.filter(h=>h.pubkey.equals(f.pubkey)).length===0)}return{decode:r,encode:n,check:i,expected:s,canAddToArray:o}}Kn.makeConverter=ch});var Do=y(Mn=>{"use strict";a();p();Object.defineProperty(Mn,"__esModule",{value:!0});function ah(e){return t;function t(r){let n;if(e.includes(r.key[0])&&(n=r.key.slice(1),!(n.length===33||n.length===65)||![2,3,4].includes(n[0])))throw new Error("Format Error: invalid pubkey in key 0x"+r.key.toString("hex"));return n}}Mn.makeChecker=ah});var Go=y(Wn=>{"use strict";a();p();Object.defineProperty(Wn,"__esModule",{value:!0});function ph(e){function t(o){if(o.key[0]!==e)throw new Error("Decode Error: could not decode redeemScript with key 0x"+o.key.toString("hex"));return o.value}function r(o){return{key:c.Buffer.from([e]),value:o}}let n="Buffer";function s(o){return c.Buffer.isBuffer(o)}function i(o,u){return!!o&&!!u&&o.redeemScript===void 0}return{decode:t,encode:r,check:s,expected:n,canAdd:i}}Wn.makeConverter=ph});var jo=y(Fn=>{"use strict";a();p();Object.defineProperty(Fn,"__esModule",{value:!0});var Ar=Qe(),fh=Ln(),hh=e=>e.length===32;function lh(e){let t=fh.makeConverter(e,hh);function r(o){let u=Ar.decode(o.value),f=Ar.encodingLength(u),l=t.decode({key:o.key,value:o.value.slice(f+u*32)}),d=new Array(u);for(let h=0,w=f;h<u;h++,w+=32)d[h]=o.value.slice(w,w+32);return Object.assign({},l,{leafHashes:d})}function n(o){let u=t.encode(o),f=Ar.encodingLength(o.leafHashes.length),l=c.Buffer.allocUnsafe(f);Ar.encode(o.leafHashes.length,l);let d=c.Buffer.concat([l,...o.leafHashes,u.value]);return Object.assign({},u,{value:d})}let s="{ masterFingerprint: Buffer; pubkey: Buffer; path: string; leafHashes: Buffer[]; }";function i(o){return Array.isArray(o.leafHashes)&&o.leafHashes.every(u=>c.Buffer.isBuffer(u)&&u.length===32)&&t.check(o)}return{decode:r,encode:n,check:i,expected:s,canAddToArray:t.canAddToArray}}Fn.makeConverter=lh});var Vo=y(Dn=>{"use strict";a();p();Object.defineProperty(Dn,"__esModule",{value:!0});function dh(e){function t(o){if(o.key[0]!==e||o.key.length!==1)throw new Error("Decode Error: could not decode tapInternalKey with key 0x"+o.key.toString("hex"));if(o.value.length!==32)throw new Error("Decode Error: tapInternalKey not a 32-byte x-only pubkey");return o.value}function r(o){return{key:c.Buffer.from([e]),value:o}}let n="Buffer";function s(o){return c.Buffer.isBuffer(o)&&o.length===32}function i(o,u){return!!o&&!!u&&o.tapInternalKey===void 0}return{decode:t,encode:r,check:s,expected:n,canAdd:i}}Dn.makeConverter=dh});var Xo=y(Gn=>{"use strict";a();p();Object.defineProperty(Gn,"__esModule",{value:!0});function wh(e){function t(o){if(o.key[0]!==e)throw new Error("Decode Error: could not decode witnessScript with key 0x"+o.key.toString("hex"));return o.value}function r(o){return{key:c.Buffer.from([e]),value:o}}let n="Buffer";function s(o){return c.Buffer.isBuffer(o)}function i(o,u){return!!o&&!!u&&o.witnessScript===void 0}return{decode:t,encode:r,check:s,expected:n,canAdd:i}}Gn.makeConverter=wh});var Nr=y(Ht=>{"use strict";a();p();Object.defineProperty(Ht,"__esModule",{value:!0});var J=C(),yh=po(),gh=fo(),_h=lo(),Sh=yo(),Eh=_o(),mh=Eo(),Th=To(),bh=ko(),kh=Po(),Oh=Ao(),Ih=Ho(),Ph=qo(),vh=Mo(),Ah=Fo(),$o=Ln(),jn=Do(),Yo=Go(),zo=jo(),Qo=Vo(),Jo=Xo(),Nh={unsignedTx:gh,globalXpub:yh,checkPubkey:jn.makeChecker([])};Ht.globals=Nh;var Uh={nonWitnessUtxo:Eh,partialSig:mh,sighashType:bh,finalScriptSig:_h,finalScriptWitness:Sh,porCommitment:Th,witnessUtxo:vh,bip32Derivation:$o.makeConverter(J.InputTypes.BIP32_DERIVATION),redeemScript:Yo.makeConverter(J.InputTypes.REDEEM_SCRIPT),witnessScript:Jo.makeConverter(J.InputTypes.WITNESS_SCRIPT),checkPubkey:jn.makeChecker([J.InputTypes.PARTIAL_SIG,J.InputTypes.BIP32_DERIVATION]),tapKeySig:kh,tapScriptSig:Ph,tapLeafScript:Oh,tapBip32Derivation:zo.makeConverter(J.InputTypes.TAP_BIP32_DERIVATION),tapInternalKey:Qo.makeConverter(J.InputTypes.TAP_INTERNAL_KEY),tapMerkleRoot:Ih};Ht.inputs=Uh;var Hh={bip32Derivation:$o.makeConverter(J.OutputTypes.BIP32_DERIVATION),redeemScript:Yo.makeConverter(J.OutputTypes.REDEEM_SCRIPT),witnessScript:Jo.makeConverter(J.OutputTypes.WITNESS_SCRIPT),checkPubkey:jn.makeChecker([J.OutputTypes.BIP32_DERIVATION]),tapBip32Derivation:zo.makeConverter(J.OutputTypes.TAP_BIP32_DERIVATION),tapTree:Ah,tapInternalKey:Qo.makeConverter(J.OutputTypes.TAP_INTERNAL_KEY)};Ht.outputs=Hh});var tu=y(xt=>{"use strict";a();p();Object.defineProperty(xt,"__esModule",{value:!0});var v=Nr(),Ur=Pr(),Zo=Qe(),_=C();function xh(e,t){let r=0;function n(){let U=Zo.decode(e,r);r+=Zo.encodingLength(U);let $=e.slice(r,r+U);return r+=U,$}function s(){let U=e.readUInt32BE(r);return r+=4,U}function i(){let U=e.readUInt8(r);return r+=1,U}function o(){let U=n(),$=n();return{key:U,value:$}}function u(){if(r>=e.length)throw new Error("Format Error: Unexpected End of PSBT");let U=e.readUInt8(r)===0;return U&&r++,U}if(s()!==1886610036)throw new Error("Format Error: Invalid Magic Number");if(i()!==255)throw new Error("Format Error: Magic Number must be followed by 0xff separator");let f=[],l={};for(;!u();){let U=o(),$=U.key.toString("hex");if(l[$])throw new Error("Format Error: Keys must be unique for global keymap: key "+$);l[$]=1,f.push(U)}let d=f.filter(U=>U.key[0]===_.GlobalTypes.UNSIGNED_TX);if(d.length!==1)throw new Error("Format Error: Only one UNSIGNED_TX allowed");let h=t(d[0].value),{inputCount:w,outputCount:q}=h.getInputOutputCounts(),R=[],j=[];for(let U of Ur.range(w)){let $={},_t=[];for(;!u();){let St=o(),xe=St.key.toString("hex");if($[xe])throw new Error("Format Error: Keys must be unique for each input: input index "+U+" key "+xe);$[xe]=1,_t.push(St)}R.push(_t)}for(let U of Ur.range(q)){let $={},_t=[];for(;!u();){let St=o(),xe=St.key.toString("hex");if($[xe])throw new Error("Format Error: Keys must be unique for each output: output index "+U+" key "+xe);$[xe]=1,_t.push(St)}j.push(_t)}return eu(h,{globalMapKeyVals:f,inputKeyVals:R,outputKeyVals:j})}xt.psbtFromBuffer=xh;function M(e,t,r){if(!t.equals(c.Buffer.from([r])))throw new Error(`Format Error: Invalid ${e} key: ${t.toString("hex")}`)}xt.checkKeyBuffer=M;function eu(e,{globalMapKeyVals:t,inputKeyVals:r,outputKeyVals:n}){let s={unsignedTx:e},i=0;for(let d of t)switch(d.key[0]){case _.GlobalTypes.UNSIGNED_TX:if(M("global",d.key,_.GlobalTypes.UNSIGNED_TX),i>0)throw new Error("Format Error: GlobalMap has multiple UNSIGNED_TX");i++;break;case _.GlobalTypes.GLOBAL_XPUB:s.globalXpub===void 0&&(s.globalXpub=[]),s.globalXpub.push(v.globals.globalXpub.decode(d));break;default:s.unknownKeyVals||(s.unknownKeyVals=[]),s.unknownKeyVals.push(d)}let o=r.length,u=n.length,f=[],l=[];for(let d of Ur.range(o)){let h={};for(let w of r[d])switch(v.inputs.checkPubkey(w),w.key[0]){case _.InputTypes.NON_WITNESS_UTXO:if(M("input",w.key,_.InputTypes.NON_WITNESS_UTXO),h.nonWitnessUtxo!==void 0)throw new Error("Format Error: Input has multiple NON_WITNESS_UTXO");h.nonWitnessUtxo=v.inputs.nonWitnessUtxo.decode(w);break;case _.InputTypes.WITNESS_UTXO:if(M("input",w.key,_.InputTypes.WITNESS_UTXO),h.witnessUtxo!==void 0)throw new Error("Format Error: Input has multiple WITNESS_UTXO");h.witnessUtxo=v.inputs.witnessUtxo.decode(w);break;case _.InputTypes.PARTIAL_SIG:h.partialSig===void 0&&(h.partialSig=[]),h.partialSig.push(v.inputs.partialSig.decode(w));break;case _.InputTypes.SIGHASH_TYPE:if(M("input",w.key,_.InputTypes.SIGHASH_TYPE),h.sighashType!==void 0)throw new Error("Format Error: Input has multiple SIGHASH_TYPE");h.sighashType=v.inputs.sighashType.decode(w);break;case _.InputTypes.REDEEM_SCRIPT:if(M("input",w.key,_.InputTypes.REDEEM_SCRIPT),h.redeemScript!==void 0)throw new Error("Format Error: Input has multiple REDEEM_SCRIPT");h.redeemScript=v.inputs.redeemScript.decode(w);break;case _.InputTypes.WITNESS_SCRIPT:if(M("input",w.key,_.InputTypes.WITNESS_SCRIPT),h.witnessScript!==void 0)throw new Error("Format Error: Input has multiple WITNESS_SCRIPT");h.witnessScript=v.inputs.witnessScript.decode(w);break;case _.InputTypes.BIP32_DERIVATION:h.bip32Derivation===void 0&&(h.bip32Derivation=[]),h.bip32Derivation.push(v.inputs.bip32Derivation.decode(w));break;case _.InputTypes.FINAL_SCRIPTSIG:M("input",w.key,_.InputTypes.FINAL_SCRIPTSIG),h.finalScriptSig=v.inputs.finalScriptSig.decode(w);break;case _.InputTypes.FINAL_SCRIPTWITNESS:M("input",w.key,_.InputTypes.FINAL_SCRIPTWITNESS),h.finalScriptWitness=v.inputs.finalScriptWitness.decode(w);break;case _.InputTypes.POR_COMMITMENT:M("input",w.key,_.InputTypes.POR_COMMITMENT),h.porCommitment=v.inputs.porCommitment.decode(w);break;case _.InputTypes.TAP_KEY_SIG:M("input",w.key,_.InputTypes.TAP_KEY_SIG),h.tapKeySig=v.inputs.tapKeySig.decode(w);break;case _.InputTypes.TAP_SCRIPT_SIG:h.tapScriptSig===void 0&&(h.tapScriptSig=[]),h.tapScriptSig.push(v.inputs.tapScriptSig.decode(w));break;case _.InputTypes.TAP_LEAF_SCRIPT:h.tapLeafScript===void 0&&(h.tapLeafScript=[]),h.tapLeafScript.push(v.inputs.tapLeafScript.decode(w));break;case _.InputTypes.TAP_BIP32_DERIVATION:h.tapBip32Derivation===void 0&&(h.tapBip32Derivation=[]),h.tapBip32Derivation.push(v.inputs.tapBip32Derivation.decode(w));break;case _.InputTypes.TAP_INTERNAL_KEY:M("input",w.key,_.InputTypes.TAP_INTERNAL_KEY),h.tapInternalKey=v.inputs.tapInternalKey.decode(w);break;case _.InputTypes.TAP_MERKLE_ROOT:M("input",w.key,_.InputTypes.TAP_MERKLE_ROOT),h.tapMerkleRoot=v.inputs.tapMerkleRoot.decode(w);break;default:h.unknownKeyVals||(h.unknownKeyVals=[]),h.unknownKeyVals.push(w)}f.push(h)}for(let d of Ur.range(u)){let h={};for(let w of n[d])switch(v.outputs.checkPubkey(w),w.key[0]){case _.OutputTypes.REDEEM_SCRIPT:if(M("output",w.key,_.OutputTypes.REDEEM_SCRIPT),h.redeemScript!==void 0)throw new Error("Format Error: Output has multiple REDEEM_SCRIPT");h.redeemScript=v.outputs.redeemScript.decode(w);break;case _.OutputTypes.WITNESS_SCRIPT:if(M("output",w.key,_.OutputTypes.WITNESS_SCRIPT),h.witnessScript!==void 0)throw new Error("Format Error: Output has multiple WITNESS_SCRIPT");h.witnessScript=v.outputs.witnessScript.decode(w);break;case _.OutputTypes.BIP32_DERIVATION:h.bip32Derivation===void 0&&(h.bip32Derivation=[]),h.bip32Derivation.push(v.outputs.bip32Derivation.decode(w));break;case _.OutputTypes.TAP_INTERNAL_KEY:M("output",w.key,_.OutputTypes.TAP_INTERNAL_KEY),h.tapInternalKey=v.outputs.tapInternalKey.decode(w);break;case _.OutputTypes.TAP_TREE:M("output",w.key,_.OutputTypes.TAP_TREE),h.tapTree=v.outputs.tapTree.decode(w);break;case _.OutputTypes.TAP_BIP32_DERIVATION:h.tapBip32Derivation===void 0&&(h.tapBip32Derivation=[]),h.tapBip32Derivation.push(v.outputs.tapBip32Derivation.decode(w));break;default:h.unknownKeyVals||(h.unknownKeyVals=[]),h.unknownKeyVals.push(w)}l.push(h)}return{globalMap:s,inputs:f,outputs:l}}xt.psbtFromKeyVals=eu});var su=y(Hr=>{"use strict";a();p();Object.defineProperty(Hr,"__esModule",{value:!0});var Vn=Nr(),ru=Pr();function qh({globalMap:e,inputs:t,outputs:r}){let{globalKeyVals:n,inputKeyVals:s,outputKeyVals:i}=nu({globalMap:e,inputs:t,outputs:r}),o=ru.keyValsToBuffer(n),u=h=>h.length===0?[c.Buffer.from([0])]:h.map(ru.keyValsToBuffer),f=u(s),l=u(i),d=c.Buffer.allocUnsafe(5);return d.writeUIntBE(482972169471,0,5),c.Buffer.concat([d,o].concat(f,l))}Hr.psbtToBuffer=qh;var Ch=(e,t)=>e.key.compare(t.key);function Xn(e,t){let r=new Set,n=Object.entries(e).reduce((i,[o,u])=>{if(o==="unknownKeyVals")return i;let f=t[o];if(f===void 0)return i;let l=(Array.isArray(u)?u:[u]).map(f.encode);return l.map(h=>h.key.toString("hex")).forEach(h=>{if(r.has(h))throw new Error("Serialize Error: Duplicate key: "+h);r.add(h)}),i.concat(l)},[]),s=e.unknownKeyVals?e.unknownKeyVals.filter(i=>!r.has(i.key.toString("hex"))):[];return n.concat(s).sort(Ch)}function nu({globalMap:e,inputs:t,outputs:r}){return{globalKeyVals:Xn(e,Vn.globals),inputKeyVals:t.map(n=>Xn(n,Vn.inputs)),outputKeyVals:r.map(n=>Xn(n,Vn.outputs))}}Hr.psbtToKeyVals=nu});var $n=y(xr=>{"use strict";a();p();function iu(e){for(var t in e)xr.hasOwnProperty(t)||(xr[t]=e[t])}Object.defineProperty(xr,"__esModule",{value:!0});iu(tu());iu(su())});var uu=y(Qn=>{"use strict";a();p();Object.defineProperty(Qn,"__esModule",{value:!0});var Yn=$n();function Bh(e){let t=e[0],r=Yn.psbtToKeyVals(t),n=e.slice(1);if(n.length===0)throw new Error("Combine: Nothing to combine");let s=ou(t);if(s===void 0)throw new Error("Combine: Self missing transaction");let i=dt(r.globalKeyVals),o=r.inputKeyVals.map(dt),u=r.outputKeyVals.map(dt);for(let f of n){let l=ou(f);if(l===void 0||!l.toBuffer().equals(s.toBuffer()))throw new Error("Combine: One of the Psbts does not have the same transaction.");let d=Yn.psbtToKeyVals(f);dt(d.globalKeyVals).forEach(zn(i,r.globalKeyVals,d.globalKeyVals)),d.inputKeyVals.map(dt).forEach((R,j)=>R.forEach(zn(o[j],r.inputKeyVals[j],d.inputKeyVals[j]))),d.outputKeyVals.map(dt).forEach((R,j)=>R.forEach(zn(u[j],r.outputKeyVals[j],d.outputKeyVals[j])))}return Yn.psbtFromKeyVals(s,{globalMapKeyVals:r.globalKeyVals,inputKeyVals:r.inputKeyVals,outputKeyVals:r.outputKeyVals})}Qn.combine=Bh;function zn(e,t,r){return n=>{if(e.has(n))return;let s=r.filter(i=>i.key.toString("hex")===n)[0];t.push(s),e.add(n)}}function ou(e){return e.globalMap.unsignedTx}function dt(e){let t=new Set;return e.forEach(r=>{let n=r.key.toString("hex");if(t.has(n))throw new Error("Combine: KeyValue Map keys should be unique");t.add(n)}),t}});var Zn=y(G=>{"use strict";a();p();Object.defineProperty(G,"__esModule",{value:!0});var Rh=Nr();function au(e,t){let r=e[t];if(r===void 0)throw new Error(`No input #${t}`);return r}G.checkForInput=au;function pu(e,t){let r=e[t];if(r===void 0)throw new Error(`No output #${t}`);return r}G.checkForOutput=pu;function Kh(e,t,r){if(e.key[0]<r)throw new Error("Use the method for your specific key instead of addUnknownKeyVal*");if(t&&t.filter(n=>n.key.equals(e.key)).length!==0)throw new Error(`Duplicate Key: ${e.key.toString("hex")}`)}G.checkHasKey=Kh;function Lh(e){let t=0;return Object.keys(e).forEach(r=>{Number(isNaN(Number(r)))&&t++}),t}G.getEnumLength=Lh;function Mh(e,t){let r=!1;if(t.nonWitnessUtxo||t.witnessUtxo){let n=!!t.redeemScript,s=!!t.witnessScript,i=!n||!!t.finalScriptSig,o=!s||!!t.finalScriptWitness,u=!!t.finalScriptSig||!!t.finalScriptWitness;r=i&&o&&u}if(r===!1)throw new Error(`Input #${e} has too much or too little data to clean`)}G.inputCheckUncleanFinalized=Mh;function cu(e,t,r,n){throw new Error(`Data for ${e} key ${t} is incorrect: Expected ${r} and got ${JSON.stringify(n)}`)}function Jn(e){return(t,r)=>{for(let n of Object.keys(t)){let s=t[n],{canAdd:i,canAddToArray:o,check:u,expected:f}=Rh[e+"s"][n]||{},l=!!o;if(u)if(l){if(!Array.isArray(s)||r[n]&&!Array.isArray(r[n]))throw new Error(`Key type ${n} must be an array`);s.every(u)||cu(e,n,f,s);let d=r[n]||[],h=new Set;if(!s.every(w=>o(d,w,h)))throw new Error("Can not add duplicate data to array");r[n]=d.concat(s)}else{if(u(s)||cu(e,n,f,s),!i(r,s))throw new Error(`Can not add duplicate data to ${e}`);r[n]=s}}}}G.updateGlobal=Jn("global");G.updateInput=Jn("input");G.updateOutput=Jn("output");function Wh(e,t){let r=e.length-1,n=au(e,r);G.updateInput(t,n)}G.addInputAttributes=Wh;function Fh(e,t){let r=e.length-1,n=pu(e,r);G.updateOutput(t,n)}G.addOutputAttributes=Fh;function Dh(e,t){if(!c.Buffer.isBuffer(t)||t.length<4)throw new Error("Set Version: Invalid Transaction");return t.writeUInt32LE(e,0),t}G.defaultVersionSetter=Dh;function Gh(e,t){if(!c.Buffer.isBuffer(t)||t.length<4)throw new Error("Set Locktime: Invalid Transaction");return t.writeUInt32LE(e,t.length-4),t}G.defaultLocktimeSetter=Gh});var hu=y(rs=>{"use strict";a();p();Object.defineProperty(rs,"__esModule",{value:!0});var jh=uu(),fu=$n(),es=C(),W=Zn(),ts=class{constructor(t){this.inputs=[],this.outputs=[],this.globalMap={unsignedTx:t}}static fromBase64(t,r){let n=c.Buffer.from(t,"base64");return this.fromBuffer(n,r)}static fromHex(t,r){let n=c.Buffer.from(t,"hex");return this.fromBuffer(n,r)}static fromBuffer(t,r){let n=fu.psbtFromBuffer(t,r),s=new this(n.globalMap.unsignedTx);return Object.assign(s,n),s}toBase64(){return this.toBuffer().toString("base64")}toHex(){return this.toBuffer().toString("hex")}toBuffer(){return fu.psbtToBuffer(this)}updateGlobal(t){return W.updateGlobal(t,this.globalMap),this}updateInput(t,r){let n=W.checkForInput(this.inputs,t);return W.updateInput(r,n),this}updateOutput(t,r){let n=W.checkForOutput(this.outputs,t);return W.updateOutput(r,n),this}addUnknownKeyValToGlobal(t){return W.checkHasKey(t,this.globalMap.unknownKeyVals,W.getEnumLength(es.GlobalTypes)),this.globalMap.unknownKeyVals||(this.globalMap.unknownKeyVals=[]),this.globalMap.unknownKeyVals.push(t),this}addUnknownKeyValToInput(t,r){let n=W.checkForInput(this.inputs,t);return W.checkHasKey(r,n.unknownKeyVals,W.getEnumLength(es.InputTypes)),n.unknownKeyVals||(n.unknownKeyVals=[]),n.unknownKeyVals.push(r),this}addUnknownKeyValToOutput(t,r){let n=W.checkForOutput(this.outputs,t);return W.checkHasKey(r,n.unknownKeyVals,W.getEnumLength(es.OutputTypes)),n.unknownKeyVals||(n.unknownKeyVals=[]),n.unknownKeyVals.push(r),this}addInput(t){this.globalMap.unsignedTx.addInput(t),this.inputs.push({unknownKeyVals:[]});let r=t.unknownKeyVals||[],n=this.inputs.length-1;if(!Array.isArray(r))throw new Error("unknownKeyVals must be an Array");return r.forEach(s=>this.addUnknownKeyValToInput(n,s)),W.addInputAttributes(this.inputs,t),this}addOutput(t){this.globalMap.unsignedTx.addOutput(t),this.outputs.push({unknownKeyVals:[]});let r=t.unknownKeyVals||[],n=this.outputs.length-1;if(!Array.isArray(r))throw new Error("unknownKeyVals must be an Array");return r.forEach(s=>this.addUnknownKeyValToInput(n,s)),W.addOutputAttributes(this.outputs,t),this}clearFinalizedInput(t){let r=W.checkForInput(this.inputs,t);W.inputCheckUncleanFinalized(t,r);for(let n of Object.keys(r))["witnessUtxo","nonWitnessUtxo","finalScriptSig","finalScriptWitness","unknownKeyVals"].includes(n)||delete r[n];return this}combine(...t){let r=jh.combine([this].concat(t));return Object.assign(this,r),this}getTransaction(){return this.globalMap.unsignedTx.toBuffer()}};rs.Psbt=ts});var Bu=y(os=>{"use strict";a();p();Object.defineProperty(os,"__esModule",{value:!0});var lu=hu(),Cr=Qe(),ie=Zn(),du=Sr(),Br=Pt(),Vh=ne(),ku=mr(),Xh=z(),F=kt(),V=S(),x=vt(),$h={network:Xh.bitcoin,maximumFeeRate:5e3},wt=class{constructor(t={},r=new lu.Psbt(new Rr)){this.data=r,this.opts=Object.assign({},$h,t),this.__CACHE={__NON_WITNESS_UTXO_TX_CACHE:[],__NON_WITNESS_UTXO_BUF_CACHE:[],__TX_IN_CACHE:{},__TX:this.data.globalMap.unsignedTx.tx,__UNSAFE_SIGN_NONSEGWIT:!1},this.data.inputs.length===0&&this.setVersion(2);let n=(s,i,o,u)=>Object.defineProperty(s,i,{enumerable:o,writable:u});n(this,"__CACHE",!1,!0),n(this,"opts",!1,!0)}static fromBase64(t,r={}){let n=c.Buffer.from(t,"base64");return this.fromBuffer(n,r)}static fromHex(t,r={}){let n=c.Buffer.from(t,"hex");return this.fromBuffer(n,r)}static fromBuffer(t,r={}){let n=lu.Psbt.fromBuffer(t,Yh),s=new wt(r,n);return nl(s.__CACHE.__TX,s.__CACHE),s}get inputCount(){return this.data.inputs.length}get version(){return this.__CACHE.__TX.version}set version(t){this.setVersion(t)}get locktime(){return this.__CACHE.__TX.locktime}set locktime(t){this.setLocktime(t)}get txInputs(){return this.__CACHE.__TX.ins.map(t=>({hash:Br.cloneBuffer(t.hash),index:t.index,sequence:t.sequence}))}get txOutputs(){return this.__CACHE.__TX.outs.map(t=>{let r;try{r=du.fromOutputScript(t.script,this.opts.network)}catch{}return{script:Br.cloneBuffer(t.script),value:t.value,address:r}})}combine(...t){return this.data.combine(...t.map(r=>r.data)),this}clone(){let t=wt.fromBuffer(this.data.toBuffer());return t.opts=JSON.parse(JSON.stringify(this.opts)),t}setMaximumFeeRate(t){qr(t),this.opts.maximumFeeRate=t}setVersion(t){qr(t),qt(this.data.inputs,"setVersion");let r=this.__CACHE;return r.__TX.version=t,r.__EXTRACTED_TX=void 0,this}setLocktime(t){qr(t),qt(this.data.inputs,"setLocktime");let r=this.__CACHE;return r.__TX.locktime=t,r.__EXTRACTED_TX=void 0,this}setInputSequence(t,r){qr(r),qt(this.data.inputs,"setInputSequence");let n=this.__CACHE;if(n.__TX.ins.length<=t)throw new Error("Input index too high");return n.__TX.ins[t].sequence=r,n.__EXTRACTED_TX=void 0,this}addInputs(t){return t.forEach(r=>this.addInput(r)),this}addInput(t){if(arguments.length>1||!t||t.hash===void 0||t.index===void 0)throw new Error("Invalid arguments for Psbt.addInput. Requires single object with at least [hash] and [index]");qt(this.data.inputs,"addInput"),t.witnessScript&&Kr(t.witnessScript);let r=this.__CACHE;this.data.addInput(t);let n=r.__TX.ins[r.__TX.ins.length-1];vu(r,n);let s=this.data.inputs.length-1,i=this.data.inputs[s];return i.nonWitnessUtxo&&ss(this.__CACHE,i,s),r.__FEE=void 0,r.__FEE_RATE=void 0,r.__EXTRACTED_TX=void 0,this}addOutputs(t){return t.forEach(r=>this.addOutput(r)),this}addOutput(t){if(arguments.length>1||!t||t.value===void 0||t.address===void 0&&t.script===void 0)throw new Error("Invalid arguments for Psbt.addOutput. Requires single object with at least [script or address] and [value]");qt(this.data.inputs,"addOutput");let{address:r}=t;if(typeof r=="string"){let{network:s}=this.opts,i=du.toOutputScript(r,s);t=Object.assign(t,{script:i})}let n=this.__CACHE;return this.data.addOutput(t),n.__FEE=void 0,n.__FEE_RATE=void 0,n.__EXTRACTED_TX=void 0,this}extractTransaction(t){if(!this.data.inputs.every(Ou))throw new Error("Not finalized");let r=this.__CACHE;if(t||el(this,r,this.opts),r.__EXTRACTED_TX)return r.__EXTRACTED_TX;let n=r.__TX.clone();return Hu(this.data.inputs,n,r,!0),n}getFeeRate(){return Eu("__FEE_RATE","fee rate",this.data.inputs,this.__CACHE)}getFee(){return Eu("__FEE","fee",this.data.inputs,this.__CACHE)}finalizeAllInputs(){return ie.checkForInput(this.data.inputs,0),Ct(this.data.inputs.length).forEach(t=>this.finalizeInput(t)),this}finalizeInput(t,r=sl){let n=ie.checkForInput(this.data.inputs,t),{script:s,isP2SH:i,isP2WSH:o,isSegwit:u}=cl(t,n,this.__CACHE);if(!s)throw new Error(`No script found for input #${t}`);tl(n);let{finalScriptSig:f,finalScriptWitness:l}=r(t,n,s,u,i,o);if(f&&this.data.updateInput(t,{finalScriptSig:f}),l&&this.data.updateInput(t,{finalScriptWitness:l}),!f&&!l)throw new Error(`Unknown error finalizing input #${t}`);return this.data.clearFinalizedInput(t),this}getInputType(t){let r=ie.checkForInput(this.data.inputs,t),n=xu(t,r,this.__CACHE),s=Wr(n,t,"input",r.redeemScript||ll(r.finalScriptSig),r.witnessScript||dl(r.finalScriptWitness)),i=s.type==="raw"?"":s.type+"-",o=Cu(s.meaningfulScript);return i+o}inputHasPubkey(t,r){let n=ie.checkForInput(this.data.inputs,t);return fl(r,n,t,this.__CACHE)}inputHasHDKey(t,r){let n=ie.checkForInput(this.data.inputs,t),s=gu(r);return!!n.bip32Derivation&&n.bip32Derivation.some(s)}outputHasPubkey(t,r){let n=ie.checkForOutput(this.data.outputs,t);return hl(r,n,t,this.__CACHE)}outputHasHDKey(t,r){let n=ie.checkForOutput(this.data.outputs,t),s=gu(r);return!!n.bip32Derivation&&n.bip32Derivation.some(s)}validateSignaturesOfAllInputs(){return ie.checkForInput(this.data.inputs,0),Ct(this.data.inputs.length).map(r=>this.validateSignaturesOfInput(r)).reduce((r,n)=>n===!0&&r,!0)}validateSignaturesOfInput(t,r){let n=this.data.inputs[t],s=(n||{}).partialSig;if(!n||!s||s.length<1)throw new Error("No signatures to validate");let i=r?s.filter(d=>d.pubkey.equals(r)):s;if(i.length<1)throw new Error("No signatures for this pubkey");let o=[],u,f,l;for(let d of i){let h=V.signature.decode(d.signature),{hash:w,script:q}=l!==h.hashType?Nu(t,Object.assign({},n,{sighashType:h.hashType}),this.__CACHE,!0):{hash:u,script:f};l=h.hashType,u=w,f=q,Pu(d.pubkey,q,"verify");let R=ku.fromPublicKey(d.pubkey);o.push(R.verify(w,h.signature))}return o.every(d=>d===!0)}signAllInputsHD(t,r=[x.Transaction.SIGHASH_ALL]){if(!t||!t.publicKey||!t.fingerprint)throw new Error("Need HDSigner to sign input");let n=[];for(let s of Ct(this.data.inputs.length))try{this.signInputHD(s,t,r),n.push(!0)}catch{n.push(!1)}if(n.every(s=>s===!1))throw new Error("No inputs were signed");return this}signAllInputsHDAsync(t,r=[x.Transaction.SIGHASH_ALL]){return new Promise((n,s)=>{if(!t||!t.publicKey||!t.fingerprint)return s(new Error("Need HDSigner to sign input"));let i=[],o=[];for(let u of Ct(this.data.inputs.length))o.push(this.signInputHDAsync(u,t,r).then(()=>{i.push(!0)},()=>{i.push(!1)}));return Promise.all(o).then(()=>{if(i.every(u=>u===!1))return s(new Error("No inputs were signed"));n()})})}signInputHD(t,r,n=[x.Transaction.SIGHASH_ALL]){if(!r||!r.publicKey||!r.fingerprint)throw new Error("Need HDSigner to sign input");return Tu(t,this.data.inputs,r).forEach(i=>this.signInput(t,i,n)),this}signInputHDAsync(t,r,n=[x.Transaction.SIGHASH_ALL]){return new Promise((s,i)=>{if(!r||!r.publicKey||!r.fingerprint)return i(new Error("Need HDSigner to sign input"));let u=Tu(t,this.data.inputs,r).map(f=>this.signInputAsync(t,f,n));return Promise.all(u).then(()=>{s()}).catch(i)})}signAllInputs(t,r=[x.Transaction.SIGHASH_ALL]){if(!t||!t.publicKey)throw new Error("Need Signer to sign input");let n=[];for(let s of Ct(this.data.inputs.length))try{this.signInput(s,t,r),n.push(!0)}catch{n.push(!1)}if(n.every(s=>s===!1))throw new Error("No inputs were signed");return this}signAllInputsAsync(t,r=[x.Transaction.SIGHASH_ALL]){return new Promise((n,s)=>{if(!t||!t.publicKey)return s(new Error("Need Signer to sign input"));let i=[],o=[];for(let[u]of this.data.inputs.entries())o.push(this.signInputAsync(u,t,r).then(()=>{i.push(!0)},()=>{i.push(!1)}));return Promise.all(o).then(()=>{if(i.every(u=>u===!1))return s(new Error("No inputs were signed"));n()})})}signInput(t,r,n=[x.Transaction.SIGHASH_ALL]){if(!r||!r.publicKey)throw new Error("Need Signer to sign input");let{hash:s,sighashType:i}=mu(this.data.inputs,t,r.publicKey,this.__CACHE,n),o=[{pubkey:r.publicKey,signature:V.signature.encode(r.sign(s),i)}];return this.data.updateInput(t,{partialSig:o}),this}signInputAsync(t,r,n=[x.Transaction.SIGHASH_ALL]){return Promise.resolve().then(()=>{if(!r||!r.publicKey)throw new Error("Need Signer to sign input");let{hash:s,sighashType:i}=mu(this.data.inputs,t,r.publicKey,this.__CACHE,n);return Promise.resolve(r.sign(s)).then(o=>{let u=[{pubkey:r.publicKey,signature:V.signature.encode(o,i)}];this.data.updateInput(t,{partialSig:u})})})}toBuffer(){return ns(this.__CACHE),this.data.toBuffer()}toHex(){return ns(this.__CACHE),this.data.toHex()}toBase64(){return ns(this.__CACHE),this.data.toBase64()}updateGlobal(t){return this.data.updateGlobal(t),this}updateInput(t,r){return r.witnessScript&&Kr(r.witnessScript),this.data.updateInput(t,r),r.nonWitnessUtxo&&ss(this.__CACHE,this.data.inputs[t],t),this}updateOutput(t,r){return this.data.updateOutput(t,r),this}addUnknownKeyValToGlobal(t){return this.data.addUnknownKeyValToGlobal(t),this}addUnknownKeyValToInput(t,r){return this.data.addUnknownKeyValToInput(t,r),this}addUnknownKeyValToOutput(t,r){return this.data.addUnknownKeyValToOutput(t,r),this}clearFinalizedInput(t){return this.data.clearFinalizedInput(t),this}};os.Psbt=wt;var Yh=e=>new Rr(e),Rr=class{constructor(t=c.Buffer.from([2,0,0,0,0,0,0,0,0,0])){this.tx=x.Transaction.fromBuffer(t),rl(this.tx),Object.defineProperty(this,"tx",{enumerable:!1,writable:!0})}getInputOutputCounts(){return{inputCount:this.tx.ins.length,outputCount:this.tx.outs.length}}addInput(t){if(t.hash===void 0||t.index===void 0||!c.Buffer.isBuffer(t.hash)&&typeof t.hash!="string"||typeof t.index!="number")throw new Error("Error adding input.");let r=typeof t.hash=="string"?Br.reverseBuffer(c.Buffer.from(t.hash,"hex")):t.hash;this.tx.addInput(r,t.index,t.sequence)}addOutput(t){if(t.script===void 0||t.value===void 0||!c.Buffer.isBuffer(t.script)||typeof t.value!="number")throw new Error("Error adding output.");this.tx.addOutput(t.script,t.value)}toBuffer(){return this.tx.toBuffer()}};function zh(e,t,r){switch(r){case"pubkey":case"pubkeyhash":case"witnesspubkeyhash":return wu(1,e.partialSig);case"multisig":let n=F.p2ms({output:t});return wu(n.m,e.partialSig,n.pubkeys);default:return!1}}function ns(e){if(e.__UNSAFE_SIGN_NONSEGWIT!==!1)throw new Error("Not BIP174 compliant, can not export")}function wu(e,t,r){if(!t)return!1;let n;if(r?n=r.map(s=>{let i=ku.fromPublicKey(s,{compressed:!0}).publicKey;return t.find(o=>o.pubkey.equals(i))}).filter(s=>!!s):n=t,n.length>e)throw new Error("Too many signatures");return n.length===e}function Ou(e){return!!e.finalScriptSig||!!e.finalScriptWitness}function yt(e){return t=>{try{return e({output:t}),!0}catch{return!1}}}var Qh=yt(F.p2ms),Jh=yt(F.p2pk),Zh=yt(F.p2pkh),Lr=yt(F.p2wpkh),yu=yt(F.p2wsh),Iu=yt(F.p2sh);function gu(e){return t=>!(!t.masterFingerprint.equals(e.fingerprint)||!e.derivePath(t.path).publicKey.equals(t.pubkey))}function qr(e){if(typeof e!="number"||e!==Math.floor(e)||e>4294967295||e<0)throw new Error("Invalid 32 bit integer")}function el(e,t,r){let n=t.__FEE_RATE||e.getFeeRate(),s=t.__EXTRACTED_TX.virtualSize(),i=n*s;if(n>=r.maximumFeeRate)throw new Error(`Warning: You are paying around ${(i/1e8).toFixed(8)} in fees, which is ${n} satoshi per byte for a transaction with a VSize of ${s} bytes (segwit counted as 0.25 byte per byte). Use setMaximumFeeRate method to raise your threshold, or pass true to the first arg of extractTransaction.`)}function qt(e,t){e.forEach(r=>{let n=!1,s=[];if((r.partialSig||[]).length===0){if(!r.finalScriptSig&&!r.finalScriptWitness)return;s=ul(r)}else s=r.partialSig;if(s.forEach(i=>{let{hashType:o}=V.signature.decode(i.signature),u=[];switch(o&x.Transaction.SIGHASH_ANYONECANPAY&&u.push("addInput"),o&31){case x.Transaction.SIGHASH_ALL:break;case x.Transaction.SIGHASH_SINGLE:case x.Transaction.SIGHASH_NONE:u.push("addOutput"),u.push("setInputSequence");break}u.indexOf(t)===-1&&(n=!0)}),n)throw new Error("Can not modify transaction, signatures exist.")})}function tl(e){if(!e.sighashType||!e.partialSig)return;let{partialSig:t,sighashType:r}=e;t.forEach(n=>{let{hashType:s}=V.signature.decode(n.signature);if(r!==s)throw new Error("Signature sighash does not match input sighash type")})}function Pu(e,t,r){if(!is(e,t))throw new Error(`Can not ${r} for this input with the key ${e.toString("hex")}`)}function rl(e){if(!e.ins.every(r=>r.script&&r.script.length===0&&r.witness&&r.witness.length===0))throw new Error("Format Error: Transaction ScriptSigs are not empty")}function nl(e,t){e.ins.forEach(r=>{vu(t,r)})}function vu(e,t){let r=Br.reverseBuffer(c.Buffer.from(t.hash)).toString("hex")+":"+t.index;if(e.__TX_IN_CACHE[r])throw new Error("Duplicate input detected.");e.__TX_IN_CACHE[r]=1}function Au(e,t){return(r,n,s,i)=>{let o=e({redeem:{output:s}}).output;if(!n.equals(o))throw new Error(`${t} for ${i} #${r} doesn't match the scriptPubKey in the prevout`)}}var _u=Au(F.p2sh,"Redeem script"),Su=Au(F.p2wsh,"Witness script");function Eu(e,t,r,n){if(!r.every(Ou))throw new Error(`PSBT must be finalized to calculate ${t}`);if(e==="__FEE_RATE"&&n.__FEE_RATE)return n.__FEE_RATE;if(e==="__FEE"&&n.__FEE)return n.__FEE;let s,i=!0;if(n.__EXTRACTED_TX?(s=n.__EXTRACTED_TX,i=!1):s=n.__TX.clone(),Hu(r,s,n,i),e==="__FEE_RATE")return n.__FEE_RATE;if(e==="__FEE")return n.__FEE}function sl(e,t,r,n,s,i){let o=Cu(r);if(!zh(t,r,o))throw new Error(`Can not finalize input #${e}`);return il(r,o,t.partialSig,n,s,i)}function il(e,t,r,n,s,i){let o,u,f=ol(e,t,r),l=i?F.p2wsh({redeem:f}):null,d=s?F.p2sh({redeem:l||f}):null;return n?(l?u=bu(l.witness):u=bu(f.witness),d&&(o=d.input)):d?o=d.input:o=f.input,{finalScriptSig:o,finalScriptWitness:u}}function mu(e,t,r,n,s){let i=ie.checkForInput(e,t),{hash:o,sighashType:u,script:f}=Nu(t,i,n,!1,s);return Pu(r,f,"sign"),{hash:o,sighashType:u}}function Nu(e,t,r,n,s){let i=r.__TX,o=t.sighashType||x.Transaction.SIGHASH_ALL;if(s&&s.indexOf(o)<0){let h=pl(o);throw new Error(`Sighash type is not allowed. Retry the sign method passing the sighashTypes array of whitelisted types. Sighash type: ${h}`)}let u,f;if(t.nonWitnessUtxo){let h=Mr(r,t,e),w=i.ins[e].hash,q=h.getHash();if(!w.equals(q))throw new Error(`Non-witness UTXO hash for input #${e} doesn't match the hash specified in the prevout`);let R=i.ins[e].index;f=h.outs[R]}else if(t.witnessUtxo)f=t.witnessUtxo;else throw new Error("Need a Utxo input item for signing");let{meaningfulScript:l,type:d}=Wr(f.script,e,"input",t.redeemScript,t.witnessScript);if(["p2sh-p2wsh","p2wsh"].indexOf(d)>=0)u=i.hashForWitnessV0(e,l,f.value,o);else if(Lr(l)){let h=F.p2pkh({hash:l.slice(2)}).output;u=i.hashForWitnessV0(e,h,f.value,o)}else{if(t.nonWitnessUtxo===void 0&&r.__UNSAFE_SIGN_NONSEGWIT===!1)throw new Error(`Input #${e} has witnessUtxo but non-segwit script: ${l.toString("hex")}`);!n&&r.__UNSAFE_SIGN_NONSEGWIT!==!1&&console.warn(`Warning: Signing non-segwit inputs without the full parent transaction means there is a chance that a miner could feed you incorrect information to trick you into paying large fees. This behavior is the same as the old TransactionBuilder class when signing non-segwit scripts. You are not able to export this Psbt with toBuffer|toBase64|toHex since it is not BIP174 compliant.
*********************
PROCEED WITH CAUTION!
*********************`),u=i.hashForSignature(e,l,o)}return{script:l,sighashType:o,hash:u}}function ol(e,t,r){let n;switch(t){case"multisig":let s=al(e,r);n=F.p2ms({output:e,signatures:s});break;case"pubkey":n=F.p2pk({output:e,signature:r[0].signature});break;case"pubkeyhash":n=F.p2pkh({output:e,pubkey:r[0].pubkey,signature:r[0].signature});break;case"witnesspubkeyhash":n=F.p2wpkh({output:e,pubkey:r[0].pubkey,signature:r[0].signature});break}return n}function ul(e){let t=e.finalScriptSig?V.decompile(e.finalScriptSig)||[]:[],r=e.finalScriptWitness?V.decompile(e.finalScriptWitness)||[]:[];return t.concat(r).filter(n=>c.Buffer.isBuffer(n)&&V.isCanonicalScriptSignature(n)).map(n=>({signature:n}))}function cl(e,t,r){let n=r.__TX,s={script:null,isSegwit:!1,isP2SH:!1,isP2WSH:!1};if(s.isP2SH=!!t.redeemScript,s.isP2WSH=!!t.witnessScript,t.witnessScript)s.script=t.witnessScript;else if(t.redeemScript)s.script=t.redeemScript;else if(t.nonWitnessUtxo){let i=Mr(r,t,e),o=n.ins[e].index;s.script=i.outs[o].script}else t.witnessUtxo&&(s.script=t.witnessUtxo.script);return(t.witnessScript||Lr(s.script))&&(s.isSegwit=!0),s}function Tu(e,t,r){let n=ie.checkForInput(t,e);if(!n.bip32Derivation||n.bip32Derivation.length===0)throw new Error("Need bip32Derivation to sign with HD");let s=n.bip32Derivation.map(o=>{if(o.masterFingerprint.equals(r.fingerprint))return o}).filter(o=>!!o);if(s.length===0)throw new Error("Need one bip32Derivation masterFingerprint to match the HDSigner fingerprint");return s.map(o=>{let u=r.derivePath(o.path);if(!o.pubkey.equals(u.publicKey))throw new Error("pubkey did not match bip32Derivation");return u})}function al(e,t){return F.p2ms({output:e}).pubkeys.map(n=>(t.filter(s=>s.pubkey.equals(n))[0]||{}).signature).filter(n=>!!n)}function Uu(e){let t=0;function r(o){return t+=o,e.slice(t-o,t)}function n(){let o=Cr.decode(e,t);return t+=Cr.decode.bytes,o}function s(){return r(n())}function i(){let o=n(),u=[];for(let f=0;f<o;f++)u.push(s());return u}return i()}function pl(e){let t=e&x.Transaction.SIGHASH_ANYONECANPAY?"SIGHASH_ANYONECANPAY | ":"";switch(e&31){case x.Transaction.SIGHASH_ALL:t+="SIGHASH_ALL";break;case x.Transaction.SIGHASH_SINGLE:t+="SIGHASH_SINGLE";break;case x.Transaction.SIGHASH_NONE:t+="SIGHASH_NONE";break}return t}function bu(e){let t=c.Buffer.allocUnsafe(0);function r(o){t=c.Buffer.concat([t,c.Buffer.from(o)])}function n(o){let u=t.length,f=Cr.encodingLength(o);t=c.Buffer.concat([t,c.Buffer.allocUnsafe(f)]),Cr.encode(o,t,u)}function s(o){n(o.length),r(o)}function i(o){n(o.length),o.forEach(s)}return i(e),t}function ss(e,t,r){e.__NON_WITNESS_UTXO_BUF_CACHE[r]=t.nonWitnessUtxo;let n=x.Transaction.fromBuffer(t.nonWitnessUtxo);e.__NON_WITNESS_UTXO_TX_CACHE[r]=n;let s=e,i=r;delete t.nonWitnessUtxo,Object.defineProperty(t,"nonWitnessUtxo",{enumerable:!0,get(){let o=s.__NON_WITNESS_UTXO_BUF_CACHE[i],u=s.__NON_WITNESS_UTXO_TX_CACHE[i];if(o!==void 0)return o;{let f=u.toBuffer();return s.__NON_WITNESS_UTXO_BUF_CACHE[i]=f,f}},set(o){s.__NON_WITNESS_UTXO_BUF_CACHE[i]=o}})}function Hu(e,t,r,n){let s=0;e.forEach((f,l)=>{if(n&&f.finalScriptSig&&(t.ins[l].script=f.finalScriptSig),n&&f.finalScriptWitness&&(t.ins[l].witness=Uu(f.finalScriptWitness)),f.witnessUtxo)s+=f.witnessUtxo.value;else if(f.nonWitnessUtxo){let d=Mr(r,f,l),h=t.ins[l].index;s+=d.outs[h].value}});let i=t.outs.reduce((f,l)=>f+l.value,0),o=s-i;if(o<0)throw new Error("Outputs are spending more than Inputs");let u=t.virtualSize();r.__FEE=o,r.__EXTRACTED_TX=t,r.__FEE_RATE=Math.floor(o/u)}function Mr(e,t,r){let n=e.__NON_WITNESS_UTXO_TX_CACHE;return n[r]||ss(e,t,r),n[r]}function xu(e,t,r){if(t.witnessUtxo!==void 0)return t.witnessUtxo.script;if(t.nonWitnessUtxo!==void 0)return Mr(r,t,e).outs[r.__TX.ins[e].index].script;throw new Error("Can't find pubkey in input without Utxo data")}function fl(e,t,r,n){let s=xu(r,t,n),{meaningfulScript:i}=Wr(s,r,"input",t.redeemScript,t.witnessScript);return is(e,i)}function hl(e,t,r,n){let s=n.__TX.outs[r].script,{meaningfulScript:i}=Wr(s,r,"output",t.redeemScript,t.witnessScript);return is(e,i)}function ll(e){if(!e)return;let t=V.decompile(e);if(!t)return;let r=t[t.length-1];if(!(!c.Buffer.isBuffer(r)||qu(r)||wl(r)||!V.decompile(r)))return r}function dl(e){if(!e)return;let t=Uu(e),r=t[t.length-1];if(!(qu(r)||!V.decompile(r)))return r}function qu(e){return e.length===33&&V.isCanonicalPubKey(e)}function wl(e){return V.isCanonicalScriptSignature(e)}function Wr(e,t,r,n,s){let i=Iu(e),o=i&&n&&yu(n),u=yu(e);if(i&&n===void 0)throw new Error("scriptPubkey is P2SH but redeemScript missing");if((u||o)&&s===void 0)throw new Error("scriptPubkey or redeemScript is P2WSH but witnessScript missing");let f;return o?(f=s,_u(t,e,n,r),Su(t,n,s,r),Kr(f)):u?(f=s,Su(t,e,s,r),Kr(f)):i?(f=n,_u(t,e,n,r)):f=e,{meaningfulScript:f,type:o?"p2sh-p2wsh":i?"p2sh":u?"p2wsh":"raw"}}function Kr(e){if(Lr(e)||Iu(e))throw new Error("P2WPKH or P2SH can not be contained within P2WSH")}function is(e,t){let r=Vh.hash160(e),n=V.decompile(t);if(n===null)throw new Error("Unknown script error");return n.some(s=>typeof s=="number"?!1:s.equals(e)||s.equals(r))}function Cu(e){return Lr(e)?"witnesspubkeyhash":Zh(e)?"pubkeyhash":Qh(e)?"multisig":Jh(e)?"pubkey":"nonstandard"}function Ct(e){return[...Array(e).keys()]}});var Lu=y(cs=>{"use strict";a();p();Object.defineProperty(cs,"__esModule",{value:!0});var us=S(),Ru=S();function yl(e){return e===Ru.OPS.OP_0||us.isCanonicalScriptSignature(e)}function Ku(e,t){let r=us.decompile(e);return r.length<2||r[0]!==Ru.OPS.OP_0?!1:t?r.slice(1).every(yl):r.slice(1).every(us.isCanonicalScriptSignature)}cs.check=Ku;Ku.toJSON=()=>"multisig input"});var ju=y(as=>{"use strict";a();p();Object.defineProperty(as,"__esModule",{value:!0});var Mu=S(),Du=S(),Wu=ee(),Fu=Du.OPS.OP_RESERVED;function Gu(e,t){let r=Mu.decompile(e);if(r.length<4||r[r.length-1]!==Du.OPS.OP_CHECKMULTISIG||!Wu.Number(r[0])||!Wu.Number(r[r.length-2]))return!1;let n=r[0]-Fu,s=r[r.length-2]-Fu;return n<=0||s>16||n>s||s!==r.length-3?!1:t?!0:r.slice(1,-2).every(Mu.isCanonicalPubKey)}as.check=Gu;Gu.toJSON=()=>"multi-sig output"});var Dr=y(Fr=>{"use strict";a();p();Object.defineProperty(Fr,"__esModule",{value:!0});var gl=Lu();Fr.input=gl;var _l=ju();Fr.output=_l});var Xu=y(Gr=>{"use strict";a();p();Object.defineProperty(Gr,"__esModule",{value:!0});var Vu=S(),Sl=Vu.OPS;function ps(e){let t=Vu.compile(e);return t.length>1&&t[0]===Sl.OP_RETURN}Gr.check=ps;ps.toJSON=()=>"null data output";var El={check:ps};Gr.output=El});var zu=y(fs=>{"use strict";a();p();Object.defineProperty(fs,"__esModule",{value:!0});var $u=S();function Yu(e){let t=$u.decompile(e);return t.length===1&&$u.isCanonicalScriptSignature(t[0])}fs.check=Yu;Yu.toJSON=()=>"pubKey input"});var Zu=y(hs=>{"use strict";a();p();Object.defineProperty(hs,"__esModule",{value:!0});var Qu=S(),ml=S();function Ju(e){let t=Qu.decompile(e);return t.length===2&&Qu.isCanonicalPubKey(t[0])&&t[1]===ml.OPS.OP_CHECKSIG}hs.check=Ju;Ju.toJSON=()=>"pubKey output"});var Vr=y(jr=>{"use strict";a();p();Object.defineProperty(jr,"__esModule",{value:!0});var Tl=zu();jr.input=Tl;var bl=Zu();jr.output=bl});var tc=y(ds=>{"use strict";a();p();Object.defineProperty(ds,"__esModule",{value:!0});var ls=S();function ec(e){let t=ls.decompile(e);return t.length===2&&ls.isCanonicalScriptSignature(t[0])&&ls.isCanonicalPubKey(t[1])}ds.check=ec;ec.toJSON=()=>"pubKeyHash input"});var nc=y(ws=>{"use strict";a();p();Object.defineProperty(ws,"__esModule",{value:!0});var kl=S(),Xr=S();function rc(e){let t=kl.compile(e);return t.length===25&&t[0]===Xr.OPS.OP_DUP&&t[1]===Xr.OPS.OP_HASH160&&t[2]===20&&t[23]===Xr.OPS.OP_EQUALVERIFY&&t[24]===Xr.OPS.OP_CHECKSIG}ws.check=rc;rc.toJSON=()=>"pubKeyHash output"});var Yr=y($r=>{"use strict";a();p();Object.defineProperty($r,"__esModule",{value:!0});var Ol=tc();$r.input=Ol;var Il=nc();$r.output=Il});var gs=y(ys=>{"use strict";a();p();Object.defineProperty(ys,"__esModule",{value:!0});var Pl=S(),vl=S();function sc(e){let t=Pl.compile(e);return t.length===22&&t[0]===vl.OPS.OP_0&&t[1]===20}ys.check=sc;sc.toJSON=()=>"Witness pubKeyHash output"});var Ss=y(_s=>{"use strict";a();p();Object.defineProperty(_s,"__esModule",{value:!0});var Al=S(),Nl=S();function ic(e){let t=Al.compile(e);return t.length===34&&t[0]===Nl.OPS.OP_0&&t[1]===32}_s.check=ic;ic.toJSON=()=>"Witness scriptHash output"});var pc=y(Es=>{"use strict";a();p();Object.defineProperty(Es,"__esModule",{value:!0});var Bt=S(),oc=Dr(),uc=Vr(),cc=Yr(),Ul=gs(),Hl=Ss();function ac(e,t){let r=Bt.decompile(e);if(r.length<1)return!1;let n=r[r.length-1];if(!c.Buffer.isBuffer(n))return!1;let s=Bt.decompile(Bt.compile(r.slice(0,-1))),i=Bt.decompile(n);return!i||!Bt.isPushOnly(s)?!1:r.length===1?Hl.check(i)||Ul.check(i):!!(cc.input.check(s)&&cc.output.check(i)||oc.input.check(s,t)&&oc.output.check(i)||uc.input.check(s)&&uc.output.check(i))}Es.check=ac;ac.toJSON=()=>"scriptHash input"});var lc=y(ms=>{"use strict";a();p();Object.defineProperty(ms,"__esModule",{value:!0});var xl=S(),fc=S();function hc(e){let t=xl.compile(e);return t.length===23&&t[0]===fc.OPS.OP_HASH160&&t[1]===20&&t[22]===fc.OPS.OP_EQUAL}ms.check=hc;hc.toJSON=()=>"scriptHash output"});var dc=y(zr=>{"use strict";a();p();Object.defineProperty(zr,"__esModule",{value:!0});var ql=pc();zr.input=ql;var Cl=lc();zr.output=Cl});var _c=y(Rt=>{"use strict";a();p();Object.defineProperty(Rt,"__esModule",{value:!0});var Ts=S(),wc=S(),Bl=ee(),yc=H(),gc=c.Buffer.from("aa21a9ed","hex");function bs(e){let t=Ts.compile(e);return t.length>37&&t[0]===wc.OPS.OP_RETURN&&t[1]===36&&t.slice(2,6).equals(gc)}Rt.check=bs;bs.toJSON=()=>"Witness commitment output";function Rl(e){yc(Bl.Hash256bit,e);let t=c.Buffer.allocUnsafe(36);return gc.copy(t,0),e.copy(t,4),Ts.compile([wc.OPS.OP_RETURN,t])}Rt.encode=Rl;function Kl(e){return yc(bs,e),Ts.decompile(e)[1].slice(4,36)}Rt.decode=Kl});var Sc=y(ks=>{"use strict";a();p();Object.defineProperty(ks,"__esModule",{value:!0});var Ll=_c();ks.output=Ll});var mc=y(Is=>{"use strict";a();p();Object.defineProperty(Is,"__esModule",{value:!0});var Os=S();function Ml(e){return Os.isCanonicalPubKey(e)&&e.length===33}function Ec(e){let t=Os.decompile(e);return t.length===2&&Os.isCanonicalScriptSignature(t[0])&&Ml(t[1])}Is.check=Ec;Ec.toJSON=()=>"witnessPubKeyHash input"});var Tc=y(Qr=>{"use strict";a();p();Object.defineProperty(Qr,"__esModule",{value:!0});var Wl=mc();Qr.input=Wl;var Fl=gs();Qr.output=Fl});var Ac=y(Ps=>{"use strict";a();p();Object.defineProperty(Ps,"__esModule",{value:!0});var bc=S(),kc=H(),Oc=Dr(),Ic=Vr(),Pc=Yr();function vc(e,t){if(kc(kc.Array,e),e.length<1)return!1;let r=e[e.length-1];if(!c.Buffer.isBuffer(r))return!1;let n=bc.decompile(r);if(!n||n.length===0)return!1;let s=bc.compile(e.slice(0,-1));return!!(Pc.input.check(s)&&Pc.output.check(n)||Oc.input.check(s,t)&&Oc.output.check(n)||Ic.input.check(s)&&Ic.output.check(n))}Ps.check=vc;vc.toJSON=()=>"witnessScriptHash input"});var Nc=y(Jr=>{"use strict";a();p();Object.defineProperty(Jr,"__esModule",{value:!0});var Dl=Ac();Jr.input=Dl;var Gl=Ss();Jr.output=Gl});var Rc=y(gt=>{"use strict";a();p();Object.defineProperty(gt,"__esModule",{value:!0});var vs=S(),Uc=Dr(),jl=Xu(),Hc=Vr(),xc=Yr(),qc=dc(),Vl=Sc(),Cc=Tc(),Bc=Nc(),B={P2MS:"multisig",NONSTANDARD:"nonstandard",NULLDATA:"nulldata",P2PK:"pubkey",P2PKH:"pubkeyhash",P2SH:"scripthash",P2WPKH:"witnesspubkeyhash",P2WSH:"witnessscripthash",WITNESS_COMMITMENT:"witnesscommitment"};gt.types=B;function Xl(e){if(Cc.output.check(e))return B.P2WPKH;if(Bc.output.check(e))return B.P2WSH;if(xc.output.check(e))return B.P2PKH;if(qc.output.check(e))return B.P2SH;let t=vs.decompile(e);if(!t)throw new TypeError("Invalid script");return Uc.output.check(t)?B.P2MS:Hc.output.check(t)?B.P2PK:Vl.output.check(t)?B.WITNESS_COMMITMENT:jl.output.check(t)?B.NULLDATA:B.NONSTANDARD}gt.output=Xl;function $l(e,t){let r=vs.decompile(e);if(!r)throw new TypeError("Invalid script");return xc.input.check(r)?B.P2PKH:qc.input.check(r,t)?B.P2SH:Uc.input.check(r,t)?B.P2MS:Hc.input.check(r)?B.P2PK:B.NONSTANDARD}gt.input=$l;function Yl(e,t){let r=vs.decompile(e);if(!r)throw new TypeError("Invalid script");return Cc.input.check(r)?B.P2WPKH:Bc.input.check(r,t)?B.P2WSH:B.NONSTANDARD}gt.witness=Yl});var Lc=y(Hs=>{"use strict";a();p();Object.defineProperty(Hs,"__esModule",{value:!0});var zl=Sr(),Ql=Pt(),et=Rc(),Kc=ne(),Jl=mr(),Zl=z(),O=kt(),tt=S(),ed=S(),we=vt(),ye=ee(),m=H(),g=et.types,td=new Set(["p2pkh","p2pk","p2wpkh","p2ms","p2sh-p2pkh","p2sh-p2pk","p2sh-p2wpkh","p2sh-p2ms","p2wsh-p2pkh","p2wsh-p2pk","p2wsh-p2ms","p2sh-p2wsh-p2pkh","p2sh-p2wsh-p2pk","p2sh-p2wsh-p2ms"]);function k(e,t,r){try{m(e,t)}catch{throw new Error(r)}}function rd(e){return typeof e=="string"||e instanceof String}function nd(e){return e instanceof we.Transaction}var Lt=class{constructor(t=Zl.bitcoin,r=2500){this.network=t,this.maximumFeeRate=r,this.__PREV_TX_SET={},this.__INPUTS=[],this.__TX=new we.Transaction,this.__TX.version=2,this.__USE_LOW_R=!1,console.warn("Deprecation Warning: TransactionBuilder will be removed in the future. (v6.x.x or later) Please use the Psbt class instead. Examples of usage are available in the transactions-psbt.js integration test file on our Github. A high level explanation is available in the psbt.ts and psbt.js files as well.")}static fromTransaction(t,r){let n=new Lt(r);return n.setVersion(t.version),n.setLockTime(t.locktime),t.outs.forEach(s=>{n.addOutput(s.script,s.value)}),t.ins.forEach(s=>{n.__addInputUnsafe(s.hash,s.index,{sequence:s.sequence,script:s.script,witness:s.witness})}),n.__INPUTS.forEach((s,i)=>{sd(s,t,i)}),n}setLowR(t){return m(m.maybe(m.Boolean),t),t===void 0&&(t=!0),this.__USE_LOW_R=t,t}setLockTime(t){if(m(ye.UInt32,t),this.__INPUTS.some(r=>r.signatures?r.signatures.some(n=>n!==void 0):!1))throw new Error("No, this would invalidate signatures");this.__TX.locktime=t}setVersion(t){m(ye.UInt32,t),this.__TX.version=t}addInput(t,r,n,s){if(!this.__canModifyInputs())throw new Error("No, this would invalidate signatures");let i;if(rd(t))t=Ql.reverseBuffer(c.Buffer.from(t,"hex"));else if(nd(t)){let o=t.outs[r];s=o.script,i=o.value,t=t.getHash(!1)}return this.__addInputUnsafe(t,r,{sequence:n,prevOutScript:s,value:i})}addOutput(t,r){if(!this.__canModifyOutputs())throw new Error("No, this would invalidate signatures");return typeof t=="string"&&(t=zl.toOutputScript(t,this.network)),this.__TX.addOutput(t,r)}build(){return this.__build(!1)}buildIncomplete(){return this.__build(!0)}sign(t,r,n,s,i,o){ud(cd(this.network,this.__INPUTS,this.__needsOutputs.bind(this),this.__TX,t,r,n,s,i,o,this.__USE_LOW_R))}__addInputUnsafe(t,r,n){if(we.Transaction.isCoinbaseHash(t))throw new Error("coinbase inputs not supported");let s=t.toString("hex")+":"+r;if(this.__PREV_TX_SET[s]!==void 0)throw new Error("Duplicate TxOut: "+s);let i={};if(n.script!==void 0&&(i=Zr(n.script,n.witness||[])),n.value!==void 0&&(i.value=n.value),!i.prevOutScript&&n.prevOutScript){let u;if(!i.pubkeys&&!i.signatures){let f=Kt(n.prevOutScript);f.pubkeys&&(i.pubkeys=f.pubkeys,i.signatures=f.signatures),u=f.type}i.prevOutScript=n.prevOutScript,i.prevOutType=u||et.output(n.prevOutScript)}let o=this.__TX.addInput(t,r,n.sequence,n.scriptSig);return this.__INPUTS[o]=i,this.__PREV_TX_SET[s]=!0,o}__build(t){if(!t){if(!this.__TX.ins.length)throw new Error("Transaction has no inputs");if(!this.__TX.outs.length)throw new Error("Transaction has no outputs")}let r=this.__TX.clone();if(this.__INPUTS.forEach((n,s)=>{if(!n.prevOutType&&!t)throw new Error("Transaction is not complete");let i=Us(n.prevOutType,n,t);if(!i){if(!t&&n.prevOutType===g.NONSTANDARD)throw new Error("Unknown input type");if(!t)throw new Error("Not enough information");return}r.setInputScript(s,i.input),r.setWitness(s,i.witness)}),!t&&this.__overMaximumFees(r.virtualSize()))throw new Error("Transaction has absurd fees");return r}__canModifyInputs(){return this.__INPUTS.every(t=>t.signatures?t.signatures.every(r=>r?(Ns(r)&we.Transaction.SIGHASH_ANYONECANPAY)!==0:!0):!0)}__needsOutputs(t){return t===we.Transaction.SIGHASH_ALL?this.__TX.outs.length===0:this.__TX.outs.length===0&&this.__INPUTS.some(r=>r.signatures?r.signatures.some(n=>!(!n||Ns(n)&we.Transaction.SIGHASH_NONE)):!1)}__canModifyOutputs(){let t=this.__TX.ins.length,r=this.__TX.outs.length;return this.__INPUTS.every(n=>n.signatures===void 0?!0:n.signatures.every(s=>{if(!s)return!0;let o=Ns(s)&31;return o===we.Transaction.SIGHASH_NONE?!0:o===we.Transaction.SIGHASH_SINGLE?t<=r:!1}))}__overMaximumFees(t){let r=this.__INPUTS.reduce((o,u)=>o+(u.value>>>0),0),n=this.__TX.outs.reduce((o,u)=>o+u.value,0);return(r-n)/t>this.maximumFeeRate}};Hs.TransactionBuilder=Lt;function Zr(e,t,r,n){if(e.length===0&&t.length===0)return{};if(!r){let s=et.input(e,!0),i=et.witness(t,!0);s===g.NONSTANDARD&&(s=void 0),i===g.NONSTANDARD&&(i=void 0),r=s||i}switch(r){case g.P2WPKH:{let{output:s,pubkey:i,signature:o}=O.p2wpkh({witness:t});return{prevOutScript:s,prevOutType:g.P2WPKH,pubkeys:[i],signatures:[o]}}case g.P2PKH:{let{output:s,pubkey:i,signature:o}=O.p2pkh({input:e});return{prevOutScript:s,prevOutType:g.P2PKH,pubkeys:[i],signatures:[o]}}case g.P2PK:{let{signature:s}=O.p2pk({input:e});return{prevOutType:g.P2PK,pubkeys:[void 0],signatures:[s]}}case g.P2MS:{let{m:s,pubkeys:i,signatures:o}=O.p2ms({input:e,output:n},{allowIncomplete:!0});return{prevOutType:g.P2MS,pubkeys:i,signatures:o,maxSignatures:s}}}if(r===g.P2SH){let{output:s,redeem:i}=O.p2sh({input:e,witness:t}),o=et.output(i.output),u=Zr(i.input,i.witness,o,i.output);return u.prevOutType?{prevOutScript:s,prevOutType:g.P2SH,redeemScript:i.output,redeemScriptType:u.prevOutType,witnessScript:u.witnessScript,witnessScriptType:u.witnessScriptType,pubkeys:u.pubkeys,signatures:u.signatures}:{}}if(r===g.P2WSH){let{output:s,redeem:i}=O.p2wsh({input:e,witness:t}),o=et.output(i.output),u;return o===g.P2WPKH?u=Zr(i.input,i.witness,o):u=Zr(tt.compile(i.witness),[],o,i.output),u.prevOutType?{prevOutScript:s,prevOutType:g.P2WSH,witnessScript:i.output,witnessScriptType:u.prevOutType,pubkeys:u.pubkeys,signatures:u.signatures}:{}}return{prevOutType:g.NONSTANDARD,prevOutScript:e}}function sd(e,t,r){if(e.redeemScriptType!==g.P2MS||!e.redeemScript||e.pubkeys.length===e.signatures.length)return;let n=e.signatures.concat();e.signatures=e.pubkeys.map(s=>{let i=Jl.fromPublicKey(s),o;return n.some((u,f)=>{if(!u)return!1;let l=tt.signature.decode(u),d=t.hashForSignature(r,e.redeemScript,l.hashType);return i.verify(d,l.signature)?(n[f]=void 0,o=u,!0):!1}),o})}function Kt(e,t){m(ye.Buffer,e);let r=et.output(e);switch(r){case g.P2PKH:{if(!t)return{type:r};let n=O.p2pkh({output:e}).hash,s=Kc.hash160(t);return n.equals(s)?{type:r,pubkeys:[t],signatures:[void 0]}:{type:r}}case g.P2WPKH:{if(!t)return{type:r};let n=O.p2wpkh({output:e}).hash,s=Kc.hash160(t);return n.equals(s)?{type:r,pubkeys:[t],signatures:[void 0]}:{type:r}}case g.P2PK:{let n=O.p2pk({output:e});return{type:r,pubkeys:[n.pubkey],signatures:[void 0]}}case g.P2MS:{let n=O.p2ms({output:e});return{type:r,pubkeys:n.pubkeys,signatures:n.pubkeys.map(()=>{}),maxSignatures:n.m}}}return{type:r}}function id(e,t,r,n){if(r&&n){let i=O.p2wsh({redeem:{output:n}}),o=O.p2wsh({output:r}),u=O.p2sh({redeem:{output:r}}),f=O.p2sh({redeem:i});if(!i.hash.equals(o.hash))throw new Error("Witness script inconsistent with prevOutScript");if(!u.hash.equals(f.hash))throw new Error("Redeem script inconsistent with prevOutScript");let l=Kt(i.redeem.output,t);if(!l.pubkeys)throw new Error(l.type+" not supported as witnessScript ("+tt.toASM(n)+")");e.signatures&&e.signatures.some(h=>h!==void 0)&&(l.signatures=e.signatures);let d=n;if(l.type===g.P2WPKH)throw new Error("P2SH(P2WSH(P2WPKH)) is a consensus failure");return{redeemScript:r,redeemScriptType:g.P2WSH,witnessScript:n,witnessScriptType:l.type,prevOutType:g.P2SH,prevOutScript:u.output,hasWitness:!0,signScript:d,signType:l.type,pubkeys:l.pubkeys,signatures:l.signatures,maxSignatures:l.maxSignatures}}if(r){let i=O.p2sh({redeem:{output:r}});if(e.prevOutScript){let f;try{f=O.p2sh({output:e.prevOutScript})}catch{throw new Error("PrevOutScript must be P2SH")}if(!i.hash.equals(f.hash))throw new Error("Redeem script inconsistent with prevOutScript")}let o=Kt(i.redeem.output,t);if(!o.pubkeys)throw new Error(o.type+" not supported as redeemScript ("+tt.toASM(r)+")");e.signatures&&e.signatures.some(f=>f!==void 0)&&(o.signatures=e.signatures);let u=r;return o.type===g.P2WPKH&&(u=O.p2pkh({pubkey:o.pubkeys[0]}).output),{redeemScript:r,redeemScriptType:o.type,prevOutType:g.P2SH,prevOutScript:i.output,hasWitness:o.type===g.P2WPKH,signScript:u,signType:o.type,pubkeys:o.pubkeys,signatures:o.signatures,maxSignatures:o.maxSignatures}}if(n){let i=O.p2wsh({redeem:{output:n}});if(e.prevOutScript){let f=O.p2wsh({output:e.prevOutScript});if(!i.hash.equals(f.hash))throw new Error("Witness script inconsistent with prevOutScript")}let o=Kt(i.redeem.output,t);if(!o.pubkeys)throw new Error(o.type+" not supported as witnessScript ("+tt.toASM(n)+")");e.signatures&&e.signatures.some(f=>f!==void 0)&&(o.signatures=e.signatures);let u=n;if(o.type===g.P2WPKH)throw new Error("P2WSH(P2WPKH) is a consensus failure");return{witnessScript:n,witnessScriptType:o.type,prevOutType:g.P2WSH,prevOutScript:i.output,hasWitness:!0,signScript:u,signType:o.type,pubkeys:o.pubkeys,signatures:o.signatures,maxSignatures:o.maxSignatures}}if(e.prevOutType&&e.prevOutScript){if(e.prevOutType===g.P2SH)throw new Error("PrevOutScript is "+e.prevOutType+", requires redeemScript");if(e.prevOutType===g.P2WSH)throw new Error("PrevOutScript is "+e.prevOutType+", requires witnessScript");if(!e.prevOutScript)throw new Error("PrevOutScript is missing");let i=Kt(e.prevOutScript,t);if(!i.pubkeys)throw new Error(i.type+" not supported ("+tt.toASM(e.prevOutScript)+")");e.signatures&&e.signatures.some(u=>u!==void 0)&&(i.signatures=e.signatures);let o=e.prevOutScript;return i.type===g.P2WPKH&&(o=O.p2pkh({pubkey:i.pubkeys[0]}).output),{prevOutType:i.type,prevOutScript:e.prevOutScript,hasWitness:i.type===g.P2WPKH,signScript:o,signType:i.type,pubkeys:i.pubkeys,signatures:i.signatures,maxSignatures:i.maxSignatures}}let s=O.p2pkh({pubkey:t}).output;return{prevOutType:g.P2PKH,prevOutScript:s,hasWitness:!1,signScript:s,signType:g.P2PKH,pubkeys:[t],signatures:[void 0]}}function Us(e,t,r){let n=t.pubkeys||[],s=t.signatures||[];switch(e){case g.P2PKH:{if(n.length===0||s.length===0)break;return O.p2pkh({pubkey:n[0],signature:s[0]})}case g.P2WPKH:{if(n.length===0||s.length===0)break;return O.p2wpkh({pubkey:n[0],signature:s[0]})}case g.P2PK:{if(n.length===0||s.length===0)break;return O.p2pk({signature:s[0]})}case g.P2MS:{let i=t.maxSignatures;r?s=s.map(u=>u||ed.OPS.OP_0):s=s.filter(u=>u);let o=!r||i===s.length;return O.p2ms({m:i,pubkeys:n,signatures:s},{allowIncomplete:r,validate:o})}case g.P2SH:{let i=Us(t.redeemScriptType,t,r);return i?O.p2sh({redeem:{output:i.output||t.redeemScript,input:i.input,witness:i.witness}}):void 0}case g.P2WSH:{let i=Us(t.witnessScriptType,t,r);return i?O.p2wsh({redeem:{output:t.witnessScript,input:i.input,witness:i.witness}}):void 0}}}function As(e){return e.signScript!==void 0&&e.signType!==void 0&&e.pubkeys!==void 0&&e.signatures!==void 0&&e.signatures.length===e.pubkeys.length&&e.pubkeys.length>0&&(e.hasWitness===!1||e.value!==void 0)}function Ns(e){return e.readUInt8(e.length-1)}function od(e,t){if(!td.has(t.prevOutScriptType))throw new TypeError(`Unknown prevOutScriptType "${t.prevOutScriptType}"`);k(m.Number,t.vin,"sign must include vin parameter as Number (input index)"),k(ye.Signer,t.keyPair,"sign must include keyPair parameter as Signer interface"),k(m.maybe(m.Number),t.hashType,"sign hashType parameter must be a number");let r=(e[t.vin]||[]).prevOutType,n=t.prevOutScriptType;switch(n){case"p2pkh":if(r&&r!=="pubkeyhash")throw new TypeError(`input #${t.vin} is not of type p2pkh: ${r}`);k(m.value(void 0),t.witnessScript,`${n} requires NO witnessScript`),k(m.value(void 0),t.redeemScript,`${n} requires NO redeemScript`),k(m.value(void 0),t.witnessValue,`${n} requires NO witnessValue`);break;case"p2pk":if(r&&r!=="pubkey")throw new TypeError(`input #${t.vin} is not of type p2pk: ${r}`);k(m.value(void 0),t.witnessScript,`${n} requires NO witnessScript`),k(m.value(void 0),t.redeemScript,`${n} requires NO redeemScript`),k(m.value(void 0),t.witnessValue,`${n} requires NO witnessValue`);break;case"p2wpkh":if(r&&r!=="witnesspubkeyhash")throw new TypeError(`input #${t.vin} is not of type p2wpkh: ${r}`);k(m.value(void 0),t.witnessScript,`${n} requires NO witnessScript`),k(m.value(void 0),t.redeemScript,`${n} requires NO redeemScript`),k(ye.Satoshi,t.witnessValue,`${n} requires witnessValue`);break;case"p2ms":if(r&&r!=="multisig")throw new TypeError(`input #${t.vin} is not of type p2ms: ${r}`);k(m.value(void 0),t.witnessScript,`${n} requires NO witnessScript`),k(m.value(void 0),t.redeemScript,`${n} requires NO redeemScript`),k(m.value(void 0),t.witnessValue,`${n} requires NO witnessValue`);break;case"p2sh-p2wpkh":if(r&&r!=="scripthash")throw new TypeError(`input #${t.vin} is not of type p2sh-p2wpkh: ${r}`);k(m.value(void 0),t.witnessScript,`${n} requires NO witnessScript`),k(m.Buffer,t.redeemScript,`${n} requires redeemScript`),k(ye.Satoshi,t.witnessValue,`${n} requires witnessValue`);break;case"p2sh-p2ms":case"p2sh-p2pk":case"p2sh-p2pkh":if(r&&r!=="scripthash")throw new TypeError(`input #${t.vin} is not of type ${n}: ${r}`);k(m.value(void 0),t.witnessScript,`${n} requires NO witnessScript`),k(m.Buffer,t.redeemScript,`${n} requires redeemScript`),k(m.value(void 0),t.witnessValue,`${n} requires NO witnessValue`);break;case"p2wsh-p2ms":case"p2wsh-p2pk":case"p2wsh-p2pkh":if(r&&r!=="witnessscripthash")throw new TypeError(`input #${t.vin} is not of type ${n}: ${r}`);k(m.Buffer,t.witnessScript,`${n} requires witnessScript`),k(m.value(void 0),t.redeemScript,`${n} requires NO redeemScript`),k(ye.Satoshi,t.witnessValue,`${n} requires witnessValue`);break;case"p2sh-p2wsh-p2ms":case"p2sh-p2wsh-p2pk":case"p2sh-p2wsh-p2pkh":if(r&&r!=="scripthash")throw new TypeError(`input #${t.vin} is not of type ${n}: ${r}`);k(m.Buffer,t.witnessScript,`${n} requires witnessScript`),k(m.Buffer,t.redeemScript,`${n} requires witnessScript`),k(ye.Satoshi,t.witnessValue,`${n} requires witnessScript`);break}}function ud({input:e,ourPubKey:t,keyPair:r,signatureHash:n,hashType:s,useLowR:i}){let o=!1;for(let[u,f]of e.pubkeys.entries()){if(!t.equals(f))continue;if(e.signatures[u])throw new Error("Signature already exists");if(t.length!==33&&e.hasWitness)throw new Error("BIP143 rejects uncompressed public keys in P2WPKH or P2WSH");let l=r.sign(n,i);e.signatures[u]=tt.signature.encode(l,s),o=!0}if(!o)throw new Error("Key pair cannot sign for this input")}function cd(e,t,r,n,s,i,o,u,f,l,d){let h;if(typeof s=="number")console.warn("DEPRECATED: TransactionBuilder sign method arguments will change in v6, please use the TxbSignArg interface"),h=s;else if(typeof s=="object")od(t,s),{vin:h,keyPair:i,redeemScript:o,hashType:u,witnessValue:f,witnessScript:l}=s;else throw new TypeError("TransactionBuilder sign first arg must be TxbSignArg or number");if(i===void 0)throw new Error("sign requires keypair");if(i.network&&i.network!==e)throw new TypeError("Inconsistent network");if(!t[h])throw new Error("No input at index: "+h);if(u=u||we.Transaction.SIGHASH_ALL,r(u))throw new Error("Transaction needs outputs");let w=t[h];if(w.redeemScript!==void 0&&o&&!w.redeemScript.equals(o))throw new Error("Inconsistent redeemScript");let q=i.publicKey||i.getPublicKey&&i.getPublicKey();if(!As(w)){if(f!==void 0){if(w.value!==void 0&&w.value!==f)throw new Error("Input did not match witnessValue");m(ye.Satoshi,f),w.value=f}if(!As(w)){let j=id(w,q,o,l);Object.assign(w,j)}if(!As(w))throw Error(w.prevOutType+" not supported")}let R;return w.hasWitness?R=n.hashForWitnessV0(h,w.signScript,w.value,u):R=n.hashForSignature(h,w.signScript,u),{input:w,ourPubKey:q,keyPair:i,signatureHash:R,hashType:u,useLowR:!!d}}});var md=y(X=>{"use strict";a();p();Object.defineProperty(X,"__esModule",{value:!0});var ad=zs();X.bip32=ad;var pd=Sr();X.address=pd;var fd=ne();X.crypto=fd;var hd=mr();X.ECPair=hd;var ld=z();X.networks=ld;var dd=kt();X.payments=dd;var wd=S();X.script=wd;var yd=co();X.Block=yd.Block;var gd=Bu();X.Psbt=gd.Psbt;var _d=S();X.opcodes=_d.OPS;var Sd=vt();X.Transaction=Sd.Transaction;var Ed=Lc();X.TransactionBuilder=Ed.TransactionBuilder});export{md as a};

window.inOKXExtension = true;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=chunk-Y7TCBFVM.js.map
