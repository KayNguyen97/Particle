import{a as mo,b as co}from"./chunk-WB3OW5ND.js";import{b as io}from"./chunk-MHASEPVA.js";import{a as to,e as oo,h as ro,k as eo,l as so,p as no,q as ao}from"./chunk-DPVVGFWQ.js";import{b as vt,d as Wt}from"./chunk-VNHZZRMI.js";import{a as Qt}from"./chunk-I2KPNTIF.js";import{b as O}from"./chunk-D6O2GLPR.js";import{b as Vt,c as z}from"./chunk-2CPFAAZ7.js";import{a as Xt}from"./chunk-D54UDGZS.js";import{c as ot}from"./chunk-E2KMZQ6K.js";import{a as $t}from"./chunk-PGPPXRV7.js";import{f as yt}from"./chunk-DCUBXXOY.js";import{d as W,e as tt}from"./chunk-2HWABU7H.js";import{b as pt}from"./chunk-QNEJI55N.js";import{r as Tt,s as Kt}from"./chunk-GUWGENNL.js";import{b as _t}from"./chunk-67YO4IPY.js";import{i as Gt,l as Zt,m as qt}from"./chunk-62JDSRZZ.js";import{b as ft}from"./chunk-XEOGXIVD.js";import{a as Jt}from"./chunk-PCGRDRHF.js";import{p as E}from"./chunk-IU3TYIWS.js";import{A as zt,l as Rt,o as Ht}from"./chunk-VPBQLZCI.js";import{a as v}from"./chunk-O4EDZSHP.js";import{b as Yo}from"./chunk-6ZPGW3YM.js";import{P as Q,Z as jt,b as X}from"./chunk-UXFKODVN.js";import{a as jo}from"./chunk-TPSXCUGD.js";import{b as V,i as Yt,p as H}from"./chunk-RMQJRDTF.js";import{c as w}from"./chunk-2YLR7R2N.js";import{a as K,b as Lt}from"./chunk-MVLY6WUP.js";import{f as $,h as Mt}from"./chunk-ZEAKIEIQ.js";import{C as J,D as Uo,H as Dt,Pa as Mo,a as Ft,b as Do,mb as Ut,q as k,rb as Lo,v as y}from"./chunk-CVJKAN5R.js";import{G as Ot,b as St,o as kt}from"./chunk-GXQ645QR.js";import{a as j}from"./chunk-V4YVDLI4.js";import{f as b,m as f,o as p}from"./chunk-6V2G2Z5W.js";f();p();var o=b(j());Lo();var Eo=b(Yo()),Co=b(jo());J();var bo=b(Uo());f();p();var xt=b(j());J();Mo();var Ro=7*1e3,Ho=({walletId:s,coinId:m,satBytes:a,needFilteredUtxo:e})=>{let d=Gt(s),u=(0,xt.useMemo)(()=>{var n;return((n=d==null?void 0:d.addressType)==null?void 0:n[Dt])||[]},[d==null?void 0:d.walletId]),[_,C]=eo({coinId:m,walletId:s,satBytes:a,addressList:u==null?void 0:u.map(({address:n})=>n),needFilteredUtxo:e},{pollingInterval:Ro,ready:!!(e!=null&&e.length)&&!!a}),g=(0,xt.useMemo)(()=>{let n=u.map((B,N)=>({...B,canTransferAmount:C[N]}));return n==null?void 0:n.sort((B,N)=>{let D=k.sub(N.canTransferAmount,B.canTransferAmount);return Number(D)})},[C,u]);return[_,g]},uo=Ho;f();p();Mt();Lt();var zo=s=>{let{loading:m,data:a}=Rt(async()=>{var d;let e=await $(K.batchBtcNftDetail,{inscriptionIdProtocols:Array.isArray(s)?s:[s]});return((d=e==null?void 0:e.data)==null?void 0:d.details)||[]});return[m,a||[]]},lo=zo;f();p();Do();var fo=b(j()),Go=()=>(0,fo.useCallback)(({value:s,message:m,reportParams:a})=>{try{Ft.captureEvent({message:m,contexts:{report:{info:JSON.stringify(a)}},exception:{values:[{type:"BIZ_ERROR_btcPayWalletAddress",value:s}]},level:"warn"})}catch(e){console.log(e)}},[]),po=Go;f();p();var G=b(j());Mt();Lt();function Zo(s,m,a){let[e,d]=(0,G.useState)(a),[u,_]=(0,G.useState)([]);return(0,G.useEffect)(()=>{(async()=>{var g;try{if(!a)return;let n=await $(K.checkDustForBtcTx,{inscriptionIds:m,targetAddress:s,scene:24});_(((g=n==null?void 0:n.data)==null?void 0:g.dustInscriptionIds)||[])}finally{d(!1)}})()},[a,s,m]),{isDustLoading:e,dustError:u.length>0}}var _o=Zo;f();p();var To=b(j());J();var qo=({isMpcWallet:s,isHardware:m,feeError:a,isSufficientGas:e,dustError:d,transferReminder:u})=>({tipMessageProps:(0,To.useMemo)(()=>s?{type:O.TIP_TYPE.COMMON_ERROR,message:y("extension_wallet_contractual_interaction_wallet_unavailable")}:m?{type:O.TIP_TYPE.COMMON_ERROR,message:y("wallet_extension_top_toast_dapp_comingsoon")}:a?{type:O.TIP_TYPE.FEE_ERROR}:e?d?{type:O.TIP_TYPE.COMMON_ERROR,message:y("wallet_info_dialog_dust_limit_individually")}:{type:St.TYPE.warn,message:u}:{type:jt.FEE_BALANCE_INSUFFICIENT},[a,s,m,e,d,u])}),yo=qo;f();p();var A=b(j());J();f();p();var xo={list:"_list_shbob_1"};var Jo=({coinId:s,value:m,visible:a,onToggleVisible:e,options:d,onChange:u})=>{let _=ot(s),C=g=>{let{addressType:n,address:B,canTransferAmount:N}=g;return A.default.createElement(_t.Card,{selected:(m==null?void 0:m.address)===B,onClick:()=>{e==null||e(),u==null||u(g)}},A.default.createElement(w.Box,{style:{width:"100%"}},A.default.createElement(w.FlexBox,{justify:"space-between",align:w.ALIGN.center},A.default.createElement(E.Text,{strong:!0},y(V[n])),A.default.createElement(E.DisplayAmount,{strong:!0,mode:E.CRYPTO,decimals:_==null?void 0:_.decimals},N)),A.default.createElement(w.FlexBox,{justify:"space-between",align:w.ALIGN.center},A.default.createElement(E.Address,{address:B,desensitize:!0,copyable:!1,size:E.SIZE.sm,type:E.TYPE.secondary}),A.default.createElement(E.Text,{type:E.TYPE.secondary,size:E.SIZE.xs},y("nftmarket_general_wallet_label_available")||"Available BTC"))))};return A.default.createElement(kt,{visible:a,alignBottom:!0,noTopRadius:!1,windowStyle:{width:"100%"},title:y("btcnft_gas_title_pay_gas_with"),onClose:e},A.default.createElement(_t,{space:16,dataSource:d,renderItem:C,className:xo.list}))},Ao=Jo;f();p();var At={"nft-transfer__extend":"_nft-transfer__extend_1bjoo_1",nftTransferExtend:"_nft-transfer__extend_1bjoo_1","nft-transfer__icon":"_nft-transfer__icon_1bjoo_4",nftTransferIcon:"_nft-transfer__icon_1bjoo_4"};var go={Ordinals:"Ordinals",Atomicals:"Atomicals"},No=2,Io="NFT",we=({unapproved:s})=>{let m=s==null?void 0:s.walletId,a=Ut,e=ot(a),d=qt(m),u=s.params.transfer.from,_=s.params.transfer.to,{feeRate:C}=s.params.transfer.options||{},g=po(),n=vt({coinId:a,address:u}),B=n==null?void 0:n.transferReminder,[N,D]=zt({payWallet:!1,networkFee:!1}),[l,gt]=(0,o.useState)(C&&typeof C=="number"?{satBytes:C,level:Q.CUSTOM}:{satBytes:n==null?void 0:n.normal,level:Q.STANDARD});(0,o.useEffect)(()=>{!(l!=null&&l.satBytes)&&(n==null?void 0:n.normal)&&gt({satBytes:n==null?void 0:n.normal,level:Q.STANDARD})},[n,l]);let Z=s.params.transfer.data,U=Array.isArray(Z)&&Z.length>1,{isDustLoading:Nt,dustError:rt}=_o(_,Z,U),[,i]=lo(Z),R=(0,o.useMemo)(()=>{if(!Array.isArray(i)||!(i!=null&&i.length))return;let[{protocol:r}]=i||[];if(r===go.Atomicals)return H.ARC_20},[i]),et=(0,o.useMemo)(()=>i.map(r=>{var c,T;return`${(c=r.btcNftUtxoDetail)==null?void 0:c.txId}-${(T=r.btcNftUtxoDetail)==null?void 0:T.outputIndex}`}),[i]),[It,P]=uo({coinId:a,walletId:m,needFilteredUtxo:et,satBytes:l==null?void 0:l.satBytes}),[t,st]=(0,o.useState)({}),[nt,{toggle:wo}]=Ht(!1);(0,o.useEffect)(()=>{let r=P==null?void 0:P[0];if((0,bo.isEmpty)(t)&&!!r&&(r==null?void 0:r.canTransferAmount)&&st(r),P&&t.address&&(t==null?void 0:t.canTransferAmount)){let c=P.find(({address:T})=>T===(t==null?void 0:t.address));c||g({value:c,reportParams:{payWallet:t,payWallets:P},message:`payWallet address get ${c}`}),c&&st(c)}},[g,t,P]);let F=(0,o.useMemo)(()=>i.map(r=>{let{tokenId:c,protocol:T}=r,{txId:L,outputIndex:Y,outputValue:Oo}=(r==null?void 0:r.btcNftUtxoDetail)||{},ht={txHash:L,nftId:r.tokenId,status:1,address:u,vout:Number(Y),coinAmount:Number(Oo),resourceUrl:r==null?void 0:r.resourceUrl};return T===go.Atomicals&&Object.assign(ht,{data:[{atomicalId:c,type:Io}]}),ht}),[u,i]),Et=(0,o.useMemo)(()=>i.map(r=>{let c=r==null?void 0:r.tokenId,{outputValue:T}=(r==null?void 0:r.btcNftUtxoDetail)||{},L=Number(T);U||(L=k.lt(T,546)?546:Number(T));let Y={amount:L,address:_};return R===H.ARC_20&&Object.assign(Y,{data:[{atomicalId:c,type:Io}]}),Y}),[U,i,R,_]),at=(0,o.useMemo)(()=>{var r;if(!U){let{outputValue:c=0}=((r=i==null?void 0:i[0])==null?void 0:r.btcNftUtxoDetail)||{};if(c<546)return k.sub(546,c)}return 0},[U,i]),[it,x,q]=no({coinId:a,protocolId:R,toAddr:_,coinAmount:at,fromAddr:t==null?void 0:t.address,satBytes:l==null?void 0:l.satBytes,utxoParams:{satBytes:l==null?void 0:l.satBytes,needFilteredUtxo:et},canTransferAmount:t==null?void 0:t.canTransferAmount,inputs:F,outputs:Et},{ready:!!(F!=null&&F.length)}),mt=U?X.BTC_NFT_BULK_SEND:X.SEND_NFT,Ct=ao({coinId:a,walletId:m,protocolId:R,coinAmount:0,toAddr:_,fromAddr:u,changeAddr:t==null?void 0:t.address,localType:e==null?void 0:e.localType,dustSize:R===H.ARC_20||n==null?void 0:n.minOutput,networkFee:x,satBytes:l.satBytes,inputs:F,outputs:Et}),ct=i.map(({tokenId:r})=>r),Bo=JSON.stringify({nftIds:ct,from:u,to:_,serviceCharge:x,gasFrom:t==null?void 0:t.address}),bt=Wt({coinId:a,txType:mt,walletId:m,coinAmount:0,fromAddr:u,toAddr:_,networkFee:x,localType:e==null?void 0:e.localType,extJson:Bo,txSource:Yt.NFT}),wt=ro({coinId:a,walletId:m,address:t.address,utxoType:to.TRANSFER,satBytes:l==null?void 0:l.satBytes,needFilteredUtxo:et}),I=(0,Eo.useDispatch)(),S=(0,Co.useHistory)(),Bt=so({coinId:a,txType:X.SEND_NFT,protocolId:H.BRC_NFT,address:t.address}),ut=i==null?void 0:i.length,Po=(0,o.useMemo)(()=>(i==null?void 0:i.slice(0,nt?ut:No)).map(({resourceUrl:c,name:T})=>({title:T,icon:{src:c}})),[i,nt,ut]),M=(0,o.useMemo)(()=>!((t==null?void 0:t.canTransferAmount)&&k.lt(t==null?void 0:t.canTransferAmount,k.add(x,at))),[x,at,t==null?void 0:t.canTransferAmount]),ho=Zt(m),[Fo,dt]=(0,o.useState)(!1),lt=(0,o.useCallback)(async()=>{s.id?(await I(Tt(s.id)),await I(pt()),S.push(v)):(I(yt()),M?S.goBack():S.replace(v)),dt(!1)},[I,S,M,s.id]),{tipMessageProps:So}=yo({isHardware:d,feeError:q,isSufficientGas:M,dustError:rt,transferReminder:B}),Pt=(0,o.useCallback)(async()=>{if(!await Xt({walletId:m,callback:async()=>{await I(Tt(s.id))}}))return;let c=await wt(0,x);await Bt([...F,...c],lt),dt(!0);let T=await Ct({utxoList:[],utxos:[{address:t.address,inputs:oo(c)}]}),L=await $t(e==null?void 0:e.localType,T);try{s.id?(await I(Kt(s.id,{txHash:L,signedTx:T,serviceCharge:x,gasFrom:t.address,txType:mt,nftIds:ct})),await I(pt())):(await bt(T),I(yt()),Ot.success({title:y("wallet_transfer_notif_transaction_submit")})),S.push(v)}catch(Y){console.log(Y)}finally{dt(!1)}},[lt,Bt,e==null?void 0:e.localType,I,x,wt,S,M,ct,t.address,bt,Ct,F,mt,s.id]),ko=(0,o.useMemo)(()=>{let r={actionType:z.ACTION_TYPE.CANCEL,btnText:y("wallet_dapp_connection_btn_reject"),onClick:lt},c={disabled:It||it||q||d||!Number(x)||!(i!=null&&i.length)||Nt||rt,actionType:z.ACTION_TYPE.CONFIRM,onClick:Pt};return M||(c={coinId:a,walletId:m,address:t==null?void 0:t.address,actionType:z.ACTION_TYPE.FILL_UP}),[r,c]},[It,it,q,d,x,i==null?void 0:i.length,Pt,M,s.id,I,S,a,m,t==null?void 0:t.address,Nt,rt]);return o.default.createElement(w.Box,null,o.default.createElement(tt,null,o.default.createElement(Vt,{space:24,title:y("wallet_extension_send_colored_send"),summaryList:Po}),ut>No&&o.default.createElement(w.FlexBox,{justify:"center",className:At["nft-transfer__extend"],onClick:wo},o.default.createElement(ft,{size:ft.SIZE.xs,className:At["nft-transfer__icon"],icon:nt?"okds-arrow-chevron-up-md":"okx-wallet-plugin-add-arrow-chevrons"}))),o.default.createElement(tt,null,o.default.createElement(W,{walletId:m,address:u,title:y("extension_send_mid_text_from")}),o.default.createElement(W,{address:_,title:y("extension_send_mid_text_to")})),o.default.createElement(tt,null,o.default.createElement(Qt,{coinId:a,loading:it,estimateFailed:q,networkFee:x,onClick:()=>{D({networkFee:!0})}}),o.default.createElement(W,{copyable:!1,address:t==null?void 0:t.address,addressType:t==null?void 0:t.addressType,title:y("btcnft_gas_label_pay_gas_with"),tags:[y(V[t==null?void 0:t.addressType])],onClick:()=>{D({payWallet:!0})}},o.default.createElement(mo,{coinBalance:t.canTransferAmount}))),o.default.createElement(Ao,{coinId:a,value:t,options:P,visible:N.payWallet,onChange:st,onToggleVisible:()=>{D({payWallet:!1})}}),o.default.createElement(Jt,{offsetBottom:0,placeholder:!0,borderTop:!0},o.default.createElement(O,{coinId:a,...So}),o.default.createElement(z,{buttonGroup:ko})),o.default.createElement(io,{coinId:a,signInfo:n,visible:N==null?void 0:N.networkFee,value:l,estimatedFee:x,onChange:gt,onToggleVisible:()=>{D({networkFee:!1})}}),o.default.createElement(co,{visible:ho&&Fo}))};export{we as a};

window.inOKXExtension = true;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=chunk-26PWDO73.js.map
