import{a as ut}from"./chunk-Y7TCBFVM.js";import{a as Ln}from"./chunk-24BKNDA7.js";import{b as Cn}from"./chunk-JQQNTNIX.js";import{a as Nn,b as gr,c as Ct,f as Dn}from"./chunk-7MX3OHNE.js";import{a as js}from"./chunk-2BSLA752.js";import"./chunk-FLCN6MAI.js";import"./chunk-XKG5DY6K.js";import"./chunk-6PGLMYAE.js";import{a as Ke}from"./chunk-RMQJRDTF.js";import"./chunk-2YLR7R2N.js";import{a as An,b as Hs}from"./chunk-MVLY6WUP.js";import{f as On,h as Fs}from"./chunk-ZEAKIEIQ.js";import{a as Pn}from"./chunk-5KSDRGLW.js";import"./chunk-DQTCC3FF.js";import"./chunk-O5LVHMPV.js";import{D as Ms,H as Sn,Pa as Gs,Vb as Xs,zb as Rn}from"./chunk-CVJKAN5R.js";import"./chunk-A5Y2KVNP.js";import"./chunk-GXQ645QR.js";import"./chunk-DQ2NYVYI.js";import"./chunk-C2H3SRET.js";import"./chunk-V4YVDLI4.js";import"./chunk-Z4JATHZR.js";import"./chunk-Z37GURZ6.js";import{b as $s}from"./chunk-IYYFWVWL.js";import"./chunk-KTHMEYYS.js";import{a as Ws}from"./chunk-GT57MMCB.js";import{D as Ks,p as bn,s as _n,t as mr,v as Bs,y as Vs}from"./chunk-RYNAOZ73.js";import"./chunk-GKHVFCKF.js";import{c as O,f as F,l as process,m as h,n as u,o as d}from"./chunk-6V2G2Z5W.js";var qn=O((gl,Un)=>{h();d();var Te=Bs(),zs=u.Buffer.alloc(1,1),kn=u.Buffer.alloc(1,0);function Ys(r,t,e,i,o){let n=u.Buffer.alloc(32,0),a=u.Buffer.alloc(32,1);n=Te("sha256",n).update(a).update(kn).update(t).update(r).update(o||"").digest(),a=Te("sha256",n).update(a).digest(),n=Te("sha256",n).update(a).update(zs).update(t).update(r).update(o||"").digest(),a=Te("sha256",n).update(a).digest(),a=Te("sha256",n).update(a).digest();let l=a;for(;!i(l)||!e(l);)n=Te("sha256",n).update(a).update(kn).digest(),a=Te("sha256",n).update(a).digest(),a=Te("sha256",n).update(a).digest(),l=a;return l}Un.exports=Ys});var Er=O((wl,Kn)=>{h();d();var Zs=Vs(),Qs=Ks().ec,yr=new Qs("secp256k1"),Js=qn(),kt=u.Buffer.alloc(32,0),Ut=u.Buffer.from("fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141","hex"),Mn=u.Buffer.from("fffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f","hex"),he=yr.curve.n,$n=he.shrn(1),Mt=yr.curve.g,$t="Expected Private",Pe="Expected Point",Gt="Expected Tweak",Gn="Expected Hash",ea="Expected Signature",ta="Expected Extra Data (32 bytes)";function ct(r){return u.Buffer.isBuffer(r)&&r.length===32}function Bt(r){return ct(r)?r.compare(Ut)<0:!1}function Se(r){if(!u.Buffer.isBuffer(r)||r.length<33)return!1;let t=r[0],e=r.slice(1,33);if(e.compare(kt)===0||e.compare(Mn)>=0)return!1;if((t===2||t===3)&&r.length===33){try{Ne(r)}catch{return!1}return!0}let i=r.slice(33);return i.compare(kt)===0||i.compare(Mn)>=0?!1:t===4&&r.length===65}function Bn(r){return r[0]!==4}function ra(r){return Se(r)?Bn(r):!1}function be(r){return ct(r)?r.compare(kt)>0&&r.compare(Ut)<0:!1}function na(r){let t=r.slice(0,32),e=r.slice(32,64);return u.Buffer.isBuffer(r)&&r.length===64&&t.compare(Ut)<0&&e.compare(Ut)<0}function lt(r,t){return r===void 0&&t!==void 0?Bn(t):r===void 0?!0:r}function ne(r){return new Zs(r)}function qt(r){return r.toArrayLike(u.Buffer,"be",32)}function Ne(r){return yr.curve.decodePoint(r)}function Fe(r,t){return u.Buffer.from(r._encode(t))}function ia(r,t,e){if(!Se(r))throw new TypeError(Pe);if(!Se(t))throw new TypeError(Pe);let i=Ne(r),o=Ne(t),n=i.add(o);if(n.isInfinity())return null;let a=lt(e,r);return Fe(n,a)}function oa(r,t,e){if(!Se(r))throw new TypeError(Pe);if(!Bt(t))throw new TypeError(Gt);let i=lt(e,r),o=Ne(r);if(t.compare(kt)===0)return Fe(o,i);let n=ne(t),a=Mt.mul(n),l=o.add(a);return l.isInfinity()?null:Fe(l,i)}function sa(r,t){if(!Se(r))throw new TypeError(Pe);let e=Ne(r);if(e.isInfinity())throw new TypeError(Pe);let i=lt(t,r);return Fe(e,i)}function aa(r,t){if(!be(r))throw new TypeError($t);let e=ne(r),i=Mt.mul(e);if(i.isInfinity())return null;let o=lt(t);return Fe(i,o)}function ua(r,t,e){if(!Se(r))throw new TypeError(Pe);if(!Bt(t))throw new TypeError(Gt);let i=lt(e,r),o=Ne(r),n=ne(t),a=o.mul(n);return a.isInfinity()?null:Fe(a,i)}function ca(r,t){if(!be(r))throw new TypeError($t);if(!Bt(t))throw new TypeError(Gt);let e=ne(r),i=ne(t),o=qt(e.add(i).umod(he));return be(o)?o:null}function la(r,t){if(!be(r))throw new TypeError($t);if(!Bt(t))throw new TypeError(Gt);let e=ne(r),i=ne(t),o=qt(e.sub(i).umod(he));return be(o)?o:null}function fa(r,t){return Vn(r,t)}function pa(r,t,e){return Vn(r,t,e)}function Vn(r,t,e){if(!ct(r))throw new TypeError(Gn);if(!be(t))throw new TypeError($t);if(e!==void 0&&!ct(e))throw new TypeError(ta);let i=ne(t),o=ne(r),n,a;Js(r,t,function(s){let f=ne(s),p=Mt.mul(f);return!(p.isInfinity()||(n=p.x.umod(he),n.isZero()===0)||(a=f.invm(he).mul(o.add(i.mul(n))).umod(he),a.isZero()===0))},be,e),a.cmp($n)>0&&(a=he.sub(a));let c=u.Buffer.allocUnsafe(64);return qt(n).copy(c,0),qt(a).copy(c,32),c}function ha(r,t,e,i){if(!ct(r))throw new TypeError(Gn);if(!Se(t))throw new TypeError(Pe);if(!na(e))throw new TypeError(ea);let o=Ne(t),n=ne(e.slice(0,32)),a=ne(e.slice(32,64));if(i&&a.cmp($n)>0||n.gtn(0)<=0||a.gtn(0)<=0)return!1;let l=ne(r),c=a.invm(he),s=l.mul(c).umod(he),f=n.mul(c).umod(he),p=Mt.mulAdd(s,o,f);return p.isInfinity()?!1:p.x.umod(he).eq(n)}Kn.exports={isPoint:Se,isPointCompressed:ra,isPrivate:be,pointAdd:ia,pointAddScalar:oa,pointCompress:sa,pointFromScalar:aa,pointMultiply:ua,privateAdd:ca,privateSub:la,sign:fa,signWithEntropy:pa,verify:ha}});var Wn=O((_l,Hn)=>{"use strict";h();d();var br=bn().Buffer,da=9007199254740991;function _r(r){if(r<0||r>da||r%1!==0)throw new RangeError("value out of range")}function ft(r,t,e){if(_r(r),t||(t=br.allocUnsafe(Xn(r))),!br.isBuffer(t))throw new TypeError("buffer must be a Buffer instance");return e||(e=0),r<253?(t.writeUInt8(r,e),ft.bytes=1):r<=65535?(t.writeUInt8(253,e),t.writeUInt16LE(r,e+1),ft.bytes=3):r<=4294967295?(t.writeUInt8(254,e),t.writeUInt32LE(r,e+1),ft.bytes=5):(t.writeUInt8(255,e),t.writeUInt32LE(r>>>0,e+1),t.writeUInt32LE(r/4294967296|0,e+5),ft.bytes=9),t}function pt(r,t){if(!br.isBuffer(r))throw new TypeError("buffer must be a Buffer instance");t||(t=0);var e=r.readUInt8(t);if(e<253)return pt.bytes=1,e;if(e===253)return pt.bytes=3,r.readUInt16LE(t+1);if(e===254)return pt.bytes=5,r.readUInt32LE(t+1);pt.bytes=9;var i=r.readUInt32LE(t+1),o=r.readUInt32LE(t+5),n=o*4294967296+i;return _r(n),n}function Xn(r){return _r(r),r<253?1:r<=65535?3:r<=4294967295?5:9}Hn.exports={encode:ft,decode:pt,encodingLength:Xn}});var di=O((Nf,hi)=>{"use strict";h();d();var Yt=bn().Buffer;function Na(r){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),e=0;e<t.length;e++)t[e]=255;for(var i=0;i<r.length;i++){var o=r.charAt(i),n=o.charCodeAt(0);if(t[n]!==255)throw new TypeError(o+" is ambiguous");t[n]=i}var a=r.length,l=r.charAt(0),c=Math.log(a)/Math.log(256),s=Math.log(256)/Math.log(a);function f(v){if((Array.isArray(v)||v instanceof Uint8Array)&&(v=Yt.from(v)),!Yt.isBuffer(v))throw new TypeError("Expected Buffer");if(v.length===0)return"";for(var g=0,T=0,y=0,S=v.length;y!==S&&v[y]===0;)y++,g++;for(var E=(S-y)*s+1>>>0,R=new Uint8Array(E);y!==S;){for(var b=v[y],P=0,I=E-1;(b!==0||P<T)&&I!==-1;I--,P++)b+=256*R[I]>>>0,R[I]=b%a>>>0,b=b/a>>>0;if(b!==0)throw new Error("Non-zero carry");T=P,y++}for(var k=E-T;k!==E&&R[k]===0;)k++;for(var L=l.repeat(g);k<E;++k)L+=r.charAt(R[k]);return L}function p(v){if(typeof v!="string")throw new TypeError("Expected String");if(v.length===0)return Yt.alloc(0);var g=0;if(v[g]!==" "){for(var T=0,y=0;v[g]===l;)T++,g++;for(var S=(v.length-g)*c+1>>>0,E=new Uint8Array(S);v[g];){var R=t[v.charCodeAt(g)];if(R===255)return;for(var b=0,P=S-1;(R!==0||b<y)&&P!==-1;P--,b++)R+=a*E[P]>>>0,E[P]=R%256>>>0,R=R/256>>>0;if(R!==0)throw new Error("Non-zero carry");y=b,g++}if(v[g]!==" "){for(var I=S-y;I!==S&&E[I]===0;)I++;var k=Yt.allocUnsafe(T+(S-I));k.fill(0,0,T);for(var L=T;I!==S;)k[L++]=E[I++];return k}}}function m(v){var g=p(v);if(g)return g;throw new Error("Non-base"+a+" character")}return{encode:f,decodeUnsafe:p,decode:m}}hi.exports=Na});var mi=O((Cf,vi)=>{h();d();var La=di(),Da="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";vi.exports=La(Da)});var Br=O((Bf,yi)=>{"use strict";h();d();var Ua=function(r,t,e,i,o,n,a,l){if(!r){var c;if(t===void 0)c=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var s=[e,i,o,n,a,l],f=0;c=new Error(t.replace(/%s/g,function(){return s[f++]})),c.name="Invariant Violation"}throw c.framesToPop=1,c}};yi.exports=Ua});var Et=O((Ep,_i)=>{h();d();var Ba="2.0.0",Va=Number.MAX_SAFE_INTEGER||9007199254740991,Ka=16;_i.exports={SEMVER_SPEC_VERSION:Ba,MAX_LENGTH:256,MAX_SAFE_INTEGER:Va,MAX_SAFE_COMPONENT_LENGTH:Ka}});var wt=O((Ip,Oi)=>{h();d();var Fa=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...r)=>console.error("SEMVER",...r):()=>{};Oi.exports=Fa});var ke=O((Oe,Ri)=>{h();d();var{MAX_SAFE_COMPONENT_LENGTH:jr}=Et(),Xa=wt();Oe=Ri.exports={};var Ha=Oe.re=[],w=Oe.src=[],x=Oe.t={},Wa=0,D=(r,t,e)=>{let i=Wa++;Xa(i,t),x[r]=i,w[i]=t,Ha[i]=new RegExp(t,e?"g":void 0)};D("NUMERICIDENTIFIER","0|[1-9]\\d*");D("NUMERICIDENTIFIERLOOSE","[0-9]+");D("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*");D("MAINVERSION",`(${w[x.NUMERICIDENTIFIER]})\\.(${w[x.NUMERICIDENTIFIER]})\\.(${w[x.NUMERICIDENTIFIER]})`);D("MAINVERSIONLOOSE",`(${w[x.NUMERICIDENTIFIERLOOSE]})\\.(${w[x.NUMERICIDENTIFIERLOOSE]})\\.(${w[x.NUMERICIDENTIFIERLOOSE]})`);D("PRERELEASEIDENTIFIER",`(?:${w[x.NUMERICIDENTIFIER]}|${w[x.NONNUMERICIDENTIFIER]})`);D("PRERELEASEIDENTIFIERLOOSE",`(?:${w[x.NUMERICIDENTIFIERLOOSE]}|${w[x.NONNUMERICIDENTIFIER]})`);D("PRERELEASE",`(?:-(${w[x.PRERELEASEIDENTIFIER]}(?:\\.${w[x.PRERELEASEIDENTIFIER]})*))`);D("PRERELEASELOOSE",`(?:-?(${w[x.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${w[x.PRERELEASEIDENTIFIERLOOSE]})*))`);D("BUILDIDENTIFIER","[0-9A-Za-z-]+");D("BUILD",`(?:\\+(${w[x.BUILDIDENTIFIER]}(?:\\.${w[x.BUILDIDENTIFIER]})*))`);D("FULLPLAIN",`v?${w[x.MAINVERSION]}${w[x.PRERELEASE]}?${w[x.BUILD]}?`);D("FULL",`^${w[x.FULLPLAIN]}$`);D("LOOSEPLAIN",`[v=\\s]*${w[x.MAINVERSIONLOOSE]}${w[x.PRERELEASELOOSE]}?${w[x.BUILD]}?`);D("LOOSE",`^${w[x.LOOSEPLAIN]}$`);D("GTLT","((?:<|>)?=?)");D("XRANGEIDENTIFIERLOOSE",`${w[x.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);D("XRANGEIDENTIFIER",`${w[x.NUMERICIDENTIFIER]}|x|X|\\*`);D("XRANGEPLAIN",`[v=\\s]*(${w[x.XRANGEIDENTIFIER]})(?:\\.(${w[x.XRANGEIDENTIFIER]})(?:\\.(${w[x.XRANGEIDENTIFIER]})(?:${w[x.PRERELEASE]})?${w[x.BUILD]}?)?)?`);D("XRANGEPLAINLOOSE",`[v=\\s]*(${w[x.XRANGEIDENTIFIERLOOSE]})(?:\\.(${w[x.XRANGEIDENTIFIERLOOSE]})(?:\\.(${w[x.XRANGEIDENTIFIERLOOSE]})(?:${w[x.PRERELEASELOOSE]})?${w[x.BUILD]}?)?)?`);D("XRANGE",`^${w[x.GTLT]}\\s*${w[x.XRANGEPLAIN]}$`);D("XRANGELOOSE",`^${w[x.GTLT]}\\s*${w[x.XRANGEPLAINLOOSE]}$`);D("COERCE",`(^|[^\\d])(\\d{1,${jr}})(?:\\.(\\d{1,${jr}}))?(?:\\.(\\d{1,${jr}}))?(?:$|[^\\d])`);D("COERCERTL",w[x.COERCE],!0);D("LONETILDE","(?:~>?)");D("TILDETRIM",`(\\s*)${w[x.LONETILDE]}\\s+`,!0);Oe.tildeTrimReplace="$1~";D("TILDE",`^${w[x.LONETILDE]}${w[x.XRANGEPLAIN]}$`);D("TILDELOOSE",`^${w[x.LONETILDE]}${w[x.XRANGEPLAINLOOSE]}$`);D("LONECARET","(?:\\^)");D("CARETTRIM",`(\\s*)${w[x.LONECARET]}\\s+`,!0);Oe.caretTrimReplace="$1^";D("CARET",`^${w[x.LONECARET]}${w[x.XRANGEPLAIN]}$`);D("CARETLOOSE",`^${w[x.LONECARET]}${w[x.XRANGEPLAINLOOSE]}$`);D("COMPARATORLOOSE",`^${w[x.GTLT]}\\s*(${w[x.LOOSEPLAIN]})$|^$`);D("COMPARATOR",`^${w[x.GTLT]}\\s*(${w[x.FULLPLAIN]})$|^$`);D("COMPARATORTRIM",`(\\s*)${w[x.GTLT]}\\s*(${w[x.LOOSEPLAIN]}|${w[x.XRANGEPLAIN]})`,!0);Oe.comparatorTrimReplace="$1$2$3";D("HYPHENRANGE",`^\\s*(${w[x.XRANGEPLAIN]})\\s+-\\s+(${w[x.XRANGEPLAIN]})\\s*$`);D("HYPHENRANGELOOSE",`^\\s*(${w[x.XRANGEPLAINLOOSE]})\\s+-\\s+(${w[x.XRANGEPLAINLOOSE]})\\s*$`);D("STAR","(<|>)?=?\\s*\\*");D("GTE0","^\\s*>=\\s*0.0.0\\s*$");D("GTE0PRE","^\\s*>=\\s*0.0.0-0\\s*$")});var xt=O((Op,Ai)=>{h();d();var ja=["includePrerelease","loose","rtl"],za=r=>r?typeof r!="object"?{loose:!0}:ja.filter(t=>r[t]).reduce((t,e)=>(t[e]=!0,t),{}):{};Ai.exports=za});var Qt=O((Pp,Li)=>{h();d();var Pi=/^[0-9]+$/,Ni=(r,t)=>{let e=Pi.test(r),i=Pi.test(t);return e&&i&&(r=+r,t=+t),r===t?0:e&&!i?-1:i&&!e?1:r<t?-1:1},Ya=(r,t)=>Ni(t,r);Li.exports={compareIdentifiers:Ni,rcompareIdentifiers:Ya}});var Z=O((Dp,Ui)=>{h();d();var Jt=wt(),{MAX_LENGTH:Di,MAX_SAFE_INTEGER:er}=Et(),{re:Ci,t:ki}=ke(),Za=xt(),{compareIdentifiers:It}=Qt(),ie=class{constructor(t,e){if(e=Za(e),t instanceof ie){if(t.loose===!!e.loose&&t.includePrerelease===!!e.includePrerelease)return t;t=t.version}else if(typeof t!="string")throw new TypeError(`Invalid Version: ${t}`);if(t.length>Di)throw new TypeError(`version is longer than ${Di} characters`);Jt("SemVer",t,e),this.options=e,this.loose=!!e.loose,this.includePrerelease=!!e.includePrerelease;let i=t.trim().match(e.loose?Ci[ki.LOOSE]:Ci[ki.FULL]);if(!i)throw new TypeError(`Invalid Version: ${t}`);if(this.raw=t,this.major=+i[1],this.minor=+i[2],this.patch=+i[3],this.major>er||this.major<0)throw new TypeError("Invalid major version");if(this.minor>er||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>er||this.patch<0)throw new TypeError("Invalid patch version");i[4]?this.prerelease=i[4].split(".").map(o=>{if(/^[0-9]+$/.test(o)){let n=+o;if(n>=0&&n<er)return n}return o}):this.prerelease=[],this.build=i[5]?i[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(t){if(Jt("SemVer.compare",this.version,this.options,t),!(t instanceof ie)){if(typeof t=="string"&&t===this.version)return 0;t=new ie(t,this.options)}return t.version===this.version?0:this.compareMain(t)||this.comparePre(t)}compareMain(t){return t instanceof ie||(t=new ie(t,this.options)),It(this.major,t.major)||It(this.minor,t.minor)||It(this.patch,t.patch)}comparePre(t){if(t instanceof ie||(t=new ie(t,this.options)),this.prerelease.length&&!t.prerelease.length)return-1;if(!this.prerelease.length&&t.prerelease.length)return 1;if(!this.prerelease.length&&!t.prerelease.length)return 0;let e=0;do{let i=this.prerelease[e],o=t.prerelease[e];if(Jt("prerelease compare",e,i,o),i===void 0&&o===void 0)return 0;if(o===void 0)return 1;if(i===void 0)return-1;if(i===o)continue;return It(i,o)}while(++e)}compareBuild(t){t instanceof ie||(t=new ie(t,this.options));let e=0;do{let i=this.build[e],o=t.build[e];if(Jt("prerelease compare",e,i,o),i===void 0&&o===void 0)return 0;if(o===void 0)return 1;if(i===void 0)return-1;if(i===o)continue;return It(i,o)}while(++e)}inc(t,e){switch(t){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",e);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",e);break;case"prepatch":this.prerelease.length=0,this.inc("patch",e),this.inc("pre",e);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",e),this.inc("pre",e);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":if(this.prerelease.length===0)this.prerelease=[0];else{let i=this.prerelease.length;for(;--i>=0;)typeof this.prerelease[i]=="number"&&(this.prerelease[i]++,i=-2);i===-1&&this.prerelease.push(0)}e&&(this.prerelease[0]===e?isNaN(this.prerelease[1])&&(this.prerelease=[e,0]):this.prerelease=[e,0]);break;default:throw new Error(`invalid increment argument: ${t}`)}return this.format(),this.raw=this.version,this}};Ui.exports=ie});var Ue=O((Up,Gi)=>{h();d();var{MAX_LENGTH:Qa}=Et(),{re:qi,t:Mi}=ke(),$i=Z(),Ja=xt(),eu=(r,t)=>{if(t=Ja(t),r instanceof $i)return r;if(typeof r!="string"||r.length>Qa||!(t.loose?qi[Mi.LOOSE]:qi[Mi.FULL]).test(r))return null;try{return new $i(r,t)}catch{return null}};Gi.exports=eu});var Vi=O(($p,Bi)=>{h();d();var tu=Ue(),ru=(r,t)=>{let e=tu(r,t);return e?e.version:null};Bi.exports=ru});var Fi=O((Vp,Ki)=>{h();d();var nu=Ue(),iu=(r,t)=>{let e=nu(r.trim().replace(/^[=v]+/,""),t);return e?e.version:null};Ki.exports=iu});var Hi=O((Xp,Xi)=>{h();d();var ou=Z(),su=(r,t,e,i)=>{typeof e=="string"&&(i=e,e=void 0);try{return new ou(r,e).inc(t,i).version}catch{return null}};Xi.exports=su});var fe=O((jp,ji)=>{h();d();var Wi=Z(),au=(r,t,e)=>new Wi(r,e).compare(new Wi(t,e));ji.exports=au});var tr=O((Zp,zi)=>{h();d();var uu=fe(),cu=(r,t,e)=>uu(r,t,e)===0;zi.exports=cu});var Qi=O((eh,Zi)=>{h();d();var Yi=Ue(),lu=tr(),fu=(r,t)=>{if(lu(r,t))return null;{let e=Yi(r),i=Yi(t),o=e.prerelease.length||i.prerelease.length,n=o?"pre":"",a=o?"prerelease":"";for(let l in e)if((l==="major"||l==="minor"||l==="patch")&&e[l]!==i[l])return n+l;return a}};Zi.exports=fu});var eo=O((nh,Ji)=>{h();d();var pu=Z(),hu=(r,t)=>new pu(r,t).major;Ji.exports=hu});var ro=O((sh,to)=>{h();d();var du=Z(),vu=(r,t)=>new du(r,t).minor;to.exports=vu});var io=O((ch,no)=>{h();d();var mu=Z(),gu=(r,t)=>new mu(r,t).patch;no.exports=gu});var so=O((ph,oo)=>{h();d();var yu=Ue(),Eu=(r,t)=>{let e=yu(r,t);return e&&e.prerelease.length?e.prerelease:null};oo.exports=Eu});var uo=O((vh,ao)=>{h();d();var wu=fe(),xu=(r,t,e)=>wu(t,r,e);ao.exports=xu});var lo=O((yh,co)=>{h();d();var Iu=fe(),Tu=(r,t)=>Iu(r,t,!0);co.exports=Tu});var rr=O((xh,po)=>{h();d();var fo=Z(),Su=(r,t,e)=>{let i=new fo(r,e),o=new fo(t,e);return i.compare(o)||i.compareBuild(o)};po.exports=Su});var vo=O((Sh,ho)=>{h();d();var bu=rr(),_u=(r,t)=>r.sort((e,i)=>bu(e,i,t));ho.exports=_u});var go=O((Oh,mo)=>{h();d();var Ou=rr(),Ru=(r,t)=>r.sort((e,i)=>Ou(i,e,t));mo.exports=Ru});var Tt=O((Ph,yo)=>{h();d();var Au=fe(),Pu=(r,t,e)=>Au(r,t,e)>0;yo.exports=Pu});var nr=O((Dh,Eo)=>{h();d();var Nu=fe(),Lu=(r,t,e)=>Nu(r,t,e)<0;Eo.exports=Lu});var zr=O((Uh,wo)=>{h();d();var Du=fe(),Cu=(r,t,e)=>Du(r,t,e)!==0;wo.exports=Cu});var ir=O(($h,xo)=>{h();d();var ku=fe(),Uu=(r,t,e)=>ku(r,t,e)>=0;xo.exports=Uu});var or=O((Vh,Io)=>{h();d();var qu=fe(),Mu=(r,t,e)=>qu(r,t,e)<=0;Io.exports=Mu});var Yr=O((Xh,To)=>{h();d();var $u=tr(),Gu=zr(),Bu=Tt(),Vu=ir(),Ku=nr(),Fu=or(),Xu=(r,t,e,i)=>{switch(t){case"===":return typeof r=="object"&&(r=r.version),typeof e=="object"&&(e=e.version),r===e;case"!==":return typeof r=="object"&&(r=r.version),typeof e=="object"&&(e=e.version),r!==e;case"":case"=":case"==":return $u(r,e,i);case"!=":return Gu(r,e,i);case">":return Bu(r,e,i);case">=":return Vu(r,e,i);case"<":return Ku(r,e,i);case"<=":return Fu(r,e,i);default:throw new TypeError(`Invalid operator: ${t}`)}};To.exports=Xu});var bo=O((jh,So)=>{h();d();var Hu=Z(),Wu=Ue(),{re:sr,t:ar}=ke(),ju=(r,t)=>{if(r instanceof Hu)return r;if(typeof r=="number"&&(r=String(r)),typeof r!="string")return null;t=t||{};let e=null;if(!t.rtl)e=r.match(sr[ar.COERCE]);else{let i;for(;(i=sr[ar.COERCERTL].exec(r))&&(!e||e.index+e[0].length!==r.length);)(!e||i.index+i[0].length!==e.index+e[0].length)&&(e=i),sr[ar.COERCERTL].lastIndex=i.index+i[1].length+i[2].length;sr[ar.COERCERTL].lastIndex=-1}return e===null?null:Wu(`${e[2]}.${e[3]||"0"}.${e[4]||"0"}`,t)};So.exports=ju});var pe=O((Zh,Ao)=>{h();d();var qe=class{constructor(t,e){if(e=Yu(e),t instanceof qe)return t.loose===!!e.loose&&t.includePrerelease===!!e.includePrerelease?t:new qe(t.raw,e);if(t instanceof Zr)return this.raw=t.value,this.set=[[t]],this.format(),this;if(this.options=e,this.loose=!!e.loose,this.includePrerelease=!!e.includePrerelease,this.raw=t,this.set=t.split(/\s*\|\|\s*/).map(i=>this.parseRange(i.trim())).filter(i=>i.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${t}`);if(this.set.length>1){let i=this.set[0];if(this.set=this.set.filter(o=>!Oo(o[0])),this.set.length===0)this.set=[i];else if(this.set.length>1){for(let o of this.set)if(o.length===1&&tc(o[0])){this.set=[o];break}}}this.format()}format(){return this.range=this.set.map(t=>t.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(t){t=t.trim();let i=`parseRange:${Object.keys(this.options).join(",")}:${t}`,o=_o.get(i);if(o)return o;let n=this.options.loose,a=n?Q[Y.HYPHENRANGELOOSE]:Q[Y.HYPHENRANGE];t=t.replace(a,fc(this.options.includePrerelease)),H("hyphen replace",t),t=t.replace(Q[Y.COMPARATORTRIM],Qu),H("comparator trim",t,Q[Y.COMPARATORTRIM]),t=t.replace(Q[Y.TILDETRIM],Ju),t=t.replace(Q[Y.CARETTRIM],ec),t=t.split(/\s+/).join(" ");let l=n?Q[Y.COMPARATORLOOSE]:Q[Y.COMPARATOR],c=t.split(" ").map(m=>rc(m,this.options)).join(" ").split(/\s+/).map(m=>lc(m,this.options)).filter(this.options.loose?m=>!!m.match(l):()=>!0).map(m=>new Zr(m,this.options)),s=c.length,f=new Map;for(let m of c){if(Oo(m))return[m];f.set(m.value,m)}f.size>1&&f.has("")&&f.delete("");let p=[...f.values()];return _o.set(i,p),p}intersects(t,e){if(!(t instanceof qe))throw new TypeError("a Range is required");return this.set.some(i=>Ro(i,e)&&t.set.some(o=>Ro(o,e)&&i.every(n=>o.every(a=>n.intersects(a,e)))))}test(t){if(!t)return!1;if(typeof t=="string")try{t=new Zu(t,this.options)}catch{return!1}for(let e=0;e<this.set.length;e++)if(pc(this.set[e],t,this.options))return!0;return!1}};Ao.exports=qe;var zu=js(),_o=new zu({max:1e3}),Yu=xt(),Zr=St(),H=wt(),Zu=Z(),{re:Q,t:Y,comparatorTrimReplace:Qu,tildeTrimReplace:Ju,caretTrimReplace:ec}=ke(),Oo=r=>r.value==="<0.0.0-0",tc=r=>r.value==="",Ro=(r,t)=>{let e=!0,i=r.slice(),o=i.pop();for(;e&&i.length;)e=i.every(n=>o.intersects(n,t)),o=i.pop();return e},rc=(r,t)=>(H("comp",r,t),r=oc(r,t),H("caret",r),r=nc(r,t),H("tildes",r),r=ac(r,t),H("xrange",r),r=cc(r,t),H("stars",r),r),ee=r=>!r||r.toLowerCase()==="x"||r==="*",nc=(r,t)=>r.trim().split(/\s+/).map(e=>ic(e,t)).join(" "),ic=(r,t)=>{let e=t.loose?Q[Y.TILDELOOSE]:Q[Y.TILDE];return r.replace(e,(i,o,n,a,l)=>{H("tilde",r,i,o,n,a,l);let c;return ee(o)?c="":ee(n)?c=`>=${o}.0.0 <${+o+1}.0.0-0`:ee(a)?c=`>=${o}.${n}.0 <${o}.${+n+1}.0-0`:l?(H("replaceTilde pr",l),c=`>=${o}.${n}.${a}-${l} <${o}.${+n+1}.0-0`):c=`>=${o}.${n}.${a} <${o}.${+n+1}.0-0`,H("tilde return",c),c})},oc=(r,t)=>r.trim().split(/\s+/).map(e=>sc(e,t)).join(" "),sc=(r,t)=>{H("caret",r,t);let e=t.loose?Q[Y.CARETLOOSE]:Q[Y.CARET],i=t.includePrerelease?"-0":"";return r.replace(e,(o,n,a,l,c)=>{H("caret",r,o,n,a,l,c);let s;return ee(n)?s="":ee(a)?s=`>=${n}.0.0${i} <${+n+1}.0.0-0`:ee(l)?n==="0"?s=`>=${n}.${a}.0${i} <${n}.${+a+1}.0-0`:s=`>=${n}.${a}.0${i} <${+n+1}.0.0-0`:c?(H("replaceCaret pr",c),n==="0"?a==="0"?s=`>=${n}.${a}.${l}-${c} <${n}.${a}.${+l+1}-0`:s=`>=${n}.${a}.${l}-${c} <${n}.${+a+1}.0-0`:s=`>=${n}.${a}.${l}-${c} <${+n+1}.0.0-0`):(H("no pr"),n==="0"?a==="0"?s=`>=${n}.${a}.${l}${i} <${n}.${a}.${+l+1}-0`:s=`>=${n}.${a}.${l}${i} <${n}.${+a+1}.0-0`:s=`>=${n}.${a}.${l} <${+n+1}.0.0-0`),H("caret return",s),s})},ac=(r,t)=>(H("replaceXRanges",r,t),r.split(/\s+/).map(e=>uc(e,t)).join(" ")),uc=(r,t)=>{r=r.trim();let e=t.loose?Q[Y.XRANGELOOSE]:Q[Y.XRANGE];return r.replace(e,(i,o,n,a,l,c)=>{H("xRange",r,i,o,n,a,l,c);let s=ee(n),f=s||ee(a),p=f||ee(l),m=p;return o==="="&&m&&(o=""),c=t.includePrerelease?"-0":"",s?o===">"||o==="<"?i="<0.0.0-0":i="*":o&&m?(f&&(a=0),l=0,o===">"?(o=">=",f?(n=+n+1,a=0,l=0):(a=+a+1,l=0)):o==="<="&&(o="<",f?n=+n+1:a=+a+1),o==="<"&&(c="-0"),i=`${o+n}.${a}.${l}${c}`):f?i=`>=${n}.0.0${c} <${+n+1}.0.0-0`:p&&(i=`>=${n}.${a}.0${c} <${n}.${+a+1}.0-0`),H("xRange return",i),i})},cc=(r,t)=>(H("replaceStars",r,t),r.trim().replace(Q[Y.STAR],"")),lc=(r,t)=>(H("replaceGTE0",r,t),r.trim().replace(Q[t.includePrerelease?Y.GTE0PRE:Y.GTE0],"")),fc=r=>(t,e,i,o,n,a,l,c,s,f,p,m,v)=>(ee(i)?e="":ee(o)?e=`>=${i}.0.0${r?"-0":""}`:ee(n)?e=`>=${i}.${o}.0${r?"-0":""}`:a?e=`>=${e}`:e=`>=${e}${r?"-0":""}`,ee(s)?c="":ee(f)?c=`<${+s+1}.0.0-0`:ee(p)?c=`<${s}.${+f+1}.0-0`:m?c=`<=${s}.${f}.${p}-${m}`:r?c=`<${s}.${f}.${+p+1}-0`:c=`<=${c}`,`${e} ${c}`.trim()),pc=(r,t,e)=>{for(let i=0;i<r.length;i++)if(!r[i].test(t))return!1;if(t.prerelease.length&&!e.includePrerelease){for(let i=0;i<r.length;i++)if(H(r[i].semver),r[i].semver!==Zr.ANY&&r[i].semver.prerelease.length>0){let o=r[i].semver;if(o.major===t.major&&o.minor===t.minor&&o.patch===t.patch)return!0}return!1}return!0}});var St=O((e0,Co)=>{h();d();var bt=Symbol("SemVer ANY"),rt=class{static get ANY(){return bt}constructor(t,e){if(e=hc(e),t instanceof rt){if(t.loose===!!e.loose)return t;t=t.value}Jr("comparator",t,e),this.options=e,this.loose=!!e.loose,this.parse(t),this.semver===bt?this.value="":this.value=this.operator+this.semver.version,Jr("comp",this)}parse(t){let e=this.options.loose?Po[No.COMPARATORLOOSE]:Po[No.COMPARATOR],i=t.match(e);if(!i)throw new TypeError(`Invalid comparator: ${t}`);this.operator=i[1]!==void 0?i[1]:"",this.operator==="="&&(this.operator=""),i[2]?this.semver=new Lo(i[2],this.options.loose):this.semver=bt}toString(){return this.value}test(t){if(Jr("Comparator.test",t,this.options.loose),this.semver===bt||t===bt)return!0;if(typeof t=="string")try{t=new Lo(t,this.options)}catch{return!1}return Qr(t,this.operator,this.semver,this.options)}intersects(t,e){if(!(t instanceof rt))throw new TypeError("a Comparator is required");if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),this.operator==="")return this.value===""?!0:new Do(t.value,e).test(this.value);if(t.operator==="")return t.value===""?!0:new Do(this.value,e).test(t.semver);let i=(this.operator===">="||this.operator===">")&&(t.operator===">="||t.operator===">"),o=(this.operator==="<="||this.operator==="<")&&(t.operator==="<="||t.operator==="<"),n=this.semver.version===t.semver.version,a=(this.operator===">="||this.operator==="<=")&&(t.operator===">="||t.operator==="<="),l=Qr(this.semver,"<",t.semver,e)&&(this.operator===">="||this.operator===">")&&(t.operator==="<="||t.operator==="<"),c=Qr(this.semver,">",t.semver,e)&&(this.operator==="<="||this.operator==="<")&&(t.operator===">="||t.operator===">");return i||o||n&&a||l||c}};Co.exports=rt;var hc=xt(),{re:Po,t:No}=ke(),Qr=Yr(),Jr=wt(),Lo=Z(),Do=pe()});var _t=O((n0,ko)=>{h();d();var dc=pe(),vc=(r,t,e)=>{try{t=new dc(t,e)}catch{return!1}return t.test(r)};ko.exports=vc});var qo=O((s0,Uo)=>{h();d();var mc=pe(),gc=(r,t)=>new mc(r,t).set.map(e=>e.map(i=>i.value).join(" ").trim().split(" "));Uo.exports=gc});var $o=O((c0,Mo)=>{h();d();var yc=Z(),Ec=pe(),wc=(r,t,e)=>{let i=null,o=null,n=null;try{n=new Ec(t,e)}catch{return null}return r.forEach(a=>{n.test(a)&&(!i||o.compare(a)===-1)&&(i=a,o=new yc(i,e))}),i};Mo.exports=wc});var Bo=O((p0,Go)=>{h();d();var xc=Z(),Ic=pe(),Tc=(r,t,e)=>{let i=null,o=null,n=null;try{n=new Ic(t,e)}catch{return null}return r.forEach(a=>{n.test(a)&&(!i||o.compare(a)===1)&&(i=a,o=new xc(i,e))}),i};Go.exports=Tc});var Fo=O((v0,Ko)=>{h();d();var en=Z(),Sc=pe(),Vo=Tt(),bc=(r,t)=>{r=new Sc(r,t);let e=new en("0.0.0");if(r.test(e)||(e=new en("0.0.0-0"),r.test(e)))return e;e=null;for(let i=0;i<r.set.length;++i){let o=r.set[i],n=null;o.forEach(a=>{let l=new en(a.semver.version);switch(a.operator){case">":l.prerelease.length===0?l.patch++:l.prerelease.push(0),l.raw=l.format();case"":case">=":(!n||Vo(l,n))&&(n=l);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${a.operator}`)}}),n&&(!e||Vo(e,n))&&(e=n)}return e&&r.test(e)?e:null};Ko.exports=bc});var Ho=O((y0,Xo)=>{h();d();var _c=pe(),Oc=(r,t)=>{try{return new _c(r,t).range||"*"}catch{return null}};Xo.exports=Oc});var ur=O((x0,Yo)=>{h();d();var Rc=Z(),zo=St(),{ANY:Ac}=zo,Pc=pe(),Nc=_t(),Wo=Tt(),jo=nr(),Lc=or(),Dc=ir(),Cc=(r,t,e,i)=>{r=new Rc(r,i),t=new Pc(t,i);let o,n,a,l,c;switch(e){case">":o=Wo,n=Lc,a=jo,l=">",c=">=";break;case"<":o=jo,n=Dc,a=Wo,l="<",c="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(Nc(r,t,i))return!1;for(let s=0;s<t.set.length;++s){let f=t.set[s],p=null,m=null;if(f.forEach(v=>{v.semver===Ac&&(v=new zo(">=0.0.0")),p=p||v,m=m||v,o(v.semver,p.semver,i)?p=v:a(v.semver,m.semver,i)&&(m=v)}),p.operator===l||p.operator===c||(!m.operator||m.operator===l)&&n(r,m.semver))return!1;if(m.operator===c&&a(r,m.semver))return!1}return!0};Yo.exports=Cc});var Qo=O((S0,Zo)=>{h();d();var kc=ur(),Uc=(r,t,e)=>kc(r,t,">",e);Zo.exports=Uc});var es=O((O0,Jo)=>{h();d();var qc=ur(),Mc=(r,t,e)=>qc(r,t,"<",e);Jo.exports=Mc});var ns=O((P0,rs)=>{h();d();var ts=pe(),$c=(r,t,e)=>(r=new ts(r,e),t=new ts(t,e),r.intersects(t));rs.exports=$c});var os=O((D0,is)=>{h();d();var Gc=_t(),Bc=fe();is.exports=(r,t,e)=>{let i=[],o=null,n=null,a=r.sort((f,p)=>Bc(f,p,e));for(let f of a)Gc(f,t,e)?(n=f,o||(o=f)):(n&&i.push([o,n]),n=null,o=null);o&&i.push([o,null]);let l=[];for(let[f,p]of i)f===p?l.push(f):!p&&f===a[0]?l.push("*"):p?f===a[0]?l.push(`<=${p}`):l.push(`${f} - ${p}`):l.push(`>=${f}`);let c=l.join(" || "),s=typeof t.raw=="string"?t.raw:String(t);return c.length<s.length?c:t}});var ls=O((U0,cs)=>{h();d();var ss=pe(),cr=St(),{ANY:tn}=cr,Ot=_t(),rn=fe(),Vc=(r,t,e={})=>{if(r===t)return!0;r=new ss(r,e),t=new ss(t,e);let i=!1;e:for(let o of r.set){for(let n of t.set){let a=Kc(o,n,e);if(i=i||a!==null,a)continue e}if(i)return!1}return!0},Kc=(r,t,e)=>{if(r===t)return!0;if(r.length===1&&r[0].semver===tn){if(t.length===1&&t[0].semver===tn)return!0;e.includePrerelease?r=[new cr(">=0.0.0-0")]:r=[new cr(">=0.0.0")]}if(t.length===1&&t[0].semver===tn){if(e.includePrerelease)return!0;t=[new cr(">=0.0.0")]}let i=new Set,o,n;for(let v of r)v.operator===">"||v.operator===">="?o=as(o,v,e):v.operator==="<"||v.operator==="<="?n=us(n,v,e):i.add(v.semver);if(i.size>1)return null;let a;if(o&&n){if(a=rn(o.semver,n.semver,e),a>0)return null;if(a===0&&(o.operator!==">="||n.operator!=="<="))return null}for(let v of i){if(o&&!Ot(v,String(o),e)||n&&!Ot(v,String(n),e))return null;for(let g of t)if(!Ot(v,String(g),e))return!1;return!0}let l,c,s,f,p=n&&!e.includePrerelease&&n.semver.prerelease.length?n.semver:!1,m=o&&!e.includePrerelease&&o.semver.prerelease.length?o.semver:!1;p&&p.prerelease.length===1&&n.operator==="<"&&p.prerelease[0]===0&&(p=!1);for(let v of t){if(f=f||v.operator===">"||v.operator===">=",s=s||v.operator==="<"||v.operator==="<=",o){if(m&&v.semver.prerelease&&v.semver.prerelease.length&&v.semver.major===m.major&&v.semver.minor===m.minor&&v.semver.patch===m.patch&&(m=!1),v.operator===">"||v.operator===">="){if(l=as(o,v,e),l===v&&l!==o)return!1}else if(o.operator===">="&&!Ot(o.semver,String(v),e))return!1}if(n){if(p&&v.semver.prerelease&&v.semver.prerelease.length&&v.semver.major===p.major&&v.semver.minor===p.minor&&v.semver.patch===p.patch&&(p=!1),v.operator==="<"||v.operator==="<="){if(c=us(n,v,e),c===v&&c!==n)return!1}else if(n.operator==="<="&&!Ot(n.semver,String(v),e))return!1}if(!v.operator&&(n||o)&&a!==0)return!1}return!(o&&s&&!n&&a!==0||n&&f&&!o&&a!==0||m||p)},as=(r,t,e)=>{if(!r)return t;let i=rn(r.semver,t.semver,e);return i>0?r:i<0||t.operator===">"&&r.operator===">="?t:r},us=(r,t,e)=>{if(!r)return t;let i=rn(r.semver,t.semver,e);return i<0?r:i>0||t.operator==="<"&&r.operator==="<="?t:r};cs.exports=Vc});var ps=O(($0,fs)=>{h();d();var nn=ke();fs.exports={re:nn.re,src:nn.src,tokens:nn.t,SEMVER_SPEC_VERSION:Et().SEMVER_SPEC_VERSION,SemVer:Z(),compareIdentifiers:Qt().compareIdentifiers,rcompareIdentifiers:Qt().rcompareIdentifiers,parse:Ue(),valid:Vi(),clean:Fi(),inc:Hi(),diff:Qi(),major:eo(),minor:ro(),patch:io(),prerelease:so(),compare:fe(),rcompare:uo(),compareLoose:lo(),compareBuild:rr(),sort:vo(),rsort:go(),gt:Tt(),lt:nr(),eq:tr(),neq:zr(),gte:ir(),lte:or(),cmp:Yr(),coerce:bo(),Comparator:St(),Range:pe(),satisfies:_t(),toComparators:qo(),maxSatisfying:$o(),minSatisfying:Bo(),minVersion:Fo(),validRange:Ho(),outside:ur(),gtr:Qo(),ltr:es(),intersects:ns(),simplifyRange:os(),subset:ls()}});h();d();var Us=F(Ms());h();d();h();d();var fi=F(ut()),pi=F(Er());h();d();var wr=F(Ln()),xr=F(Ws());function Ir(r){var t=u.Buffer.alloc(1+r.length*4);return t[0]=r.length,r.forEach(function(e,i){t.writeUInt32BE(e,1+4*i)}),t}function Xe(r){var t=r?ge(r):[];return Ir(t)}function He(r){return wr.default.fromPathArray(r).toString()}function ge(r){return wr.default.fromString(r).toPathArray()}function Tr(r){var t=xr.default.decode(r);return t.slice(t.length-33)}function Sr(r){var t=xr.default.decode(r);return{chaincode:t.slice(13,13+32),pubkey:t.slice(t.length-33),version:t.readUInt32BE(0)}}function Fn(r){for(var t=r.length-1;t>=0;t--)if(r[t]>=2147483648)return r.slice(0,t+1);return[]}h();d();var Vt=F(Wn());function Or(r){if(r>Number.MAX_SAFE_INTEGER)throw new Error("Can't convert numbers > MAX_SAFE_INT");for(var t=u.Buffer.alloc(8,0),e=0;e<t.length;e++){var i=r&255;t[e]=i,r=(r-i)/256}return t}function Rr(r){var t=0;if(r.length!=8)throw new Error("Expected Bufffer of lenght 8");if(r[7]!=0)throw new Error("Can't encode numbers > MAX_SAFE_INT");if(r[6]>31)throw new Error("Can't encode numbers > MAX_SAFE_INT");for(var e=r.length-1;e>=0;e--)t=t*256+r[e];return t}var X=function(){function r(){this.bufs=[]}return r.prototype.write=function(t,e){var i=u.Buffer.alloc(t);e(i),this.bufs.push(i)},r.prototype.writeUInt8=function(t){this.write(1,function(e){return e.writeUInt8(t,0)})},r.prototype.writeInt32=function(t){this.write(4,function(e){return e.writeInt32LE(t,0)})},r.prototype.writeUInt32=function(t){this.write(4,function(e){return e.writeUInt32LE(t,0)})},r.prototype.writeUInt64=function(t){var e=Or(t);this.writeSlice(e)},r.prototype.writeVarInt=function(t){this.bufs.push(Vt.default.encode(t))},r.prototype.writeSlice=function(t){this.bufs.push(u.Buffer.from(t))},r.prototype.writeVarSlice=function(t){this.writeVarInt(t.length),this.writeSlice(t)},r.prototype.buffer=function(){return u.Buffer.concat(this.bufs)},r}();var ye=function(){function r(t,e){e===void 0&&(e=0),this.buffer=t,this.offset=e}return r.prototype.available=function(){return this.buffer.length-this.offset},r.prototype.readUInt8=function(){var t=this.buffer.readUInt8(this.offset);return this.offset++,t},r.prototype.readInt32=function(){var t=this.buffer.readInt32LE(this.offset);return this.offset+=4,t},r.prototype.readUInt32=function(){var t=this.buffer.readUInt32LE(this.offset);return this.offset+=4,t},r.prototype.readUInt64=function(){var t=this.readSlice(8),e=Rr(t);return e},r.prototype.readVarInt=function(){var t=Vt.default.decode(this.buffer,this.offset);return this.offset+=Vt.default.decode.bytes,t},r.prototype.readSlice=function(t){if(this.buffer.length<this.offset+t)throw new Error("Cannot read slice out of bounds");var e=this.buffer.slice(this.offset,this.offset+t);return this.offset+=t,e},r.prototype.readVarSlice=function(){return this.readSlice(this.readVarInt())},r.prototype.readVector=function(){for(var t=this.readVarInt(),e=[],i=0;i<t;i++)e.push(this.readVarSlice());return e},r}();h();d();var Ar=F(ut()),Qn=F(Er());h();d();var ce=50,jn=1,Kt=0,We=4294967295,ht=1,Ft=118,dt=169,je=20,zn=135,Xt=136,Ht=172;h();d();var Yn=F(_n()),Zn=F(mr());function _e(r){return new Yn.default().update((0,Zn.default)("sha256").update(r).digest()).digest()}var vt=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,o){i.__proto__=o}||function(i,o){for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(i[n]=o[n])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),va=function(){function r(t,e){this.psbt=t,this.masterFp=e}return r}(),Wt=function(r){vt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.spendingCondition=function(e){if(e.length!=1)throw new Error("Expected single key, got "+e.length);return this.singleKeyCondition(e[0])},t.prototype.setInput=function(e,i,o,n,a){if(n.length!=1)throw new Error("Expected single key, got "+n.length);if(a.length!=1)throw new Error("Expected single path, got "+a.length);this.setSingleKeyInput(e,i,o,n[0],a[0])},t.prototype.setOwnOutput=function(e,i,o,n){if(o.length!=1)throw new Error("Expected single key, got "+o.length);if(n.length!=1)throw new Error("Expected single path, got "+n.length);this.setSingleKeyOutput(e,i,o[0],n[0])},t}(va),Jn=function(r){vt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.singleKeyCondition=function(e){var i=new X,o=_e(e);return i.writeSlice(u.Buffer.from([Ft,dt,je])),i.writeSlice(o),i.writeSlice(u.Buffer.from([Xt,Ht])),{scriptPubKey:i.buffer()}},t.prototype.setSingleKeyInput=function(e,i,o,n,a){if(!i)throw new Error("Full input base transaction required");this.psbt.setInputNonWitnessUtxo(e,i),this.psbt.setInputBip32Derivation(e,n,this.masterFp,a)},t.prototype.setSingleKeyOutput=function(e,i,o,n){this.psbt.setOutputBip32Derivation(e,o,this.masterFp,n)},t.prototype.getDescriptorTemplate=function(){return"pkh(@0)"},t}(Wt);var ei=function(r){vt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.singleKeyCondition=function(e){var i=e.slice(1),o=new X,n=this.getTaprootOutputKey(i);return o.writeSlice(u.Buffer.from([81,32])),o.writeSlice(n),{scriptPubKey:o.buffer()}},t.prototype.setSingleKeyInput=function(e,i,o,n,a){var l=n.slice(1);this.psbt.setInputTapBip32Derivation(e,l,[],this.masterFp,a),this.psbt.setInputWitnessUtxo(e,o.amount,o.cond.scriptPubKey)},t.prototype.setSingleKeyOutput=function(e,i,o,n){var a=o.slice(1);this.psbt.setOutputTapBip32Derivation(e,a,[],this.masterFp,n)},t.prototype.getDescriptorTemplate=function(){return"tr(@0)"},t.prototype.hashTapTweak=function(e){var i=Ar.crypto.sha256(u.Buffer.from("TapTweak","utf-8"));return Ar.crypto.sha256(u.Buffer.concat([i,i,e]))},t.prototype.getTaprootOutputKey=function(e){if(e.length!=32)throw new Error("Expected 32 byte pubkey. Got "+e.length);var i=u.Buffer.concat([u.Buffer.from([2]),e]),o=this.hashTapTweak(e),n=u.Buffer.from((0,Qn.pointAddScalar)(i,o)),a=n.slice(1);return a},t}(Wt);var ti=function(r){vt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.singleKeyCondition=function(e){var i=new X,o=this.createRedeemScript(e),n=_e(o);return i.writeSlice(u.Buffer.from([dt,je])),i.writeSlice(n),i.writeUInt8(zn),{scriptPubKey:i.buffer(),redeemScript:o}},t.prototype.setSingleKeyInput=function(e,i,o,n,a){if(!i)throw new Error("Full input base transaction required");this.psbt.setInputNonWitnessUtxo(e,i),this.psbt.setInputBip32Derivation(e,n,this.masterFp,a);var l=o.cond.redeemScript,c=this.createRedeemScript(n);if(l&&!c.equals(l))throw new Error("User-supplied redeemScript ".concat(l.toString("hex"),` doesn't
       match expected `).concat(c.toString("hex")," for input ").concat(e));this.psbt.setInputRedeemScript(e,c),this.psbt.setInputWitnessUtxo(e,o.amount,o.cond.scriptPubKey)},t.prototype.setSingleKeyOutput=function(e,i,o,n){this.psbt.setOutputRedeemScript(e,i.redeemScript),this.psbt.setOutputBip32Derivation(e,o,this.masterFp,n)},t.prototype.getDescriptorTemplate=function(){return"sh(wpkh(@0))"},t.prototype.createRedeemScript=function(e){var i=_e(e);return u.Buffer.concat([u.Buffer.from("0014","hex"),i])},t}(Wt);var ri=function(r){vt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.singleKeyCondition=function(e){var i=new X,o=_e(e);return i.writeSlice(u.Buffer.from([0,je])),i.writeSlice(o),{scriptPubKey:i.buffer()}},t.prototype.setSingleKeyInput=function(e,i,o,n,a){if(!i)throw new Error("Full input base transaction required");this.psbt.setInputNonWitnessUtxo(e,i),this.psbt.setInputBip32Derivation(e,n,this.masterFp,a),this.psbt.setInputWitnessUtxo(e,o.amount,o.cond.scriptPubKey)},t.prototype.setSingleKeyOutput=function(e,i,o,n){this.psbt.setOutputBip32Derivation(e,o,this.masterFp,n)},t.prototype.getDescriptorTemplate=function(){return"wpkh(@0)"},t}(Wt);h();d();var oi=F(ut());h();d();var Lr=F(ut()),ni=function(r,t){var e=typeof Symbol=="function"&&r[Symbol.iterator];if(!e)return r;var i=e.call(r),o,n=[],a;try{for(;(t===void 0||t-- >0)&&!(o=i.next()).done;)n.push(o.value)}catch(l){a={error:l}}finally{try{o&&!o.done&&(e=i.return)&&e.call(i)}finally{if(a)throw a.error}}return n},ii=function(r,t,e){if(e||arguments.length===2)for(var i=0,o=t.length,n;i<o;i++)(n||!(i in t))&&(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return r.concat(n||Array.prototype.slice.call(t))},Ee=function(){function r(t,e){e===void 0&&(e=Lr.crypto.sha256),this.leaves=t,this.h=e;var i=this.calculateRoot(t);this.rootNode=i.root,this.leafNodes=i.leaves}return r.prototype.getRoot=function(){return this.rootNode.hash},r.prototype.size=function(){return this.leaves.length},r.prototype.getLeaves=function(){return this.leaves},r.prototype.getLeafHash=function(t){return this.leafNodes[t].hash},r.prototype.getProof=function(t){if(t>=this.leaves.length)throw Error("Index out of bounds");return Nr(this.leafNodes[t])},r.prototype.calculateRoot=function(t){var e=t.length;if(e==0)return{root:new Pr(void 0,void 0,u.Buffer.alloc(32,0)),leaves:[]};if(e==1){var i=new Pr(void 0,void 0,t[0]);return{root:i,leaves:[i]}}var o=ga(e),n=this.calculateRoot(t.slice(0,o)),a=this.calculateRoot(t.slice(o)),l=n.root,c=a.root,s=this.hashNode(l.hash,c.hash),f=new Pr(l,c,s);return l.parent=f,c.parent=f,{root:f,leaves:n.leaves.concat(a.leaves)}},r.prototype.hashNode=function(t,e){return this.h(u.Buffer.concat([u.Buffer.from([1]),t,e]))},r}();function we(r,t){return t===void 0&&(t=Lr.crypto.sha256),ma(u.Buffer.from([0]),r,t)}function ma(r,t,e){return e(u.Buffer.concat([r,t]))}var Pr=function(){function r(t,e,i){this.leftChild=t,this.rightChild=e,this.hash=i}return r.prototype.isLeaf=function(){return this.leftChild==null},r}();function Nr(r){if(!r.parent)return[];if(r.parent.leftChild==r){if(!r.parent.rightChild)throw new Error("Expected right child to exist");return ii([r.parent.rightChild.hash],ni(Nr(r.parent)),!1)}else{if(!r.parent.leftChild)throw new Error("Expected left child to exist");return ii([r.parent.leftChild.hash],ni(Nr(r.parent)),!1)}}function ga(r){if(r<2)throw Error("Expected n >= 2");return ya(r)?r/2:1<<Math.floor(Math.log2(r))}function ya(r){return(r&r-1)==0}var Dr=function(){function r(t,e){this.descriptorTemplate=t,this.keys=[e]}return r.prototype.getWalletId=function(){return oi.crypto.sha256(this.serialize())},r.prototype.serialize=function(){var t=this.keys.map(function(o){return u.Buffer.from(o,"ascii")}),e=new Ee(t.map(function(o){return we(o)})),i=new X;return i.writeUInt8(1),i.writeUInt8(0),i.writeVarSlice(u.Buffer.from(this.descriptorTemplate,"ascii")),i.writeVarInt(this.keys.length),i.writeSlice(e.getRoot()),i.buffer()},r}();function Cr(r,t,e){var i=He(t);return"[".concat(r.toString("hex")).concat(i.substring(1),"]").concat(e,"/**")}h();d();function si(r){var t,e,i=new X;i.writeUInt32(r.getGlobalTxVersion());var o=!!r.getInputWitnessUtxo(0);o&&i.writeSlice(u.Buffer.from([0,1]));var n=r.getGlobalInputCount();i.writeVarInt(n);for(var a=new X,l=0;l<n;l++)i.writeSlice(r.getInputPreviousTxid(l)),i.writeUInt32(r.getInputOutputIndex(l)),i.writeVarSlice((t=r.getInputFinalScriptsig(l))!==null&&t!==void 0?t:u.Buffer.from([])),i.writeUInt32(r.getInputSequence(l)),o&&a.writeSlice(r.getInputFinalScriptwitness(l));var c=r.getGlobalOutputCount();i.writeVarInt(c);for(var l=0;l<c;l++)i.writeUInt64(r.getOutputAmount(l)),i.writeVarSlice(r.getOutputScript(l));return i.writeSlice(a.buffer()),i.writeUInt32((e=r.getGlobalFallbackLocktime())!==null&&e!==void 0?e:0),i.buffer()}h();d();h();d();var Ea=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,o){i.__proto__=o}||function(i,o){for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(i[n]=o[n])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),qr=function(){return qr=Object.assign||function(r){for(var t,e=1,i=arguments.length;e<i;e++){t=arguments[e];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(r[o]=t[o])}return r},qr.apply(this,arguments)},wa=function(r){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&r[t],i=0;if(e)return e.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&i>=r.length&&(r=void 0),{value:r&&r[i++],done:!r}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},te;(function(r){r[r.TX_VERSION=2]="TX_VERSION",r[r.FALLBACK_LOCKTIME=3]="FALLBACK_LOCKTIME",r[r.INPUT_COUNT=4]="INPUT_COUNT",r[r.OUTPUT_COUNT=5]="OUTPUT_COUNT",r[r.TX_MODIFIABLE=6]="TX_MODIFIABLE",r[r.VERSION=251]="VERSION"})(te||(te={}));var C;(function(r){r[r.NON_WITNESS_UTXO=0]="NON_WITNESS_UTXO",r[r.WITNESS_UTXO=1]="WITNESS_UTXO",r[r.PARTIAL_SIG=2]="PARTIAL_SIG",r[r.SIGHASH_TYPE=3]="SIGHASH_TYPE",r[r.REDEEM_SCRIPT=4]="REDEEM_SCRIPT",r[r.BIP32_DERIVATION=6]="BIP32_DERIVATION",r[r.FINAL_SCRIPTSIG=7]="FINAL_SCRIPTSIG",r[r.FINAL_SCRIPTWITNESS=8]="FINAL_SCRIPTWITNESS",r[r.PREVIOUS_TXID=14]="PREVIOUS_TXID",r[r.OUTPUT_INDEX=15]="OUTPUT_INDEX",r[r.SEQUENCE=16]="SEQUENCE",r[r.TAP_KEY_SIG=19]="TAP_KEY_SIG",r[r.TAP_BIP32_DERIVATION=22]="TAP_BIP32_DERIVATION"})(C||(C={}));var le;(function(r){r[r.REDEEM_SCRIPT=0]="REDEEM_SCRIPT",r[r.BIP_32_DERIVATION=2]="BIP_32_DERIVATION",r[r.AMOUNT=3]="AMOUNT",r[r.SCRIPT=4]="SCRIPT",r[r.TAP_BIP32_DERIVATION=7]="TAP_BIP32_DERIVATION"})(le||(le={}));var xa=u.Buffer.from([112,115,98,116,255]),Ia=function(r){Ea(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t}(Error);var jt=function(){function r(){this.globalMap=new Map,this.inputMaps=[],this.outputMaps=[]}return r.prototype.setGlobalTxVersion=function(t){this.setGlobal(te.TX_VERSION,ze(t))},r.prototype.getGlobalTxVersion=function(){return this.getGlobal(te.TX_VERSION).readUInt32LE(0)},r.prototype.setGlobalFallbackLocktime=function(t){this.setGlobal(te.FALLBACK_LOCKTIME,ze(t))},r.prototype.getGlobalFallbackLocktime=function(){var t;return(t=this.getGlobalOptional(te.FALLBACK_LOCKTIME))===null||t===void 0?void 0:t.readUInt32LE(0)},r.prototype.setGlobalInputCount=function(t){this.setGlobal(te.INPUT_COUNT,ai(t))},r.prototype.getGlobalInputCount=function(){return ui(this.getGlobal(te.INPUT_COUNT))},r.prototype.setGlobalOutputCount=function(t){this.setGlobal(te.OUTPUT_COUNT,ai(t))},r.prototype.getGlobalOutputCount=function(){return ui(this.getGlobal(te.OUTPUT_COUNT))},r.prototype.setGlobalTxModifiable=function(t){this.setGlobal(te.TX_MODIFIABLE,t)},r.prototype.getGlobalTxModifiable=function(){return this.getGlobalOptional(te.TX_MODIFIABLE)},r.prototype.setGlobalPsbtVersion=function(t){this.setGlobal(te.VERSION,ze(t))},r.prototype.getGlobalPsbtVersion=function(){return this.getGlobal(te.VERSION).readUInt32LE(0)},r.prototype.setInputNonWitnessUtxo=function(t,e){this.setInput(t,C.NON_WITNESS_UTXO,G(),e)},r.prototype.getInputNonWitnessUtxo=function(t){return this.getInputOptional(t,C.NON_WITNESS_UTXO,G())},r.prototype.setInputWitnessUtxo=function(t,e,i){var o=new X;o.writeSlice(e),o.writeVarSlice(i),this.setInput(t,C.WITNESS_UTXO,G(),o.buffer())},r.prototype.getInputWitnessUtxo=function(t){var e=this.getInputOptional(t,C.WITNESS_UTXO,G());if(!!e){var i=new ye(e);return{amount:i.readSlice(8),scriptPubKey:i.readVarSlice()}}},r.prototype.setInputPartialSig=function(t,e,i){this.setInput(t,C.PARTIAL_SIG,e,i)},r.prototype.getInputPartialSig=function(t,e){return this.getInputOptional(t,C.PARTIAL_SIG,e)},r.prototype.setInputSighashType=function(t,e){this.setInput(t,C.SIGHASH_TYPE,G(),ze(e))},r.prototype.getInputSighashType=function(t){var e=this.getInputOptional(t,C.SIGHASH_TYPE,G());if(!!e)return e.readUInt32LE(0)},r.prototype.setInputRedeemScript=function(t,e){this.setInput(t,C.REDEEM_SCRIPT,G(),e)},r.prototype.getInputRedeemScript=function(t){return this.getInputOptional(t,C.REDEEM_SCRIPT,G())},r.prototype.setInputBip32Derivation=function(t,e,i,o){if(e.length!=33)throw new Error("Invalid pubkey length: "+e.length);this.setInput(t,C.BIP32_DERIVATION,e,this.encodeBip32Derivation(i,o))},r.prototype.getInputBip32Derivation=function(t,e){var i=this.getInputOptional(t,C.BIP32_DERIVATION,e);if(!!i)return this.decodeBip32Derivation(i)},r.prototype.setInputFinalScriptsig=function(t,e){this.setInput(t,C.FINAL_SCRIPTSIG,G(),e)},r.prototype.getInputFinalScriptsig=function(t){return this.getInputOptional(t,C.FINAL_SCRIPTSIG,G())},r.prototype.setInputFinalScriptwitness=function(t,e){this.setInput(t,C.FINAL_SCRIPTWITNESS,G(),e)},r.prototype.getInputFinalScriptwitness=function(t){return this.getInput(t,C.FINAL_SCRIPTWITNESS,G())},r.prototype.setInputPreviousTxId=function(t,e){this.setInput(t,C.PREVIOUS_TXID,G(),e)},r.prototype.getInputPreviousTxid=function(t){return this.getInput(t,C.PREVIOUS_TXID,G())},r.prototype.setInputOutputIndex=function(t,e){this.setInput(t,C.OUTPUT_INDEX,G(),ze(e))},r.prototype.getInputOutputIndex=function(t){return this.getInput(t,C.OUTPUT_INDEX,G()).readUInt32LE(0)},r.prototype.setInputSequence=function(t,e){this.setInput(t,C.SEQUENCE,G(),ze(e))},r.prototype.getInputSequence=function(t){var e,i;return(i=(e=this.getInputOptional(t,C.SEQUENCE,G()))===null||e===void 0?void 0:e.readUInt32LE(0))!==null&&i!==void 0?i:4294967295},r.prototype.setInputTapKeySig=function(t,e){this.setInput(t,C.TAP_KEY_SIG,G(),e)},r.prototype.getInputTapKeySig=function(t){return this.getInputOptional(t,C.TAP_KEY_SIG,G())},r.prototype.setInputTapBip32Derivation=function(t,e,i,o,n){if(e.length!=32)throw new Error("Invalid pubkey length: "+e.length);var a=this.encodeTapBip32Derivation(i,o,n);this.setInput(t,C.TAP_BIP32_DERIVATION,e,a)},r.prototype.getInputTapBip32Derivation=function(t,e){var i=this.getInput(t,C.TAP_BIP32_DERIVATION,e);return this.decodeTapBip32Derivation(i)},r.prototype.getInputKeyDatas=function(t,e){return this.getKeyDatas(this.inputMaps[t],e)},r.prototype.setOutputRedeemScript=function(t,e){this.setOutput(t,le.REDEEM_SCRIPT,G(),e)},r.prototype.getOutputRedeemScript=function(t){return this.getOutput(t,le.REDEEM_SCRIPT,G())},r.prototype.setOutputBip32Derivation=function(t,e,i,o){this.setOutput(t,le.BIP_32_DERIVATION,e,this.encodeBip32Derivation(i,o))},r.prototype.getOutputBip32Derivation=function(t,e){var i=this.getOutput(t,le.BIP_32_DERIVATION,e);return this.decodeBip32Derivation(i)},r.prototype.setOutputAmount=function(t,e){this.setOutput(t,le.AMOUNT,G(),ba(e))},r.prototype.getOutputAmount=function(t){var e=this.getOutput(t,le.AMOUNT,G());return Rr(e)},r.prototype.setOutputScript=function(t,e){this.setOutput(t,le.SCRIPT,G(),e)},r.prototype.getOutputScript=function(t){return this.getOutput(t,le.SCRIPT,G())},r.prototype.setOutputTapBip32Derivation=function(t,e,i,o,n){var a=this.encodeTapBip32Derivation(i,o,n);this.setOutput(t,le.TAP_BIP32_DERIVATION,e,a)},r.prototype.getOutputTapBip32Derivation=function(t,e){var i=this.getOutput(t,le.TAP_BIP32_DERIVATION,e);return this.decodeTapBip32Derivation(i)},r.prototype.deleteInputEntries=function(t,e){var i=this,o=this.inputMaps[t];o.forEach(function(n,a,l){i.isKeyType(a,e)&&l.delete(a)})},r.prototype.copy=function(t){this.copyMap(this.globalMap,t.globalMap),this.copyMaps(this.inputMaps,t.inputMaps),this.copyMaps(this.outputMaps,t.outputMaps)},r.prototype.copyMaps=function(t,e){var i=this;t.forEach(function(o,n){var a=new Map;i.copyMap(o,a),e[n]=a})},r.prototype.copyMap=function(t,e){t.forEach(function(i,o){return e.set(o,u.Buffer.from(i))})},r.prototype.serialize=function(){var t=new X;return t.writeSlice(u.Buffer.from([112,115,98,116,255])),kr(t,this.globalMap),this.inputMaps.forEach(function(e){kr(t,e)}),this.outputMaps.forEach(function(e){kr(t,e)}),t.buffer()},r.prototype.deserialize=function(t){var e=new ye(t);if(!e.readSlice(5).equals(xa))throw new Error("Invalid magic bytes");for(;this.readKeyPair(this.globalMap,e););for(var i=0;i<this.getGlobalInputCount();i++)for(this.inputMaps[i]=new Map;this.readKeyPair(this.inputMaps[i],e););for(var i=0;i<this.getGlobalOutputCount();i++)for(this.outputMaps[i]=new Map;this.readKeyPair(this.outputMaps[i],e););},r.prototype.readKeyPair=function(t,e){var i=e.readVarInt();if(i==0)return!1;var o=e.readUInt8(),n=e.readSlice(i-1),a=e.readVarSlice();return Ur(t,o,n,a),!0},r.prototype.getKeyDatas=function(t,e){var i=this,o=[];return t.forEach(function(n,a){i.isKeyType(a,[e])&&o.push(u.Buffer.from(a.substring(2),"hex"))}),o},r.prototype.isKeyType=function(t,e){var i=u.Buffer.from(t.substring(0,2),"hex").readUInt8(0);return e.some(function(o){return o==i})},r.prototype.setGlobal=function(t,e){var i=new zt(t,u.Buffer.from([]));this.globalMap.set(i.toString(),e)},r.prototype.getGlobal=function(t){return mt(this.globalMap,t,G(),!1)},r.prototype.getGlobalOptional=function(t){return mt(this.globalMap,t,G(),!0)},r.prototype.setInput=function(t,e,i,o){Ur(this.getMap(t,this.inputMaps),e,i,o)},r.prototype.getInput=function(t,e,i){return mt(this.inputMaps[t],e,i,!1)},r.prototype.getInputOptional=function(t,e,i){return mt(this.inputMaps[t],e,i,!0)},r.prototype.setOutput=function(t,e,i,o){Ur(this.getMap(t,this.outputMaps),e,i,o)},r.prototype.getOutput=function(t,e,i){return mt(this.outputMaps[t],e,i,!1)},r.prototype.getMap=function(t,e){return e[t]?e[t]:e[t]=new Map},r.prototype.encodeBip32Derivation=function(t,e){var i=new X;return this.writeBip32Derivation(i,t,e),i.buffer()},r.prototype.decodeBip32Derivation=function(t){var e=new ye(t);return this.readBip32Derivation(e)},r.prototype.writeBip32Derivation=function(t,e,i){t.writeSlice(e),i.forEach(function(o){t.writeUInt32(o)})},r.prototype.readBip32Derivation=function(t){for(var e=t.readSlice(4),i=[];t.offset<t.buffer.length;)i.push(t.readUInt32());return{masterFingerprint:e,path:i}},r.prototype.encodeTapBip32Derivation=function(t,e,i){var o=new X;return o.writeVarInt(t.length),t.forEach(function(n){o.writeSlice(n)}),this.writeBip32Derivation(o,e,i),o.buffer()},r.prototype.decodeTapBip32Derivation=function(t){for(var e=new ye(t),i=e.readVarInt(),o=[],n=0;n<i;n++)o.push(e.readSlice(32));var a=this.readBip32Derivation(e);return qr({hashes:o},a)},r}();function mt(r,t,e,i){if(!r)throw Error("No such map");var o=new zt(t,e),n=r.get(o.toString());if(!n){if(i)return;throw new Ia(o.toString())}return u.Buffer.from(n)}var zt=function(){function r(t,e){this.keyType=t,this.keyData=e}return r.prototype.toString=function(){var t=new X;return this.toBuffer(t),t.buffer().toString("hex")},r.prototype.serialize=function(t){t.writeVarInt(1+this.keyData.length),this.toBuffer(t)},r.prototype.toBuffer=function(t){t.writeUInt8(this.keyType),t.writeSlice(this.keyData)},r}(),Ta=function(){function r(t,e){this.key=t,this.value=e}return r.prototype.serialize=function(t){this.key.serialize(t),t.writeVarSlice(this.value)},r}();function Sa(r){return new zt(r.readUInt8(0),r.slice(1))}function kr(r,t){var e,i;try{for(var o=wa(t.keys()),n=o.next();!n.done;n=o.next()){var a=n.value,l=t.get(a),c=new Ta(Sa(u.Buffer.from(a,"hex")),l);c.serialize(r)}}catch(s){e={error:s}}finally{try{n&&!n.done&&(i=o.return)&&i.call(o)}finally{if(e)throw e.error}}r.writeUInt8(0)}function G(){return u.Buffer.from([])}function Ur(r,t,e,i){var o=new zt(t,e);r.set(o.toString(),i)}function ze(r){var t=u.Buffer.alloc(4);return t.writeUInt32LE(r,0),t}function ba(r){return Or(r)}function ai(r){var t=new X;return t.writeVarInt(r),t.buffer()}function ui(r){return new ye(r).readVarInt()}function li(r){for(var t=r.getGlobalInputCount(),e=0;e<t;e++){var i=r.getInputKeyDatas(e,C.PARTIAL_SIG),o=r.getInputTapKeySig(e);if(i.length==0&&!o)throw Error("No signature for input ".concat(e," present"));if(i.length>0){if(i.length>1)throw Error("Expected exactly one signature, got ".concat(i.length));if(o)throw Error("Both taproot and non-taproot signatures present.");var n=!!r.getInputWitnessUtxo(e),a=r.getInputRedeemScript(e),l=!!a,c=r.getInputPartialSig(e,i[0]);if(!c)throw new Error("Expected partial signature for input "+e);if(n){var s=new X;if(s.writeVarInt(2),s.writeVarInt(c.length),s.writeSlice(c),s.writeVarInt(i[0].length),s.writeSlice(i[0]),r.setInputFinalScriptwitness(e,s.buffer()),l){if(!a||a.length==0)throw new Error("Expected non-empty redeemscript. Can't finalize intput "+e);var f=new X;f.writeUInt8(a.length),f.writeSlice(a),r.setInputFinalScriptsig(e,f.buffer())}}else{var p=new X;ci(p,c),ci(p,i[0]),r.setInputFinalScriptsig(e,p.buffer())}}else{var c=r.getInputTapKeySig(e);if(!c)throw Error("No taproot signature found");if(c.length!=64&&c.length!=65)throw Error("Unexpected length of schnorr signature.");var s=new X;s.writeVarInt(1),s.writeVarSlice(c),r.setInputFinalScriptwitness(e,s.buffer())}_a(r,e)}}function _a(r,t){var e=[C.BIP32_DERIVATION,C.PARTIAL_SIG,C.TAP_BIP32_DERIVATION,C.TAP_KEY_SIG],i=!!r.getInputWitnessUtxo(t),o=!!r.getInputNonWitnessUtxo(t);i&&o&&e.push(C.NON_WITNESS_UTXO),r.deleteInputEntries(t,e)}function ci(r,t){if(t.length<=75)r.writeUInt8(t.length);else if(t.length<=256)r.writeUInt8(76),r.writeUInt8(t.length);else if(t.length<=256*256){r.writeUInt8(77);var e=u.Buffer.alloc(2);e.writeUInt16LE(t.length,0),r.writeSlice(e)}r.writeSlice(t)}h();d();h();d();function Le(r,t){if(r[t]<253)return[r[t],1];if(r[t]===253)return[(r[t+2]<<8)+r[t+1],3];if(r[t]===254)return[(r[t+4]<<24)+(r[t+3]<<16)+(r[t+2]<<8)+r[t+1],5];throw new Error("getVarint called with unexpected parameters")}function V(r){if(r<253){var t=u.Buffer.alloc(1);return t[0]=r,t}if(r<=65535){var e=u.Buffer.alloc(3);return e[0]=253,e[1]=r&255,e[2]=r>>8&255,e}var i=u.Buffer.alloc(5);return i[0]=254,i[1]=r&255,i[2]=r>>8&255,i[3]=r>>16&255,i[4]=r>>24&255,i}function Mr(r){var t=r.outputs,e=u.Buffer.alloc(0);return typeof t<"u"&&(e=u.Buffer.concat([e,V(t.length)]),t.forEach(function(i){e=u.Buffer.concat([e,i.amount,V(i.script.length),i.script])})),e}function Ye(r,t,e,i){i===void 0&&(i=[]);var o=i.includes("decred"),n=i.includes("zcash"),a=i.includes("bech32"),l=u.Buffer.alloc(0),c=typeof r.witness<"u"&&!t;r.inputs.forEach(function(f){l=o||a?u.Buffer.concat([l,f.prevout,u.Buffer.from([0]),f.sequence]):u.Buffer.concat([l,f.prevout,V(f.script.length),f.script,f.sequence])});var s=Mr(r);return typeof r.outputs<"u"&&typeof r.locktime<"u"&&(s=u.Buffer.concat([s,c&&r.witness||u.Buffer.alloc(0),r.locktime,r.nExpiryHeight||u.Buffer.alloc(0),r.extraData||u.Buffer.alloc(0)])),n?u.Buffer.concat([r.version,r.nVersionGroupId||u.Buffer.alloc(0),u.Buffer.from([180,208,214,194]),r.locktime||u.Buffer.from([0,0,0,0]),r.nExpiryHeight||u.Buffer.from([0,0,0,0]),c?u.Buffer.from("0001","hex"):u.Buffer.alloc(0),V(r.inputs.length),l,s]):u.Buffer.concat([r.version,e||u.Buffer.alloc(0),r.nVersionGroupId||u.Buffer.alloc(0),c?u.Buffer.from("0001","hex"):u.Buffer.alloc(0),V(r.inputs.length),l,s])}var De=function(r,t,e,i){function o(n){return n instanceof e?n:new e(function(a){a(n)})}return new(e||(e=Promise))(function(n,a){function l(f){try{s(i.next(f))}catch(p){a(p)}}function c(f){try{s(i.throw(f))}catch(p){a(p)}}function s(f){f.done?n(f.value):o(f.value).then(l,c)}s((i=i.apply(r,t||[])).next())})},Ce=function(r,t){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,o,n,a;return a={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(s){return function(f){return c([s,f])}}function c(s){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,o&&(n=s[0]&2?o.return:s[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,s[1])).done)return n;switch(o=0,n&&(s=[s[0]&2,n.value]),s[0]){case 0:case 1:n=s;break;case 4:return e.label++,{value:s[1],done:!1};case 5:e.label++,o=s[1],s=[0];continue;case 7:s=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(s[0]===6||s[0]===2)){e=0;continue}if(s[0]===3&&(!n||s[1]>n[0]&&s[1]<n[3])){e.label=s[1];break}if(s[0]===6&&e.label<n[1]){e.label=n[1],n=s;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(s);break}n[2]&&e.ops.pop(),e.trys.pop();continue}s=t.call(r,e)}catch(f){s=[6,f],o=0}finally{i=n=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},Oa=function(){function r(t){this.client=t}return r.prototype.getWalletXpub=function(t){var e=t.path,i=t.xpubVersion;return De(this,void 0,void 0,function(){var o,n,a;return Ce(this,function(l){switch(l.label){case 0:return o=ge(e),[4,this.client.getExtendedPubkey(!1,o)];case 1:if(n=l.sent(),a=Sr(n),a.version!=i)throw new Error("Expected xpub version ".concat(i," doesn't match the xpub version from the device ").concat(a.version));return[2,n]}})})},r.prototype.getWalletPublicKey=function(t,e){var i,o;return De(this,void 0,void 0,function(){var n,a,l,c,s,f;return Ce(this,function(p){switch(p.label){case 0:if(!Pa(t))throw Error("non-standard path: ".concat(t));return n=ge(t),[4,this.client.getExtendedPubkey(!1,n)];case 1:return a=p.sent(),l=(i=e==null?void 0:e.verify)!==null&&i!==void 0?i:!1,[4,this.getWalletAddress(n,Ra((o=e==null?void 0:e.format)!==null&&o!==void 0?o:"legacy"),l)];case 2:return c=p.sent(),s=Sr(a),f=u.Buffer.from((0,pi.pointCompress)(s.pubkey,!1)),[2,{publicKey:f.toString("hex"),bitcoinAddress:c,chainCode:s.chaincode.toString("hex")}]}})})},r.prototype.getWalletAddress=function(t,e,i){return De(this,void 0,void 0,function(){var o,n,a,l,c;return Ce(this,function(s){switch(s.label){case 0:return o=Fn(t),o.length+2!=t.length?[2,""]:[4,this.client.getExtendedPubkey(!1,o)];case 1:return n=s.sent(),[4,this.client.getMasterFingerprint()];case 2:return a=s.sent(),l=new Dr(e,Cr(a,o,n)),c=t.slice(-2,t.length),[2,this.client.getWalletAddress(l,u.Buffer.alloc(32,0),c[0],c[1],i)]}})})},r.prototype.createPaymentTransaction=function(t){return De(this,void 0,void 0,function(){var e,i,o,n,a,l,c,s,y,f,p,m,v,g,T,y,S,E,R,b,P,I,k,L,W,_;return Ce(this,function(U){switch(U.label){case 0:if(e=t.inputs.length,e==0)throw Error("No inputs");return i=new jt,[4,this.client.getMasterFingerprint()];case 1:o=U.sent(),n=Aa(t,i,o),t.lockTime!=null&&i.setGlobalFallbackLocktime(t.lockTime),i.setGlobalInputCount(e),i.setGlobalPsbtVersion(2),i.setGlobalTxVersion(2),a=0,l=function(){!t.onDeviceStreaming||t.onDeviceStreaming({total:2*e,index:a,progress:++a/(2*e)})},c="",s=[],y=0,U.label=2;case 2:return y<e?(l(),f=ge(t.associatedKeysets[y]),c!=""?[3,4]:(s=f.slice(0,-2),[4,this.client.getExtendedPubkey(!1,s)])):[3,7];case 3:c=U.sent(),U.label=4;case 4:return[4,this.setInput(i,y,t.inputs[y],f,n,o,t.sigHashType)];case 5:U.sent(),U.label=6;case 6:return y++,[3,2];case 7:return p=u.Buffer.from(t.outputScriptHex,"hex"),m=new ye(p),v=m.readVarInt(),i.setGlobalOutputCount(v),[4,this.outputScriptAt(s,n,t.changePath)];case 8:for(g=U.sent(),T=!g,y=0;y<v;y++)S=Number(m.readUInt64()),E=m.readVarSlice(),i.setOutputAmount(y,S),i.setOutputScript(y,E),R=g&&E.equals(g==null?void 0:g.cond.scriptPubKey),R&&(T=!0,b=ge(t.changePath),P=g.pubkey,n.setOwnOutput(y,g.cond,[P],[b]));if(!T)throw new Error("Change script not found among outputs! "+(g==null?void 0:g.cond.scriptPubKey.toString("hex")));return I=Cr(o,s,c),k=new Dr(n.getDescriptorTemplate(),I),t.onDeviceSignatureRequested&&t.onDeviceSignatureRequested(),L=!1,W=function(){L||(L=!0,t.onDeviceSignatureGranted&&t.onDeviceSignatureGranted()),l()},[4,this.signPsbt(i,k,W)];case 9:return U.sent(),li(i),_=si(i),[2,_.toString("hex")]}})})},r.prototype.outputScriptAt=function(t,e,i){return De(this,void 0,void 0,function(){var o,n,a,l,c;return Ce(this,function(s){switch(s.label){case 0:if(!i)return[2,void 0];for(o=ge(i),n=0;n<t.length;n++)if(t[n]!=o[n])throw new Error("Path ".concat(i," not in account ").concat(He(t)));return[4,this.client.getExtendedPubkey(!1,o)];case 1:return a=s.sent(),l=Tr(a),c=e.spendingCondition([l]),[2,{cond:c,pubkey:l}]}})})},r.prototype.setInput=function(t,e,i,o,n,a,l){return De(this,void 0,void 0,function(){var c,s,f,p,m,v,g,T,y,S,E;return Ce(this,function(R){switch(R.label){case 0:return c=i[0],s=i[1],f=i[2]?u.Buffer.from(i[2],"hex"):void 0,p=i[3],p!=null&&t.setInputSequence(e,p),l!=null&&t.setInputSighashType(e,l),m=Ye(c,!0),v=fi.crypto.hash256(m),[4,this.client.getExtendedPubkey(!1,o)];case 1:if(g=R.sent(),T=Tr(g),!c.outputs)throw Error("Missing outputs array in transaction to sign");return y=c.outputs[s],S={scriptPubKey:y.script,redeemScript:f},E={cond:S,amount:y.amount},n.setInput(e,m,E,[T],[o]),t.setInputPreviousTxId(e,v),t.setInputOutputIndex(e,s),[2]}})})},r.prototype.signPsbt=function(t,e,i){return De(this,void 0,void 0,function(){var o;return Ce(this,function(n){switch(n.label){case 0:return[4,this.client.signPsbt(t,e,u.Buffer.alloc(32,0),i)];case 1:return o=n.sent(),o.forEach(function(a,l){var c=t.getInputKeyDatas(l,C.BIP32_DERIVATION),s;if(c.length!=1){if(s=t.getInputKeyDatas(l,C.TAP_BIP32_DERIVATION),s.length==0)throw Error("Missing pubkey derivation for input ".concat(l));t.setInputTapKeySig(l,a)}else s=c[0],t.setInputPartialSig(l,s,a)}),[2]}})})},r}(),$r=Oa;function Ra(r){if(r=="legacy")return"pkh(@0)";if(r=="p2sh")return"sh(wpkh(@0))";if(r=="bech32")return"wpkh(@0)";if(r=="bech32m")return"tr(@0)";throw new Error("Unsupported address format "+r)}function Aa(r,t,e){return r.additionals.includes("bech32m")?new ei(t,e):r.additionals.includes("bech32")?new ri(t,e):r.segwit?new ti(t,e):new Jn(t,e)}function Pa(r){var t=2147483648,e=ge(r),i=function(a){return a>=t},o=function(a){return a===void 0||a<t},n=function(a){return a===void 0||a===0||a===1};return!!(e.length>=3&&e.length<=5&&[44+t,49+t,84+t,86+t].some(function(a){return a==e[0]})&&[0+t,1+t].some(function(a){return a==e[1]})&&i(e[2])&&n(e[3])&&o(e[4])||e.length>=4&&e.length<=6&&48+t==e[0]&&[0+t,1+t].some(function(a){return a==e[1]})&&i(e[2])&&i(e[3])&&n(e[4])&&o(e[5]))}h();d();var ws=F(mi()),xs=F(_n()),Is=F(mr());h();d();h();d();var Gr=function(){return Gr=Object.assign||function(r){for(var t,e=1,i=arguments.length;e<i;e++){t=arguments[e];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(r[o]=t[o])}return r},Gr.apply(this,arguments)},Ca=function(r,t,e,i){function o(n){return n instanceof e?n:new e(function(a){a(n)})}return new(e||(e=Promise))(function(n,a){function l(f){try{s(i.next(f))}catch(p){a(p)}}function c(f){try{s(i.throw(f))}catch(p){a(p)}}function s(f){f.done?n(f.value):o(f.value).then(l,c)}s((i=i.apply(r,t||[])).next())})},ka=function(r,t){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,o,n,a;return a={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(s){return function(f){return c([s,f])}}function c(s){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,o&&(n=s[0]&2?o.return:s[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,s[1])).done)return n;switch(o=0,n&&(s=[s[0]&2,n.value]),s[0]){case 0:case 1:n=s;break;case 4:return e.label++,{value:s[1],done:!1};case 5:e.label++,o=s[1],s=[0];continue;case 7:s=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(s[0]===6||s[0]===2)){e=0;continue}if(s[0]===3&&(!n||s[1]>n[0]&&s[1]<n[3])){e.label=s[1];break}if(s[0]===6&&e.label<n[1]){e.label=n[1],n=s;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(s);break}n[2]&&e.ops.pop(),e.trys.pop();continue}s=t.call(r,e)}catch(f){s=[6,f],o=0}finally{i=n=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},gi={legacy:0,p2sh:1,bech32:2,cashaddr:3};function gt(r,t){return Ca(this,void 0,void 0,function(){var e,i,o,n,a,l,c,s,f,p,m,v,g;return ka(this,function(T){switch(T.label){case 0:if(e=Gr({verify:!1,format:"legacy"},t),i=e.path,o=e.verify,n=e.format,!(n in gi))throw new Error("btc.getWalletPublicKey invalid format="+n);return a=Xe(i),l=o?1:0,c=gi[n],[4,r.send(224,64,l,c,a)];case 1:return s=T.sent(),f=s[0],p=s[1+f],m=s.slice(1,1+f).toString("hex"),v=s.slice(1+f+1,1+f+1+p).toString("ascii"),g=s.slice(1+f+1+p,1+f+1+p+32).toString("hex"),[2,{publicKey:m,bitcoinAddress:v,chainCode:g}]}})})}h();d();var Ei=F(Br());var Kr=function(r,t,e,i){function o(n){return n instanceof e?n:new e(function(a){a(n)})}return new(e||(e=Promise))(function(n,a){function l(f){try{s(i.next(f))}catch(p){a(p)}}function c(f){try{s(i.throw(f))}catch(p){a(p)}}function s(f){f.done?n(f.value):o(f.value).then(l,c)}s((i=i.apply(r,t||[])).next())})},Fr=function(r,t){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,o,n,a;return a={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(s){return function(f){return c([s,f])}}function c(s){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,o&&(n=s[0]&2?o.return:s[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,s[1])).done)return n;switch(o=0,n&&(s=[s[0]&2,n.value]),s[0]){case 0:case 1:n=s;break;case 4:return e.label++,{value:s[1],done:!1};case 5:e.label++,o=s[1],s=[0];continue;case 7:s=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(s[0]===6||s[0]===2)){e=0;continue}if(s[0]===3&&(!n||s[1]>n[0]&&s[1]<n[3])){e.label=s[1];break}if(s[0]===6&&e.label<n[1]){e.label=n[1],n=s;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(s);break}n[2]&&e.ops.pop(),e.trys.pop();continue}s=t.call(r,e)}catch(f){s=[6,f],o=0}finally{i=n=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},Vr=function(r){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&r[t],i=0;if(e)return e.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&i>=r.length&&(r=void 0),{value:r&&r[i++],done:!r}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};function Ze(r,t,e){return Kr(this,void 0,void 0,function(){var i,o,n,a,l;return Fr(this,function(c){switch(c.label){case 0:return o=!1,typeof e=="number"?(o=!0,n=u.Buffer.alloc(4),n.writeUInt32BE(e,0),i=u.Buffer.concat([n,t],t.length+4)):i=t,[4,r.send(224,66,o?0:128,0,i)];case 1:return a=c.sent(),l=a.slice(0,a.length-2).toString("hex"),[2,l]}})})}function Qe(r,t,e,i){return i===void 0&&(i=[]),Kr(this,void 0,void 0,function(){var o,n,a,l,c,s,f,p,m,v,g,T,y,S,E,_,R,b,P,I,_,k,L,W,_,U,N,j,J,z,xe=this;return Fr(this,function(M){switch(M.label){case 0:if(o=e.version,n=e.inputs,a=e.outputs,l=e.locktime,c=e.nExpiryHeight,s=e.extraData,!a||!l)throw new Error("getTrustedInput: locktime & outputs is expected");return f=i.includes("decred"),p=i.includes("stealthcoin"),m=function(K,de){return Kr(xe,void 0,void 0,function(){var B,$,re,ve,Ie,oe,me,$e,Re,Ae,st;return Fr(this,function(se){switch(se.label){case 0:for(B=de||u.Buffer.alloc(0),$=[],re=0;re!==K.length;)ve=K.length-re>ce?ce:K.length-re,re+ve!==K.length?$.push(K.slice(re,re+ve)):$.push(u.Buffer.concat([K.slice(re,re+ve),B])),re+=ve;K.length===0&&$.push(B),se.label=1;case 1:se.trys.push([1,6,7,8]),oe=Vr($),me=oe.next(),se.label=2;case 2:return me.done?[3,5]:($e=me.value,[4,Ze(r,$e)]);case 3:Ie=se.sent(),se.label=4;case 4:return me=oe.next(),[3,2];case 5:return[3,8];case 6:return Re=se.sent(),Ae={error:Re},[3,8];case 7:try{me&&!me.done&&(st=oe.return)&&st.call(oe)}finally{if(Ae)throw Ae.error}return[7];case 8:return[2,Ie]}})})},v=function(K){return Ze(r,K)},[4,Ze(r,u.Buffer.concat([e.version,e.timestamp||u.Buffer.alloc(0),e.nVersionGroupId||u.Buffer.alloc(0),V(n.length)]),t)];case 1:M.sent(),M.label=2;case 2:M.trys.push([2,8,9,10]),g=Vr(n),T=g.next(),M.label=3;case 3:return T.done?[3,7]:(y=T.value,S=p&&u.Buffer.compare(o,u.Buffer.from([2,0,0,0]))===0,E=f?y.tree||u.Buffer.from([0]):u.Buffer.alloc(0),_=u.Buffer.concat([y.prevout,E,S?u.Buffer.from([0]):V(y.script.length)]),[4,Ze(r,_)]);case 4:return M.sent(),[4,f?v(u.Buffer.concat([y.script,y.sequence])):S?v(y.sequence):m(y.script,y.sequence)];case 5:M.sent(),M.label=6;case 6:return T=g.next(),[3,3];case 7:return[3,10];case 8:return R=M.sent(),N={error:R},[3,10];case 9:try{T&&!T.done&&(j=g.return)&&j.call(g)}finally{if(N)throw N.error}return[7];case 10:return[4,Ze(r,V(a.length))];case 11:M.sent(),M.label=12;case 12:M.trys.push([12,17,18,19]),b=Vr(a),P=b.next(),M.label=13;case 13:return P.done?[3,16]:(I=P.value,_=u.Buffer.concat([I.amount,f?u.Buffer.from([0,0]):u.Buffer.alloc(0),V(I.script.length),I.script]),[4,Ze(r,_)]);case 14:M.sent(),M.label=15;case 15:return P=b.next(),[3,13];case 16:return[3,19];case 17:return k=M.sent(),J={error:k},[3,19];case 18:try{P&&!P.done&&(z=b.return)&&z.call(b)}finally{if(J)throw J.error}return[7];case 19:return L=[],c&&c.length>0&&L.push(c),s&&s.length>0&&L.push(s),L.length&&(_=u.Buffer.concat(L),W=f?_:u.Buffer.concat([V(_.length),_])),[4,m(u.Buffer.concat([l,W||u.Buffer.alloc(0)]))];case 20:return U=M.sent(),(0,Ei.default)(U,"missing result in processScriptBlocks"),[2,U]}})})}h();d();var qa=function(r,t,e,i){function o(n){return n instanceof e?n:new e(function(a){a(n)})}return new(e||(e=Promise))(function(n,a){function l(f){try{s(i.next(f))}catch(p){a(p)}}function c(f){try{s(i.throw(f))}catch(p){a(p)}}function s(f){f.done?n(f.value):o(f.value).then(l,c)}s((i=i.apply(r,t||[])).next())})},Ma=function(r,t){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,o,n,a;return a={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(s){return function(f){return c([s,f])}}function c(s){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,o&&(n=s[0]&2?o.return:s[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,s[1])).done)return n;switch(o=0,n&&(s=[s[0]&2,n.value]),s[0]){case 0:case 1:n=s;break;case 4:return e.label++,{value:s[1],done:!1};case 5:e.label++,o=s[1],s=[0];continue;case 7:s=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(s[0]===6||s[0]===2)){e=0;continue}if(s[0]===3&&(!n||s[1]>n[0]&&s[1]<n[3])){e.label=s[1];break}if(s[0]===6&&e.label<n[1]){e.label=n[1],n=s;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(s);break}n[2]&&e.ops.pop(),e.trys.pop();continue}s=t.call(r,e)}catch(f){s=[6,f],o=0}finally{i=n=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},wi=function(r){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&r[t],i=0;if(e)return e.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&i>=r.length&&(r=void 0),{value:r&&r[i++],done:!r}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};function Xr(r,t,e,i,o,n,a){o===void 0&&(o=!1),n===void 0&&(n=!1),a===void 0&&(a=[]);var l=a.includes("cashaddr")?3:o?a.includes("sapling")?5:n?4:2:0;return r.send(224,68,e?0:128,t?l:128,i)}function Je(r,t,e,i,o,n,a,l){return o===void 0&&(o=!1),n===void 0&&(n=!1),a===void 0&&(a=[]),l===void 0&&(l=!1),qa(this,void 0,void 0,function(){var c,s,f,p,m,v,g,T,y,S,E,R,b,P,I,k,L,W,_,U;return Ma(this,function(N){switch(N.label){case 0:return c=u.Buffer.concat([e.version,e.timestamp||u.Buffer.alloc(0),e.nVersionGroupId||u.Buffer.alloc(0),V(e.inputs.length)]),[4,Xr(r,t,!0,c,o,n,a)];case 1:N.sent(),s=0,f=a.includes("decred"),N.label=2;case 2:N.trys.push([2,15,16,17]),p=wi(e.inputs),m=p.next(),N.label=3;case 3:return m.done?[3,14]:(v=m.value,g=void 0,T=i[s].value,o?l&&i[s].trustedInput?g=u.Buffer.from([1,T.length]):g=u.Buffer.from([2]):i[s].trustedInput?g=u.Buffer.from([1,i[s].value.length]):g=u.Buffer.from([0]),c=u.Buffer.concat([g,T,f?u.Buffer.from([0]):u.Buffer.alloc(0),V(v.script.length)]),[4,Xr(r,t,!1,c,o,n,a)]);case 4:if(N.sent(),y=[],S=0,v.script.length===0)y.push(v.sequence);else for(;S!==v.script.length;)E=v.script.length-S>ce?ce:v.script.length-S,S+E!==v.script.length?y.push(v.script.slice(S,S+E)):y.push(u.Buffer.concat([v.script.slice(S,S+E),v.sequence])),S+=E;N.label=5;case 5:N.trys.push([5,10,11,12]),R=(_=void 0,wi(y)),b=R.next(),N.label=6;case 6:return b.done?[3,9]:(P=b.value,[4,Xr(r,t,!1,P,o,n,a)]);case 7:N.sent(),N.label=8;case 8:return b=R.next(),[3,6];case 9:return[3,12];case 10:return I=N.sent(),_={error:I},[3,12];case 11:try{b&&!b.done&&(U=R.return)&&U.call(R)}finally{if(_)throw _.error}return[7];case 12:s++,N.label=13;case 13:return m=p.next(),[3,3];case 14:return[3,17];case 15:return k=N.sent(),L={error:k},[3,17];case 16:try{m&&!m.done&&(W=p.return)&&W.call(p)}finally{if(L)throw L.error}return[7];case 17:return[2]}})})}h();d();var Hr=F(mr());function et(r,t,e,i){if(i===void 0&&(i=[]),!e)throw new Error("getTrustedInputBIP143: missing tx");var o=i.includes("decred");if(o)throw new Error("Decred does not implement BIP143");var n=(0,Hr.default)("sha256").update((0,Hr.default)("sha256").update(Ye(e,!0)).digest()).digest(),a=u.Buffer.alloc(4);a.writeUInt32LE(t,0);var l=e.outputs,c=e.locktime;if(!l||!c)throw new Error("getTrustedInputBIP143: locktime & outputs is expected");if(!l[t])throw new Error("getTrustedInputBIP143: wrong index");return n=u.Buffer.concat([n,a,l[t].amount]),n.toString("hex")}h();d();function xi(r){var t=(r[64]&1)!==0?3:2,e=u.Buffer.alloc(1);return e[0]=t,u.Buffer.concat([e,r.slice(1,1+32)])}h();d();function yt(r,t,e,i,o,n){n===void 0&&(n=[]);var a=n.includes("decred"),l=Xe(t),c=u.Buffer.alloc(4);c.writeUInt32BE(e,0);var s=a?u.Buffer.concat([l,c,o||u.Buffer.from([0,0,0,0]),u.Buffer.from([i])]):u.Buffer.concat([l,u.Buffer.from([0]),c,u.Buffer.from([i])]);return o&&!a&&(s=u.Buffer.concat([s,o])),r.send(224,72,0,0,s).then(function(f){return f.length>0?(f[0]=48,f.slice(0,f.length-2)):f})}h();d();var $a=function(r,t,e,i){function o(n){return n instanceof e?n:new e(function(a){a(n)})}return new(e||(e=Promise))(function(n,a){function l(f){try{s(i.next(f))}catch(p){a(p)}}function c(f){try{s(i.throw(f))}catch(p){a(p)}}function s(f){f.done?n(f.value):o(f.value).then(l,c)}s((i=i.apply(r,t||[])).next())})},Ga=function(r,t){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,o,n,a;return a={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(s){return function(f){return c([s,f])}}function c(s){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,o&&(n=s[0]&2?o.return:s[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,s[1])).done)return n;switch(o=0,n&&(s=[s[0]&2,n.value]),s[0]){case 0:case 1:n=s;break;case 4:return e.label++,{value:s[1],done:!1};case 5:e.label++,o=s[1],s=[0];continue;case 7:s=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(s[0]===6||s[0]===2)){e=0;continue}if(s[0]===3&&(!n||s[1]>n[0]&&s[1]<n[3])){e.label=s[1];break}if(s[0]===6&&e.label<n[1]){e.label=n[1],n=s;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(s);break}n[2]&&e.ops.pop(),e.trys.pop();continue}s=t.call(r,e)}catch(f){s=[6,f],o=0}finally{i=n=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}};function Wr(r,t){var e=Xe(t);return r.send(224,74,255,0,e)}function tt(r,t,e){return e===void 0&&(e=[]),$a(this,void 0,void 0,function(){var i,o,n,a,l,c;return Ga(this,function(s){switch(s.label){case 0:if(i=0,o=Number(128),n=e.includes("decred"),n)return[2,r.send(224,74,o,0,t)];s.label=1;case 1:return i<t.length?(a=i+ce>=t.length?t.length-i:ce,l=i+a===t.length?128:0,c=t.slice(i,i+a),[4,r.send(224,74,l,0,c)]):[3,3];case 2:return s.sent(),i+=a,[3,1];case 3:return[2]}})})}h();d();var Si=F(Br()),Ii=function(r,t,e,i){function o(n){return n instanceof e?n:new e(function(a){a(n)})}return new(e||(e=Promise))(function(n,a){function l(f){try{s(i.next(f))}catch(p){a(p)}}function c(f){try{s(i.throw(f))}catch(p){a(p)}}function s(f){f.done?n(f.value):o(f.value).then(l,c)}s((i=i.apply(r,t||[])).next())})},Ti=function(r,t){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,o,n,a;return a={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(s){return function(f){return c([s,f])}}function c(s){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,o&&(n=s[0]&2?o.return:s[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,s[1])).done)return n;switch(o=0,n&&(s=[s[0]&2,n.value]),s[0]){case 0:case 1:n=s;break;case 4:return e.label++,{value:s[1],done:!1};case 5:e.label++,o=s[1],s=[0];continue;case 7:s=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(s[0]===6||s[0]===2)){e=0;continue}if(s[0]===3&&(!n||s[1]>n[0]&&s[1]<n[3])){e.label=s[1];break}if(s[0]===6&&e.label<n[1]){e.label=n[1],n=s;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(s);break}n[2]&&e.ops.pop(),e.trys.pop();continue}s=t.call(r,e)}catch(f){s=[6,f],o=0}finally{i=n=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},Zt=function(r){return Ii(void 0,void 0,void 0,function(){var t,e,i,o,n,a,l,c,s;return Ti(this,function(f){switch(f.label){case 0:return[4,r.send(176,1,0,0)];case 1:return t=f.sent(),e=0,i=t[e++],(0,Si.default)(i===1,"getAppAndVersion: format not supported"),o=t[e++],n=t.slice(e,e+=o).toString("ascii"),a=t[e++],l=t.slice(e,e+=a).toString("ascii"),c=t[e++],s=t.slice(e,e+=c),[2,{name:n,version:l,flags:s}]}})})},bi=function(r){return Ii(void 0,void 0,void 0,function(){var t;return Ti(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,r.send(224,196,0,0)];case 1:return e.sent(),[3,3];case 2:return t=e.sent(),[2,!1];case 3:return[2,!0]}})})};h();d();var hs=F(ps());function ds(r){var t=r.version,e=r.name;return e==="Decred"?!1:e==="Exchange"?!0:hs.default.gte(t,"1.4.0")}var nt=function(){return nt=Object.assign||function(r){for(var t,e=1,i=arguments.length;e<i;e++){t=arguments[e];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(r[o]=t[o])}return r},nt.apply(this,arguments)},Fc=function(r,t,e,i){function o(n){return n instanceof e?n:new e(function(a){a(n)})}return new(e||(e=Promise))(function(n,a){function l(f){try{s(i.next(f))}catch(p){a(p)}}function c(f){try{s(i.throw(f))}catch(p){a(p)}}function s(f){f.done?n(f.value):o(f.value).then(l,c)}s((i=i.apply(r,t||[])).next())})},Xc=function(r,t){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,o,n,a;return a={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(s){return function(f){return c([s,f])}}function c(s){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,o&&(n=s[0]&2?o.return:s[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,s[1])).done)return n;switch(o=0,n&&(s=[s[0]&2,n.value]),s[0]){case 0:case 1:n=s;break;case 4:return e.label++,{value:s[1],done:!1};case 5:e.label++,o=s[1],s=[0];continue;case 7:s=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(s[0]===6||s[0]===2)){e=0;continue}if(s[0]===3&&(!n||s[1]>n[0]&&s[1]<n[3])){e.label=s[1];break}if(s[0]===6&&e.label<n[1]){e.label=n[1],n=s;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(s);break}n[2]&&e.ops.pop(),e.trys.pop();continue}s=t.call(r,e)}catch(f){s=[6,f],o=0}finally{i=n=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},Hc=function(r){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&r[t],i=0;if(e)return e.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&i>=r.length&&(r=void 0),{value:r&&r[i++],done:!r}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Wc={lockTime:Kt,sigHashType:ht,segwit:!1,additionals:[],onDeviceStreaming:function(r){},onDeviceSignatureGranted:function(){},onDeviceSignatureRequested:function(){}};function vs(r,t){return Fc(this,void 0,void 0,function(){var e,i,o,n,a,l,c,s,f,p,m,v,g,T,y,S,E,R,b,P,I,k,L,W,_,U,N,j,J,z,xe,M,K,de,B,$,re,ve,Ie,oe,ae,me,$e,Re,Ae,st,se,A,gn,A,A,ae,fr,at,yn,En,A,pr,hr,dr,ue,Lt,A,wn,Dt,vr,xn;return Xc(this,function(q){switch(q.label){case 0:if(e=nt(nt({},Wc),t),i=e.inputs,o=e.associatedKeysets,n=e.changePath,a=e.outputScriptHex,l=e.lockTime,c=e.sigHashType,s=e.segwit,f=e.initialTimestamp,p=e.additionals,m=e.expiryHeight,v=e.onDeviceStreaming,g=e.onDeviceSignatureGranted,T=e.onDeviceSignatureRequested,y=e.useTrustedInputForSegwit,y!==void 0)return[3,4];q.label=1;case 1:return q.trys.push([1,3,,4]),[4,Zt(r)];case 2:return S=q.sent(),y=ds(S),[3,4];case 3:if(E=q.sent(),E.statusCode===27904)y=!1;else throw E;return[3,4];case 4:R=function(Ge,Be){var Ve=i.length;if(!(Ve<3)){var In=Ve*Ge+Be,Tn=2*Ve,qs=In/Tn;v({progress:qs,total:Tn,index:In})}},b=p.includes("decred"),P=p.includes("zcash"),I=p.includes("stealthcoin"),k=Date.now(),L=p.includes("sapling"),W=s&&p.includes("bech32"),_=s||!!p&&(p.includes("abc")||p.includes("gold")||p.includes("bip143"))||!!m&&!b,U=u.Buffer.alloc(4),U.writeUInt32LE(l,0),N=u.Buffer.alloc(0),j=u.Buffer.alloc(0),J=u.Buffer.alloc(4),!!m&&!b?J.writeUInt32LE(P?2147483653:L?2147483652:2147483651,0):I?J.writeUInt32LE(2,0):J.writeUInt32LE(1,0),z=[],xe=[],M=[],K=[],de=!0,B=!1,$={inputs:[],version:J,timestamp:u.Buffer.alloc(0)},re=_&&!y?et:Qe,ve=u.Buffer.from(a,"hex"),R(0,0),q.label=5;case 5:q.trys.push([5,11,12,13]),Ie=Hc(i),oe=Ie.next(),q.label=6;case 6:return oe.done?[3,10]:(ae=oe.value,B?[3,8]:[4,re(r,ae[1],ae[0],p)]);case 7:me=q.sent(),Ct("hw","got trustedInput="+me),$e=u.Buffer.alloc(4),$e.writeUInt32LE(ae.length>=4&&typeof ae[3]=="number"?ae[3]:We,0),z.push({trustedInput:!0,value:u.Buffer.from(me,"hex"),sequence:$e}),q.label=8;case 8:Re=ae[0].outputs,Ae=ae[1],Re&&Ae<=Re.length-1&&xe.push(Re[Ae]),m&&!b?($.nVersionGroupId=u.Buffer.from(P?[10,39,167,38]:L?[133,32,47,137]:[112,130,196,3]),$.nExpiryHeight=m,$.extraData=u.Buffer.from(L?[0,0,0,0,0,0,0,0,0,0,0]:[0])):b&&($.nExpiryHeight=m),q.label=9;case 9:return oe=Ie.next(),[3,6];case 10:return[3,13];case 11:return st=q.sent(),vr={error:st},[3,13];case 12:try{oe&&!oe.done&&(xn=Ie.return)&&xn.call(Ie)}finally{if(vr)throw vr.error}return[7];case 13:if($.inputs=i.map(function(Ge,Be){var Ve=u.Buffer.alloc(4);return Ve.writeUInt32LE(Ge.length>=4&&typeof Ge[3]=="number"?Ge[3]:We,0),{script:P?xe[Be].script:N,prevout:j,sequence:Ve}}),B)return[3,18];se=[],A=0,q.label=14;case 14:return A<i.length?[4,gt(r,{path:o[A]})]:[3,17];case 15:gn=q.sent(),R(0,A+1),se.push(gn),q.label=16;case 16:return A++,[3,14];case 17:for(A=0;A<se.length;A++)K.push(xi(u.Buffer.from(se[A].publicKey,"hex")));q.label=18;case 18:return f!==void 0&&($.timestamp=u.Buffer.alloc(4),$.timestamp.writeUInt32LE(Math.floor(f+(Date.now()-k)/1e3),0)),T(),_?[4,Je(r,!0,$,z,!0,!!m,p,y)]:[3,23];case 19:return q.sent(),!B&&n?[4,Wr(r,n)]:[3,21];case 20:q.sent(),q.label=21;case 21:return[4,tt(r,ve)];case 22:q.sent(),q.label=23;case 23:return!!m&&!b?[4,yt(r,"",l,ht,m)]:[3,25];case 24:q.sent(),q.label=25;case 25:A=0,q.label=26;case 26:return A<i.length?(ae=i[A],fr=i[A].length>=3&&typeof ae[2]=="string"?u.Buffer.from(ae[2],"hex"):s?u.Buffer.concat([u.Buffer.from([Ft,dt,je]),_e(K[A]),u.Buffer.from([Xt,Ht])]):xe[A].script,at=Object.assign({},$),yn=_?[z[A]]:z,_?at.inputs=[nt(nt({},at.inputs[A]),{script:fr})]:at.inputs[A].script=fr,[4,Je(r,!_&&de,at,yn,_,!!m&&!b,p,y)]):[3,34];case 27:return q.sent(),_?[3,31]:!B&&n?[4,Wr(r,n)]:[3,29];case 28:q.sent(),q.label=29;case 29:return[4,tt(r,ve,p)];case 30:q.sent(),q.label=31;case 31:return de&&(g(),R(1,0)),[4,yt(r,o[A],l,c,m,p)];case 32:En=q.sent(),R(1,A+1),M.push(En),$.inputs[A].script=N,de&&(de=!1),q.label=33;case 33:return A++,[3,26];case 34:for(A=0;A<i.length;A++)s?($.witness=u.Buffer.alloc(0),W||($.inputs[A].script=u.Buffer.concat([u.Buffer.from("160014","hex"),_e(K[A])]))):(pr=u.Buffer.alloc(1),hr=u.Buffer.alloc(1),pr[0]=M[A].length,hr[0]=K[A].length,$.inputs[A].script=u.Buffer.concat([pr,M[A],hr,K[A]])),dr=_&&!y?0:4,$.inputs[A].prevout=z[A].value.slice(dr,dr+36);if($.locktime=U,ue=u.Buffer.concat([Ye($,!1,$.timestamp,p),ve]),s&&!b){for(Lt=u.Buffer.alloc(0),A=0;A<i.length;A++)wn=u.Buffer.concat([u.Buffer.from("02","hex"),u.Buffer.from([M[A].length]),M[A],u.Buffer.from([K[A].length]),K[A]]),Lt=u.Buffer.concat([Lt,wn]);ue=u.Buffer.concat([ue,Lt])}return P||(ue=u.Buffer.concat([ue,U]),m&&(ue=u.Buffer.concat([ue,$.nExpiryHeight||u.Buffer.alloc(0),$.extraData||u.Buffer.alloc(0)]))),b&&(Dt=u.Buffer.from([$.inputs.length]),i.forEach(function(Ge,Be){Dt=u.Buffer.concat([Dt,u.Buffer.from([0,0,0,0,0,0,0,0]),u.Buffer.from([0,0,0,0]),u.Buffer.from([255,255,255,255]),u.Buffer.from([$.inputs[Be].script.length]),$.inputs[Be].script])}),ue=u.Buffer.concat([ue,Dt])),P&&(ue=u.Buffer.concat([ue,u.Buffer.from([0,0,0])])),[2,ue.toString("hex")]}})})}var lr=function(){return lr=Object.assign||function(r){for(var t,e=1,i=arguments.length;e<i;e++){t=arguments[e];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(r[o]=t[o])}return r},lr.apply(this,arguments)},ms=function(r,t,e,i){function o(n){return n instanceof e?n:new e(function(a){a(n)})}return new(e||(e=Promise))(function(n,a){function l(f){try{s(i.next(f))}catch(p){a(p)}}function c(f){try{s(i.throw(f))}catch(p){a(p)}}function s(f){f.done?n(f.value):o(f.value).then(l,c)}s((i=i.apply(r,t||[])).next())})},gs=function(r,t){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,o,n,a;return a={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(s){return function(f){return c([s,f])}}function c(s){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,o&&(n=s[0]&2?o.return:s[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,s[1])).done)return n;switch(o=0,n&&(s=[s[0]&2,n.value]),s[0]){case 0:case 1:n=s;break;case 4:return e.label++,{value:s[1],done:!1};case 5:e.label++,o=s[1],s=[0];continue;case 7:s=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(s[0]===6||s[0]===2)){e=0;continue}if(s[0]===3&&(!n||s[1]>n[0]&&s[1]<n[3])){e.label=s[1];break}if(s[0]===6&&e.label<n[1]){e.label=n[1],n=s;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(s);break}n[2]&&e.ops.pop(),e.trys.pop();continue}s=t.call(r,e)}catch(f){s=[6,f],o=0}finally{i=n=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},jc=function(){function r(t){this.transport=t,this.derivationsCache={}}return r.prototype.derivatePath=function(t){return ms(this,void 0,void 0,function(){var e;return gs(this,function(i){switch(i.label){case 0:return this.derivationsCache[t]?[2,this.derivationsCache[t]]:[4,gt(this.transport,{path:t})];case 1:return e=i.sent(),this.derivationsCache[t]=e,[2,e]}})})},r.prototype.getWalletXpub=function(t){var e=t.path,i=t.xpubVersion;return ms(this,void 0,void 0,function(){var o,n,a,l,c,s;return gs(this,function(f){switch(f.label){case 0:return o=ge(e),n=o.slice(0,-1),[4,this.derivatePath(He(n))];case 1:return a=f.sent(),[4,this.derivatePath(e)];case 2:return l=f.sent(),c=zc(Es(u.Buffer.from(a.publicKey,"hex"))),s=Yc(i,o.length,c,o[o.length-1],u.Buffer.from(l.chainCode,"hex"),Es(u.Buffer.from(l.publicKey,"hex"))),[2,s]}})})},r.prototype.getWalletPublicKey=function(t,e){if((e==null?void 0:e.format)==="bech32m")throw new Error("Unsupported address format bech32m");return gt(this.transport,lr(lr({},e),{path:t}))},r.prototype.createPaymentTransaction=function(t){if(arguments.length>1)throw new Error("@ledgerhq/hw-app-btc: createPaymentTransaction multi argument signature is deprecated. please switch to named parameters.");return vs(this.transport,t)},r}(),sn=jc;function zc(r){return Jc(r).slice(0,4)}function ys(r){var t=u.Buffer.allocUnsafe(4);return t.writeUInt32BE(r,0),t}var Es=function(r){return u.Buffer.concat([u.Buffer.from([2+(r[64]&1)]),r.slice(1,33)])};function Yc(r,t,e,i,o,n){var a=ys(i);a[0]|=128;var l=u.Buffer.concat([ys(r),u.Buffer.from([t]),e,a,o,n]),c=Zc(l).slice(0,4);return ws.default.encode(u.Buffer.concat([l,c]))}function on(r){return(0,Is.default)("sha256").update(r).digest()}function Zc(r){return on(on(r))}function Qc(r){return new xs.default().update(r).digest()}function Jc(r){return Qc(on(r))}h();d();h();d();h();d();var Ts=function(){function r(t,e){if(t.length!=e.length)throw new Error("keys and values should have the same length");for(var i=0;i<t.length-1;i++)if(t[i].toString("hex")>=t[i+1].toString("hex"))throw new Error("keys must be in strictly increasing order");this.keys=t,this.keysTree=new Ee(t.map(function(o){return we(o)})),this.values=e,this.valuesTree=new Ee(e.map(function(o){return we(o)}))}return r.prototype.commitment=function(){return u.Buffer.concat([V(this.keys.length),this.keysTree.getRoot(),this.valuesTree.getRoot()])},r}();var el=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,o){i.__proto__=o}||function(i,o){for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(i[n]=o[n])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),an=function(r,t){var e=typeof Symbol=="function"&&r[Symbol.iterator];if(!e)return r;var i=e.call(r),o,n=[],a;try{for(;(t===void 0||t-- >0)&&!(o=i.next()).done;)n.push(o.value)}catch(l){a={error:l}}finally{try{o&&!o.done&&(e=i.return)&&e.call(i)}finally{if(a)throw a.error}}return n},un=function(r,t,e){if(e||arguments.length===2)for(var i=0,o=t.length,n;i<o;i++)(n||!(i in t))&&(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return r.concat(n||Array.prototype.slice.call(t))},Ss=function(r){el(t,r);function t(e){var i=r.call(this)||this;i.inputMerkleMaps=[],i.outputMerkleMaps=[],e.copy(i),i.globalMerkleMap=t.createMerkleMap(i.globalMap);for(var o=0;o<i.getGlobalInputCount();o++)i.inputMerkleMaps.push(t.createMerkleMap(i.inputMaps[o]));i.inputMapCommitments=un([],an(i.inputMerkleMaps.values()),!1).map(function(n){return n.commitment()});for(var o=0;o<i.getGlobalOutputCount();o++)i.outputMerkleMaps.push(t.createMerkleMap(i.outputMaps[o]));return i.outputMapCommitments=un([],an(i.outputMerkleMaps.values()),!1).map(function(n){return n.commitment()}),i}return t.prototype.getGlobalSize=function(){return this.globalMap.size},t.prototype.getGlobalKeysValuesRoot=function(){return this.globalMerkleMap.commitment()},t.createMerkleMap=function(e){var i=un([],an(e.keys()),!1).sort(),o=i.map(function(l){var c=e.get(l);if(!c)throw new Error("No value for key "+l);return c}),n=i.map(function(l){return u.Buffer.from(l,"hex")}),a=new Ts(n,o);return a},t}(jt);h();d();var _s=F(ut());var Rt=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,o){i.__proto__=o}||function(i,o){for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(i[n]=o[n])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),cn=function(r,t){var e=typeof Symbol=="function"&&r[Symbol.iterator];if(!e)return r;var i=e.call(r),o,n=[],a;try{for(;(t===void 0||t-- >0)&&!(o=i.next()).done;)n.push(o.value)}catch(l){a={error:l}}finally{try{o&&!o.done&&(e=i.return)&&e.call(i)}finally{if(a)throw a.error}}return n},ln=function(r,t,e){if(e||arguments.length===2)for(var i=0,o=t.length,n;i<o;i++)(n||!(i in t))&&(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return r.concat(n||Array.prototype.slice.call(t))},bs=function(r){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&r[t],i=0;if(e)return e.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&i>=r.length&&(r=void 0),{value:r&&r[i++],done:!r}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Me;(function(r){r[r.YIELD=16]="YIELD",r[r.GET_PREIMAGE=64]="GET_PREIMAGE",r[r.GET_MERKLE_LEAF_PROOF=65]="GET_MERKLE_LEAF_PROOF",r[r.GET_MERKLE_LEAF_INDEX=66]="GET_MERKLE_LEAF_INDEX",r[r.GET_MORE_ELEMENTS=160]="GET_MORE_ELEMENTS"})(Me||(Me={}));var At=function(){function r(){}return r}(),tl=function(r){Rt(t,r);function t(e,i){var o=r.call(this)||this;return o.progressCallback=i,o.code=Me.YIELD,o.results=e,o}return t.prototype.execute=function(e){return this.results.push(u.Buffer.from(e.subarray(1))),this.progressCallback(),u.Buffer.from("")},t}(At);var rl=function(r){Rt(t,r);function t(e,i){var o=r.call(this)||this;return o.code=Me.GET_PREIMAGE,o.known_preimages=e,o.queue=i,o}return t.prototype.execute=function(e){var i=u.Buffer.from(e.subarray(1));if(i.length!=1+32)throw new Error("Invalid request, unexpected trailing data");if(i[0]!=0)throw new Error("Unsupported request, the first byte should be 0");for(var o=u.Buffer.alloc(32),n=0;n<32;n++)o[n]=i[1+n];var a=o.toString("hex"),l=this.known_preimages.get(a);if(l!=null){var c=V(l.length),s=255-c.length-1,f=Math.min(s,l.length);if(f<l.length)for(var n=f;n<l.length;n++)this.queue.push(u.Buffer.from([l[n]]));return u.Buffer.concat([c,u.Buffer.from([f]),u.Buffer.from(l.subarray(0,f))])}throw Error("Requested unknown preimage for: ".concat(a))},t}(At);var nl=function(r){Rt(t,r);function t(e,i){var o=r.call(this)||this;return o.code=Me.GET_MERKLE_LEAF_PROOF,o.known_trees=e,o.queue=i,o}return t.prototype.execute=function(e){var i,o=u.Buffer.from(e.subarray(1));if(o.length<32+1+1)throw new Error("Invalid request, expected at least 34 bytes");var n=new ye(o),a=n.readSlice(32),l=a.toString("hex"),c,s;try{c=n.readVarInt(),s=n.readVarInt()}catch{throw new Error("Invalid request, couldn't parse tree_size or leaf_index")}var f=this.known_trees.get(l);if(!f)throw Error("Requested Merkle leaf proof for unknown tree: ".concat(l));if(s>=c||f.size()!=c)throw Error("Invalid index or tree size.");if(this.queue.length!=0)throw Error("This command should not execute when the queue is not empty.");var p=f.getProof(s),m=Math.min(Math.floor((255-32-1-1)/32),p.length),v=p.length-m;return v>0&&(i=this.queue).push.apply(i,ln([],cn(p.slice(-v)),!1)),u.Buffer.concat(ln([f.getLeafHash(s),u.Buffer.from([p.length]),u.Buffer.from([m])],cn(p.slice(0,m)),!1))},t}(At);var il=function(r){Rt(t,r);function t(e){var i=r.call(this)||this;return i.code=Me.GET_MERKLE_LEAF_INDEX,i.known_trees=e,i}return t.prototype.execute=function(e){var i=u.Buffer.from(e.subarray(1));if(i.length!=32+32)throw new Error("Invalid request, unexpected trailing data");for(var o=u.Buffer.alloc(32),n=0;n<32;n++)o[n]=i.readUInt8(n);for(var a=o.toString("hex"),l=u.Buffer.alloc(32),n=0;n<32;n++)l[n]=i.readUInt8(32+n);var c=l.toString("hex"),s=this.known_trees.get(a);if(!s)throw Error("Requested Merkle leaf index for unknown root: ".concat(a));for(var f=0,p=0,n=0;n<s.size();n++)if(s.getLeafHash(n).toString("hex")==c){p=1,f=n;break}return u.Buffer.concat([u.Buffer.from([p]),V(f)])},t}(At);var ol=function(r){Rt(t,r);function t(e){var i=r.call(this)||this;return i.code=Me.GET_MORE_ELEMENTS,i.queue=e,i}return t.prototype.execute=function(e){if(e.length!=1)throw new Error("Invalid request, unexpected trailing data");if(this.queue.length===0)throw new Error("No elements to get");var i=this.queue[0].length;if(this.queue.some(function(l){return l.length!=i}))throw new Error("The queue contains elements with different byte length, which is not expected");var o=Math.floor(253/i),n=Math.min(o,this.queue.length),a=this.queue.splice(0,n);return u.Buffer.concat(ln([u.Buffer.from([n]),u.Buffer.from([i])],cn(a),!1))},t}(At);var fn=function(){function r(t){var e,i;this.roots=new Map,this.preimages=new Map,this.yielded=[],this.queue=[],this.commands=new Map;var o=[new tl(this.yielded,t),new rl(this.preimages,this.queue),new il(this.roots),new nl(this.roots,this.queue),new ol(this.queue)];try{for(var n=bs(o),a=n.next();!a.done;a=n.next()){var l=a.value;if(this.commands.has(l.code))throw new Error("Multiple commands with code ".concat(l.code));this.commands.set(l.code,l)}}catch(c){e={error:c}}finally{try{a&&!a.done&&(i=n.return)&&i.call(n)}finally{if(e)throw e.error}}}return r.prototype.getYielded=function(){return this.yielded},r.prototype.addKnownPreimage=function(t){this.preimages.set(_s.crypto.sha256(t).toString("hex"),t)},r.prototype.addKnownList=function(t){var e,i;try{for(var o=bs(t),n=o.next();!n.done;n=o.next()){var a=n.value,l=u.Buffer.concat([u.Buffer.from([0]),a]);this.addKnownPreimage(l)}}catch(s){e={error:s}}finally{try{n&&!n.done&&(i=o.return)&&i.call(o)}finally{if(e)throw e.error}}var c=new Ee(t.map(function(s){return we(s)}));this.roots.set(c.getRoot().toString("hex"),c)},r.prototype.addKnownMapping=function(t){this.addKnownList(t.keys),this.addKnownList(t.values)},r.prototype.execute=function(t){if(t.length==0)throw new Error("Unexpected empty command");var e=t[0],i=this.commands.get(e);if(!i)throw new Error("Unexpected command code ".concat(e));return i.execute(t)},r}();var Pt=function(r,t,e,i){function o(n){return n instanceof e?n:new e(function(a){a(n)})}return new(e||(e=Promise))(function(n,a){function l(f){try{s(i.next(f))}catch(p){a(p)}}function c(f){try{s(i.throw(f))}catch(p){a(p)}}function s(f){f.done?n(f.value):o(f.value).then(l,c)}s((i=i.apply(r,t||[])).next())})},Nt=function(r,t){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,o,n,a;return a={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(s){return function(f){return c([s,f])}}function c(s){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,o&&(n=s[0]&2?o.return:s[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,s[1])).done)return n;switch(o=0,n&&(s=[s[0]&2,n.value]),s[0]){case 0:case 1:n=s;break;case 4:return e.label++,{value:s[1],done:!1};case 5:e.label++,o=s[1],s=[0];continue;case 7:s=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(s[0]===6||s[0]===2)){e=0;continue}if(s[0]===3&&(!n||s[1]>n[0]&&s[1]<n[3])){e.label=s[1];break}if(s[0]===6&&e.label<n[1]){e.label=n[1],n=s;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(s);break}n[2]&&e.ops.pop(),e.trys.pop();continue}s=t.call(r,e)}catch(f){s=[6,f],o=0}finally{i=n=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},pn=function(r){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&r[t],i=0;if(e)return e.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&i>=r.length&&(r=void 0),{value:r&&r[i++],done:!r}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},sl=225,al=248,it;(function(r){r[r.GET_PUBKEY=0]="GET_PUBKEY",r[r.REGISTER_WALLET=2]="REGISTER_WALLET",r[r.GET_WALLET_ADDRESS=3]="GET_WALLET_ADDRESS",r[r.SIGN_PSBT=4]="SIGN_PSBT",r[r.GET_MASTER_FINGERPRINT=5]="GET_MASTER_FINGERPRINT"})(it||(it={}));var hn;(function(r){r[r.CONTINUE_INTERRUPTED=1]="CONTINUE_INTERRUPTED"})(hn||(hn={}));var Os=function(){function r(t){this.transport=t}return r.prototype.makeRequest=function(t,e,i){return Pt(this,void 0,void 0,function(){var o,n,a;return Nt(this,function(l){switch(l.label){case 0:return[4,this.transport.send(sl,t,0,0,e,[36864,57344])];case 1:o=l.sent(),l.label=2;case 2:if(o.readUInt16BE(o.length-2)!==57344)return[3,4];if(!i)throw new Error("Unexpected SW_INTERRUPTED_EXECUTION");return n=o.slice(0,-2),a=i.execute(n),[4,this.transport.send(al,hn.CONTINUE_INTERRUPTED,0,0,a,[36864,57344])];case 3:return o=l.sent(),[3,2];case 4:return[2,o.slice(0,-2)]}})})},r.prototype.getExtendedPubkey=function(t,e){return Pt(this,void 0,void 0,function(){var i;return Nt(this,function(o){switch(o.label){case 0:if(e.length>6)throw new Error("Path too long. At most 6 levels allowed.");return[4,this.makeRequest(it.GET_PUBKEY,u.Buffer.concat([u.Buffer.from(t?[1]:[0]),Ir(e)]))];case 1:return i=o.sent(),[2,i.toString("ascii")]}})})},r.prototype.getWalletAddress=function(t,e,i,o,n){return Pt(this,void 0,void 0,function(){var a,l,c;return Nt(this,function(s){switch(s.label){case 0:if(i!==0&&i!==1)throw new Error("Change can only be 0 or 1");if(o<0||!Number.isInteger(o))throw new Error("Invalid address index");if(e!=null&&e.length!=32)throw new Error("Invalid HMAC length");return a=new fn(function(){}),a.addKnownList(t.keys.map(function(f){return u.Buffer.from(f,"ascii")})),a.addKnownPreimage(t.serialize()),l=u.Buffer.alloc(4),l.writeUInt32BE(o,0),[4,this.makeRequest(it.GET_WALLET_ADDRESS,u.Buffer.concat([u.Buffer.from(n?[1]:[0]),t.getWalletId(),e||u.Buffer.alloc(32,0),u.Buffer.from([i]),l]),a)];case 1:return c=s.sent(),[2,c.toString("ascii")]}})})},r.prototype.signPsbt=function(t,e,i,o){return Pt(this,void 0,void 0,function(){var n,a,l,c,p,s,f,p,m,v,g,T,y,S,E,R,b,P,I,k,L;return Nt(this,function(W){switch(W.label){case 0:if(n=new Ss(t),i!=null&&i.length!=32)throw new Error("Invalid HMAC length");a=new fn(o),a.addKnownList(e.keys.map(function(_){return u.Buffer.from(_,"ascii")})),a.addKnownPreimage(e.serialize()),a.addKnownMapping(n.globalMerkleMap);try{for(l=pn(n.inputMerkleMaps),c=l.next();!c.done;c=l.next())p=c.value,a.addKnownMapping(p)}catch(_){R={error:_}}finally{try{c&&!c.done&&(b=l.return)&&b.call(l)}finally{if(R)throw R.error}}try{for(s=pn(n.outputMerkleMaps),f=s.next();!f.done;f=s.next())p=f.value,a.addKnownMapping(p)}catch(_){P={error:_}}finally{try{f&&!f.done&&(I=s.return)&&I.call(s)}finally{if(P)throw P.error}}return a.addKnownList(n.inputMapCommitments),m=new Ee(n.inputMapCommitments.map(function(_){return we(_)})).getRoot(),a.addKnownList(n.outputMapCommitments),v=new Ee(n.outputMapCommitments.map(function(_){return we(_)})).getRoot(),[4,this.makeRequest(it.SIGN_PSBT,u.Buffer.concat([n.getGlobalKeysValuesRoot(),V(n.getGlobalInputCount()),m,V(n.getGlobalOutputCount()),v,e.getWalletId(),i||u.Buffer.alloc(32,0)]),a)];case 1:W.sent(),g=a.getYielded(),T=new Map;try{for(y=pn(g),S=y.next();!S.done;S=y.next())E=S.value,T.set(E[0],E.slice(1))}catch(_){k={error:_}}finally{try{S&&!S.done&&(L=y.return)&&L.call(y)}finally{if(k)throw k.error}}return[2,T]}})})},r.prototype.getMasterFingerprint=function(){return Pt(this,void 0,void 0,function(){return Nt(this,function(t){return[2,this.makeRequest(it.GET_MASTER_FINGERPRINT,u.Buffer.from([]))]})})},r}();h();d();h();d();function Rs(r){var t="TX";return t+=" version "+r.version.toString("hex"),r.locktime&&(t+=" locktime "+r.locktime.toString("hex")),r.witness&&(t+=" witness "+r.witness.toString("hex")),r.timestamp&&(t+=" timestamp "+r.timestamp.toString("hex")),r.nVersionGroupId&&(t+=" nVersionGroupId "+r.nVersionGroupId.toString("hex")),r.nExpiryHeight&&(t+=" nExpiryHeight "+r.nExpiryHeight.toString("hex")),r.extraData&&(t+=" extraData "+r.extraData.toString("hex")),r.inputs.forEach(function(e,i){var o=e.prevout,n=e.script,a=e.sequence;t+=`
input `.concat(i,":"),t+=" prevout ".concat(o.toString("hex")),t+=" script ".concat(n.toString("hex")),t+=" sequence ".concat(a.toString("hex"))}),(r.outputs||[]).forEach(function(e,i){var o=e.amount,n=e.script;t+=`
output `.concat(i,":"),t+=" amount ".concat(o.toString("hex")),t+=" script ".concat(n.toString("hex"))}),t}function As(r,t,e,i,o){t===void 0&&(t=!1),e===void 0&&(e=!1),i===void 0&&(i=!1),o===void 0&&(o=[]);var n=[],a=[],l=!1,c=0,s=u.Buffer.alloc(0),f=u.Buffer.alloc(0),p=u.Buffer.alloc(0),m=u.Buffer.alloc(0),v,g,T=o.includes("decred"),y=o.includes("zencash"),S=o.includes("zcash"),E=u.Buffer.from(r,"hex"),R=E.slice(c,c+4),b=R.equals(u.Buffer.from([3,0,0,128]))||R.equals(u.Buffer.from([4,0,0,128]))||R.equals(u.Buffer.from([5,0,0,128])),P=S&&R.equals(u.Buffer.from([5,0,0,128]));c+=4,!e&&t&&E[c]===0&&E[c+1]!==0&&!y&&(c+=2,l=!0),e&&(s=E.slice(c,4+c),c+=4),b&&(p=E.slice(c,4+c),c+=4),P&&(g=E.slice(c+4,c+8),f=E.slice(c+8,c+12),c+=12);var I=Le(E,c),k=I[0];c+=I[1];for(var L=0;L<k;L++){var W=E.slice(c,c+36);c+=36;var _=u.Buffer.alloc(0),U=u.Buffer.alloc(0);T?(U=E.slice(c,c+1),c+=1):(I=Le(E,c),c+=I[1],_=E.slice(c,c+I[0]),c+=I[0]);var N=E.slice(c,c+4);c+=4,n.push({prevout:W,script:_,sequence:N,tree:U})}I=Le(E,c);var j=I[0];c+=I[1];for(var L=0;L<j;L++){var J=E.slice(c,c+8);c+=8,T&&(c+=2),I=Le(E,c),c+=I[1];var _=E.slice(c,c+I[0]);c+=I[0],a.push({amount:J,script:_})}if(l?(v=E.slice(c,-4),g=E.slice(E.length-4)):P||(g=E.slice(c,c+4)),c+=4,(b||T)&&!P&&(f=E.slice(c,c+4),c+=4),i&&(m=E.slice(c)),T){if(I=Le(E,c),c+=I[1],I[0]!==k)throw new Error("splitTransaction: incoherent number of witnesses");for(var L=0;L<k;L++){c+=8,c+=4,c+=4,I=Le(E,c),c+=I[1];var _=E.slice(c,c+I[0]);c+=I[0],n[L].script=_}}var z={version:R,inputs:n,outputs:a,locktime:g,witness:v,timestamp:s,nVersionGroupId:p,nExpiryHeight:f,extraData:m};return Ct("btc","splitTransaction ".concat(r,`:
`).concat(Rs(z))),z}h();d();var ot=function(){return ot=Object.assign||function(r){for(var t,e=1,i=arguments.length;e<i;e++){t=arguments[e];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(r[o]=t[o])}return r},ot.apply(this,arguments)},ul=function(r,t,e,i){function o(n){return n instanceof e?n:new e(function(a){a(n)})}return new(e||(e=Promise))(function(n,a){function l(f){try{s(i.next(f))}catch(p){a(p)}}function c(f){try{s(i.throw(f))}catch(p){a(p)}}function s(f){f.done?n(f.value):o(f.value).then(l,c)}s((i=i.apply(r,t||[])).next())})},cl=function(r,t){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,o,n,a;return a={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(s){return function(f){return c([s,f])}}function c(s){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,o&&(n=s[0]&2?o.return:s[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,s[1])).done)return n;switch(o=0,n&&(s=[s[0]&2,n.value]),s[0]){case 0:case 1:n=s;break;case 4:return e.label++,{value:s[1],done:!1};case 5:e.label++,o=s[1],s=[0];continue;case 7:s=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(s[0]===6||s[0]===2)){e=0;continue}if(s[0]===3&&(!n||s[1]>n[0]&&s[1]<n[3])){e.label=s[1];break}if(s[0]===6&&e.label<n[1]){e.label=n[1],n=s;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(s);break}n[2]&&e.ops.pop(),e.trys.pop();continue}s=t.call(r,e)}catch(f){s=[6,f],o=0}finally{i=n=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},ll=function(r){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&r[t],i=0;if(e)return e.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&i>=r.length&&(r=void 0),{value:r&&r[i++],done:!r}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},fl={lockTime:Kt,sigHashType:ht,segwit:!1,transactionVersion:jn};function Ps(r,t){return ul(this,void 0,void 0,function(){var e,i,o,n,a,l,c,s,f,p,m,v,g,T,y,S,E,R,b,P,I,j,k,U,L,W,_,N,U,N,j,J,z,xe,M,K,de;return cl(this,function(B){switch(B.label){case 0:e=ot(ot({},fl),t),i=e.inputs,o=e.associatedKeysets,n=e.outputScriptHex,a=e.lockTime,l=e.sigHashType,c=e.segwit,s=e.transactionVersion,f=u.Buffer.alloc(0),p=u.Buffer.alloc(0),m=u.Buffer.alloc(4),m.writeUInt32LE(s,0),v=[],g=[],T=[],y=!0,S=!1,E={inputs:[],version:m},R=c?et:Qe,b=u.Buffer.from(n,"hex"),B.label=1;case 1:B.trys.push([1,7,8,9]),P=ll(i),I=P.next(),B.label=2;case 2:return I.done?[3,6]:(j=I.value,S?[3,4]:[4,R(r,j[1],j[0])]);case 3:k=B.sent(),U=u.Buffer.alloc(4),U.writeUInt32LE(j.length>=4&&typeof j[3]=="number"?j[3]:We,0),v.push({trustedInput:!1,value:c?u.Buffer.from(k,"hex"):u.Buffer.from(k,"hex").slice(4,4+36),sequence:U}),B.label=4;case 4:L=j[0].outputs,W=j[1],L&&W<=L.length-1&&g.push(L[W]),B.label=5;case 5:return I=P.next(),[3,2];case 6:return[3,9];case 7:return _=B.sent(),K={error:_},[3,9];case 8:try{I&&!I.done&&(de=P.return)&&de.call(P)}finally{if(K)throw K.error}return[7];case 9:for(N=0;N<i.length;N++)U=u.Buffer.alloc(4),U.writeUInt32LE(i[N].length>=4&&typeof i[N][3]=="number"?i[N][3]:We,0),E.inputs.push({script:f,prevout:p,sequence:U});return c?[4,Je(r,!0,E,v,!0)]:[3,12];case 10:return B.sent(),[4,tt(r,b)];case 11:B.sent(),B.label=12;case 12:N=0,B.label=13;case 13:return N<i.length?(j=i[N],J=i[N].length>=3&&typeof j[2]=="string"?u.Buffer.from(j[2],"hex"):g[N].script,z=Object.assign({},E),xe=c?[v[N]]:v,c?z.inputs=[ot(ot({},z.inputs[N]),{script:J})]:z.inputs[N].script=J,[4,Je(r,!c&&y,z,xe,c)]):[3,19];case 14:return B.sent(),c?[3,16]:[4,tt(r,b)];case 15:B.sent(),B.label=16;case 16:return[4,yt(r,o[N],a,l)];case 17:M=B.sent(),T.push(c?M.toString("hex"):M.slice(0,M.length-1).toString("hex")),E.inputs[N].script=f,y&&(y=!1),B.label=18;case 18:return N++,[3,13];case 19:return[2,T]}})})}h();d();var Ls=F(Ln());var pl=function(r,t,e,i){function o(n){return n instanceof e?n:new e(function(a){a(n)})}return new(e||(e=Promise))(function(n,a){function l(f){try{s(i.next(f))}catch(p){a(p)}}function c(f){try{s(i.throw(f))}catch(p){a(p)}}function s(f){f.done?n(f.value):o(f.value).then(l,c)}s((i=i.apply(r,t||[])).next())})},Ns=function(r,t){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,o,n,a;return a={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(s){return function(f){return c([s,f])}}function c(s){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,o&&(n=s[0]&2?o.return:s[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,s[1])).done)return n;switch(o=0,n&&(s=[s[0]&2,n.value]),s[0]){case 0:case 1:n=s;break;case 4:return e.label++,{value:s[1],done:!1};case 5:e.label++,o=s[1],s=[0];continue;case 7:s=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(s[0]===6||s[0]===2)){e=0;continue}if(s[0]===3&&(!n||s[1]>n[0]&&s[1]<n[3])){e.label=s[1];break}if(s[0]===6&&e.label<n[1]){e.label=n[1],n=s;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(s);break}n[2]&&e.ops.pop(),e.trys.pop();continue}s=t.call(r,e)}catch(f){s=[6,f],o=0}finally{i=n=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}};function Ds(r,t){var e=t.path,i=t.messageHex;return pl(this,void 0,void 0,function(){var o,n,a,l,c,s,f,p;return Ns(this,function(m){switch(m.label){case 0:o=Ls.default.fromString(e).toPathArray(),n=u.Buffer.from(i,"hex"),a=0,l=function(){var v,g,T;return Ns(this,function(y){switch(y.label){case 0:return v=a===0?ce-1-o.length*4-4:ce,g=a+v>n.length?n.length-a:v,T=u.Buffer.alloc(a===0?1+o.length*4+2+g:g),a===0?(T[0]=o.length,o.forEach(function(S,E){T.writeUInt32BE(S,1+4*E)}),T.writeUInt16BE(n.length,1+4*o.length),n.copy(T,1+4*o.length+2,a,a+g)):n.copy(T,0,a,a+g),[4,r.send(224,78,0,a===0?1:128,T)];case 1:return y.sent(),a+=g,[2]}})},m.label=1;case 1:return a===n.length?[3,3]:[5,l()];case 2:return m.sent(),[3,1];case 3:return[4,r.send(224,78,128,0,u.Buffer.from([0]))];case 4:return c=m.sent(),s=c[0]-48,f=c.slice(4,4+c[3]),f[0]===0&&(f=f.slice(1)),f=f.toString("hex"),a=4+c[3]+2,p=c.slice(a,a+c[a-1]),p[0]===0&&(p=p.slice(1)),p=p.toString("hex"),[2,{v:s,r:f,s:p}]}})})}var hl=function(r,t,e,i){function o(n){return n instanceof e?n:new e(function(a){a(n)})}return new(e||(e=Promise))(function(n,a){function l(f){try{s(i.next(f))}catch(p){a(p)}}function c(f){try{s(i.throw(f))}catch(p){a(p)}}function s(f){f.done?n(f.value):o(f.value).then(l,c)}s((i=i.apply(r,t||[])).next())})},dl=function(r,t){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,o,n,a;return a={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(s){return function(f){return c([s,f])}}function c(s){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,o&&(n=s[0]&2?o.return:s[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,s[1])).done)return n;switch(o=0,n&&(s=[s[0]&2,n.value]),s[0]){case 0:case 1:n=s;break;case 4:return e.label++,{value:s[1],done:!1};case 5:e.label++,o=s[1],s=[0];continue;case 7:s=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(s[0]===6||s[0]===2)){e=0;continue}if(s[0]===3&&(!n||s[1]>n[0]&&s[1]<n[3])){e.label=s[1];break}if(s[0]===6&&e.label<n[1]){e.label=n[1],n=s;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(s);break}n[2]&&e.ops.pop(),e.trys.pop();continue}s=t.call(r,e)}catch(f){s=[6,f],o=0}finally{i=n=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},vl=function(){function r(t){var e=t.transport,i=t.scrambleKey,o=i===void 0?"BTC":i,n=t.currency,a=n===void 0?"bitcoin":n;this._transport=e,this._transport.decorateAppAPIMethods(this,["getWalletXpub","getWalletPublicKey","signP2SHTransaction","signMessage","createPaymentTransaction","getTrustedInput","getTrustedInputBIP143"],o),a==="bitcoin"||a==="bitcoin_testnet"?this._impl=new $r(new Os(this._transport)):this._impl=new sn(this._transport)}return r.prototype.getWalletXpub=function(t){return this.changeImplIfNecessary().then(function(e){return e.getWalletXpub(t)})},r.prototype.getWalletPublicKey=function(t,e){var i;return arguments.length>2||typeof e=="boolean"?(console.warn("btc.getWalletPublicKey deprecated signature used. Please switch to getWalletPublicKey(path, { format, verify })"),i={verify:!!e,format:arguments[2]?"p2sh":"legacy"}):i=e||{},this.changeImplIfNecessary().then(function(o){return o.getWalletPublicKey(t,i)})},r.prototype.signMessage=function(t,e){return Ds(this._transport,{path:t,messageHex:e})},r.prototype.createPaymentTransaction=function(t){if(arguments.length>1)throw new Error("@ledgerhq/hw-app-btc: createPaymentTransaction multi argument signature is deprecated. please switch to named parameters.");return this.changeImplIfNecessary().then(function(e){return e.createPaymentTransaction(t)})},r.prototype.signP2SHTransaction=function(t){return Ps(this._transport,t)},r.prototype.splitTransaction=function(t,e,i,o,n){return e===void 0&&(e=!1),i===void 0&&(i=!1),o===void 0&&(o=!1),n===void 0&&(n=[]),As(t,e,i,o,n)},r.prototype.serializeTransactionOutputs=function(t){return Mr(t)},r.prototype.getTrustedInput=function(t,e,i){return i===void 0&&(i=[]),Qe(this._transport,t,e,i)},r.prototype.getTrustedInputBIP143=function(t,e,i){return i===void 0&&(i=[]),et(this._transport,t,e,i)},r.prototype.changeImplIfNecessary=function(){return hl(this,void 0,void 0,function(){var t,e;return dl(this,function(i){switch(i.label){case 0:return[4,Zt(this._transport)];case 1:return t=i.sent(),t.name==="Exchange"&&this._impl instanceof $r?[4,bi(this._transport)]:[3,3];case 2:e=i.sent(),e&&(this._impl=new sn(this._transport)),i.label=3;case 3:return[2,this._impl]}})})},r}(),Cs=vl;Xs();Hs();var vn=F($s());Fs();Gs();var ks=2,ml=12e4,dn=(r=0)=>({[Ke.LEGACY]:{path:`m/44'/0'/0'/0/${r}`,segwit:!1,format:"legacy"},[Ke.SEGWIT_NESTED_49]:{path:`m/49'/0'/0'/0/${r}`,segwit:!0,format:"p2sh"},[Ke.SEGWIT_NATIVE]:{path:`m/84'/0'/0'/0/${r}`,segwit:!0,format:"bech32"},[Ke.SEGWIT_TAPROOT]:{path:`m/86'/0'/0'/0/${r}`,segwit:!0,format:"bech32m"}}),mn=class extends Dn{async makeApp(){await this.initLedgerTransPorter(),this.app||(this.app=new Cs({transport:this.ledgerTransPorter}))}throwTimeoutError(){return new Promise((t,e)=>{setTimeout(()=>{e(new Error("Timeout"))},ml)})}async getAddressPromise(t){await this.makeApp();let e=[];for(let i=t*ks;i<(t+1)*ks;i++){let o=dn(i),n=Object.keys(o),a={};for(let l=0;l<n.length;l++){let c=n[l],s=o[c],{path:f,format:p}=s,{bitcoinAddress:m,publicKey:v}=await this.app.getWalletPublicKey(f,{format:p});c===Ke.SEGWIT_NESTED_49&&(a.address=m,a.path=f),a[c]={address:m,path:f,publicKey:v}}e.push(a)}return e}async getAddress(t=0){return await Promise.race([this.getAddressPromise(t),this.throwTimeoutError()])}async getTokens(t,e){let i=Object.keys(dn()),o=[];t.forEach(n=>{(0,Us.each)(n,a=>{a.address&&o.push(a.address)})});try{let n=await On(An.getChainToken,{addressList:o,coinId:e});if((n==null?void 0:n.code)===0){let{data:a}=n,l={};a.forEach(({address:c,coinAmount:s})=>{l[c]=s}),t.forEach(c=>{i.forEach(s=>{let f=c[s],{address:p}=f,m=l[p];f.coinAmount=m,Rn(m,0)&&(c.hasAsset=!0)})})}}catch(n){console.log(n)}return t}async signTransaction(t={},e){try{gr.openModal(Nn.confirm);let{address:i}=e,o=Cn(i,(t==null?void 0:t.accountsMap)||(t==null?void 0:t.addressType)),n=o==null?void 0:o.path;await this.checkLedgerConnection();let{omni:a}=e,{inputs:l}=e,c=[];l.forEach(b=>{let P=this.app.splitTransaction(b.rawTransaction,!0);c.push([P,b.vOut,void 0,4294967295])});let{getHardWareRawTransaction:s}=await Pn(),f=await s(a?vn.Currency.OMNI_USDT:vn.Currency.BTC,{data:e}),p=this.app.splitTransaction(f),m=this.app.serializeTransactionOutputs(p).toString("hex"),v=n.slice(n.lastIndexOf("/")+1),g=dn(v),T=Object.values(g).find(b=>b.path===n),{segwit:y,format:S}=T||{},E=[];["bech32m","bech32"].includes(S)&&E.push(S);let R=await this.app.createPaymentTransaction({inputs:c,associatedKeysets:new Array(c.length).fill(n),outputScriptHex:m,additionals:E,segwit:y});return gr.closeModal(),R}catch(i){return this.handleErrors(i,Sn)}}},Rv=new mn;export{Rv as default};

window.inOKXExtension = true;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=btcAdapter-LYA4HI2L.js.map
