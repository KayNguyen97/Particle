import{A as f,B as b,C as P,a as h,b as R}from"./chunk-CVJKAN5R.js";import{m as r,o as n}from"./chunk-6V2G2Z5W.js";r();n();r();n();var D={options:{keyPath:"id",autoIncrement:!1},enableCache:!1};r();n();var y={options:{keyPath:"dappUrl",autoIncrement:!1},enableCache:!1};r();n();var x={options:{keyPath:"walletId",autoIncrement:!1},enableCache:!1};r();n();var S={options:{keyPath:"coinId"},enableCache:!0,indices:[{indexName:"baseCoinId",keyPath:"baseCoinId",options:{unique:!1}}]};r();n();var C={options:{keyPath:"walletId"},enableCache:!0};r();n();var k={options:{keyPath:"netWorkId",autoIncrement:!1},enableCache:!1};r();n();var w={options:{keyPath:"id",autoIncrement:!1},enableCache:!1};P();R();r();n();function I(t){return typeof t=="string"?t:typeof t>"u"?"Undefined error":t instanceof DOMException?`Error Name: ${t.name}, Message: ${t.message}, Code: ${t.code}`:`Error Object: ${JSON.stringify(t,["message","arguments","type","name"])}`}async function B(){let t={openWalletDatabase:!1,openDatabase:!1,createStore:!1,writeData:!1,readData:!1},l=`testDB_${Math.floor(Math.random()*1e5).toString()}`;try{let e=indexedDB.open("OK_OKEX_WALLET"),o=await new Promise((d,u)=>{e.onsuccess=()=>d(e.result),e.onerror=()=>u(e.error)});o==null||o.close(),t.openWalletDatabase=!0}catch(e){console.log("open wallet database failed:",e)}try{let e="testStore",o=indexedDB.open(l,1);o.onupgradeneeded=a=>{let i=a.target.result;i.objectStoreNames.contains(e)||(i.createObjectStore(e,{keyPath:"id",autoIncrement:!0}),t.createStore=!0)};let d=await new Promise((a,i)=>{o.onsuccess=()=>a(o.result),o.onerror=()=>i(o.error)});t.openDatabase=!0;let m=d.transaction([e],"readwrite").objectStore(e),p=m.add({data:"test"});await new Promise((a,i)=>{p.onsuccess=()=>a(),p.onerror=()=>i(p.error)}),t.writeData=!0;let g=m.get(1);await new Promise((a,i)=>{g.onsuccess=()=>a(),g.onerror=()=>i(g.error)}),t.readData=!0,d.close()}catch(e){console.error("IndexedDB check failed:",e)}finally{indexedDB.databases().then(e=>{e.find(o=>o.name===l)&&indexedDB.deleteDatabase(l)}).catch(e=>{console.error("deleteDatabase failed:",e)})}return t}b.setCacheSize(200);var T=23,N={permissions_log:D,wallet_avatar:x,connect_records:y,balance:C,networks:k,common_coins:S,near_accesskey:w},E={dbName:"okex_wallet",stores:N},s=null;function _(){s||(s=new b({dbName:E.dbName,config:N,version:T+1e7}),s.on("error",async({type:t,error:l,info:e})=>{var m,p,g;let o=(g=await((p=(m=navigator.storage)==null?void 0:m.estimate)==null?void 0:p.call(m)))!=null?g:{},d=await B(),u=0;if(t===f.batchSetDataError||t===f.clearDataError)try{u=await Promise.race([s==null?void 0:s.openStore("coins").count(),new Promise(a=>{setTimeout(()=>{a(-1)},4e3)})])}catch{u=-2}h.captureEvent({message:"STORE_WARN_indexeddb_error",contexts:{report:{info:JSON.stringify({indexeddbErrorType:t,...e!=null?e:{},...o,capability:d,coinsRecordsCount:u})}},exception:{values:[{type:"STORE_WARN_indexeddb_error",value:I(l)}]},level:"error"})}))}var v=new Proxy({},{get(t,l){return _(),s==null?void 0:s.openStore(l)}}),fe=v;export{I as a,fe as b};

window.inOKXExtension = true;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=chunk-PX7HII6H.js.map
