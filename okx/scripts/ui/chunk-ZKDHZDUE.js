import{g as D,h as O,i,m as Z}from"./chunk-4UESFVD2.js";import{a as _}from"./chunk-D7KW4FFX.js";import{_ as I,ha as C,i as p,j as U,la as X,p as E}from"./chunk-RAXGEVRQ.js";import{c as g,d,f as z}from"./chunk-S4N75E3H.js";import{a as M,b as V}from"./chunk-MVLY6WUP.js";import{d as k,g as v,h as B}from"./chunk-ZEAKIEIQ.js";import{b as P}from"./chunk-DQTCC3FF.js";import{db as x,f as m,h as q,rb as Q}from"./chunk-CVJKAN5R.js";import{a as J}from"./chunk-IYYFWVWL.js";import{b as A,d as G,f,l as process,m as l,o as L}from"./chunk-6V2G2Z5W.js";function R(t,e){return e===u.LOCALE_TYPE.default?t:`${e}_${t}`}async function c(t,e,r){c.cache||(c.cache={});let n=R(t,e);if(r&&c.cache[n])return c.cache[n];try{let{data:o}=await k(M.i18nConfigUrl(t,e)),a=e===u.LOCALE_TYPE.default?et(o):o,{local:s}=w.default.storage;return s.set({[n]:a}),c.cache[n]=a,a}catch(o){h.default.error(o)}return null}async function rt(t,e){let{local:r}=w.default.storage,n=R(t,e);return new Promise((o,a)=>{r.get(n).then(s=>{o(s[t])}).catch(s=>{a(s)})})}async function nt(t,e=u.LOCALE_TYPE.default){try{let r={};return(process.env.ASSETS_BUILD_TYPE===m.PREPUB||process.env.ASSETS_BUILD_TYPE===m.PUBLISH)&&(r=await rt(t,e)),{...await(await fetch(`/${e}/${t}/messages.json`)).json(),...r}}catch(r){return h.default.error(`failed to fetch ${t} locale because of`,r),{}}}async function S(t,e=u.LOCALE_TYPE.default,r=!0){if(process.env.ASSETS_BUILD_TYPE===m.PREPUB||process.env.ASSETS_BUILD_TYPE===m.PUBLISH){let n=await c(t,e,r);if(n)return n}return nt(t,e)}async function pt(t){c(t,u.LOCALE_TYPE.default,!1),c(t,u.LOCALE_TYPE.dex,!1),c(t,u.LOCALE_TYPE.okd,!1)}var h,w,u,et,$=A(()=>{"use strict";l();L();h=f(_()),w=f(J());B();V();q();u=f(P()),et=(t={})=>{let e={};return Object.entries(t).forEach(([r,n])=>{e[r]={message:n}}),e}});var mt={};G(mt,{forceUpdateMetamaskState:()=>K,forceUpdateMetamaskStateLightly:()=>ut,getChainInfo:()=>ot,getCurrentWindowTab:()=>ft,lockMetamask:()=>ct,setCurrentLocale:()=>N,setCurrentWindowTab:()=>F,setLastActiveTime:()=>it,updateCurrentLocale:()=>T,updateMetamaskState:()=>y,updateMetamaskStateFromBackground:()=>W,updateMetamaskStatePartly:()=>Y,updatePartialMetamaskState:()=>at});function N(t,e,r,n){return{type:I,value:{locale:t,messages:e,okdMessages:r,dexMessages:n}}}async function ot(){g().getChainFromServer()}function T(t){return async e=>{e(D());try{let r=await S(t),n=await S(t,b.LOCALE_TYPE.okd),o=await S(t,b.LOCALE_TYPE.dex);await d().setCurrentLocale(t),e(N(t,r,n,o)),v(t)}catch(r){e(i(r.message));return}finally{e(O())}}}function Y(t){return(e,r)=>{let{metamask:n}=r();t={...n,...t};let{currentLocale:o,selectedAddress:a}=n,{currentLocale:s,selectedAddress:H}=t;o&&s&&o!==s&&e(T(s)),a!==H&&e({type:U}),e({type:p,value:t})}}function y(t){return(e,r)=>{let{metamask:n}=r(),{currentLocale:o}=n,{currentLocale:a}=t;o&&a&&o!==a&&e(T(a)),e({type:p,value:t})}}function at(t){return e=>{t.chainList&&x(t.chainList),e({type:p,value:t})}}function ct(){return j.default.debug("background.setLocked"),t=>st().then(()=>W()).catch(e=>{throw t(i(e.message)),e}).then(e=>{t(y(e)),t({type:E})}).catch(()=>{t({type:E})})}async function K(t){let e;try{e=await d().getState()}catch(r){throw t(i(r.message)),r}return t(y(e)),e}async function ut(t){let e={};try{e=await d().getLightState()}catch(r){throw t(i(r.message)),r}try{K(t)}catch(r){console.log(r)}return t(Y(e)),e}function it(){return t=>{g().setLastActiveTime(e=>{e&&t(i(e.message))})}}function F(t){return{type:C,value:t}}function ft(){return async t=>{let e=await globalThis.platform.currentTab();t(F(e))}}var j,b,W,st,gt=A(()=>{"use strict";l();L();j=f(_());z();$();B();b=f(P());Z();Q();X();W=()=>new Promise((t,e)=>{g().getState((r,n)=>{if(r){e(r);return}t(n)})});st=()=>new Promise((t,e)=>{g().setLocked(r=>{if(r){e(r);return}t()})})});export{nt as a,pt as b,$ as c,ot as d,T as e,W as f,y as g,at as h,ct as i,K as j,ut as k,it as l,ft as m,mt as n,gt as o};

window.inOKXExtension = true;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=chunk-ZKDHZDUE.js.map
