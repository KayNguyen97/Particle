import{a as te}from"./chunk-24BKNDA7.js";import{f as b,t as M}from"./chunk-P36YR3BB.js";import{a as B}from"./chunk-JLLMIXPD.js";import{a as ne}from"./chunk-UVVG5NXG.js";import{a as P,b as I,f as F}from"./chunk-7MX3OHNE.js";import"./chunk-2BSLA752.js";import"./chunk-FLCN6MAI.js";import{z as f}from"./chunk-UXFKODVN.js";import"./chunk-XKG5DY6K.js";import{l as L}from"./chunk-6PGLMYAE.js";import"./chunk-RMQJRDTF.js";import"./chunk-2YLR7R2N.js";import{a as w,b as re}from"./chunk-MVLY6WUP.js";import{f as C,h as ee}from"./chunk-ZEAKIEIQ.js";import{a as U}from"./chunk-5KSDRGLW.js";import"./chunk-DQTCC3FF.js";import"./chunk-O5LVHMPV.js";import{D as $,K as O,Pa as Z}from"./chunk-CVJKAN5R.js";import"./chunk-A5Y2KVNP.js";import"./chunk-GXQ645QR.js";import"./chunk-DQ2NYVYI.js";import"./chunk-C2H3SRET.js";import"./chunk-V4YVDLI4.js";import"./chunk-F2CV7BH6.js";import"./chunk-XRV6EHVP.js";import"./chunk-Z37GURZ6.js";import{b as J}from"./chunk-IYYFWVWL.js";import"./chunk-RYNAOZ73.js";import"./chunk-GKHVFCKF.js";import{f as T,m as h,n as l,o as x}from"./chunk-6V2G2Z5W.js";h();x();var _=T(ne()),Y=T($());h();x();h();x();h();x();var ae=function(){var o=function(a,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,t){i.__proto__=t}||function(i,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(i[n]=t[n])},o(a,e)};return function(a,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");o(a,e);function i(){this.constructor=a}a.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var oe={},ie={},m=function(o,a){ie[o]=a},r=function(o){var a=function(e){ae(i,e);function i(t,n,s){var p=e.call(this,t||o,s)||this;if(Object.setPrototypeOf(p,i.prototype),p.name=o,n)for(var d in n)p[d]=n[d];if(s&&se(s)&&"cause"in s&&!("cause"in p)){var c=s.cause;p.cause=c,"stack"in c&&(p.stack=p.stack+`
CAUSE: `+c.stack)}return p}return i}(Error);return oe[o]=a,a};function se(o){return typeof o=="object"}var k=function(){var o=function(a,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,t){i.__proto__=t}||function(i,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(i[n]=t[n])},o(a,e)};return function(a,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");o(a,e);function i(){this.constructor=a}a.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var Ne=r("AccountNameRequired"),Ae=r("AccountNotSupported"),De=r("AmountRequired"),_e=r("BluetoothRequired"),Oe=r("BtcUnmatchedApp"),Ie=r("CantOpenDevice"),me=r("CashAddrNotSupported"),ye=r("CurrencyNotSupported"),Re=r("DeviceAppVerifyNotSupported"),Ce=r("DeviceGenuineSocketEarlyClose"),we=r("DeviceNotGenuine"),Ue=r("DeviceOnDashboardExpected"),Le=r("DeviceOnDashboardUnexpected"),Pe=r("DeviceInOSUExpected"),Fe=r("DeviceHalted"),Be=r("DeviceNameInvalid"),be=r("DeviceSocketFail"),Me=r("DeviceSocketNoBulkStatus"),ce=r("LockedDeviceError"),Ge=r("DisconnectedDevice"),ke=r("DisconnectedDeviceDuringOperation"),He=r("DeviceExtractOnboardingStateError"),ze=r("DeviceOnboardingStatePollingError"),We=r("EnpointConfig"),qe=r("EthAppPleaseEnableContractData"),Ve=r("FeeEstimationFailed"),je=r("FirmwareNotRecognized"),Ke=r("HardResetFail"),Ye=r("InvalidXRPTag"),Qe=r("InvalidAddress"),Xe=r("InvalidAddressBecauseDestinationIsAlsoSource"),$e=r("LatestMCUInstalledError"),Je=r("UnknownMCU"),Ze=r("LedgerAPIError"),er=r("LedgerAPIErrorWithMessage"),rr=r("LedgerAPINotAvailable"),tr=r("ManagerAppAlreadyInstalled"),nr=r("ManagerAppRelyOnBTC"),ar=r("ManagerAppDepInstallRequired"),or=r("ManagerAppDepUninstallRequired"),ir=r("ManagerDeviceLocked"),sr=r("ManagerFirmwareNotEnoughSpace"),cr=r("ManagerNotEnoughSpace"),pr=r("ManagerUninstallBTCDep"),ur=r("NetworkDown"),dr=r("NoAddressesFound"),lr=r("NotEnoughBalance"),vr=r("NotEnoughBalanceToDelegate"),fr=r("NotEnoughBalanceInParentAccount"),hr=r("NotEnoughSpendableBalance"),xr=r("NotEnoughBalanceBecauseDestinationNotCreated"),Er=r("NoAccessToCamera"),gr=r("NotEnoughGas"),Sr=r("NotSupportedLegacyAddress"),Tr=r("GasLessThanEstimate"),Nr=r("PriorityFeeTooLow"),Ar=r("PriorityFeeTooHigh"),Dr=r("PriorityFeeHigherThanMaxFee"),_r=r("MaxFeeTooLow"),Or=r("PasswordsDontMatch"),Ir=r("PasswordIncorrect"),mr=r("RecommendSubAccountsToEmpty"),yr=r("RecommendUndelegation"),Rr=r("TimeoutTagged"),Cr=r("UnexpectedBootloader"),wr=r("MCUNotGenuineToDashboard"),Ur=r("RecipientRequired"),Lr=r("UnavailableTezosOriginatedAccountReceive"),Pr=r("UnavailableTezosOriginatedAccountSend"),Fr=r("UpdateFetchFileFail"),Br=r("UpdateIncorrectHash"),br=r("UpdateIncorrectSig"),Mr=r("UpdateYourApp"),Gr=r("UserRefusedDeviceNameChange"),kr=r("UserRefusedAddress"),Hr=r("UserRefusedFirmwareUpdate"),zr=r("UserRefusedAllowManager"),Wr=r("UserRefusedOnDevice"),qr=r("TransportOpenUserCancelled"),Vr=r("TransportInterfaceNotAvailable"),jr=r("TransportRaceCondition"),Kr=r("TransportWebUSBGestureRequired"),Yr=r("DeviceShouldStayInApp"),Qr=r("WebsocketConnectionError"),Xr=r("WebsocketConnectionFailed"),$r=r("WrongDeviceForAccount"),Jr=r("WrongAppForCurrency"),Zr=r("ETHAddressNonEIP"),et=r("CantScanQRCode"),rt=r("FeeNotLoaded"),tt=r("FeeRequired"),nt=r("FeeTooHigh"),at=r("PendingOperation"),ot=r("SyncError"),it=r("PairingFailed"),st=r("GenuineCheckFailed"),ct=r("LedgerAPI4xx"),pt=r("LedgerAPI5xx"),ut=r("FirmwareOrAppUpdateRequired"),dt=r("OpReturnSizeLimit"),lt=r("DustLimit"),vt=r("LanguageNotFound"),ft=r("NoDBPathGiven"),ht=r("DBWrongPassword"),xt=r("DBNotReset"),G;(function(o){o.Unknown="Unknown",o.LocationServicesDisabled="LocationServicesDisabled",o.LocationServicesUnauthorized="LocationServicesUnauthorized",o.BluetoothScanStartFailed="BluetoothScanStartFailed"})(G||(G={}));var Et=function(o){k(a,o);function a(e,i){var t=o.call(this,i)||this;return t.name="HwTransportError",t.type=e,Object.setPrototypeOf(t,a.prototype),t}return a}(Error);var pe=function(o){k(a,o);function a(e,i){var t=this,n="TransportError";return t=o.call(this,e||n)||this,t.name=n,t.message=e,t.stack=new Error().stack,t.id=i,t}return a}(Error);m("TransportError",function(o){return new pe(o.message,o.id)});var E={ACCESS_CONDITION_NOT_FULFILLED:38916,ALGORITHM_NOT_SUPPORTED:38020,CLA_NOT_SUPPORTED:28160,CODE_BLOCKED:38976,CODE_NOT_INITIALIZED:38914,COMMAND_INCOMPATIBLE_FILE_STRUCTURE:27009,CONDITIONS_OF_USE_NOT_SATISFIED:27013,CONTRADICTION_INVALIDATION:38928,CONTRADICTION_SECRET_CODE_STATUS:38920,CUSTOM_IMAGE_BOOTLOADER:26159,CUSTOM_IMAGE_EMPTY:26158,FILE_ALREADY_EXISTS:27273,FILE_NOT_FOUND:37892,GP_AUTH_FAILED:25344,HALTED:28586,INCONSISTENT_FILE:37896,INCORRECT_DATA:27264,INCORRECT_LENGTH:26368,INCORRECT_P1_P2:27392,INS_NOT_SUPPORTED:27904,DEVICE_NOT_ONBOARDED:27911,DEVICE_NOT_ONBOARDED_2:26129,INVALID_KCV:38021,INVALID_OFFSET:37890,LICENSING:28482,LOCKED_DEVICE:21781,MAX_VALUE_REACHED:38992,MEMORY_PROBLEM:37440,MISSING_CRITICAL_PARAMETER:26624,NO_EF_SELECTED:37888,NOT_ENOUGH_MEMORY_SPACE:27268,OK:36864,PIN_REMAINING_ATTEMPTS:25536,REFERENCED_DATA_NOT_FOUND:27272,SECURITY_STATUS_NOT_SATISFIED:27010,TECHNICAL_PROBLEM:28416,UNKNOWN_APDU:27906,USER_REFUSED_ON_DEVICE:21761,NOT_ENOUGH_SPACE:20738};function ue(o){switch(o){case 26368:return"Incorrect length";case 26624:return"Missing critical parameter";case 27010:return"Security not satisfied (dongle locked or have invalid access rights)";case 27013:return"Condition of use not satisfied (denied by the user?)";case 27264:return"Invalid data received";case 27392:return"Invalid parameter received";case 21781:return"Locked device"}if(28416<=o&&o<=28671)return"Internal error, please report"}function H(o){var a=Object.keys(E).find(function(n){return E[n]===o})||"UNKNOWN_ERROR",e=ue(o)||a,i=o.toString(16),t="Ledger device: ".concat(e," (0x").concat(i,")");if(o===E.LOCKED_DEVICE)throw new ce(t);this.name="TransportStatusError",this.message=t,this.stack=new Error().stack,this.statusCode=o,this.statusText=a}H.prototype=new Error;m("TransportStatusError",function(o){return new H(o.statusCode)});var j=T(te()),g=function(o,a,e,i){function t(n){return n instanceof e?n:new e(function(s){s(n)})}return new(e||(e=Promise))(function(n,s){function p(u){try{c(i.next(u))}catch(v){s(v)}}function d(u){try{c(i.throw(u))}catch(v){s(v)}}function c(u){u.done?n(u.value):t(u.value).then(p,d)}c((i=i.apply(o,a||[])).next())})},S=function(o,a){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,t,n,s;return s={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function p(c){return function(u){return d([c,u])}}function d(c){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,t&&(n=c[0]&2?t.return:c[0]?t.throw||((n=t.return)&&n.call(t),0):t.next)&&!(n=n.call(t,c[1])).done)return n;switch(t=0,n&&(c=[c[0]&2,n.value]),c[0]){case 0:case 1:n=c;break;case 4:return e.label++,{value:c[1],done:!1};case 5:e.label++,t=c[1],c=[0];continue;case 7:c=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(c[0]===6||c[0]===2)){e=0;continue}if(c[0]===3&&(!n||c[1]>n[0]&&c[1]<n[3])){e.label=c[1];break}if(c[0]===6&&e.label<n[1]){e.label=n[1],n=c;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(c);break}n[2]&&e.ops.pop(),e.trys.pop();continue}c=a.call(o,e)}catch(u){c=[6,u],t=0}finally{i=n=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}},z=function(o,a){var e=typeof Symbol=="function"&&o[Symbol.iterator];if(!e)return o;var i=e.call(o),t,n=[],s;try{for(;(a===void 0||a-- >0)&&!(t=i.next()).done;)n.push(t.value)}catch(p){s={error:p}}finally{try{t&&!t.done&&(e=i.return)&&e.call(i)}finally{if(s)throw s.error}}return n},de=function(o){var a=typeof Symbol=="function"&&Symbol.iterator,e=a&&o[a],i=0;if(e)return e.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&i>=o.length&&(o=void 0),{value:o&&o[i++],done:!o}}};throw new TypeError(a?"Object is not iterable.":"Symbol.iterator is not defined.")},W=0,y=1,le=1,ve=2,N=255,q=224,A={GET_VERSION:4,GET_ADDR:5,SIGN:6,SIGN_OFFCHAIN:7},D;(function(o){o[o.BLIND_SIGNATURE_REQUIRED=26632]="BLIND_SIGNATURE_REQUIRED"})(D||(D={}));var fe=function(){function o(a,e){e===void 0&&(e="solana_default_scramble_key"),this.transport=a,this.transport.decorateAppAPIMethods(this,["getAddress","signTransaction","getAppConfiguration"],e)}return o.prototype.getAddress=function(a,e){return e===void 0&&(e=!1),g(this,void 0,void 0,function(){var i,t;return S(this,function(n){switch(n.label){case 0:return i=this.pathToBuffer(a),[4,this.sendToDevice(A.GET_ADDR,e?y:W,i)];case 1:return t=n.sent(),[2,{address:t}]}})})},o.prototype.signTransaction=function(a,e){return g(this,void 0,void 0,function(){var i,t,n,s;return S(this,function(p){switch(p.label){case 0:return i=this.pathToBuffer(a),t=l.Buffer.alloc(1),t.writeUInt8(1,0),n=l.Buffer.concat([t,i,e]),[4,this.sendToDevice(A.SIGN,y,n)];case 1:return s=p.sent(),[2,{signature:s}]}})})},o.prototype.signOffchainMessage=function(a,e){return g(this,void 0,void 0,function(){var i,t,n,s;return S(this,function(p){switch(p.label){case 0:return i=this.pathToBuffer(a),t=l.Buffer.alloc(1),t.writeUInt8(1,0),n=l.Buffer.concat([t,i,e]),[4,this.sendToDevice(A.SIGN_OFFCHAIN,y,n)];case 1:return s=p.sent(),[2,{signature:s}]}})})},o.prototype.getAppConfiguration=function(){return g(this,void 0,void 0,function(){var a,e,i,t,n,s;return S(this,function(p){switch(p.label){case 0:return[4,this.sendToDevice(A.GET_VERSION,W,l.Buffer.alloc(0))];case 1:return a=z.apply(void 0,[p.sent(),5]),e=a[0],i=a[1],t=a[2],n=a[3],s=a[4],[2,{blindSigningEnabled:Boolean(e),pubKeyDisplayMode:i,version:"".concat(t,".").concat(n,".").concat(s)}]}})})},o.prototype.pathToBuffer=function(a){var e=a.split("/").map(function(t){return t.endsWith("'")||t.endsWith("h")?t:t+"'"}).join("/"),i=j.default.fromString(e).toPathArray();return this.serializePath(i)},o.prototype.serializePath=function(a){var e,i,t=l.Buffer.alloc(1+a.length*4);t.writeUInt8(a.length,0);try{for(var n=de(a.entries()),s=n.next();!s.done;s=n.next()){var p=z(s.value,2),d=p[0],c=p[1];t.writeUInt32BE(c,1+d*4)}}catch(u){e={error:u}}finally{try{s&&!s.done&&(i=n.return)&&i.call(n)}finally{if(e)throw e.error}}return t},o.prototype.sendToDevice=function(a,e,i){return g(this,void 0,void 0,function(){var t,n,s,p,d,c,u;return S(this,function(v){switch(v.label){case 0:if(t=[E.OK,D.BLIND_SIGNATURE_REQUIRED],n=0,s=0,!(i.length>N))return[3,3];v.label=1;case 1:return i.length-s>N?(p=i.slice(s,s+N),s+=N,[4,this.transport.send(q,a,e,n|ve,p,t)]):[3,3];case 2:return d=v.sent(),this.throwOnFailure(d),n|=le,[3,1];case 3:return c=i.slice(s),[4,this.transport.send(q,a,e,n,c,t)];case 4:return u=v.sent(),this.throwOnFailure(u),[2,u.slice(0,u.length-2)]}})})},o.prototype.throwOnFailure=function(a){var e=a.readUInt16BE(a.length-2);switch(e){case D.BLIND_SIGNATURE_REQUIRED:throw new Error("Missing a parameter. Try enabling blind signature in the app");default:return}},o}(),K=fe,V;(function(o){o[o.LONG=0]="LONG",o[o.SHORT=1]="SHORT"})(V||(V={}));re();ee();var Q=T(J());Z();var R=class extends F{async makeApp(){await this.initLedgerTransPorter(),this.app||(this.app=new K(this.ledgerTransPorter))}async getAddressPromise(a,e){await this.makeApp();let i=[];for(let t=a*5;t<(a+1)*5;t++){let n=`44'/501'/${t}'/0'`;e===L&&(n=`44'/501'/${t}'`);let{address:s}=await this.app.getAddress(n,!1);i.push({address:_.default.encode(s),index:t,path:n})}return i}async getAddress(a=0,e){return await Promise.race([this.getAddressPromise(a,e),this.throwTimeoutError()])}async getTokens(a,e){let i=a.map(({address:t})=>t);try{let t=await C(w.getChainToken,{addressList:i,coinId:e});if((t==null?void 0:t.code)===0){let{data:n}=t;n.forEach(({address:s,coinAmount:p})=>{let d=(0,Y.find)(a,{address:s});d.coinAmount=p})}}catch(t){console.log(t)}return a}async signTransaction(a,e){try{I.openModal(P.confirm);let i=a.hdPathMap[O];await this.checkLedgerConnection();let{payer:t}=e,{getHardWareRawTransaction:n}=await U(),s=await n(Q.Currency.SOL,{data:e}),p=l.Buffer.from(s,"hex"),d=M.from(p),c=d.serializeMessage(),{signature:u}=await this.app.signTransaction(i,c),v=new b(t);d.signatures&&(d.signatures=[]),d.addSignature(v,u);let X=d.serialize();return I.closeModal(),_.default.encode(X)}catch(i){return this.handleErrors(i,O)}}approveRequestOfSignMessage(a,e){let i=t=>_.default.encode(new TextEncoder().encode(t));return this.privateHandleRequest(a,i,e)}async privateHandleRequest(a,e,i){var u;if(!B(e))throw new Error("the dataHandler must be a function");let{localType:t,params:n}=a,s=(u=i==null?void 0:i.hdPathMap)==null?void 0:u[t],p=(n==null?void 0:n.message)||"",d=e(p);return await this.app.signOffchainMessage(s,d)}async approveRequest({walletInfo:a,requestMeta:e}){return await this.makeApp(),e.method===f.SIGN_MESSAGE||e.method===f.RPC_SIGN_MESSAGE?this.approveRequestOfSignMessage(e,a):e.method===f.SIGN_TRANSACTION||e.method===f.RPC_SIGN_TRANSACTION?this.approveRequestOfSignTransaction(e):e.method===f.SIGN_ALL_TRANSACTIONS||e.method===f.RPC_SIGN_ALL_TRANSACTIONS?this.approveRequestOfSignAllTransactions(e):e.method===f.SIGN_AND_SEND_TRANSACTION||e.method===f.RPC_SIGN_AND_SEND_TRANSACTION?this.approveRequestOfSignAndSendTransaction(e):{}}},Bt=new R;export{Bt as default};

window.inOKXExtension = true;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=solanaAdapter-J626CH34.js.map
