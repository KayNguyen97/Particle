import{a as cr,b as or}from"./chunk-4KY5XQ5E.js";import{t as ar}from"./chunk-VPBQLZCI.js";import{p as nr,q as sr,r as S}from"./chunk-O4EDZSHP.js";import{b as Ur}from"./chunk-6ZPGW3YM.js";import{j as E,o as Kr}from"./chunk-ZKDHZDUE.js";import{c as j,d as I,f as Rr}from"./chunk-S4N75E3H.js";import{a as rr,b as er,f as tr}from"./chunk-7MX3OHNE.js";import{a as Y,b as J,c as Q,d as Z,e as v}from"./chunk-IMRS4RGO.js";import{a as Pr}from"./chunk-TPSXCUGD.js";import{c as O,e as A}from"./chunk-6PGLMYAE.js";import{a as D,h as x}from"./chunk-RMQJRDTF.js";import{a as X,b as Lr}from"./chunk-MVLY6WUP.js";import{f as z,h as kr}from"./chunk-ZEAKIEIQ.js";import{C as wr,D as Dr,F as $,H,I as q,M as V,Pa as G,v as b}from"./chunk-CVJKAN5R.js";import{H as M}from"./chunk-GXQ645QR.js";import{a as Br}from"./chunk-V4YVDLI4.js";import{c as T,f as C,m as f,o as l}from"./chunk-6V2G2Z5W.js";var ur=T((le,dr)=>{"use strict";f();l();dr.exports=r=>encodeURIComponent(r).replace(/[!'()*]/g,e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`)});var yr=T((ye,mr)=>{"use strict";f();l();var pr="%[a-f0-9]{2}",fr=new RegExp(pr,"gi"),lr=new RegExp("("+pr+")+","gi");function R(r,e){try{return decodeURIComponent(r.join(""))}catch{}if(r.length===1)return r;e=e||1;var t=r.slice(0,e),n=r.slice(e);return Array.prototype.concat.call([],R(t),R(n))}function Hr(r){try{return decodeURIComponent(r)}catch{for(var e=r.match(fr),t=1;t<e.length;t++)r=R(e,t).join(""),e=r.match(fr);return r}}function qr(r){for(var e={"%FE%FF":"\uFFFD\uFFFD","%FF%FE":"\uFFFD\uFFFD"},t=lr.exec(r);t;){try{e[t[0]]=decodeURIComponent(t[0])}catch{var n=Hr(t[0]);n!==t[0]&&(e[t[0]]=n)}t=lr.exec(r)}e["%C2"]="\uFFFD";for(var s=Object.keys(e),a=0;a<s.length;a++){var c=s[a];r=r.replace(new RegExp(c,"g"),e[c])}return r}mr.exports=function(r){if(typeof r!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof r+"`");try{return r=r.replace(/\+/g," "),decodeURIComponent(r)}catch{return qr(r)}}});var Wr=T((he,gr)=>{"use strict";f();l();gr.exports=(r,e)=>{if(!(typeof r=="string"&&typeof e=="string"))throw new TypeError("Expected the arguments to be of type `string`");if(e==="")return[r];let t=r.indexOf(e);return t===-1?[r]:[r.slice(0,t),r.slice(t+e.length)]}});var Ir=T((Ae,hr)=>{"use strict";f();l();hr.exports=function(r,e){for(var t={},n=Object.keys(r),s=Array.isArray(e),a=0;a<n.length;a++){var c=n[a],o=r[c];(s?e.indexOf(c)!==-1:e(c,o,r))&&(t[c]=o)}return t}});var Mr=T(p=>{"use strict";f();l();var Vr=ur(),Gr=yr(),Ar=Wr(),zr=Ir(),Xr=r=>r==null,k=Symbol("encodeFragmentIdentifier");function Yr(r){switch(r.arrayFormat){case"index":return e=>(t,n)=>{let s=t.length;return n===void 0||r.skipNull&&n===null||r.skipEmptyString&&n===""?t:n===null?[...t,[u(e,r),"[",s,"]"].join("")]:[...t,[u(e,r),"[",u(s,r),"]=",u(n,r)].join("")]};case"bracket":return e=>(t,n)=>n===void 0||r.skipNull&&n===null||r.skipEmptyString&&n===""?t:n===null?[...t,[u(e,r),"[]"].join("")]:[...t,[u(e,r),"[]=",u(n,r)].join("")];case"colon-list-separator":return e=>(t,n)=>n===void 0||r.skipNull&&n===null||r.skipEmptyString&&n===""?t:n===null?[...t,[u(e,r),":list="].join("")]:[...t,[u(e,r),":list=",u(n,r)].join("")];case"comma":case"separator":case"bracket-separator":{let e=r.arrayFormat==="bracket-separator"?"[]=":"=";return t=>(n,s)=>s===void 0||r.skipNull&&s===null||r.skipEmptyString&&s===""?n:(s=s===null?"":s,n.length===0?[[u(t,r),e,u(s,r)].join("")]:[[n,u(s,r)].join(r.arrayFormatSeparator)])}default:return e=>(t,n)=>n===void 0||r.skipNull&&n===null||r.skipEmptyString&&n===""?t:n===null?[...t,u(e,r)]:[...t,[u(e,r),"=",u(n,r)].join("")]}}function Jr(r){let e;switch(r.arrayFormat){case"index":return(t,n,s)=>{if(e=/\[(\d*)\]$/.exec(t),t=t.replace(/\[\d*\]$/,""),!e){s[t]=n;return}s[t]===void 0&&(s[t]={}),s[t][e[1]]=n};case"bracket":return(t,n,s)=>{if(e=/(\[\])$/.exec(t),t=t.replace(/\[\]$/,""),!e){s[t]=n;return}if(s[t]===void 0){s[t]=[n];return}s[t]=[].concat(s[t],n)};case"colon-list-separator":return(t,n,s)=>{if(e=/(:list)$/.exec(t),t=t.replace(/:list$/,""),!e){s[t]=n;return}if(s[t]===void 0){s[t]=[n];return}s[t]=[].concat(s[t],n)};case"comma":case"separator":return(t,n,s)=>{let a=typeof n=="string"&&n.includes(r.arrayFormatSeparator),c=typeof n=="string"&&!a&&g(n,r).includes(r.arrayFormatSeparator);n=c?g(n,r):n;let o=a||c?n.split(r.arrayFormatSeparator).map(i=>g(i,r)):n===null?n:g(n,r);s[t]=o};case"bracket-separator":return(t,n,s)=>{let a=/(\[\])$/.test(t);if(t=t.replace(/\[\]$/,""),!a){s[t]=n&&g(n,r);return}let c=n===null?[]:n.split(r.arrayFormatSeparator).map(o=>g(o,r));if(s[t]===void 0){s[t]=c;return}s[t]=[].concat(s[t],c)};default:return(t,n,s)=>{if(s[t]===void 0){s[t]=n;return}s[t]=[].concat(s[t],n)}}}function Er(r){if(typeof r!="string"||r.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function u(r,e){return e.encode?e.strict?Vr(r):encodeURIComponent(r):r}function g(r,e){return e.decode?Gr(r):r}function Fr(r){return Array.isArray(r)?r.sort():typeof r=="object"?Fr(Object.keys(r)).sort((e,t)=>Number(e)-Number(t)).map(e=>r[e]):r}function Tr(r){let e=r.indexOf("#");return e!==-1&&(r=r.slice(0,e)),r}function Qr(r){let e="",t=r.indexOf("#");return t!==-1&&(e=r.slice(t)),e}function Cr(r){r=Tr(r);let e=r.indexOf("?");return e===-1?"":r.slice(e+1)}function xr(r,e){return e.parseNumbers&&!Number.isNaN(Number(r))&&typeof r=="string"&&r.trim()!==""?r=Number(r):e.parseBooleans&&r!==null&&(r.toLowerCase()==="true"||r.toLowerCase()==="false")&&(r=r.toLowerCase()==="true"),r}function br(r,e){e=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},e),Er(e.arrayFormatSeparator);let t=Jr(e),n=Object.create(null);if(typeof r!="string"||(r=r.trim().replace(/^[?#&]/,""),!r))return n;for(let s of r.split("&")){if(s==="")continue;let[a,c]=Ar(e.decode?s.replace(/\+/g," "):s,"=");c=c===void 0?null:["comma","separator","bracket-separator"].includes(e.arrayFormat)?c:g(c,e),t(g(a,e),c,n)}for(let s of Object.keys(n)){let a=n[s];if(typeof a=="object"&&a!==null)for(let c of Object.keys(a))a[c]=xr(a[c],e);else n[s]=xr(a,e)}return e.sort===!1?n:(e.sort===!0?Object.keys(n).sort():Object.keys(n).sort(e.sort)).reduce((s,a)=>{let c=n[a];return Boolean(c)&&typeof c=="object"&&!Array.isArray(c)?s[a]=Fr(c):s[a]=c,s},Object.create(null))}p.extract=Cr;p.parse=br;p.stringify=(r,e)=>{if(!r)return"";e=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},e),Er(e.arrayFormatSeparator);let t=c=>e.skipNull&&Xr(r[c])||e.skipEmptyString&&r[c]==="",n=Yr(e),s={};for(let c of Object.keys(r))t(c)||(s[c]=r[c]);let a=Object.keys(s);return e.sort!==!1&&a.sort(e.sort),a.map(c=>{let o=r[c];return o===void 0?"":o===null?u(c,e):Array.isArray(o)?o.length===0&&e.arrayFormat==="bracket-separator"?u(c,e)+"[]":o.reduce(n(c),[]).join("&"):u(c,e)+"="+u(o,e)}).filter(c=>c.length>0).join("&")};p.parseUrl=(r,e)=>{e=Object.assign({decode:!0},e);let[t,n]=Ar(r,"#");return Object.assign({url:t.split("?")[0]||"",query:br(Cr(r),e)},e&&e.parseFragmentIdentifier&&n?{fragmentIdentifier:g(n,e)}:{})};p.stringifyUrl=(r,e)=>{e=Object.assign({encode:!0,strict:!0,[k]:!0},e);let t=Tr(r.url).split("?")[0]||"",n=p.extract(r.url),s=p.parse(n,{sort:!1}),a=Object.assign(s,r.query),c=p.stringify(a,e);c&&(c=`?${c}`);let o=Qr(r.url);return r.fragmentIdentifier&&(o=`#${e[k]?u(r.fragmentIdentifier,e):r.fragmentIdentifier}`),`${t}${c}${o}`};p.pick=(r,e,t)=>{t=Object.assign({parseFragmentIdentifier:!0,[k]:!1},t);let{url:n,query:s,fragmentIdentifier:a}=p.parseUrl(r,t);return p.stringifyUrl({url:n,query:zr(s,e),fragmentIdentifier:a},t)};p.exclude=(r,e,t)=>{let n=Array.isArray(e)?s=>!e.includes(s):(s,a)=>!e(s,a);return p.pick(r,n,t)}});f();l();var ir=()=>!!(window.navigator&&window.navigator.hid);f();l();var F=C(Mr()),d=C(Br()),y=C(Ur()),U=C(Pr());Kr();wr();Rr();G();f();l();var N=C(Dr());G();var Zr=(r=[],e)=>{let t={};return r.forEach(n=>{t[n[e]]=n}),t},Or=(r,e)=>{if(!r||!Array.isArray(r))return[];let{hasBackup:t,keyringType:n}=e||{};return r.filter(({hasBackup:s,keyringIdentityType:a})=>{let c=!0;if(typeof t=="boolean"&&(c=t===s),n){let o=typeof n=="string"?[n]:n;c=o==null?void 0:o.includes(a)}return c})},Sr=r=>r==null?void 0:r.reduce((e,{walletIdentities:t,...n})=>[...e,...t.map((s={})=>({...n,...s}))],[]),Nr=r=>r.map(e=>{var n,s;let{walletIdentities:t}=e;return{...e,hasBackup:!((s=(n=t==null?void 0:t[0])==null?void 0:n.backupData)!=null&&s.length)}}),vr=(r={},e)=>{let t=[D.SEGWIT_NESTED,D.SEGWIT_NESTED_49],n={};return Object.keys(r).forEach(a=>{let c=e[a],o=t.find(m=>m!==c),i=Object.entries(r[a]).map(([m,h])=>({addressType:m,...h}));n[a]=i.filter(({addressType:m})=>m!==o)}),n},_r=(r=[],e=[])=>{let t=Zr(e,"walletId");return r.map(n=>{let{walletIdentities:s}=n;return{...n,walletIdentities:s.map(a=>{let{walletId:c,accountsMap:o,addressType:i,...m}=a;if(!t[c])return{walletId:c,addressType:{},...m};let{addressType:h,segwitAddressType:_}=t[c];return{walletId:c,selectedAddressType:h,addressType:vr(a==null?void 0:a.accountsMap,_),...m}})}})};var re=[H,V,q],Ne=(r,e=$,t)=>{var s,a,c;if(re.includes(e)&&t){let o=((s=r==null?void 0:r.addressType)==null?void 0:s[e])||[];return(a=(0,N.find)(o,i=>i.addressType===t))==null?void 0:a.address}return(c=r==null?void 0:r.account)==null?void 0:c[e]};f();l();Lr();kr();var jr=()=>({syncMpcWallet:async e=>{var a;let t=((a=e==null?void 0:e.walletIdentities)==null?void 0:a.length)||0,n=(e==null?void 0:e.mpcId)||"",{data:s}=await z(X.syncMpcwallet,{mpcId:n,deriveIndex:t});return s}});var ee="syncMpcWalletErrorCode",tt=()=>(0,y.useSelector)(({metamask:r})=>r==null?void 0:r.keyringIdentities),P=r=>{let e=(0,y.useSelector)(({metamask:n})=>{let{wallets:s,keyringIdentities:a}=n;return _r(a,s)});return(0,d.useMemo)(()=>{let n=Nr(e);return r?Or(n,r):n},[r,e])},B=r=>{let e=P(r);return(0,d.useMemo)(()=>Sr(e||[]),[e])},te=()=>(0,y.useSelector)(r=>{var e;return(e=r==null?void 0:r.metamask)==null?void 0:e.selectedWallet}),K=(r,e=!0)=>{let t=te(),n=r||t,s=B();return(0,d.useMemo)(()=>e===!1&&!r?null:s.find(a=>(a==null?void 0:a.walletId)===n),[s,n,e,r])},nt=(r,e)=>{let t=B(e);return(0,d.useMemo)(()=>Array.isArray(r)?t.filter(({walletId:n})=>r.includes(n)):t,[r,t])},st=()=>{let r=B();return(0,d.useCallback)(e=>r==null?void 0:r.find(t=>t.walletId===e),[r])},at=r=>{let e=K(r);return(e==null?void 0:e.keyringIdentityType)===x.MPC},ct=r=>{let e=K(r);return v(e==null?void 0:e.initialType)},ot=r=>{let e=P(),{keyringId:t}=K()||{},n=r||t;return(0,d.useMemo)(()=>e==null?void 0:e.find(s=>s.keyringId===n),[e,n])},w=()=>{let r=P();return(0,d.useCallback)(e=>r==null?void 0:r.find(t=>t.keyringId===e),[r])};var $r=()=>{let r=(0,y.useDispatch)();return(0,d.useCallback)(async e=>{try{let{walletId:t}=await I().addNewWallet(e);return await E(r),M.success({title:b("wallet_addacount_toast_account_created")}),t}catch(t){return t.message===cr&&M.error(b("wallet_home_toast_network_error")),t.message===or&&M.error(b("extension_wallet_addwallet_toast_wallets_added",{amount:500})),""}},[])},ne=()=>{let r=(0,U.useHistory)();return(0,d.useCallback)(async e=>{var a,c;let t=(c=(a=e==null?void 0:e.walletIdentities)==null?void 0:a[0])==null?void 0:c.walletId;if(!ir()){r.push(`${S}/${O.ledger}?${F.default.stringify({baseChain:$,type:A.addAccount,walletId:t})}`);return}let n=`${sr}?${F.default.stringify({type:A.addAccount,walletId:t})}`;await tr.hasConnectedLedger()?r.push(n):er.openModal(rr.hardWareNotConnected,{walletName:e.keyringName,onButtonClick:()=>{globalThis.platform.openExtensionInBrowser(nr)},onExtButtonClick:()=>{globalThis.platform.openExtensionInBrowser(`${n}&hideBack=1`)}})},[])},se=()=>{var n;let r=(0,U.useHistory)(),e=ne(),t=(n=B())==null?void 0:n.length;return(0,d.useCallback)(async s=>{var o,i;if(t===500){M.error(b("extension_wallet_addwallet_toast_wallets_added",{amount:500}));return}let{initialType:a}=s,c=(i=(o=s==null?void 0:s.walletIdentities)==null?void 0:o[0])==null?void 0:i.walletId;switch(!0){case Y(a):{e(s);break}case J(a):{globalThis.platform.openExtensionInBrowser(`${S}/${O.trezor}?${F.default.stringify({type:A.addAccount,walletId:c,hideBack:1})}`);break}case Q(a):{r.push(`${S}/${O.keystone}?${F.default.stringify({walletId:c,type:A.addAccount})}`);break}case Z(a):{let{onekeyInfo:m}=s,{firstEvmAddress:h,connectId:_}=m;r.push(`${S}/${O.onekey}?${F.default.stringify({firstEvmAddress:h,connectId:_,type:A.addAccount})}`);break}default:break}},[])},it=()=>{let r=w(),e=$r(),t=se(),n=$r(),{syncMpcWallet:s}=jr();return(0,d.useCallback)(async a=>{var c,o;if(a&&typeof a=="string"){let i=r(a),m=(o=(c=i==null?void 0:i.walletIdentities)==null?void 0:c[0])==null?void 0:o.walletId;if((i==null?void 0:i.keyringIdentityType)===x.MNEMONIC)return await e(m);if((i==null?void 0:i.keyringIdentityType)===x.HARDWARE)return t(i);if((i==null?void 0:i.keyringIdentityType)===x.MPC){try{await s(i)}catch{return Promise.reject(new Error(ee))}return await n(m)}return Promise.reject()}return Promise.reject()},[r,e,t,n,s])},ae=()=>{let r=w();return(0,d.useCallback)(e=>new Promise((t,n)=>{var a,c;let s=r(e);j().getMnemonicByWalletId((c=(a=s==null?void 0:s.walletIdentities)==null?void 0:a[0])==null?void 0:c.walletId,(o,i)=>{if(o){n(o);return}t(i)})}),[])},dt=(r,e=!0)=>{let t=ae(),[n,s]=(0,d.useState)(null);return(0,d.useEffect)(()=>{(async()=>{if(r){let a=await t(r);s(a)}})()},[r]),e?n==null?void 0:n.split(" "):n},ce=()=>(0,d.useCallback)((r,e={})=>new Promise((t,n)=>{j().getBackupPrivateKeys(r,(s,a)=>{if(s){n(s);return}let c=a;Array.isArray(e==null?void 0:e.exclude)&&(c=c==null?void 0:c.filter(({coinId:o})=>{var i;return!((i=e==null?void 0:e.exclude)!=null&&i.includes(o))})),t(c)})}),[]),ut=(r,e={})=>{let[t,n]=(0,d.useState)([]),s=ce();return ar(()=>{(async()=>{if(r){let a=await s(r,e);n(a)}})()},[r,e]),t},oe=()=>{let r=w();return(0,d.useCallback)(e=>new Promise((t,n)=>{var a,c;let s=r(e);j().getBackupData((c=(a=s==null?void 0:s.walletIdentities)==null?void 0:a[0])==null?void 0:c.walletId,(o,i)=>{if(o){n(o);return}t(i)})}),[])},ft=r=>{let[e,t]=(0,d.useState)([]),n=oe();return(0,d.useEffect)(()=>{(async()=>{if(r){let s=await n(r);t(s)}})()},[r]),e},lt=()=>{let r=(0,y.useDispatch)(),e=w();return(0,d.useCallback)(async t=>{var s,a;let n=e(t);await I().backupMnemonic((a=(s=n==null?void 0:n.walletIdentities)==null?void 0:s[0])==null?void 0:a.walletId),await E(r)},[])},pt=()=>{let r=(0,y.useDispatch)();return(0,d.useCallback)(async(e,t)=>{await I().updateKeyringIdentityName(e,t),await E(r)},[])},mt=()=>{let r=(0,y.useDispatch)();return(0,d.useCallback)(async(e,t)=>{await I().updateWalletIdentityName(e,t),await E(r)},[])},yt=()=>{let r=(0,y.useDispatch)();return(0,d.useCallback)(async e=>{await I().updateAllKeyringIdentities(e),await E(r)},[r])};export{ir as a,Mr as b,Ne as c,ee as d,tt as e,P as f,B as g,te as h,K as i,nt as j,st as k,at as l,ct as m,ot as n,w as o,it as p,dt as q,ce as r,ut as s,ft as t,lt as u,pt as v,mt as w,yt as x};

window.inOKXExtension = true;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=chunk-62JDSRZZ.js.map
