import{a as Ce,b as ye}from"./chunk-MBJ4MFYL.js";import{b as V}from"./chunk-PCY622ND.js";import{a as j,d as ee}from"./chunk-NS35PZCP.js";import{b as te,c as re}from"./chunk-BBN3UGKM.js";import{f as $,g as ve,j as Le}from"./chunk-QMNAWRVI.js";import{b as de,c as Ve,d as Ye,e as qe,f as pe,g as Ge,h as he}from"./chunk-OZ6XSJY6.js";import{f as Y}from"./chunk-DMJQUOJT.js";import{f as L,i as me,n as fe}from"./chunk-62JDSRZZ.js";import{d as Z}from"./chunk-4OTZHHYZ.js";import{W as _e,l as Ue}from"./chunk-R6GCLTW2.js";import{b as I}from"./chunk-VPBQLZCI.js";import{a as ct,j as De}from"./chunk-X2LENRE7.js";import{a as Oe}from"./chunk-O4EDZSHP.js";import{b as ie}from"./chunk-6ZPGW3YM.js";import{a as ut}from"./chunk-TPSXCUGD.js";import{g as Q,h as X}from"./chunk-RMQJRDTF.js";import{a as Ke,b as at}from"./chunk-MVLY6WUP.js";import{f as Se,h as st}from"./chunk-ZEAKIEIQ.js";import{Ab as Ie,C as rt,D as Ee,F as Ne,Nb as Pe,Pa as nt,Ra as J,Vb as le,q as p,rb as ot,sb as v,tb as Re,ub as Fe,v as we}from"./chunk-CVJKAN5R.js";import{H as xe}from"./chunk-GXQ645QR.js";import{a as z}from"./chunk-V4YVDLI4.js";import{f as w,m as T,o as A}from"./chunk-6V2G2Z5W.js";T();A();var P=w(z());rt();var R=w(ie());var U=w(Ee());nt();T();A();var G=w(z()),H=w(Ee()),g=w(ie()),Ae=w(ct());T();A();var He=w(z());function ne(e,t,r){let n=He.default.useRef({});return(!("value"in n.current)||r(n.current.condition,t))&&(n.current.value=e(),n.current.condition=t),n.current.value}st();T();A();var Je=w(z()),Te=w(ie());T();A();var We={},lt=async e=>{let t=(await import("./web3.min-HU26EVOM.js")).default,r=new t(new t.providers.HttpProvider(e));return We[e]=r,r},ze=async e=>We[e]?We[e]:lt(e);var q=(e="")=>{let t=(0,Te.useSelector)(Y),{isRpcMode:r}=(0,Te.useSelector)(Z),{rpcUrl:n}=t;return(0,Je.useCallback)(async()=>r?await ze(e||n):{},[e,n,r])};at();ot();le();T();A();T();A();le();var dt=6,Qe=(e,t=dt)=>{if(!Number(e))return"0";let r=e==null?void 0:e.toString(),n=e.split(".")[1]||"";return(n==null?void 0:n.length)>t?Pe(r,t&&Number(t)):r},Xe=(e,t)=>{let{rpcUrl:r,chainId:n,account:s,existAccounts:o,isDeleted:c}=t;return Array.isArray(e)?e.filter(u=>{let a=!0;return n&&(a=a&&u.chainId===n),s&&(a=a&&u.account===s),Array.isArray(o)&&!!(o!=null&&o.length)&&(a=a&&(o==null?void 0:o.includes(u.account))),c!==void 0&&(a=a&&(u.isDeleted||!1)===c),u.address||(a=a&&u.rpcUrl===r),a}):[]},Ze=(e,t={})=>{let{symbol:r,usdToThisRate:n,chainTokenPrice:s,chainTokenBalance:o}=t;return Array.isArray(e)?e.map(c=>{var m,f,y,B,N,S;let u,a,{chainId:l,decimals:d}=c,h=r;c.address?(u=((B=s==null?void 0:s[l])==null?void 0:B[c.address])||0,a=((S=(N=o==null?void 0:o[c.account])==null?void 0:N[l])==null?void 0:S[c.address])||0):(u=((m=s==null?void 0:s[l])==null?void 0:m.price)||0,a=((y=(f=o==null?void 0:o[c.account])==null?void 0:f[l])==null?void 0:y.balance)||0),a=Qe(a&&Re(a,10**d));let C=Qe(v(a,v(u,n)));return{price:u,balance:a,...c,moneySymbol:h,marketValue:C}}):[]};var D=(e,t,r=!0)=>{let{chainId:n,rpcUrl:s}=(0,g.useSelector)(Y),o=(0,g.useSelector)(de),c=(0,g.useSelector)(Ve),u=(0,g.useSelector)(Ye),{symbol:a,usdToThisRate:l}=(0,g.useSelector)(_e),d=Ce(),h=ye(void 0,J),C=(0,G.useMemo)(()=>Xe(o,{chainId:n,rpcUrl:s,existAccounts:h,account:r?d:void 0,isDeleted:t?void 0:!1}),[n,d,h,o]);return(0,G.useMemo)(()=>e?C:Ze(C,{symbol:a,usdToThisRate:l,chainTokenPrice:c,chainTokenBalance:u}),[a,C,l,c,u,e])},xr=(e,t)=>{let r=D(t);return(0,G.useMemo)(()=>r.find(n=>n.address===(e||void 0))||{},[e,r])};var pt=e=>{let t=q(e);return I(async r=>{let n=await t(),s=new n.eth.Contract(Ae.default,r),o=await s.methods.symbol().call(),c=await s.methods.decimals().call();return{name:await s.methods.name().call(),symbol:o,decimals:c}},[t])},ht=()=>{let e=q(),t=V();return I(async(r,n,s)=>{let o,c=s||await e(),u=n||t;return r?o=await new c.eth.Contract(Ae.default,r).methods.balanceOf(u).call():o=await c.eth.getBalance(u,"latest"),o},[e,t])},Ct=()=>I(async(e,t)=>{let r=t;typeof t=="string"&&(r=[t]);try{let{data:n}=await Se(Ke.getCoinPrice,{tokenAddresses:r,chainId:typeof e=="string"?Number.parseInt(e,16):e});return n}catch{return[]}},[]),Nr=()=>{let e=q(),t=(0,g.useDispatch)();return I(async({chainId:r,injectWeb3:n,wallets:s=[]})=>{let o=n||await e(),c=new o.BatchRequest;s.forEach(u=>{c.add(o.eth.getBalance.request(u,"latest",(a,l)=>{a||t(he({chainId:r,balance:l,account:u}))}))}),c.execute()})},yt=()=>{let e=(0,g.useDispatch)(),t=V(),r=Ct(),n=ht();return I(async({chainId:s,address:o,injectAccount:c,injectWeb3:u})=>{let[a,l]=await Promise.all([r(s,o),n(o,c,u)]);return a!=null&&a.length&&e(Ge({chainId:s,price:a[0].price})),e(he({chainId:s,balance:l,address:o,account:c||t})),!0},[n,t])},Sr=()=>{let e=V(),{chainId:t}=(0,g.useSelector)(Y),r=D(!0,!1,!1);return ne(()=>({chainId:t,chainTokens:r}),{chainId:t,account:e,needPollChainTokens:r},(n,s)=>!(0,H.isEqual)(n,s))},Wt=18,Tt=()=>{let e=(0,g.useDispatch)(),t=(0,g.useSelector)(de),r=V();return I((n,s,o)=>{if(!n&&!r&&!(o!=null&&o.account))return!1;let{rpcUrl:c}=o,u=t.find(l=>{let d=l.chainId===n&&l.address===s&&l.account===((o==null?void 0:o.account)||r);return s||(d=d&&l.rpcUrl===c),d});if(u){if(u.isDeleted===!0){let l={...u,...o,chainId:n,address:s,isDeleted:!1};return e(pe(l)),!0}return!1}let a={chainId:n,address:s,isDeleted:!1,account:r,decimals:Wt};return o&&typeof o=="object"&&Object.assign(a,o),e(qe(a)),!0},[t,r])},Rr=e=>{let t=q(e),r=Tt(),n=pt(e),s=yt();return async(o,c)=>{let u=await n(c);if(r(o,c,u)){let l=await t();await s(o,c,l)}}},At=(e={})=>{let t=L(e);return ne(()=>t.reduce((r,n)=>{if(n.keyringIdentityType===X.MNEMONIC)r.push(n);else{let s=n.walletIdentities.filter(o=>Boolean(o.account[J]));s.length&&r.push({...n,walletIdentities:s})}return r},[]),t,(r,n)=>!(0,H.isEqual)(r,n))},Fr=(e={})=>{let t=At(e),r=D(!1,!1,!1);return(0,G.useMemo)(()=>{let n=(0,H.groupBy)(r||[],"account");return(t==null?void 0:t.map(s=>{var a;let o="",c=(a=s.walletIdentities)==null?void 0:a.map(l=>{var m,f;let d=(m=l==null?void 0:l.account)==null?void 0:m[J],{balance:h,symbol:C}=((f=n[d])==null?void 0:f.filter(({address:y})=>!y)[0])||{};return o=C,{...l,balance:h,symbol:C}}),u=c.reduce((l,d)=>Fe(l,d.balance),0);return{...s,marketValue:u,marketValueSymbol:o,walletIdentities:c}}))||[]},[r,t])},Ir=()=>{let e=(0,g.useDispatch)(),t=D(!0,!1,!1);return r=>{var n;(n=t==null?void 0:t.filter(({chainId:s,rpcUrl:o,address:c})=>!c&&s===r.chainId&&o===r.rpcUrl))==null||n.forEach(({chainId:s,account:o})=>{e(pe({chainId:s,account:o,...r}))})}};var $e=w(ut());le();var bt=()=>(0,R.useSelector)(Ue),be=()=>(0,R.useSelector)(e=>{var t;return((t=e==null?void 0:e.metamask)==null?void 0:t.reducedCoins)||{}}),gt=()=>(0,R.useSelector)(e=>{var t;return((t=e==null?void 0:e.metamask)==null?void 0:t.addedCoins)||{}}),ge=()=>(0,R.useSelector)(Le),ke=()=>{let e=bt(),t=gt(),r=(0,R.useSelector)(n=>n.metamask.createdMap);return(0,P.useCallback)(({walletId:n,keyringIdentityType:s})=>{var a;let o=(a=r[n])!=null?a:[],c=new Set(o.map(({coinId:l})=>l)),u=s===X.PRIVATE_KEY?c:[];return[...t[n]||[],...e].map(({coinId:l})=>l).concat(u)},[e,t,r])},kt=({walletId:e,keyringIdentityType:t})=>{let r=ke();return(0,P.useMemo)(()=>r({walletId:e,keyringIdentityType:t}),[e,t,r])},it=e=>{let t=L(e),r=ge(),[n]=re(te.showNftAmount),s=be(),o=(0,R.useSelector)(ve),c=ee(),u=j(c),a=ke(),{isRpcMode:l}=(0,R.useSelector)(Z),d=D(!1,!1,!1),h=(0,U.groupBy)(d||[],"account"),C=(0,P.useMemo)(()=>t.map(f=>{let{walletIdentities:y}=f,B=y.map(i=>{var _,Me;let{walletId:k}=i,b=a(i),{coins:F,nft:oe,defi:se}=r[k]||{},x=F==null?void 0:F.filter(({voucherToken:M})=>!M),ae=(0,U.map)((s==null?void 0:s[k])||{},"key");if(l){let M=(_=i==null?void 0:i.account)==null?void 0:_[Ne];if(!M||[Q.HD_KEYRING,Q.SIMPLE_KEYRING,Q.MPC_KEYRING].indexOf(i==null?void 0:i.initialType)<0)return{unsupported:!0,walletAsset:"0",platformAsset:"0",...i};let{balance:O="0"}=((Me=h[M])==null?void 0:Me.filter(({address:ce})=>!ce)[0])||{};return{walletAsset:O,platformAsset:"0",...i}}if(x!=null&&x.length){let M="0",O="0";x==null||x.forEach(E=>{let Be=o[E.coinId],ue=Be?v(E.coinAmount,Be):"0";((Ie(ue,1)||(b==null?void 0:b.includes(E==null?void 0:E.coinId)))&&!ae.includes(E.key)||De(E))&&(M=p.add(M,ue),(E==null?void 0:E.platformType)===0&&(O=p.add(O,ue)))});let{nfts:ce=[]}=oe||{},{defis:je=[]}=se||{},{nftBalance:et,defiBalance:tt}=$({defis:je,nfts:ce,ignoreNft:!n,selectedCurrency:u});return M=p.add(M,et||"0"),M=p.add(M,tt||"0"),{walletAsset:M,platformAsset:O,...i}}let W=Array.isArray(x);return{walletAsset:W?"0":"--",platformAsset:W?"0":"--",...i}}),{walletAsset:N,platformAsset:S}=B.reduce((i,k)=>({walletAsset:p.add(i.walletAsset,k.walletAsset==="--"?"0":k.walletAsset),platformAsset:p.add(i.platformAsset,k.platformAsset==="--"?"0":k.platformAsset)}),{walletAsset:0,platformAsset:0});return{...f,walletAsset:N,platformAsset:S,walletIdentities:B}}),[t,s,a,r,n,h,l,u,o]);return[(0,P.useMemo)(()=>C==null?void 0:C.reduce((f,y)=>({walletAsset:p.add(f.walletAsset,y.walletAsset),platformAsset:p.add(f.platformAsset,y.platformAsset),rpcModeCoinSymbol:f.rpcModeCoinSymbol||(y==null?void 0:y.rpcModeCoinSymbol)}),{walletAsset:"0",platformAsset:"0",rpcModeCoinSymbol:""}),[C,l]),C]},mt=e=>{let t=(0,$e.useHistory)(),r=fe(e),n=ke(),s=ge(),[o]=re(te.showNftAmount),c=be(),u=ee(),a=j(u);return r||(xe.error(we("wallet_extension_top_error_parameters")),t.push(Oe)),(0,P.useMemo)(()=>{let{walletIdentities:l}=r,d=l.map(m=>{let{walletId:f}=m,y=n(m),{coins:B,nft:N,defi:S}=s[f]||{},i=B==null?void 0:B.filter(({voucherToken:b})=>!b),k=(0,U.map)((c==null?void 0:c[f])||{},"key");if(i!=null&&i.length){let b="0",F="0";i==null||i.forEach(W=>{if((W.currencyAmount>=1||(y==null?void 0:y.includes(W==null?void 0:W.coinId)))&&!k.includes(W.key)){let _=(W==null?void 0:W.currencyAmount)||"0";b=p.add(b,_),(W==null?void 0:W.platformType)===0&&(F=p.add(F,_))}});let{nfts:oe=[]}=N||{},{defis:se=[]}=S||{},{nftBalance:x,defiBalance:ae}=$({defis:se,nfts:oe,ignoreNft:!o,selectedCurrency:a});return b=p.add(b,x||"0"),b=p.add(b,ae||"0"),{walletAsset:b,platformAsset:F,...m}}return{walletAsset:"0",platformAsset:"0",...m}}),{walletAsset:h,platformAsset:C}=d.reduce((m,f)=>({walletAsset:p.add(m.walletAsset,f.walletAsset),platformAsset:p.add(m.platformAsset,f.platformAsset)}),{walletAsset:0,platformAsset:0});return{...r,walletAsset:h,platformAsset:C,walletIdentities:d}},[r,o,s,c,n,a])},ft=e=>{let[t]=re(te.showNftAmount),r=ge(),n=me(e),s=be(),o=ee(),c=j(o),u=kt(n),{coins:a,nft:l,defi:d}=r[e]||{},h=a==null?void 0:a.filter(({voucherToken:m})=>!m),C=(0,U.map)((s==null?void 0:s[e])||{},"key");if(h!=null&&h.length){let m="0",f="0";h==null||h.forEach(i=>{if((i.currencyAmount>=1||(u==null?void 0:u.includes(i==null?void 0:i.coinId)))&&!C.includes(i.key)){let k=(i==null?void 0:i.currencyAmount)||"0";m=p.add(m,k),(i==null?void 0:i.platformType)===0&&(f=p.add(f,k))}});let{nfts:y=[]}=l||{},{defis:B=[]}=d||{},{nftBalance:N,defiBalance:S}=$({defis:B,nfts:y,ignoreNft:!t,selectedCurrency:c});return m=p.add(m,N||"0"),m=p.add(m,S||"0"),{walletAsset:m,platformAsset:f,...n}}return{walletAsset:"0",platformAsset:"0",...n}};export{ne as a,lt as b,ze as c,q as d,D as e,xr as f,pt as g,ht as h,Ct as i,Nr as j,yt as k,Sr as l,Tt as m,Rr as n,At as o,Fr as p,Ir as q,it as r,mt as s,ft as t};

window.inOKXExtension = true;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=chunk-FEET7RP6.js.map
