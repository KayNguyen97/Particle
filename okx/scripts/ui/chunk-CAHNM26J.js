import{c as fe}from"./chunk-IKPPHICM.js";import{e as _e,g as ue,i as de,k as xe,m as B}from"./chunk-HR4SA7Z5.js";import{b as pe}from"./chunk-WIOZQWEG.js";import{n as me}from"./chunk-YLO74Q7W.js";import{b as ce}from"./chunk-E73QHIZ6.js";import{g as se}from"./chunk-QMNAWRVI.js";import{c as re,f as le}from"./chunk-MTMZQEHP.js";import{W as ie}from"./chunk-R6GCLTW2.js";import{k as ne,l as oe}from"./chunk-IU3TYIWS.js";import{b as ve}from"./chunk-6ZPGW3YM.js";import{U as z,k as ae}from"./chunk-UXFKODVN.js";import{C as Y,D as Ge,Vb as Ne,q as V,sb as W,tb as ee,ub as $,v as o,vb as te}from"./chunk-CVJKAN5R.js";import{G as X,o as v}from"./chunk-GXQ645QR.js";import{V as T}from"./chunk-C2H3SRET.js";import{a as Q}from"./chunk-V4YVDLI4.js";import{f as I,m as s,o as r}from"./chunk-6V2G2Z5W.js";s();r();s();r();Y();s();r();var L=I(Q());s();r();s();r();var y=I(Q()),q=I(ve());Y();Ne();s();r();var C={title:"_title_1xthp_1",subtitle:"_subtitle_1xthp_9",fee:"_fee_1xthp_15",feeTitle:"_feeTitle_1xthp_21",feeDetail:"_feeDetail_1xthp_26",speedDetail:"_speedDetail_1xthp_33",gasDetail:"_gasDetail_1xthp_36"};var be=()=>{let F=ce(),E=me(),l=(0,q.useSelector)(se),u=(0,q.useSelector)(ie),d=pe(),x=fe(),a=async(t,c,e,h=0)=>{let{baseCoin:_}=await F(e,!0),f=(l==null?void 0:l[_.coinId])||"0",P=W(t,c),w=oe($(P,h),{symbol:_.symbol,decimals:_.decimals}),m=ne(W(ee($(P,h),10**_.decimals),f),{symbol:u.symbol});return`${w} ${m}`},i=(t,c)=>{let e=d(t);return o("wallet_extension_transaction_confirmation_gas_detail",{gasPrice:V.thousandFormat(e),gasLimit:V.thousandFormat(c)})},p=async(t,c)=>{try{return await x({...t,coinId:c})}catch{return""}},n=({userGasInfo:t,updateGasInfo:c,fetchParams:e})=>{let{gasPrice:h,maxFeePerGas:_,maxPriorityFeePerGas:f}=c,{supportEip1559:P,gasLimit:w,gasPrice:m,maxFeePerGas:D,maxPriorityFeePerGas:S}=t;return P?(delete e.gasPrice,{...e,value:e==null?void 0:e.amount,maxFeePerGas:_||D,maxPriorityFeePerGas:f||S,gasLimit:w}):{...e,value:e==null?void 0:e.amount,gasPrice:h||m,gasLimit:w}};return async({coinId:t,baseCoinAmountUse:c,userGasInfo:e,updateGasInfo:h,serverSignInfo:_,fetchParams:f})=>{let{gasPrice:P,maxFeePerGas:w}=h,{supportEip1559:m,gasLimit:D,gasPrice:S,maxFeePerGas:H}=e,b=0;_!=null&&_.needExtFee&&(b=await p(n({userGasInfo:e,updateGasInfo:h,fetchParams:f}),t));let R=m?H:S,M=await a(R,D,t),A=i(R,D),k=m?w:P,O=await a(k,D,t,b),N=i(k,D);return new Promise((Pe,J)=>{let K=v.prompt({hideCloseBtn:!1,alignBottom:!1,titleCenter:!1,infoType:null,confirmText:o("extension_toast_btn_confirmgasfee"),confirmBtnProps:{type:T.TYPE.highlight,size:T.SIZE.lg},onConfirm:async()=>{K.destroy();let{baseCoin:U}=await F(t,!0),{coinAmountInt:Ee}=E(U.coinId),De=te(Ee,c);xe({userGasInfo:e,updateGasInfo:h,baseCoinAmountAvailable:De,L1FEE:b})?(X.error({title:o("extension_toast_text_insufficient_balance")}),J(new Error(B))):Pe(h)},onClose:()=>{K.destroy(),J(new Error(B))},renderContent:U=>y.default.createElement(U,null,y.default.createElement("div",{className:C.title},o("extension_toast_title_transaction_replace")),y.default.createElement("div",{className:C.subtitle},o("extension_toast_subtitle_gasincrease")),y.default.createElement("div",{className:C.feeTitle},o("extension_toast_title_current_transaction")),y.default.createElement("div",{className:C.fee},y.default.createElement("div",{className:C.feeDetail},M),y.default.createElement("div",{className:C.gasDetail},A)),y.default.createElement("div",{className:C.feeTitle},o("extension_toast_title_gasprice")),y.default.createElement("div",{className:C.fee},y.default.createElement("div",{className:C.speedDetail},O),y.default.createElement("div",{className:C.gasDetail},N)))})})}},Fe=be;var ke=()=>{let F=Fe();return async({coinId:l,baseCoinAmountUse:u,userGasInfo:d,serverGasInfo:x,serverSignInfo:a,originTxGasInfo:i,fetchParams:p})=>{let n=de({userGasInfo:d,serverGasInfo:x,originTxGasInfo:i});return(n==null?void 0:n.gasPrice)||(n==null?void 0:n.maxFeePerGas)?(await F({coinId:l,baseCoinAmountUse:u,userGasInfo:d,updateGasInfo:n,serverSignInfo:a,fetchParams:p}),Promise.resolve(n)):Promise.resolve()}},ge=ke;s();r();var Z={content:"_content_18w99_1",title:"_title_18w99_4",text:"_text_18w99_10"};var Be=()=>{let F=ge();return async({coinId:l,baseCoinAmountUse:u="0",showSelectNonceDialog:d=!1,onChainNonce:x="0",newNonce:a="0",userGasInfo:i={},serverGasInfo:p={},serverSignInfo:n={},originTxGasInfo:g={},fetchParams:t={},title:c="",text:e="",confirmText:h="",cancelText:_=""})=>new Promise((f,P)=>{if(d){let w=v.prompt({hideCloseBtn:!0,alignBottom:!1,titleCenter:!1,infoType:null,cancelBtnProps:{category:T.CATEGORY.outline,size:T.SIZE.lg},confirmBtnProps:{type:T.TYPE.highlight,size:T.SIZE.lg},confirmText:h,cancelText:_,onConfirm:async()=>{w.destroy();try{let m=await F({coinId:l,baseCoinAmountUse:u,userGasInfo:i,serverGasInfo:p,serverSignInfo:n,originTxGasInfo:g,fetchParams:t});f(m?{nonce:x,updateGasInfo:m}:{nonce:x})}catch(m){P(m)}},onCancel:()=>{w.destroy(),f({nonce:a})},renderContent:m=>L.default.createElement(m,null,L.default.createElement("div",{className:Z.content},L.default.createElement("div",{className:Z.title},c),L.default.createElement("div",{className:Z.text},e)))})}else f({nonce:a})})},j=Be;var Se=()=>{let F=j();return async({coinId:l,baseCoinAmountUse:u,hasFailedTx:d,onChainNonce:x,newNonce:a,userGasInfo:i,serverGasInfo:p,originTxGasInfo:n,serverSignInfo:g,fetchParams:t})=>F({coinId:l,baseCoinAmountUse:u,showSelectNonceDialog:d,onChainNonce:x,newNonce:a,userGasInfo:i,serverGasInfo:p,serverSignInfo:g,originTxGasInfo:n,fetchParams:t,title:o("wallet_extension_transaction_popup_failed_transaction"),text:o("wallet_extension_transaction_popup_replace_failed_transaction"),confirmText:o("wallet_extension_transaction_popup_btn_replace"),cancelText:o("wallet_extension_transaction_popup_btn_skip")})},he=Se;s();r();Y();var Le=()=>{let F=j();return async({coinId:l,baseCoinAmountUse:u,hasPendingTx:d,onChainNonce:x,newNonce:a,userGasInfo:i,serverGasInfo:p,originTxGasInfo:n,serverSignInfo:g,fetchParams:t})=>F({coinId:l,baseCoinAmountUse:u,showSelectNonceDialog:d,onChainNonce:x,newNonce:a,userGasInfo:i,serverGasInfo:p,serverSignInfo:g,fetchParams:t,originTxGasInfo:n,title:o("wallet_extension_transaction_popup_pending_transaction"),text:o("wallet_extension_transaction_popup_replace_pending_transaction"),confirmText:o("wallet_extension_transaction_popup_btn_replace"),cancelText:o("wallet_extension_transaction_popup_btn_continue_wait")})},Te=Le;s();r();Y();var ye=I(Ge());var He=()=>async({isRepeat:E,onCancel:l})=>new Promise((u,d)=>{if(E){let x=v.prompt({alignBottom:!1,hideCloseBtn:!0,infoType:v.Prompt.INFO_TYPE.warn,confirmBtnProps:{type:T.TYPE.highlight,size:T.SIZE.lg},cancelBtnProps:{category:T.CATEGORY.outline,size:T.SIZE.lg},title:o("wallet_extension_popup_repeat_order"),confirmText:o("wallet_extension_popup_repeat_order_btn_continue"),cancelText:l?o("wallet_extension_popup_repeat_order_btn_viewhistory"):null,text:o("wallet_extension_popup_repeat_order_desc"),onConfirm:()=>{x.destroy(),u()},onCancel:()=>{x.destroy(),(0,ye.isFunction)(l)&&l(),d(new Error(B))}})}else u()}),we=He;var Ce="FetchError";var Ut=()=>{let F=he(),E=Te(),l=we(),u=async({coinId:a,from:i,to:p,amount:n,gasPrice:g})=>{let[{data:t=[]},{data:c={}}]=await Promise.all([le({checkTypes:[z.REPEAT,z.OVERWRITTEN],coinId:a,from:i,to:p,amount:n,gasPrice:g}),re({coinId:a,address:i},{fromAddr:i,scenario:ae.SCENARIO_SEND_COIN})]);return{txToastCheckData:t,signInfoData:c}},d=a=>{let{hasFailedTx:i,hasPendingTx:p,nonce:n,newNonce:g,originGasPrice:t,originPriorityFee:c}=ue(a),e=_e(a,z.REPEAT);return{hasFailedTx:i,hasPendingTx:p,nonce:n,newNonce:g,originGasPrice:t,originPriorityFee:c,isRepeat:e}};return async({coinId:a,from:i,to:p,amount:n,gasPrice:g,baseCoinAmountUse:t,userGasInfo:c,whetherCheckRepeat:e,onRepeatCancel:h})=>{var O;let _=[],f={};try{let N=await u({coinId:a,from:i,to:p,amount:n,gasPrice:g});if(!Array.isArray(N.txToastCheckData)||typeof N.signInfoData!="object")throw new Error(Ce);_=N.txToastCheckData,f=((O=N.signInfoData)==null?void 0:O.info)||{}}catch{throw new Error(Ce)}let P=d(_),{nonce:w,newNonce:m,originGasPrice:D,originPriorityFee:S,hasFailedTx:H,hasPendingTx:b,isRepeat:R}=P,M={originGasPrice:D,originPriorityFee:S},A={coinId:a,baseCoinAmountUse:t,onChainNonce:w,newNonce:m,userGasInfo:c,serverGasInfo:f.gasPrice,serverSignInfo:f,originTxGasInfo:M,fetchParams:{amount:n,coinId:a,from:i,gasPrice:g,to:p}},k={nonce:m};return H?k=await F({...A,hasFailedTx:H}):b&&(k=await E({...A,hasPendingTx:b})),e&&await l({isRepeat:R,onCancel:h}),k}};export{Ut as a};

window.inOKXExtension = true;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=chunk-CAHNM26J.js.map
