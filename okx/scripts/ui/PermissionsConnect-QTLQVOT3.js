import{a as de}from"./chunk-NLMSL6KB.js";import{a as Ke}from"./chunk-NC54FPSJ.js";import{b as N}from"./chunk-D6O2GLPR.js";import{c as O}from"./chunk-2CPFAAZ7.js";import"./chunk-ZG26PGPF.js";import"./chunk-73YQ4YAD.js";import"./chunk-OEVJ7FDO.js";import"./chunk-ATUBFYS2.js";import{a as _e,b as Te}from"./chunk-CPWFRAFM.js";import{a as ze,b as He}from"./chunk-UXA3OASR.js";import{a as Ze,e as fe}from"./chunk-LEU7ZZNB.js";import"./chunk-2N2ADYFP.js";import"./chunk-2SGW2RXR.js";import{e as je}from"./chunk-U3YDJ2W7.js";import{a as le}from"./chunk-VCWU5FEX.js";import"./chunk-KZ77CGYD.js";import"./chunk-E73QHIZ6.js";import{e as ae}from"./chunk-E2KMZQ6K.js";import"./chunk-JXT6JCNO.js";import{c as Je}from"./chunk-DC2INDOF.js";import"./chunk-AHAXQBXQ.js";import"./chunk-DUZ4ULSN.js";import"./chunk-PGPPXRV7.js";import"./chunk-54GDJWA6.js";import"./chunk-UGYRJNZG.js";import"./chunk-PLVZLQPX.js";import"./chunk-QNVM7T5C.js";import"./chunk-7T7NBYQH.js";import"./chunk-FEET7RP6.js";import"./chunk-MBJ4MFYL.js";import"./chunk-PCY622ND.js";import"./chunk-NS35PZCP.js";import"./chunk-XOD56IFT.js";import"./chunk-BBN3UGKM.js";import"./chunk-5DEIKYJL.js";import"./chunk-QMNAWRVI.js";import"./chunk-D6ZXZUY6.js";import"./chunk-QMF5LKVF.js";import"./chunk-VMACN7YR.js";import"./chunk-IQVVVGEA.js";import{e as ie,f as ne}from"./chunk-2HWABU7H.js";import"./chunk-APEQZGKB.js";import"./chunk-AX4SXHC6.js";import"./chunk-UCS37WXR.js";import"./chunk-DUHXKIBS.js";import{b as Ye}from"./chunk-QNEJI55N.js";import"./chunk-5W7SRP5N.js";import{a as Ne,b as Ge}from"./chunk-YVRXETFX.js";import{i as Ve,m as me,o as ue,q as $}from"./chunk-GUWGENNL.js";import"./chunk-WYB2CUAN.js";import"./chunk-B2BOSVTW.js";import"./chunk-GUJXW3GJ.js";import{d as ke,f as Be,h as $e}from"./chunk-VIS7KIVI.js";import"./chunk-F64VYES3.js";import"./chunk-DHX2X277.js";import"./chunk-67YO4IPY.js";import"./chunk-DLUAVD7X.js";import"./chunk-WRWXCAEZ.js";import"./chunk-OZ6XSJY6.js";import"./chunk-DMJQUOJT.js";import"./chunk-MTMZQEHP.js";import"./chunk-NKTQMEXG.js";import"./chunk-62JDSRZZ.js";import"./chunk-FF7XOOGZ.js";import"./chunk-4OTZHHYZ.js";import"./chunk-HQT4AKFZ.js";import"./chunk-JUIB44FD.js";import{ba as We}from"./chunk-R6GCLTW2.js";import"./chunk-4KY5XQ5E.js";import"./chunk-S3ECGMEP.js";import"./chunk-PX7HII6H.js";import{i as ve,l as be}from"./chunk-UEO7AURD.js";import"./chunk-DXFO7P35.js";import{i as Fe}from"./chunk-TPEASXIF.js";import{a as pe}from"./chunk-JSAFBAMQ.js";import"./chunk-A336VZZF.js";import{b as B}from"./chunk-XEOGXIVD.js";import{a as ce}from"./chunk-PCGRDRHF.js";import{n as qe}from"./chunk-IU3TYIWS.js";import"./chunk-VPBQLZCI.js";import"./chunk-ERLETJMZ.js";import"./chunk-FRDOFRM7.js";import"./chunk-X2LENRE7.js";import{a as K,bb as se,h as w,j as v}from"./chunk-O4EDZSHP.js";import{k as xe}from"./chunk-HU3KBV5G.js";import{b as ee}from"./chunk-6ZPGW3YM.js";import{k as Ae,m as De,o as Ue}from"./chunk-ZKDHZDUE.js";import"./chunk-4UESFVD2.js";import"./chunk-D7KW4FFX.js";import"./chunk-RAXGEVRQ.js";import"./chunk-S4N75E3H.js";import"./chunk-7MX3OHNE.js";import"./chunk-2BSLA752.js";import"./chunk-FLCN6MAI.js";import"./chunk-YMZEQGAL.js";import"./chunk-7E3KY4EN.js";import{f as Se}from"./chunk-JIRWXBHS.js";import"./chunk-3TVEFIPW.js";import"./chunk-UXFKODVN.js";import"./chunk-IMRS4RGO.js";import"./chunk-52GWQSZH.js";import{a as te}from"./chunk-TPSXCUGD.js";import"./chunk-XKG5DY6K.js";import"./chunk-6PGLMYAE.js";import{g as oe,h as re}from"./chunk-RMQJRDTF.js";import{c as R}from"./chunk-2YLR7R2N.js";import"./chunk-MVLY6WUP.js";import"./chunk-ZEAKIEIQ.js";import"./chunk-5KSDRGLW.js";import"./chunk-DQTCC3FF.js";import"./chunk-O5LVHMPV.js";import{Bb as X,C as Q,D as we,La as j,Pa as Le,Vb as Me,Xb as Re,ec as lt,hc as Pe,nc as dt,v as E}from"./chunk-CVJKAN5R.js";import"./chunk-A5Y2KVNP.js";import{b as Oe}from"./chunk-GXQ645QR.js";import"./chunk-DQ2NYVYI.js";import"./chunk-C2H3SRET.js";import{a as W,f as Ee}from"./chunk-V4YVDLI4.js";import"./chunk-UXBKFN2U.js";import"./chunk-HCW4K7TR.js";import"./chunk-Z4JATHZR.js";import"./chunk-TW6D7CWA.js";import"./chunk-3T5D6KAV.js";import"./chunk-MAWXDEJZ.js";import"./chunk-Z37GURZ6.js";import"./chunk-IYYFWVWL.js";import"./chunk-CLSYGH6A.js";import"./chunk-DHRSDA7N.js";import"./chunk-RYNAOZ73.js";import"./chunk-Q34CQJXG.js";import"./chunk-GKHVFCKF.js";import{f as _,h as V,m,o as u}from"./chunk-6V2G2Z5W.js";m();u();m();u();var at=_(ee()),Z=_(Ee());Ue();m();u();var T=_(Ee()),q=_(W()),H=_(te());dt();lt();m();u();Q();var g=_(W());var G=_(ee());var Xe=_(te());m();u();var he=_(W());var Ce=_(ee());Ue();var Qe=_(te());Q();var ft=({props:o,isMpcError:r,dappSelectAccount:e,connectable:t})=>{let n=(0,Ce.useDispatch)(),{permissionsRequestId:c,targetDomainMetadata:p,cancelPermissionsRequest:a,approvePermissionsRequest:s}=o,h=p==null?void 0:p.origin,l=Ke(),I={actionType:O.ACTION_TYPE.CANCEL,async onClick(){l({trade:"connect_wallet",all_confirmation:"cancel"}),await a(c),await Ae(n)}},d=(0,Ce.useSelector)(Ve),[i,f]=(0,he.useState)({});(0,he.useEffect)(()=>{(async()=>{let A=await Ze({dappUrl:h});A[0]&&f(A[0])})()},[]);let C=async()=>{l({trade:"connect_wallet",all_confirmation:"confirm"});let{request:x}=o,A={...x,permissions:{...x.permissions}};Object.keys(A.permissions).length>0?(await s(A,e,d==null?void 0:d.type),e.length===1&&await n(Fe(e[0],!0)),ve({dapp_url:h}),(i==null?void 0:i.dappUrl)&&(i==null?void 0:i.provider)&&be({dappurl:i.dappUrl,connect_method:i.provider})):await a(A.metadata.id),await Ae(n)},M=(0,Qe.useHistory)(),S={actionType:O.ACTION_TYPE.CONFIRM,disabled:e.length===0&&!(d!=null&&d.type)||r,btnText:t?E("wallet_extension_connect_btn_connect"):E("wallet_extension_connect_btn_switch_wallet"),async onClick(){t?await C():M.push({pathname:`${w}/${c}${v}`})}};return[I,S]},Ie=ft;m();u();var ge=_(W());var ye=(o,r)=>{let[e,t]=(0,ge.useState)(!1);return(0,ge.useEffect)(()=>{(async()=>{if(o&&r){let{data:n}=await je({dappUrl:o});t(n.result)}})()},[o,r]),e};var Tt=o=>{let{targetDomainMetadata:r,permissionsRequestId:e,request:t}=o,n=xe(),c=(0,G.useDispatch)(),p=(0,Xe.useHistory)(),{selectedWallet:a}=(0,G.useSelector)(ue),s=(0,G.useSelector)(me),h=(0,G.useSelector)(U=>U.metamask.wallets||[]),l=(0,g.useMemo)(()=>s.some(U=>{var k;return((k=h.find(J=>J.walletId===U))==null?void 0:k.initialType)===oe.MPC_KEYRING}),[s,h]),I=ye(r==null?void 0:r.host,l),d=(0,g.useMemo)(()=>!I&&l,[l,I]),i=s[0]||a,{walletInfo:f,connectable:C,chainName:M}=fe({request:t,walletId:i}),S=Te(i);(0,g.useEffect)(()=>{!s.length&&C&&S&&c($.setSelectAccounts([a]))},[s,C,S,c,a]);let x=(0,g.useMemo)(()=>d?{type:N.TIP_TYPE.COMMON_ERROR,message:E("extension_wallet_error_toast_not_supported")}:C?{type:N.TIP_TYPE.NORMAL,message:E("wallet_dapp_conncetion_notify_conncet_permission")}:{type:N.TIP_TYPE.COMMON_WARN,message:E("wallet_extension_connect_alert_text_doesnt_support_network",{network:M})},[d,C,M]),A=Ie({props:o,isMpcError:d,dappSelectAccount:s,connectable:C});return g.default.createElement(R.Container,null,g.default.createElement(pe,{backable:!1,closeable:!1,title:n("wallet_dapp_conncetion_maintitle_conncet_account")}),g.default.createElement(ie,null,g.default.createElement(de,{...r})),g.default.createElement(ne,{targetDomainMetadata:r,permissionsRequestId:e,request:t,dappSelectAccount:s,walletInfo:f,connectable:C}),g.default.createElement(ce,{placeholder:!0,offsetBottom:0,borderTop:!0},g.default.createElement(N,{...x}),g.default.createElement(O,{buttonGroup:A})),(f==null?void 0:f.keyringIdentityType)===re.MPC&&g.default.createElement(_e,{keyringId:f.keyringId,actionMap:{["RECOVER"]:()=>{p.push(`${se}?action=${le.RECOVER}&walletId=${f.walletId}`)},["SWITCH_WALLET"]:()=>{p.push({pathname:`${w}/${e}${v}`})}}}))},et=Tt;m();u();var tt=_(W()),ot=(0,tt.lazy)(()=>import("./Comp-MPYCZUJC.js"));m();u();var L=_(W());Q();var D=_(Ee());m();u();var b={"permissions-redirect":"_permissions-redirect_1vo12_1",permissionsRedirect:"_permissions-redirect_1vo12_1","permissions-redirect-core":"_permissions-redirect-core_1vo12_5",permissionsRedirectCore:"_permissions-redirect-core_1vo12_5","permissions-redirect-core-siteIcon":"_permissions-redirect-core-siteIcon_1vo12_17",permissionsRedirectCoreSiteIcon:"_permissions-redirect-core-siteIcon_1vo12_17","permissions-redirect-core-checkIcon":"_permissions-redirect-core-checkIcon_1vo12_22",permissionsRedirectCoreCheckIcon:"_permissions-redirect-core-checkIcon_1vo12_22","permissions-redirect-core-line":"_permissions-redirect-core-line_1vo12_28",permissionsRedirectCoreLine:"_permissions-redirect-core-line_1vo12_28"};function z({domainMetadata:o}){return L.default.createElement(R.Container,{className:b["permissions-redirect"]},L.default.createElement(R.Space,{direction:R.DIRECTION.vertical,space:24,className:b["permissions-redirect-core"]},E("wallet_addwallet_notify_hardware_wallet_connecting"),L.default.createElement(R.FlexBox,{align:R.ALIGN.center},L.default.createElement(B,{size:B.SIZE.lg,src:o.icon,text:o.name,radius:!o.icon,className:b["permissions-redirect-core-siteIcon"]}),L.default.createElement(qe,{dashed:!0,direction:R.DIRECTION.horizontal,className:b["permissions-redirect-core-line"]}),L.default.createElement(B,{icon:"okx-wallet-plugin-check",className:b["permissions-redirect-core-checkIcon"]}),L.default.createElement(qe,{dashed:!0,direction:R.DIRECTION.horizontal,className:b["permissions-redirect-core-line"]}),L.default.createElement(B,{radius:!1,size:B.SIZE.lg,src:"/static/images/icon-64.png",className:b["permissions-redirect-core-siteIcon"]}))))}z.propTypes={domainMetadata:D.default.shape({extensionId:D.default.string,icon:D.default.string,host:D.default.string.isRequired,name:D.default.string.isRequired,origin:D.default.string.isRequired})};z.defaultProps={domainMetadata:{extensionId:"",icon:"",host:"",name:"",origin:""}};m();u();Q();Me();var y=_(W());var Y=_(ee());Le();var it=_(te());var nt=_(we());m();u();var rt=_(we());Me();Le();var ht=({props:o,isMpcError:r,dappSelectAccount:e,connectable:t,walletInfo:n={}})=>{var h;let{walletId:c,address:p}=n,a=Ie({props:o,isMpcError:r,dappSelectAccount:e,connectable:t}),s=(h=ae(j,c))==null?void 0:h.coinAmountInt;return!(0,rt.isNil)(s)&&X(s,0)&&(a[1]={actionType:O.ACTION_TYPE.FILL_UP,coinId:j,walletId:c,address:p,receiveOnly:!0}),a},st=ht;var Ct=o=>{var U;let{targetDomainMetadata:r,permissionsRequestId:e,request:t}=o,n=(0,Y.useDispatch)(),c=(0,it.useHistory)(),{selectedWallet:p}=(0,Y.useSelector)(ue),a=(0,Y.useSelector)(me),s=(0,Y.useSelector)(k=>k.metamask.wallets||[]),h=(0,y.useMemo)(()=>a.some(k=>{var J;return((J=s.find(ut=>ut.walletId===k))==null?void 0:J.initialType)===oe.MPC_KEYRING}),[a,s]),l=ye(r==null?void 0:r.host,h),I=(0,y.useMemo)(()=>!l&&h,[h,l]),d=a[0]||p,{walletInfo:i,connectable:f,chainName:C}=fe({request:t,walletId:d}),M=(U=ae(j,d))==null?void 0:U.coinAmountInt,S=Te(d);(0,y.useEffect)(()=>{!a.length&&f&&S&&n($.setSelectAccounts([p]))},[a,f,S,n,p]);let x=(0,y.useMemo)(()=>!(0,nt.isNil)(M)&&X(M,0)?{type:Oe.TYPE.warn,message:E("wallet_extension_conncetion_alert_add_more")}:I?{type:N.TIP_TYPE.COMMON_ERROR,message:E("extension_wallet_error_toast_not_supported")}:f?{type:N.TIP_TYPE.NORMAL,message:E("wallet_extension_conncetion_alert_check_balance")}:{type:N.TIP_TYPE.COMMON_WARN,message:E("wallet_extension_connect_alert_text_doesnt_support_network",{network:C})},[M,I,f,C]),A=st({props:o,isMpcError:I,dappSelectAccount:a,connectable:f,walletInfo:i});return y.default.createElement(R.Container,null,y.default.createElement(pe,{backable:!1,closeable:!1,title:E("wallet_dapp_conncetion_maintitle_conncet_account")}),y.default.createElement(ie,null,y.default.createElement(de,{...r})),y.default.createElement(ne,{request:t,walletInfo:i,connectable:f,dappSelectAccount:a,targetDomainMetadata:r,permissionsRequestId:e}),y.default.createElement(ce,{placeholder:!0,offsetBottom:0,borderTop:!0},y.default.createElement(N,{...x}),y.default.createElement(O,{buttonGroup:A})),(i==null?void 0:i.keyringIdentityType)===re.MPC&&y.default.createElement(_e,{keyringId:i.keyringId,actionMap:{["RECOVER"]:()=>{c.push(`${se}?action=${le.RECOVER}&walletId=${i.walletId}`)},["SWITCH_WALLET"]:()=>{c.push({pathname:`${w}/${e}${v}`})}}}))},ct=Ct;m();u();var It=1200,F=class extends q.Component{constructor(){super(...arguments);V(this,"state",{redirecting:!1,permissionsApproved:null,origin:this.props.origin,targetDomainMetadata:this.props.targetDomainMetadata||{}});V(this,"beforeUnload",()=>{let{permissionsRequestId:e,rejectPermissionsRequest:t,optType:n}=this.props,{permissionsApproved:c,origin:p}=this.state;c===null&&e&&n===Ne.connect&&t(e,p)});V(this,"removeBeforeUnload",()=>{Pe()===Re&&window.removeEventListener("beforeunload",this.beforeUnload)});V(this,"cancelPermissionsRequest",async e=>{let{rejectPermissionsRequest:t}=this.props,{origin:n}=this.state;e&&(await t(e,n),this.redirect(!1))})}componentDidMount(){let{getCurrentWindowTab:e,getRequestAccountTabIds:t,permissionsRequest:n,history:c}=this.props;if(e(),t(),!n){c.push(K);return}Pe()===Re&&window.addEventListener("beforeunload",this.beforeUnload)}static getDerivedStateFromProps(e,t){let{permissionsRequest:n,targetDomainMetadata:c}=e,{targetDomainMetadata:p}=t;return n&&p.origin!==(c==null?void 0:c.origin)?{targetDomainMetadata:c}:null}componentDidUpdate(e){var I,d;let{permissionsRequest:t,permissionsRequestId:n,firstPermissionsRequestId:c,lastConnectedInfo:p,history:a,optType:s}=this.props;if(n!==c||s!==Ne.connect){a.push(K);return}let{redirecting:h,origin:l}=this.state;if(!t&&e.permissionsRequest&&!h){let i=((I=p[l])==null?void 0:I.lastApproved)||0,f=((d=e.lastConnectedInfo[l])==null?void 0:d.lastApproved)||0,C=i>f;this.redirect(C)}}redirect(e){let{history:t}=this.props;this.setState({redirecting:!0,permissionsApproved:e}),this.removeBeforeUnload(),e?setTimeout(()=>t.push(K),It):t.push(K)}goBack(){let{history:e,connectPath:t}=this.props;e.push(t)}render(){let{approvePermissionsRequest:e,permissionsRequest:t,permissionsRequestId:n,connectPath:c,selectWalletPath:p,setDappConnectSuccess:a}=this.props,{permissionsApproved:s,redirecting:h,targetDomainMetadata:l}=this.state;return q.default.createElement("div",{className:"page-container permissions-connect"},h&&s?q.default.createElement(z,{domainMetadata:l}):q.default.createElement(H.Switch,null,q.default.createElement(H.Route,{path:p,exact:!0,render:()=>q.default.createElement(ot,{request:t||{}})}),q.default.createElement(H.Route,{path:c,exact:!0,render:()=>{var d;let I={request:t||{},cancelPermissionsRequest:i=>this.cancelPermissionsRequest(i),permissionsRequestId:n,targetDomainMetadata:l,approvePermissionsRequest:(...i)=>{e(...i),a(!0),setTimeout(()=>{a(!1)},2e3)}};return(d=t==null?void 0:t.exts)!=null&&d.needNearTempKeyPair?q.default.createElement(ct,{...I}):q.default.createElement(et,{...I})}})))}};F.propTypes={approvePermissionsRequest:T.default.func.isRequired,setDappConnectSuccess:T.default.func.isRequired,rejectPermissionsRequest:T.default.func.isRequired,getRequestAccountTabIds:T.default.func.isRequired,getCurrentWindowTab:T.default.func.isRequired,origin:T.default.string,permissionsRequest:T.default.object,lastConnectedInfo:T.default.object.isRequired,permissionsRequestId:T.default.string,history:T.default.object.isRequired,connectPath:T.default.string.isRequired,selectWalletPath:T.default.string.isRequired,targetDomainMetadata:T.default.shape({extensionId:T.default.string,icon:T.default.string,host:T.default.string.isRequired,name:T.default.string.isRequired,origin:T.default.string.isRequired})};F.defaultProps={origin:"",permissionsRequest:void 0,permissionsRequestId:"",targetDomainMetadata:{}};F.contextTypes={t:T.default.func};var pt=F;var gt=(o,r)=>{var f;let{match:{params:{id:e}}}=r,t=Be(o),n=$e(o),c=Ge(o),p=t.find(C=>C.metadata.id===e),{metadata:a={}}=p||{},{origin:s}=a,h=We(o),l=null;if(s)if(h[s])l={...h[s],origin:s},(f=l.icon)!=null||(l.icon=Se);else{let C=new URL(s);l={host:C.host,name:C.hostname,origin:s}}let I=ke(o)||{},d=`${w}/${e}`,i=`${w}/${e}${v}`;return{permissionsRequest:p,permissionsRequestId:e,firstPermissionsRequestId:n,origin:s,lastConnectedInfo:I,connectPath:d,selectWalletPath:i,targetDomainMetadata:l,optType:c}},yt=o=>({approvePermissionsRequest:(r,e,t)=>o(ze(r,e,t)),rejectPermissionsRequest:async(r,e)=>{await o(He(r,e)),await o(Ye())},getRequestAccountTabIds:()=>o(Je()),getCurrentWindowTab:()=>o(De()),setDappConnectSuccess:r=>o($.setDappFinish(r))}),mt=(0,at.connect)(gt,yt)(pt);mt.propTypes={history:Z.default.object.isRequired,match:Z.default.shape({params:Z.default.shape({id:Z.default.string}).isRequired}).isRequired};var Et=mt;export{Et as default};

window.inOKXExtension = true;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=PermissionsConnect-QTLQVOT3.js.map
