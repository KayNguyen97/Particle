import{a as Ji}from"./chunk-PJG4F6OY.js";import{a as yl,b as _l}from"./chunk-5YPTESHY.js";import{a as Gl,b as Hl,c as jl}from"./chunk-F6PQB74I.js";import{a as Dl,b as Fl}from"./chunk-YVK4X6SB.js";import{a as xl,b as Bl,c as Ul}from"./chunk-GBWEEXVS.js";import"./chunk-4AOAXYPU.js";import"./chunk-PZPHBKNA.js";import"./chunk-236QZ4T2.js";import"./chunk-P34A6LS4.js";import"./chunk-OCVOVZC6.js";import"./chunk-OYUD7NPL.js";import"./chunk-VEYNKMNX.js";import{a as Ml}from"./chunk-5RXQBXEZ.js";import"./chunk-6HDV4AIS.js";import"./chunk-HHT2ACSL.js";import"./chunk-IB4K3FN6.js";import"./chunk-NLMSL6KB.js";import"./chunk-R7OCQATX.js";import{a as Vl}from"./chunk-XVYL73ZA.js";import{c as ql}from"./chunk-T4PHD5ZN.js";import{a as Wl}from"./chunk-E5AYNHUH.js";import"./chunk-MIPXVBPR.js";import{a as Ll}from"./chunk-CAHNM26J.js";import"./chunk-HX3FTBPA.js";import"./chunk-NC54FPSJ.js";import"./chunk-IKPPHICM.js";import"./chunk-TLDPVFFH.js";import{a as fl,b as ml,c as Sl,d as gl}from"./chunk-HR4SA7Z5.js";import"./chunk-X43FDTPV.js";import{b as Nl}from"./chunk-MHASEPVA.js";import"./chunk-ZGEQVSMJ.js";import"./chunk-5OUYE6NE.js";import"./chunk-GQOO5OO7.js";import{f as hl}from"./chunk-WIOZQWEG.js";import{h as vl,l as Pl,p as kl,r as Rl}from"./chunk-DPVVGFWQ.js";import"./chunk-67PEY2GN.js";import"./chunk-JVE4G6JP.js";import{b as bl,d as Ol}from"./chunk-VNHZZRMI.js";import"./chunk-5TSD6WDE.js";import"./chunk-TPBDSGSX.js";import"./chunk-K24OHEUM.js";import{a as _f}from"./chunk-VP4TAC72.js";import{a as Al}from"./chunk-B7IEAGED.js";import"./chunk-7CYFCARW.js";import"./chunk-JEPC4J2M.js";import"./chunk-IFXL6RBY.js";import"./chunk-H5KDYYS6.js";import{a as Cl}from"./chunk-I2KPNTIF.js";import{b as dl}from"./chunk-MEW6SUUR.js";import{b as wl}from"./chunk-D6O2GLPR.js";import{a as Il}from"./chunk-2CPFAAZ7.js";import{a as ll}from"./chunk-ZG26PGPF.js";import"./chunk-HE77KLJ4.js";import"./chunk-NOZM7AA3.js";import"./chunk-73YQ4YAD.js";import"./chunk-OEVJ7FDO.js";import"./chunk-ATUBFYS2.js";import"./chunk-2N2ADYFP.js";import{a as Tl}from"./chunk-HG2HGCVV.js";import"./chunk-X2HBIQ56.js";import"./chunk-TYILG3ER.js";import{f as pl}from"./chunk-YLO74Q7W.js";import{a as El}from"./chunk-D54UDGZS.js";import"./chunk-2SGW2RXR.js";import"./chunk-ZXEHJOAD.js";import"./chunk-U3YDJ2W7.js";import"./chunk-VCWU5FEX.js";import"./chunk-KZ77CGYD.js";import"./chunk-7CB4COOY.js";import"./chunk-RDZIVMHO.js";import{a as al}from"./chunk-E73QHIZ6.js";import{c as il,e as sl}from"./chunk-E2KMZQ6K.js";import"./chunk-JXT6JCNO.js";import"./chunk-AHAXQBXQ.js";import{a as ht}from"./chunk-HGT5CHSG.js";import"./chunk-DUZ4ULSN.js";import{a as ul}from"./chunk-PGPPXRV7.js";import"./chunk-54GDJWA6.js";import"./chunk-UGYRJNZG.js";import"./chunk-PLVZLQPX.js";import"./chunk-QNVM7T5C.js";import"./chunk-7T7NBYQH.js";import"./chunk-FEET7RP6.js";import{a as cl}from"./chunk-MBJ4MFYL.js";import{a as Zi}from"./chunk-PCY622ND.js";import"./chunk-NS35PZCP.js";import"./chunk-XOD56IFT.js";import"./chunk-BBN3UGKM.js";import"./chunk-5DEIKYJL.js";import"./chunk-QMNAWRVI.js";import{d as yf}from"./chunk-D6ZXZUY6.js";import"./chunk-QMF5LKVF.js";import"./chunk-VMACN7YR.js";import{a as M,b as k,c as zi,d as Rt,e as Gu,f as Hu,h as ju,l as Sn,m as Qu}from"./chunk-FLA6IX6E.js";import{a as Uu,b as qu,c as nr,f as Ju,i as po,j as ho,k as Tn,l as yn,m as el,n as _n,q as In,r as Lt}from"./chunk-THYNIMEO.js";import{a as cn,b as Me,c as Pe,d as uu,e as bu,f as Ou,g as Ge,h as kt,i as P,k as Bu,l as Rr,m as Vu,n as Wu,q as Lr}from"./chunk-DYEVUST3.js";import{a as Ku,b as gn,c as $u,d as Yu,e as Xu,f as zu,g as Zu}from"./chunk-XU3WF5NB.js";import{$ as Iu,$a as q,A as ln,B as du,C as ao,D as pn,E as dn,Ea as kr,F as hu,Fa as hn,G as fu,Ga as fn,Ha as Pu,I as mu,K as se,La as Yi,M as or,N as co,Na as ku,Oa as Xi,Pa as Ru,Q as Su,Ra as Lu,S as gu,Sa as Nu,T as Tu,U as yu,Ua as mn,V as uo,W as _u,Wa as Mu,Xa as Du,Ya as Fu,Z as dt,Za as xu,_ as Hi,_a as Tf,a as lc,aa as vr,b as Et,ba as ji,c as Xr,ca as Qi,d as pc,e as Ae,ea as $e,f as Le,fa as Pr,g as Ct,h as dc,ha as Eu,i as U,ia as Ye,j as Te,k as H,l as Ke,la as Cu,m as wt,n as hc,na as $,o as ie,pa as Ki,r as le,ta as wu,u as lu,v as un,w as Pt,wa as $i,x as A,xa as lo,ya as Au,z as pu,za as vu}from"./chunk-LFVM5TW4.js";import{$ as Ar,$a as me,Ac as We,B,Bb as pt,Bc as he,C as Ir,Cc as ee,D as Er,Da as ue,Dc as so,E as _c,Ea as qe,F as Cr,Fa as Or,G as er,H as Pi,Ha as Di,I as to,J as Ic,K as tr,Ka as Fi,La as xi,Ma as bc,Mb as Nc,N as Ec,Na as Oc,Nb as Mc,O as Oe,Ob as Dc,P as At,Pb as Fc,Q as ki,Qb as xc,R as bt,Rb as Bc,S as wr,Sa as lt,Sb as sn,T as tn,Ta as oo,Tb as Uc,U as fe,Ua as Ne,Ub as qc,V as Ot,Va as R,Vb as Vc,Wa as nn,Wb as Wc,X as Ri,Xa as Bi,Xb as Gc,Y as rn,Ya as Ui,Yb as Hc,Z as on,Za as vc,Zb as jc,_ as rr,_a as Ve,a as Xo,ac as Qc,b as zo,bc as Kc,c as zr,ca as Li,cc as $c,d as Zr,da as Cc,e as Zo,ec as Vi,f as Jr,fc as Yc,g as Oi,gc as an,h as Jo,hc as Wi,i as eo,ib as no,ic as Xc,j as vi,ja as I,jb as W,jc as Gi,k as fc,ka as v,kb as _,kc as zc,la as S,lc as Zc,m as be,mb as Pc,mc as Jc,n as ye,na as wc,nc as eu,o as de,oa as Ni,oc as tu,pb as _e,pc as ru,q as mc,qb as ve,qc as ou,r as Sc,ra as N,rb as vt,rc as nu,sb as qi,sc as iu,t as J,tb as kc,tc as su,u as gc,ub as Rc,v as Tc,vc as au,wa as Mi,wc as cu,xa as Ac,y as en,ya as br,yb as Lc,z as yc,za as ro,zb as O,zc as io}from"./chunk-IQVVVGEA.js";import{V as Xa,W as za,t as wi,v as Ai}from"./chunk-P36YR3BB.js";import"./chunk-PGY6IZUS.js";import"./chunk-AXKCDQTS.js";import"./chunk-JWFSXEUV.js";import{b as $a}from"./chunk-PD2BTUUF.js";import"./chunk-YCMOAOGN.js";import"./chunk-JLLMIXPD.js";import{a as Sf}from"./chunk-UVVG5NXG.js";import{a as ca,b as ua}from"./chunk-YTINGM2Q.js";import"./chunk-AGVRLTFZ.js";import"./chunk-QJBKVZVF.js";import"./chunk-YIKS2AYL.js";import"./chunk-EXUJ54CX.js";import"./chunk-D5VZXMFP.js";import"./chunk-XAMN4IIH.js";import"./chunk-BTS2GOAC.js";import"./chunk-573GFXXJ.js";import{c as sc,d as ac,e as cc}from"./chunk-2HWABU7H.js";import"./chunk-APEQZGKB.js";import"./chunk-SI3RW2CS.js";import"./chunk-AX4SXHC6.js";import"./chunk-UCS37WXR.js";import"./chunk-DUHXKIBS.js";import"./chunk-QNEJI55N.js";import{d as Za,e as Ja}from"./chunk-5W7SRP5N.js";import"./chunk-YVRXETFX.js";import"./chunk-GUWGENNL.js";import"./chunk-WYB2CUAN.js";import{b as bi}from"./chunk-B2BOSVTW.js";import"./chunk-GUJXW3GJ.js";import"./chunk-VIS7KIVI.js";import"./chunk-F64VYES3.js";import"./chunk-DHX2X277.js";import"./chunk-67YO4IPY.js";import"./chunk-DLUAVD7X.js";import"./chunk-WRWXCAEZ.js";import"./chunk-OZ6XSJY6.js";import"./chunk-DMJQUOJT.js";import{c as tl,d as rl,e as En,i as ol,l as nl}from"./chunk-MTMZQEHP.js";import"./chunk-NKTQMEXG.js";import{i as ic}from"./chunk-62JDSRZZ.js";import"./chunk-FF7XOOGZ.js";import"./chunk-4OTZHHYZ.js";import"./chunk-HQT4AKFZ.js";import"./chunk-JUIB44FD.js";import{L as Ua,M as qa,N as Va,P as Wa,R as Ga,V as Ha,W as $o,ia as ja}from"./chunk-R6GCLTW2.js";import"./chunk-4KY5XQ5E.js";import"./chunk-S3ECGMEP.js";import"./chunk-PX7HII6H.js";import"./chunk-UEO7AURD.js";import{a as mf}from"./chunk-DXFO7P35.js";import"./chunk-TPEASXIF.js";import"./chunk-JSAFBAMQ.js";import"./chunk-A336VZZF.js";import"./chunk-XEOGXIVD.js";import{a as uc}from"./chunk-PCGRDRHF.js";import"./chunk-IU3TYIWS.js";import{b as rc,h as gf,j as oc,t as nc}from"./chunk-VPBQLZCI.js";import"./chunk-ERLETJMZ.js";import"./chunk-FRDOFRM7.js";import{s as ka}from"./chunk-X2LENRE7.js";import{Wa as tc,a as ec}from"./chunk-O4EDZSHP.js";import{c as La,e as Na}from"./chunk-HU3KBV5G.js";import{b as Ra}from"./chunk-6ZPGW3YM.js";import"./chunk-ZKDHZDUE.js";import"./chunk-4UESFVD2.js";import"./chunk-D7KW4FFX.js";import"./chunk-RAXGEVRQ.js";import{d as we,f as Si}from"./chunk-S4N75E3H.js";import"./chunk-7MX3OHNE.js";import"./chunk-2BSLA752.js";import"./chunk-FLCN6MAI.js";import{a as Ya,b as Yo}from"./chunk-YMZEQGAL.js";import"./chunk-7E3KY4EN.js";import"./chunk-JIRWXBHS.js";import"./chunk-3TVEFIPW.js";import{H as Ci,P as Ba,p as Fa,u as Ei,w as xa}from"./chunk-UXFKODVN.js";import{a as Qa}from"./chunk-IMRS4RGO.js";import"./chunk-52GWQSZH.js";import{a as It}from"./chunk-TPSXCUGD.js";import"./chunk-XKG5DY6K.js";import{a as Ka}from"./chunk-6PGLMYAE.js";import{h as Jt,i as Da}from"./chunk-RMQJRDTF.js";import{c as Ma}from"./chunk-2YLR7R2N.js";import{a as Pa,b as ff}from"./chunk-MVLY6WUP.js";import{b as wa,h as pf}from"./chunk-ZEAKIEIQ.js";import{a as Ii}from"./chunk-5KSDRGLW.js";import"./chunk-DQTCC3FF.js";import{b as Ea,f as Ca,g as uf}from"./chunk-O5LVHMPV.js";import{C as hi,D as fi,F as gi,Ga as _a,H as ha,Ia as Ti,Ib as ba,K as zt,L as Qe,N as fa,Pa as Zt,S as ma,T as Sa,Tb as Oa,V as Qo,Vb as va,Yb as yi,d as aa,e as af,ec as df,gb as _r,hc as _i,ma as ga,nc as hf,pa as Ta,qa as ya,rb as Ia,sb as Yr,tb as Aa,ub as Ko,v as Xt}from"./chunk-CVJKAN5R.js";import"./chunk-A5Y2KVNP.js";import{G as yr,H as F,i as pa,m as da}from"./chunk-GXQ645QR.js";import"./chunk-DQ2NYVYI.js";import{L as la,V as mi}from"./chunk-C2H3SRET.js";import{a as V}from"./chunk-V4YVDLI4.js";import"./chunk-5QFBGARG.js";import"./chunk-AF33U5YO.js";import"./chunk-AMJPJAQW.js";import"./chunk-F2CV7BH6.js";import"./chunk-XRV6EHVP.js";import"./chunk-UXBKFN2U.js";import"./chunk-HCW4K7TR.js";import"./chunk-Z4JATHZR.js";import"./chunk-TW6D7CWA.js";import"./chunk-3T5D6KAV.js";import"./chunk-MAWXDEJZ.js";import"./chunk-Z37GURZ6.js";import{b as cf}from"./chunk-IYYFWVWL.js";import"./chunk-ZRKMRDGI.js";import"./chunk-K2CHCG7Q.js";import"./chunk-3FBBK33H.js";import"./chunk-KTHMEYYS.js";import"./chunk-GT57MMCB.js";import"./chunk-HIGM7FFU.js";import"./chunk-7KAK6IL3.js";import"./chunk-CLSYGH6A.js";import"./chunk-L5SQCUFB.js";import"./chunk-DHRSDA7N.js";import{p as lf}from"./chunk-RYNAOZ73.js";import"./chunk-PR4SLUV4.js";import"./chunk-Q34CQJXG.js";import{d as di}from"./chunk-GKHVFCKF.js";import{c as K,f as w,h as s,l as process,m as u,n as f,o as l}from"./chunk-6V2G2Z5W.js";var He=K(Bt=>{"use strict";u();l();Object.defineProperty(Bt,"__esModule",{value:!0});Bt.testnet=Bt.regtest=Bt.bitcoin=void 0;Bt.bitcoin={messagePrefix:`Bitcoin Signed Message:
`,bech32:"bc",bip32:{public:76067358,private:76066276},pubKeyHash:0,scriptHash:5,wif:128};Bt.regtest={messagePrefix:`Bitcoin Signed Message:
`,bech32:"bcrt",bip32:{public:70617039,private:70615956},pubKeyHash:111,scriptHash:196,wif:239};Bt.testnet={messagePrefix:`Bitcoin Signed Message:
`,bech32:"tb",bip32:{public:70617039,private:70615956},pubKeyHash:111,scriptHash:196,wif:239}});var fs=K(Ut=>{"use strict";u();l();Object.defineProperty(Ut,"__esModule",{value:!0});Ut.encode=Ut.decode=Ut.check=void 0;function em(r){if(r.length<8||r.length>72||r[0]!==48||r[1]!==r.length-2||r[2]!==2)return!1;let e=r[3];if(e===0||5+e>=r.length||r[4+e]!==2)return!1;let t=r[5+e];return!(t===0||6+e+t!==r.length||r[4]&128||e>1&&r[4]===0&&!(r[5]&128)||r[e+6]&128||t>1&&r[e+6]===0&&!(r[e+7]&128))}Ut.check=em;function tm(r){if(r.length<8)throw new Error("DER sequence length is too short");if(r.length>72)throw new Error("DER sequence length is too long");if(r[0]!==48)throw new Error("Expected DER sequence");if(r[1]!==r.length-2)throw new Error("DER sequence length is invalid");if(r[2]!==2)throw new Error("Expected DER integer");let e=r[3];if(e===0)throw new Error("R length is zero");if(5+e>=r.length)throw new Error("R length is too long");if(r[4+e]!==2)throw new Error("Expected DER integer (2)");let t=r[5+e];if(t===0)throw new Error("S length is zero");if(6+e+t!==r.length)throw new Error("S length is invalid");if(r[4]&128)throw new Error("R value is negative");if(e>1&&r[4]===0&&!(r[5]&128))throw new Error("R value excessively padded");if(r[e+6]&128)throw new Error("S value is negative");if(t>1&&r[e+6]===0&&!(r[e+7]&128))throw new Error("S value excessively padded");return{r:r.slice(4,4+e),s:r.slice(6+e)}}Ut.decode=tm;function rm(r,e){let t=r.length,o=e.length;if(t===0)throw new Error("R length is zero");if(o===0)throw new Error("S length is zero");if(t>33)throw new Error("R length is too long");if(o>33)throw new Error("S length is too long");if(r[0]&128)throw new Error("R value is negative");if(e[0]&128)throw new Error("S value is negative");if(t>1&&r[0]===0&&!(r[1]&128))throw new Error("R value excessively padded");if(o>1&&e[0]===0&&!(e[1]&128))throw new Error("S value excessively padded");let n=f.Buffer.allocUnsafe(6+t+o);return n[0]=48,n[1]=n.length-2,n[2]=2,n[3]=r.length,r.copy(n,4),n[4+t]=2,n[5+t]=e.length,e.copy(n,6+t),n}Ut.encode=rm});var Ss=K(Nr=>{"use strict";u();l();Object.defineProperty(Nr,"__esModule",{value:!0});Nr.REVERSE_OPS=Nr.OPS=void 0;var ms={OP_FALSE:0,OP_0:0,OP_DATA_1:1,OP_PUSHDATA1:76,OP_PUSHDATA2:77,OP_PUSHDATA4:78,OP_1NEGATE:79,OP_RESERVED:80,OP_TRUE:81,OP_1:81,OP_2:82,OP_3:83,OP_4:84,OP_5:85,OP_6:86,OP_7:87,OP_8:88,OP_9:89,OP_10:90,OP_11:91,OP_12:92,OP_13:93,OP_14:94,OP_15:95,OP_16:96,OP_NOP:97,OP_VER:98,OP_IF:99,OP_NOTIF:100,OP_VERIF:101,OP_VERNOTIF:102,OP_ELSE:103,OP_ENDIF:104,OP_VERIFY:105,OP_RETURN:106,OP_TOALTSTACK:107,OP_FROMALTSTACK:108,OP_2DROP:109,OP_2DUP:110,OP_3DUP:111,OP_2OVER:112,OP_2ROT:113,OP_2SWAP:114,OP_IFDUP:115,OP_DEPTH:116,OP_DROP:117,OP_DUP:118,OP_NIP:119,OP_OVER:120,OP_PICK:121,OP_ROLL:122,OP_ROT:123,OP_SWAP:124,OP_TUCK:125,OP_CAT:126,OP_SUBSTR:127,OP_LEFT:128,OP_RIGHT:129,OP_SIZE:130,OP_INVERT:131,OP_AND:132,OP_OR:133,OP_XOR:134,OP_EQUAL:135,OP_EQUALVERIFY:136,OP_RESERVED1:137,OP_RESERVED2:138,OP_1ADD:139,OP_1SUB:140,OP_2MUL:141,OP_2DIV:142,OP_NEGATE:143,OP_ABS:144,OP_NOT:145,OP_0NOTEQUAL:146,OP_ADD:147,OP_SUB:148,OP_MUL:149,OP_DIV:150,OP_MOD:151,OP_LSHIFT:152,OP_RSHIFT:153,OP_BOOLAND:154,OP_BOOLOR:155,OP_NUMEQUAL:156,OP_NUMEQUALVERIFY:157,OP_NUMNOTEQUAL:158,OP_LESSTHAN:159,OP_GREATERTHAN:160,OP_LESSTHANOREQUAL:161,OP_GREATERTHANOREQUAL:162,OP_MIN:163,OP_MAX:164,OP_WITHIN:165,OP_RIPEMD160:166,OP_SHA1:167,OP_SHA256:168,OP_HASH160:169,OP_HASH256:170,OP_CODESEPARATOR:171,OP_CHECKSIG:172,OP_CHECKSIGVERIFY:173,OP_CHECKMULTISIG:174,OP_CHECKMULTISIGVERIFY:175,OP_NOP1:176,OP_NOP2:177,OP_CHECKLOCKTIMEVERIFY:177,OP_NOP3:178,OP_CHECKSEQUENCEVERIFY:178,OP_NOP4:179,OP_NOP5:180,OP_NOP6:181,OP_NOP7:182,OP_NOP8:183,OP_NOP9:184,OP_NOP10:185,OP_CHECKSIGADD:186,OP_PUBKEYHASH:253,OP_PUBKEY:254,OP_INVALIDOPCODE:255};Nr.OPS=ms;var jp={};Nr.REVERSE_OPS=jp;for(let r of Object.keys(ms)){let e=ms[r];jp[e]=r}});var Kp=K(Vt=>{"use strict";u();l();Object.defineProperty(Vt,"__esModule",{value:!0});Vt.decode=Vt.encode=Vt.encodingLength=void 0;var qt=Ss();function Qp(r){return r<qt.OPS.OP_PUSHDATA1?1:r<=255?2:r<=65535?3:5}Vt.encodingLength=Qp;function om(r,e,t){let o=Qp(e);return o===1?r.writeUInt8(e,t):o===2?(r.writeUInt8(qt.OPS.OP_PUSHDATA1,t),r.writeUInt8(e,t+1)):o===3?(r.writeUInt8(qt.OPS.OP_PUSHDATA2,t),r.writeUInt16LE(e,t+1)):(r.writeUInt8(qt.OPS.OP_PUSHDATA4,t),r.writeUInt32LE(e,t+1)),o}Vt.encode=om;function nm(r,e){let t=r.readUInt8(e),o,n;if(t<qt.OPS.OP_PUSHDATA1)o=t,n=1;else if(t===qt.OPS.OP_PUSHDATA1){if(e+2>r.length)return null;o=r.readUInt8(e+1),n=2}else if(t===qt.OPS.OP_PUSHDATA2){if(e+3>r.length)return null;o=r.readUInt16LE(e+1),n=3}else{if(e+5>r.length)return null;if(t!==qt.OPS.OP_PUSHDATA4)throw new Error("Unexpected opcode");o=r.readUInt32LE(e+1),n=5}return{opcode:t,number:o,size:n}}Vt.decode=nm});var $p=K(Mr=>{"use strict";u();l();Object.defineProperty(Mr,"__esModule",{value:!0});Mr.encode=Mr.decode=void 0;function im(r,e,t){e=e||4,t=t===void 0?!0:t;let o=r.length;if(o===0)return 0;if(o>e)throw new TypeError("Script number overflow");if(t&&(r[o-1]&127)===0&&(o<=1||(r[o-2]&128)===0))throw new Error("Non-minimally encoded script number");if(o===5){let i=r.readUInt32LE(0),a=r.readUInt8(4);return a&128?-((a&-129)*4294967296+i):a*4294967296+i}let n=0;for(let i=0;i<o;++i)n|=r[i]<<8*i;return r[o-1]&128?-(n&~(128<<8*(o-1))):n}Mr.decode=im;function sm(r){return r>2147483647?5:r>8388607?4:r>32767?3:r>127?2:r>0?1:0}function am(r){let e=Math.abs(r),t=sm(e),o=f.Buffer.allocUnsafe(t),n=r<0;for(let i=0;i<t;++i)o.writeUInt8(e&255,i),e>>=8;return o[t-1]&128?o.writeUInt8(n?128:0,t-1):n&&(o[t-1]|=128),o}Mr.encode=am});var Ie=K(E=>{"use strict";u();l();Object.defineProperty(E,"__esModule",{value:!0});E.oneOf=E.Null=E.BufferN=E.Function=E.UInt32=E.UInt8=E.tuple=E.maybe=E.Hex=E.Buffer=E.String=E.Boolean=E.Array=E.Number=E.Hash256bit=E.Hash160bit=E.Buffer256bit=E.isTaptree=E.isTapleaf=E.TAPLEAF_VERSION_MASK=E.Satoshi=E.Signer=E.BIP32Path=E.UInt31=E.isPoint=E.typeforce=void 0;var Fn=di(),z=ht();Object.defineProperty(E,"typeforce",{enumerable:!0,get:function(){return z.typeforce}});var Yp=Fn.Buffer.alloc(32,0),Xp=Fn.Buffer.from("fffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f","hex");function cm(r){if(!Fn.Buffer.isBuffer(r)||r.length<33)return!1;let e=r[0],t=r.slice(1,33);if(t.compare(Yp)===0||t.compare(Xp)>=0)return!1;if((e===2||e===3)&&r.length===33)return!0;let o=r.slice(33);return o.compare(Yp)===0||o.compare(Xp)>=0?!1:e===4&&r.length===65}E.isPoint=cm;var um=Math.pow(2,31)-1;function lm(r){return z.typeforce.UInt32(r)&&r<=um}E.UInt31=lm;function zp(r){return z.typeforce.String(r)&&!!r.match(/^(m\/)?(\d+'?\/)*\d+'?$/)}E.BIP32Path=zp;zp.toJSON=()=>"BIP32 derivation path";function pm(r){return(z.typeforce.Buffer(r.publicKey)||typeof r.getPublicKey=="function")&&typeof r.sign=="function"}E.Signer=pm;var dm=21*1e14;function hm(r){return z.typeforce.UInt53(r)&&r<=dm}E.Satoshi=hm;E.TAPLEAF_VERSION_MASK=254;function Zp(r){return!r||!("output"in r)||!Fn.Buffer.isBuffer(r.output)?!1:r.version!==void 0?(r.version&E.TAPLEAF_VERSION_MASK)===r.version:!0}E.isTapleaf=Zp;function Jp(r){return(0,E.Array)(r)?r.length!==2?!1:r.every(e=>Jp(e)):Zp(r)}E.isTaptree=Jp;E.Buffer256bit=z.typeforce.BufferN(32);E.Hash160bit=z.typeforce.BufferN(20);E.Hash256bit=z.typeforce.BufferN(32);E.Number=z.typeforce.Number;E.Array=z.typeforce.Array;E.Boolean=z.typeforce.Boolean;E.String=z.typeforce.String;E.Buffer=z.typeforce.Buffer;E.Hex=z.typeforce.Hex;E.maybe=z.typeforce.maybe;E.tuple=z.typeforce.tuple;E.UInt8=z.typeforce.UInt8;E.UInt32=z.typeforce.UInt32;E.Function=z.typeforce.Function;E.BufferN=z.typeforce.BufferN;E.Null=z.typeforce.Null;E.oneOf=z.typeforce.oneOf});var id=K(xe=>{"use strict";u();l();var fm=xe&&xe.__createBinding||(Object.create?function(r,e,t,o){o===void 0&&(o=t);var n=Object.getOwnPropertyDescriptor(e,t);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,o,n)}:function(r,e,t,o){o===void 0&&(o=t),r[o]=e[t]}),mm=xe&&xe.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),od=xe&&xe.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&fm(e,r,t);return mm(e,r),e};Object.defineProperty(xe,"__esModule",{value:!0});xe.encode=xe.decode=void 0;var nd=od(fs()),gs=od(Ie()),{typeforce:Sm}=gs,ed=f.Buffer.alloc(1,0);function td(r){let e=0;for(;r[e]===0;)++e;return e===r.length?ed:(r=r.slice(e),r[0]&128?f.Buffer.concat([ed,r],1+r.length):r)}function rd(r){r[0]===0&&(r=r.slice(1));let e=f.Buffer.alloc(32,0),t=Math.max(0,32-r.length);return r.copy(e,t),e}function gm(r){let e=r.readUInt8(r.length-1),t=e&-193;if(t<=0||t>=4)throw new Error("Invalid hashType "+e);let o=nd.decode(r.slice(0,-1)),n=rd(o.r),i=rd(o.s);return{signature:f.Buffer.concat([n,i],64),hashType:e}}xe.decode=gm;function Tm(r,e){Sm({signature:gs.BufferN(64),hashType:gs.UInt8},{signature:r,hashType:e});let t=e&-193;if(t<=0||t>=4)throw new Error("Invalid hashType "+e);let o=f.Buffer.allocUnsafe(1);o.writeUInt8(e,0);let n=td(r.slice(0,32)),i=td(r.slice(32,64));return f.Buffer.concat([nd.encode(n,i),o])}xe.encode=Tm});var ze=K(x=>{"use strict";u();l();var ym=x&&x.__createBinding||(Object.create?function(r,e,t,o){o===void 0&&(o=t);var n=Object.getOwnPropertyDescriptor(e,t);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,o,n)}:function(r,e,t,o){o===void 0&&(o=t),r[o]=e[t]}),_m=x&&x.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Po=x&&x.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&ym(e,r,t);return _m(e,r),e};Object.defineProperty(x,"__esModule",{value:!0});x.signature=x.number=x.isCanonicalScriptSignature=x.isDefinedHashType=x.isCanonicalPubKey=x.toStack=x.fromASM=x.toASM=x.decompile=x.compile=x.isPushOnly=x.OPS=void 0;var Im=Po(fs()),Ee=Ss();Object.defineProperty(x,"OPS",{enumerable:!0,get:function(){return Ee.OPS}});var Ts=Po(Kp()),sd=Po($p()),Em=Po(id()),Xe=Po(Ie()),{typeforce:vo}=Xe,ad=Ee.OPS.OP_RESERVED;function Cm(r){return Xe.Number(r)&&(r===Ee.OPS.OP_0||r>=Ee.OPS.OP_1&&r<=Ee.OPS.OP_16||r===Ee.OPS.OP_1NEGATE)}function wm(r){return Xe.Buffer(r)||Cm(r)}function cd(r){return Xe.Array(r)&&r.every(wm)}x.isPushOnly=cd;function xn(r){if(r.length===0)return Ee.OPS.OP_0;if(r.length===1){if(r[0]>=1&&r[0]<=16)return ad+r[0];if(r[0]===129)return Ee.OPS.OP_1NEGATE}}function ud(r){return f.Buffer.isBuffer(r)}function Am(r){return Xe.Array(r)}function Bn(r){return f.Buffer.isBuffer(r)}function ld(r){if(ud(r))return r;vo(Xe.Array,r);let e=r.reduce((n,i)=>Bn(i)?i.length===1&&xn(i)!==void 0?n+1:n+Ts.encodingLength(i.length)+i.length:n+1,0),t=f.Buffer.allocUnsafe(e),o=0;if(r.forEach(n=>{if(Bn(n)){let i=xn(n);if(i!==void 0){t.writeUInt8(i,o),o+=1;return}o+=Ts.encode(t,n.length,o),n.copy(t,o),o+=n.length}else t.writeUInt8(n,o),o+=1}),o!==t.length)throw new Error("Could not decode chunks");return t}x.compile=ld;function ys(r){if(Am(r))return r;vo(Xe.Buffer,r);let e=[],t=0;for(;t<r.length;){let o=r[t];if(o>Ee.OPS.OP_0&&o<=Ee.OPS.OP_PUSHDATA4){let n=Ts.decode(r,t);if(n===null||(t+=n.size,t+n.number>r.length))return null;let i=r.slice(t,t+n.number);t+=n.number;let a=xn(i);a!==void 0?e.push(a):e.push(i)}else e.push(o),t+=1}return e}x.decompile=ys;function bm(r){return ud(r)&&(r=ys(r)),r.map(e=>{if(Bn(e)){let t=xn(e);if(t===void 0)return e.toString("hex");e=t}return Ee.REVERSE_OPS[e]}).join(" ")}x.toASM=bm;function Om(r){return vo(Xe.String,r),ld(r.split(" ").map(e=>Ee.OPS[e]!==void 0?Ee.OPS[e]:(vo(Xe.Hex,e),f.Buffer.from(e,"hex"))))}x.fromASM=Om;function vm(r){return r=ys(r),vo(cd,r),r.map(e=>Bn(e)?e:e===Ee.OPS.OP_0?f.Buffer.allocUnsafe(0):sd.encode(e-ad))}x.toStack=vm;function Pm(r){return Xe.isPoint(r)}x.isCanonicalPubKey=Pm;function pd(r){let e=r;return e&128&&(e=e&-129),e&64&&(e=e&-65),e>0&&e<4}x.isDefinedHashType=pd;function km(r){return!f.Buffer.isBuffer(r)||!pd(r[r.length-1])?!1:Im.check(r.slice(0,-1))}x.isCanonicalScriptSignature=km;x.number=sd;x.signature=Em});var ft=K(Dr=>{"use strict";u();l();Object.defineProperty(Dr,"__esModule",{value:!0});Dr.value=Dr.prop=void 0;function Rm(r,e,t){Object.defineProperty(r,e,{configurable:!0,enumerable:!0,get(){let o=t.call(this);return this[e]=o,o},set(o){Object.defineProperty(this,e,{configurable:!0,enumerable:!0,value:o,writable:!0})}})}Dr.prop=Rm;function Lm(r){let e;return()=>(e!==void 0||(e=r()),e)}Dr.value=Lm});var md=K(Ze=>{"use strict";u();l();var Nm=Ze&&Ze.__createBinding||(Object.create?function(r,e,t,o){o===void 0&&(o=t);var n=Object.getOwnPropertyDescriptor(e,t);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,o,n)}:function(r,e,t,o){o===void 0&&(o=t),r[o]=e[t]}),Mm=Ze&&Ze.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),fd=Ze&&Ze.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Nm(e,r,t);return Mm(e,r),e};Object.defineProperty(Ze,"__esModule",{value:!0});Ze.p2data=void 0;var Dm=He(),Un=fd(ze()),mt=Ie(),dd=fd(ft()),hd=Un.OPS;function Fm(r,e){return r.length!==e.length?!1:r.every((t,o)=>t.equals(e[o]))}function xm(r,e){if(!r.data&&!r.output)throw new TypeError("Not enough data");e=Object.assign({validate:!0},e||{}),(0,mt.typeforce)({network:mt.typeforce.maybe(mt.typeforce.Object),output:mt.typeforce.maybe(mt.typeforce.Buffer),data:mt.typeforce.maybe(mt.typeforce.arrayOf(mt.typeforce.Buffer))},r);let t=r.network||Dm.bitcoin,o={name:"embed",network:t};if(dd.prop(o,"output",()=>{if(!!r.data)return Un.compile([hd.OP_RETURN].concat(r.data))}),dd.prop(o,"data",()=>{if(!!r.output)return Un.decompile(r.output).slice(1)}),e.validate&&r.output){let n=Un.decompile(r.output);if(n[0]!==hd.OP_RETURN)throw new TypeError("Output is invalid");if(!n.slice(1).every(mt.typeforce.Buffer))throw new TypeError("Output is invalid");if(r.data&&!Fm(r.data,o.data))throw new TypeError("Data mismatch")}return Object.assign(o,r)}Ze.p2data=xm});var Td=K(Je=>{"use strict";u();l();var Bm=Je&&Je.__createBinding||(Object.create?function(r,e,t,o){o===void 0&&(o=t);var n=Object.getOwnPropertyDescriptor(e,t);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,o,n)}:function(r,e,t,o){o===void 0&&(o=t),r[o]=e[t]}),Um=Je&&Je.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),gd=Je&&Je.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Bm(e,r,t);return Um(e,r),e};Object.defineProperty(Je,"__esModule",{value:!0});Je.p2ms=void 0;var qm=He(),Fr=gd(ze()),oe=Ie(),Wt=gd(ft()),xr=Fr.OPS,qn=xr.OP_RESERVED;function Sd(r,e){return r.length!==e.length?!1:r.every((t,o)=>t.equals(e[o]))}function Vm(r,e){if(!r.input&&!r.output&&!(r.pubkeys&&r.m!==void 0)&&!r.signatures)throw new TypeError("Not enough data");e=Object.assign({validate:!0},e||{});function t(p){return Fr.isCanonicalScriptSignature(p)||(e.allowIncomplete&&p===xr.OP_0)!==void 0}(0,oe.typeforce)({network:oe.typeforce.maybe(oe.typeforce.Object),m:oe.typeforce.maybe(oe.typeforce.Number),n:oe.typeforce.maybe(oe.typeforce.Number),output:oe.typeforce.maybe(oe.typeforce.Buffer),pubkeys:oe.typeforce.maybe(oe.typeforce.arrayOf(oe.isPoint)),signatures:oe.typeforce.maybe(oe.typeforce.arrayOf(t)),input:oe.typeforce.maybe(oe.typeforce.Buffer)},r);let n={network:r.network||qm.bitcoin},i=[],a=!1;function c(p){a||(a=!0,i=Fr.decompile(p),n.m=i[0]-qn,n.n=i[i.length-2]-qn,n.pubkeys=i.slice(1,-2))}if(Wt.prop(n,"output",()=>{if(!!r.m&&!!n.n&&!!r.pubkeys)return Fr.compile([].concat(qn+r.m,r.pubkeys,qn+n.n,xr.OP_CHECKMULTISIG))}),Wt.prop(n,"m",()=>{if(!!n.output)return c(n.output),n.m}),Wt.prop(n,"n",()=>{if(!!n.pubkeys)return n.pubkeys.length}),Wt.prop(n,"pubkeys",()=>{if(!!r.output)return c(r.output),n.pubkeys}),Wt.prop(n,"signatures",()=>{if(!!r.input)return Fr.decompile(r.input).slice(1)}),Wt.prop(n,"input",()=>{if(!!r.signatures)return Fr.compile([xr.OP_0].concat(r.signatures))}),Wt.prop(n,"witness",()=>{if(!!n.input)return[]}),Wt.prop(n,"name",()=>{if(!(!n.m||!n.n))return`p2ms(${n.m} of ${n.n})`}),e.validate){if(r.output){if(c(r.output),!oe.typeforce.Number(i[0]))throw new TypeError("Output is invalid");if(!oe.typeforce.Number(i[i.length-2]))throw new TypeError("Output is invalid");if(i[i.length-1]!==xr.OP_CHECKMULTISIG)throw new TypeError("Output is invalid");if(n.m<=0||n.n>16||n.m>n.n||n.n!==i.length-3)throw new TypeError("Output is invalid");if(!n.pubkeys.every(p=>(0,oe.isPoint)(p)))throw new TypeError("Output is invalid");if(r.m!==void 0&&r.m!==n.m)throw new TypeError("m mismatch");if(r.n!==void 0&&r.n!==n.n)throw new TypeError("n mismatch");if(r.pubkeys&&!Sd(r.pubkeys,n.pubkeys))throw new TypeError("Pubkeys mismatch")}if(r.pubkeys){if(r.n!==void 0&&r.n!==r.pubkeys.length)throw new TypeError("Pubkey count mismatch");if(n.n=r.pubkeys.length,n.n<n.m)throw new TypeError("Pubkey count cannot be less than m")}if(r.signatures){if(r.signatures.length<n.m)throw new TypeError("Not enough signatures provided");if(r.signatures.length>n.m)throw new TypeError("Too many signatures provided")}if(r.input){if(r.input[0]!==xr.OP_0)throw new TypeError("Input is invalid");if(n.signatures.length===0||!n.signatures.every(t))throw new TypeError("Input has invalid signature(s)");if(r.signatures&&!Sd(r.signatures,n.signatures))throw new TypeError("Signature mismatch");if(r.m!==void 0&&r.m!==r.signatures.length)throw new TypeError("Signature count mismatch")}}return Object.assign(n,r)}Je.p2ms=Vm});var Id=K(et=>{"use strict";u();l();var Wm=et&&et.__createBinding||(Object.create?function(r,e,t,o){o===void 0&&(o=t);var n=Object.getOwnPropertyDescriptor(e,t);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,o,n)}:function(r,e,t,o){o===void 0&&(o=t),r[o]=e[t]}),Gm=et&&et.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),_d=et&&et.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Wm(e,r,t);return Gm(e,r),e};Object.defineProperty(et,"__esModule",{value:!0});et.p2pk=void 0;var Hm=He(),Ur=_d(ze()),je=Ie(),Br=_d(ft()),yd=Ur.OPS;function jm(r,e){if(!r.input&&!r.output&&!r.pubkey&&!r.input&&!r.signature)throw new TypeError("Not enough data");e=Object.assign({validate:!0},e||{}),(0,je.typeforce)({network:je.typeforce.maybe(je.typeforce.Object),output:je.typeforce.maybe(je.typeforce.Buffer),pubkey:je.typeforce.maybe(je.isPoint),signature:je.typeforce.maybe(Ur.isCanonicalScriptSignature),input:je.typeforce.maybe(je.typeforce.Buffer)},r);let t=Br.value(()=>Ur.decompile(r.input)),o=r.network||Hm.bitcoin,n={name:"p2pk",network:o};if(Br.prop(n,"output",()=>{if(!!r.pubkey)return Ur.compile([r.pubkey,yd.OP_CHECKSIG])}),Br.prop(n,"pubkey",()=>{if(!!r.output)return r.output.slice(1,-1)}),Br.prop(n,"signature",()=>{if(!!r.input)return t()[0]}),Br.prop(n,"input",()=>{if(!!r.signature)return Ur.compile([r.signature])}),Br.prop(n,"witness",()=>{if(!!n.input)return[]}),e.validate){if(r.output){if(r.output[r.output.length-1]!==yd.OP_CHECKSIG)throw new TypeError("Output is invalid");if(!(0,je.isPoint)(n.pubkey))throw new TypeError("Output pubkey is invalid");if(r.pubkey&&!r.pubkey.equals(n.pubkey))throw new TypeError("Pubkey mismatch")}if(r.signature&&r.input&&!r.input.equals(n.input))throw new TypeError("Signature mismatch");if(r.input){if(t().length!==1)throw new TypeError("Input is invalid");if(!Ur.isCanonicalScriptSignature(n.signature))throw new TypeError("Input has invalid signature")}}return Object.assign(n,r)}et.p2pk=jm});var Vr=K(Be=>{"use strict";u();l();Object.defineProperty(Be,"__esModule",{value:!0});Be.taggedHash=Be.hash256=Be.hash160=Be.sha256=Be.ripemd160=void 0;var Ed=ht();function Cd(r){return f.Buffer.from(Ed.base.ripemd160(r))}Be.ripemd160=Cd;function qr(r){return f.Buffer.from(Ed.base.sha256(r))}Be.sha256=qr;function Qm(r){return Cd(qr(r))}Be.hash160=Qm;function Km(r){return qr(qr(r))}Be.hash256=Km;var $m=["BIP0340/challenge","BIP0340/aux","BIP0340/nonce","TapLeaf","TapBranch","TapSighash","TapTweak","KeyAgg list","KeyAgg coefficient"],Ym=Object.fromEntries($m.map(r=>{let e=qr(f.Buffer.from(r));return[r,f.Buffer.concat([e,e])]}));function Xm(r,e){return qr(f.Buffer.concat([Ym[r],e]))}Be.taggedHash=Xm});var Ad=K(tt=>{"use strict";u();l();var zm=tt&&tt.__createBinding||(Object.create?function(r,e,t,o){o===void 0&&(o=t);var n=Object.getOwnPropertyDescriptor(e,t);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,o,n)}:function(r,e,t,o){o===void 0&&(o=t),r[o]=e[t]}),Zm=tt&&tt.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Is=tt&&tt.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&zm(e,r,t);return Zm(e,r),e};Object.defineProperty(tt,"__esModule",{value:!0});tt.p2pkh=void 0;var _s=Is(Vr()),Jm=He(),Wr=Is(ze()),Se=Ie(),St=Is(ft()),Gt=Wr.OPS,wd=ht();function eS(r,e){if(!r.address&&!r.hash&&!r.output&&!r.pubkey&&!r.input)throw new TypeError("Not enough data");e=Object.assign({validate:!0},e||{}),(0,Se.typeforce)({network:Se.typeforce.maybe(Se.typeforce.Object),address:Se.typeforce.maybe(Se.typeforce.String),hash:Se.typeforce.maybe(Se.typeforce.BufferN(20)),output:Se.typeforce.maybe(Se.typeforce.BufferN(25)),pubkey:Se.typeforce.maybe(Se.isPoint),signature:Se.typeforce.maybe(Wr.isCanonicalScriptSignature),input:Se.typeforce.maybe(Se.typeforce.Buffer)},r);let t=St.value(()=>{let a=wd.base.fromBase58Check(r.address),c=a.readUInt8(0),p=a.slice(1);return{version:c,hash:p}}),o=St.value(()=>Wr.decompile(r.input)),n=r.network||Jm.bitcoin,i={name:"p2pkh",network:n};if(St.prop(i,"address",()=>{if(!i.hash)return;let a=f.Buffer.allocUnsafe(21);return a.writeUInt8(n.pubKeyHash,0),i.hash.copy(a,1),wd.base.toBase58Check(a)}),St.prop(i,"hash",()=>{if(r.output)return r.output.slice(3,23);if(r.address)return t().hash;if(r.pubkey||i.pubkey)return _s.hash160(r.pubkey||i.pubkey)}),St.prop(i,"output",()=>{if(!!i.hash)return Wr.compile([Gt.OP_DUP,Gt.OP_HASH160,i.hash,Gt.OP_EQUALVERIFY,Gt.OP_CHECKSIG])}),St.prop(i,"pubkey",()=>{if(!!r.input)return o()[1]}),St.prop(i,"signature",()=>{if(!!r.input)return o()[0]}),St.prop(i,"input",()=>{if(!!r.pubkey&&!!r.signature)return Wr.compile([r.signature,r.pubkey])}),St.prop(i,"witness",()=>{if(!!i.input)return[]}),e.validate){let a=f.Buffer.from([]);if(r.address){if(t().version!==n.pubKeyHash)throw new TypeError("Invalid version or Network mismatch");if(t().hash.length!==20)throw new TypeError("Invalid address");a=t().hash}if(r.hash){if(a.length>0&&!a.equals(r.hash))throw new TypeError("Hash mismatch");a=r.hash}if(r.output){if(r.output.length!==25||r.output[0]!==Gt.OP_DUP||r.output[1]!==Gt.OP_HASH160||r.output[2]!==20||r.output[23]!==Gt.OP_EQUALVERIFY||r.output[24]!==Gt.OP_CHECKSIG)throw new TypeError("Output is invalid");let c=r.output.slice(3,23);if(a.length>0&&!a.equals(c))throw new TypeError("Hash mismatch");a=c}if(r.pubkey){let c=_s.hash160(r.pubkey);if(a.length>0&&!a.equals(c))throw new TypeError("Hash mismatch");a=c}if(r.input){let c=o();if(c.length!==2)throw new TypeError("Input is invalid");if(!Wr.isCanonicalScriptSignature(c[0]))throw new TypeError("Input has invalid signature");if(!(0,Se.isPoint)(c[1]))throw new TypeError("Input has invalid pubkey");if(r.signature&&!r.signature.equals(c[0]))throw new TypeError("Signature mismatch");if(r.pubkey&&!r.pubkey.equals(c[1]))throw new TypeError("Pubkey mismatch");let p=_s.hash160(c[1]);if(a.length>0&&!a.equals(p))throw new TypeError("Hash mismatch")}}return Object.assign(i,r)}tt.p2pkh=eS});var vd=K(ot=>{"use strict";u();l();var tS=ot&&ot.__createBinding||(Object.create?function(r,e,t,o){o===void 0&&(o=t);var n=Object.getOwnPropertyDescriptor(e,t);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,o,n)}:function(r,e,t,o){o===void 0&&(o=t),r[o]=e[t]}),rS=ot&&ot.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Es=ot&&ot.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&tS(e,r,t);return rS(e,r),e};Object.defineProperty(ot,"__esModule",{value:!0});ot.p2sh=void 0;var bd=Es(Vr()),oS=He(),gt=Es(ze()),Y=Ie(),rt=Es(ft()),Od=ht(),Vn=gt.OPS;function nS(r,e){return r.length!==e.length?!1:r.every((t,o)=>t.equals(e[o]))}function iS(r,e){if(!r.address&&!r.hash&&!r.output&&!r.redeem&&!r.input)throw new TypeError("Not enough data");e=Object.assign({validate:!0},e||{}),(0,Y.typeforce)({network:Y.typeforce.maybe(Y.typeforce.Object),address:Y.typeforce.maybe(Y.typeforce.String),hash:Y.typeforce.maybe(Y.typeforce.BufferN(20)),output:Y.typeforce.maybe(Y.typeforce.BufferN(23)),redeem:Y.typeforce.maybe({network:Y.typeforce.maybe(Y.typeforce.Object),output:Y.typeforce.maybe(Y.typeforce.Buffer),input:Y.typeforce.maybe(Y.typeforce.Buffer),witness:Y.typeforce.maybe(Y.typeforce.arrayOf(Y.typeforce.Buffer))}),input:Y.typeforce.maybe(Y.typeforce.Buffer),witness:Y.typeforce.maybe(Y.typeforce.arrayOf(Y.typeforce.Buffer))},r);let t=r.network;t||(t=r.redeem&&r.redeem.network||oS.bitcoin);let o={network:t},n=rt.value(()=>{let c=Od.base.fromBase58Check(r.address),p=c.readUInt8(0),d=c.slice(1);return{version:p,hash:d}}),i=rt.value(()=>gt.decompile(r.input)),a=rt.value(()=>{let c=i();return{network:t,output:c[c.length-1],input:gt.compile(c.slice(0,-1)),witness:r.witness||[]}});if(rt.prop(o,"address",()=>{if(!o.hash)return;let c=f.Buffer.allocUnsafe(21);return c.writeUInt8(o.network.scriptHash,0),o.hash.copy(c,1),Od.base.toBase58Check(c)}),rt.prop(o,"hash",()=>{if(r.output)return r.output.slice(2,22);if(r.address)return n().hash;if(o.redeem&&o.redeem.output)return bd.hash160(o.redeem.output)}),rt.prop(o,"output",()=>{if(!!o.hash)return gt.compile([Vn.OP_HASH160,o.hash,Vn.OP_EQUAL])}),rt.prop(o,"redeem",()=>{if(!!r.input)return a()}),rt.prop(o,"input",()=>{if(!(!r.redeem||!r.redeem.input||!r.redeem.output))return gt.compile([].concat(gt.decompile(r.redeem.input),r.redeem.output))}),rt.prop(o,"witness",()=>{if(o.redeem&&o.redeem.witness)return o.redeem.witness;if(o.input)return[]}),rt.prop(o,"name",()=>{let c=["p2sh"];return o.redeem!==void 0&&o.redeem.name!==void 0&&c.push(o.redeem.name),c.join("-")}),e.validate){let c=f.Buffer.from([]);if(r.address){if(n().version!==t.scriptHash)throw new TypeError("Invalid version or Network mismatch");if(n().hash.length!==20)throw new TypeError("Invalid address");c=n().hash}if(r.hash){if(c.length>0&&!c.equals(r.hash))throw new TypeError("Hash mismatch");c=r.hash}if(r.output){if(r.output.length!==23||r.output[0]!==Vn.OP_HASH160||r.output[1]!==20||r.output[22]!==Vn.OP_EQUAL)throw new TypeError("Output is invalid");let d=r.output.slice(2,22);if(c.length>0&&!c.equals(d))throw new TypeError("Hash mismatch");c=d}let p=d=>{if(d.output){let h=gt.decompile(d.output);if(!h||h.length<1)throw new TypeError("Redeem.output too short");let m=bd.hash160(d.output);if(c.length>0&&!c.equals(m))throw new TypeError("Hash mismatch");c=m}if(d.input){let h=d.input.length>0,m=d.witness&&d.witness.length>0;if(!h&&!m)throw new TypeError("Empty input");if(h&&m)throw new TypeError("Input and witness provided");if(h){let g=gt.decompile(d.input);if(!gt.isPushOnly(g))throw new TypeError("Non push-only scriptSig")}}};if(r.input){let d=i();if(!d||d.length<1)throw new TypeError("Input too short");if(!f.Buffer.isBuffer(a().output))throw new TypeError("Input is invalid");p(a())}if(r.redeem){if(r.redeem.network&&r.redeem.network!==t)throw new TypeError("Network mismatch");if(r.input){let d=a();if(r.redeem.output&&!r.redeem.output.equals(d.output))throw new TypeError("Redeem.output mismatch");if(r.redeem.input&&!r.redeem.input.equals(d.input))throw new TypeError("Redeem.input mismatch")}p(r.redeem)}if(r.witness&&r.redeem&&r.redeem.witness&&!nS(r.redeem.witness,r.witness))throw new TypeError("Witness and redeem.witness mismatch")}return Object.assign(o,r)}ot.p2sh=iS});var kd=K(nt=>{"use strict";u();l();var sS=nt&&nt.__createBinding||(Object.create?function(r,e,t,o){o===void 0&&(o=t);var n=Object.getOwnPropertyDescriptor(e,t);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,o,n)}:function(r,e,t,o){o===void 0&&(o=t),r[o]=e[t]}),aS=nt&&nt.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),ws=nt&&nt.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&sS(e,r,t);return aS(e,r),e};Object.defineProperty(nt,"__esModule",{value:!0});nt.p2wpkh=void 0;var Cs=ws(Vr()),cS=He(),Gn=ws(ze()),ne=Ie(),Ht=ws(ft()),Wn=ht(),Pd=Gn.OPS,uS=f.Buffer.alloc(0);function lS(r,e){if(!r.address&&!r.hash&&!r.output&&!r.pubkey&&!r.witness)throw new TypeError("Not enough data");e=Object.assign({validate:!0},e||{}),(0,ne.typeforce)({address:ne.typeforce.maybe(ne.typeforce.String),hash:ne.typeforce.maybe(ne.typeforce.BufferN(20)),input:ne.typeforce.maybe(ne.typeforce.BufferN(0)),network:ne.typeforce.maybe(ne.typeforce.Object),output:ne.typeforce.maybe(ne.typeforce.BufferN(22)),pubkey:ne.typeforce.maybe(ne.isPoint),signature:ne.typeforce.maybe(Gn.isCanonicalScriptSignature),witness:ne.typeforce.maybe(ne.typeforce.arrayOf(ne.typeforce.Buffer))},r);let t=Ht.value(()=>{let i=Wn.base.bech32.decode(r.address),a=i.words.shift(),c=Wn.base.bech32.fromWords(i.words);return{version:a,prefix:i.prefix,data:f.Buffer.from(c)}}),o=r.network||cS.bitcoin,n={name:"p2wpkh",network:o};if(Ht.prop(n,"address",()=>{if(!n.hash)return;let i=Wn.base.bech32.toWords(n.hash);return i.unshift(0),Wn.base.bech32.encode(o.bech32,i)}),Ht.prop(n,"hash",()=>{if(r.output)return r.output.slice(2,22);if(r.address)return t().data;if(r.pubkey||n.pubkey)return Cs.hash160(r.pubkey||n.pubkey)}),Ht.prop(n,"output",()=>{if(!!n.hash)return Gn.compile([Pd.OP_0,n.hash])}),Ht.prop(n,"pubkey",()=>{if(r.pubkey)return r.pubkey;if(!!r.witness)return r.witness[1]}),Ht.prop(n,"signature",()=>{if(!!r.witness)return r.witness[0]}),Ht.prop(n,"input",()=>{if(!!n.witness)return uS}),Ht.prop(n,"witness",()=>{if(!!r.pubkey&&!!r.signature)return[r.signature,r.pubkey]}),e.validate){let i=f.Buffer.from([]);if(r.address){if(o&&o.bech32!==t().prefix)throw new TypeError("Invalid prefix or Network mismatch");if(t().version!==0)throw new TypeError("Invalid address version");if(t().data.length!==20)throw new TypeError("Invalid address data");i=t().data}if(r.hash){if(i.length>0&&!i.equals(r.hash))throw new TypeError("Hash mismatch");i=r.hash}if(r.output){if(r.output.length!==22||r.output[0]!==Pd.OP_0||r.output[1]!==20)throw new TypeError("Output is invalid");if(i.length>0&&!i.equals(r.output.slice(2)))throw new TypeError("Hash mismatch");i=r.output.slice(2)}if(r.pubkey){let a=Cs.hash160(r.pubkey);if(i.length>0&&!i.equals(a))throw new TypeError("Hash mismatch");if(i=a,!(0,ne.isPoint)(r.pubkey)||r.pubkey.length!==33)throw new TypeError("Invalid pubkey for p2wpkh")}if(r.witness){if(r.witness.length!==2)throw new TypeError("Witness is invalid");if(!Gn.isCanonicalScriptSignature(r.witness[0]))throw new TypeError("Witness has invalid signature");if(!(0,ne.isPoint)(r.witness[1])||r.witness[1].length!==33)throw new TypeError("Witness has invalid pubkey");if(r.signature&&!r.signature.equals(r.witness[0]))throw new TypeError("Signature mismatch");if(r.pubkey&&!r.pubkey.equals(r.witness[1]))throw new TypeError("Pubkey mismatch");let a=Cs.hash160(r.witness[1]);if(i.length>0&&!i.equals(a))throw new TypeError("Hash mismatch")}}return Object.assign(n,r)}nt.p2wpkh=lS});var Nd=K(it=>{"use strict";u();l();var pS=it&&it.__createBinding||(Object.create?function(r,e,t,o){o===void 0&&(o=t);var n=Object.getOwnPropertyDescriptor(e,t);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,o,n)}:function(r,e,t,o){o===void 0&&(o=t),r[o]=e[t]}),dS=it&&it.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),bs=it&&it.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&pS(e,r,t);return dS(e,r),e};Object.defineProperty(it,"__esModule",{value:!0});it.p2wsh=void 0;var Rd=bs(Vr()),hS=He(),jt=bs(ze()),j=Ie(),Tt=bs(ft()),Hn=ht(),Ld=jt.OPS,As=f.Buffer.alloc(0);function fS(r,e){return r.length!==e.length?!1:r.every((t,o)=>t.equals(e[o]))}function jn(r){return!!(f.Buffer.isBuffer(r)&&r.length===65&&r[0]===4&&(0,j.isPoint)(r))}function mS(r,e){if(!r.address&&!r.hash&&!r.output&&!r.redeem&&!r.witness)throw new TypeError("Not enough data");e=Object.assign({validate:!0},e||{}),(0,j.typeforce)({network:j.typeforce.maybe(j.typeforce.Object),address:j.typeforce.maybe(j.typeforce.String),hash:j.typeforce.maybe(j.typeforce.BufferN(32)),output:j.typeforce.maybe(j.typeforce.BufferN(34)),redeem:j.typeforce.maybe({input:j.typeforce.maybe(j.typeforce.Buffer),network:j.typeforce.maybe(j.typeforce.Object),output:j.typeforce.maybe(j.typeforce.Buffer),witness:j.typeforce.maybe(j.typeforce.arrayOf(j.typeforce.Buffer))}),input:j.typeforce.maybe(j.typeforce.BufferN(0)),witness:j.typeforce.maybe(j.typeforce.arrayOf(j.typeforce.Buffer))},r);let t=Tt.value(()=>{let a=Hn.base.bech32.decode(r.address),c=a.words.shift(),p=Hn.base.bech32.fromWords(a.words);return{version:c,prefix:a.prefix,data:f.Buffer.from(p)}}),o=Tt.value(()=>jt.decompile(r.redeem.input)),n=r.network;n||(n=r.redeem&&r.redeem.network||hS.bitcoin);let i={network:n};if(Tt.prop(i,"address",()=>{if(!i.hash)return;let a=Hn.base.bech32.toWords(i.hash);return a.unshift(0),Hn.base.bech32.encode(n.bech32,a)}),Tt.prop(i,"hash",()=>{if(r.output)return r.output.slice(2);if(r.address)return t().data;if(i.redeem&&i.redeem.output)return Rd.sha256(i.redeem.output)}),Tt.prop(i,"output",()=>{if(!!i.hash)return jt.compile([Ld.OP_0,i.hash])}),Tt.prop(i,"redeem",()=>{if(!!r.witness)return{output:r.witness[r.witness.length-1],input:As,witness:r.witness.slice(0,-1)}}),Tt.prop(i,"input",()=>{if(!!i.witness)return As}),Tt.prop(i,"witness",()=>{if(r.redeem&&r.redeem.input&&r.redeem.input.length>0&&r.redeem.output&&r.redeem.output.length>0){let a=jt.toStack(o());return i.redeem=Object.assign({witness:a},r.redeem),i.redeem.input=As,[].concat(a,r.redeem.output)}if(!!r.redeem&&!!r.redeem.output&&!!r.redeem.witness)return[].concat(r.redeem.witness,r.redeem.output)}),Tt.prop(i,"name",()=>{let a=["p2wsh"];return i.redeem!==void 0&&i.redeem.name!==void 0&&a.push(i.redeem.name),a.join("-")}),e.validate){let a=f.Buffer.from([]);if(r.address){if(t().prefix!==n.bech32)throw new TypeError("Invalid prefix or Network mismatch");if(t().version!==0)throw new TypeError("Invalid address version");if(t().data.length!==32)throw new TypeError("Invalid address data");a=t().data}if(r.hash){if(a.length>0&&!a.equals(r.hash))throw new TypeError("Hash mismatch");a=r.hash}if(r.output){if(r.output.length!==34||r.output[0]!==Ld.OP_0||r.output[1]!==32)throw new TypeError("Output is invalid");let c=r.output.slice(2);if(a.length>0&&!a.equals(c))throw new TypeError("Hash mismatch");a=c}if(r.redeem){if(r.redeem.network&&r.redeem.network!==n)throw new TypeError("Network mismatch");if(r.redeem.input&&r.redeem.input.length>0&&r.redeem.witness&&r.redeem.witness.length>0)throw new TypeError("Ambiguous witness source");if(r.redeem.output){if(jt.decompile(r.redeem.output).length===0)throw new TypeError("Redeem.output is invalid");let c=Rd.sha256(r.redeem.output);if(a.length>0&&!a.equals(c))throw new TypeError("Hash mismatch");a=c}if(r.redeem.input&&!jt.isPushOnly(o()))throw new TypeError("Non push-only scriptSig");if(r.witness&&r.redeem.witness&&!fS(r.witness,r.redeem.witness))throw new TypeError("Witness and redeem.witness mismatch");if(r.redeem.input&&o().some(jn)||r.redeem.output&&(jt.decompile(r.redeem.output)||[]).some(jn))throw new TypeError("redeem.input or redeem.output contains uncompressed pubkey")}if(r.witness&&r.witness.length>0){let c=r.witness[r.witness.length-1];if(r.redeem&&r.redeem.output&&!r.redeem.output.equals(c))throw new TypeError("Witness and redeem.output mismatch");if(r.witness.some(jn)||(jt.decompile(c)||[]).some(jn))throw new TypeError("Witness contains uncompressed pubkey")}}return Object.assign(i,r)}it.p2wsh=mS});var Fd=K((Bb,Dd)=>{"use strict";u();l();var Os=lf().Buffer,SS=9007199254740991;function vs(r){if(r<0||r>SS||r%1!==0)throw new RangeError("value out of range")}function ko(r,e,t){if(vs(r),e||(e=Os.allocUnsafe(Md(r))),!Os.isBuffer(e))throw new TypeError("buffer must be a Buffer instance");return t||(t=0),r<253?(e.writeUInt8(r,t),ko.bytes=1):r<=65535?(e.writeUInt8(253,t),e.writeUInt16LE(r,t+1),ko.bytes=3):r<=4294967295?(e.writeUInt8(254,t),e.writeUInt32LE(r,t+1),ko.bytes=5):(e.writeUInt8(255,t),e.writeUInt32LE(r>>>0,t+1),e.writeUInt32LE(r/4294967296|0,t+5),ko.bytes=9),e}function Ro(r,e){if(!Os.isBuffer(r))throw new TypeError("buffer must be a Buffer instance");e||(e=0);var t=r.readUInt8(e);if(t<253)return Ro.bytes=1,t;if(t===253)return Ro.bytes=3,r.readUInt16LE(e+1);if(t===254)return Ro.bytes=5,r.readUInt32LE(e+1);Ro.bytes=9;var o=r.readUInt32LE(e+1),n=r.readUInt32LE(e+5),i=n*4294967296+o;return vs(i),i}function Md(r){return vs(r),r<253?1:r<=65535?3:r<=4294967295?5:9}Dd.exports={encode:ko,decode:Ro,encodingLength:Md}});var Wd=K(Z=>{"use strict";u();l();var gS=Z&&Z.__createBinding||(Object.create?function(r,e,t,o){o===void 0&&(o=t);var n=Object.getOwnPropertyDescriptor(e,t);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,o,n)}:function(r,e,t,o){o===void 0&&(o=t),r[o]=e[t]}),TS=Z&&Z.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),xd=Z&&Z.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&gS(e,r,t);return TS(e,r),e};Object.defineProperty(Z,"__esModule",{value:!0});Z.BufferReader=Z.BufferWriter=Z.cloneBuffer=Z.reverseBuffer=Z.writeUInt64LE=Z.readUInt64LE=Z.varuint=void 0;var lr=xd(Ie()),{typeforce:Bd}=lr,Lo=xd(Fd());Z.varuint=Lo;function Ud(r,e){if(typeof r!="number")throw new Error("cannot write a non-number as a number");if(r<0)throw new Error("specified a negative value for writing an unsigned value");if(r>e)throw new Error("RangeError: value out of range");if(Math.floor(r)!==r)throw new Error("value has a fractional component")}function qd(r,e){let t=r.readUInt32LE(e),o=r.readUInt32LE(e+4);return o*=4294967296,Ud(o+t,9007199254740991),o+t}Z.readUInt64LE=qd;function Vd(r,e,t){return Ud(e,9007199254740991),r.writeInt32LE(e&-1,t),r.writeUInt32LE(Math.floor(e/4294967296),t+4),t+8}Z.writeUInt64LE=Vd;function yS(r){if(r.length<1)return r;let e=r.length-1,t=0;for(let o=0;o<r.length/2;o++)t=r[o],r[o]=r[e],r[e]=t,e--;return r}Z.reverseBuffer=yS;function _S(r){let e=f.Buffer.allocUnsafe(r.length);return r.copy(e),e}Z.cloneBuffer=_S;var No=class{static withCapacity(e){return new No(f.Buffer.alloc(e))}constructor(e,t=0){this.buffer=e,this.offset=t,Bd(lr.tuple(lr.Buffer,lr.UInt32),[e,t])}writeUInt8(e){this.offset=this.buffer.writeUInt8(e,this.offset)}writeInt32(e){this.offset=this.buffer.writeInt32LE(e,this.offset)}writeUInt32(e){this.offset=this.buffer.writeUInt32LE(e,this.offset)}writeUInt64(e){this.offset=Vd(this.buffer,e,this.offset)}writeVarInt(e){Lo.encode(e,this.buffer,this.offset),this.offset+=Lo.encode.bytes}writeSlice(e){if(this.buffer.length<this.offset+e.length)throw new Error("Cannot write slice out of bounds");this.offset+=e.copy(this.buffer,this.offset)}writeVarSlice(e){this.writeVarInt(e.length),this.writeSlice(e)}writeVector(e){this.writeVarInt(e.length),e.forEach(t=>this.writeVarSlice(t))}end(){if(this.buffer.length===this.offset)return this.buffer;throw new Error(`buffer size ${this.buffer.length}, offset ${this.offset}`)}};Z.BufferWriter=No;var Ps=class{constructor(e,t=0){this.buffer=e,this.offset=t,Bd(lr.tuple(lr.Buffer,lr.UInt32),[e,t])}readUInt8(){let e=this.buffer.readUInt8(this.offset);return this.offset++,e}readInt32(){let e=this.buffer.readInt32LE(this.offset);return this.offset+=4,e}readUInt32(){let e=this.buffer.readUInt32LE(this.offset);return this.offset+=4,e}readUInt64(){let e=qd(this.buffer,this.offset);return this.offset+=8,e}readVarInt(){let e=Lo.decode(this.buffer,this.offset);return this.offset+=Lo.decode.bytes,e}readSlice(e){if(this.buffer.length<this.offset+e)throw new Error("Cannot read slice out of bounds");let t=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}readVarSlice(){return this.readSlice(this.readVarInt())}readVector(){let e=this.readVarInt(),t=[];for(let o=0;o<e;o++)t.push(this.readVarSlice());return t}};Z.BufferReader=Ps});var jd=K(Gr=>{"use strict";u();l();Object.defineProperty(Gr,"__esModule",{value:!0});Gr.taprootTweakPubkey=Gr.taprootTweakPrivKey=void 0;var IS=ht(),Rs=IS.signUtil.schnorr.secp256k1,Ls=Rs.schnorr,Gd=Rs.secp256k1.ProjectivePoint,ks=Rs.secp256k1.CURVE.n;function Hd(r,e){let t=Ls.utils,o=t.taggedHash("TapTweak",r,e),n=t.bytesToNumberBE(o);if(n>=ks)throw new Error("tweak higher than curve order");return n}function ES(r,e=new Uint8Array){let t=Ls.utils,o=t.bytesToNumberBE(r),n=Gd.fromPrivateKey(o),i=n.hasEvenY()?o:t.mod(-o,ks),a=t.pointToBytes(n),c=Hd(a,e);return t.numberToBytesBE(t.mod(i+c,ks),32)}Gr.taprootTweakPrivKey=ES;function CS(r,e){e||(e=new Uint8Array);let t=Ls.utils,o=Hd(r,e),i=t.lift_x(t.bytesToNumberBE(r)).add(Gd.fromPrivateKey(o)),a=i.hasEvenY()?0:1;return[t.pointToBytes(i),a]}Gr.taprootTweakPubkey=CS});var $d=K(Q=>{"use strict";u();l();var wS=Q&&Q.__createBinding||(Object.create?function(r,e,t,o){o===void 0&&(o=t);var n=Object.getOwnPropertyDescriptor(e,t);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,o,n)}:function(r,e,t,o){o===void 0&&(o=t),r[o]=e[t]}),AS=Q&&Q.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),bS=Q&&Q.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&wS(e,r,t);return AS(e,r),e};Object.defineProperty(Q,"__esModule",{value:!0});Q.tweakKey=Q.tapTweakHash=Q.tapleafHash=Q.findScriptPath=Q.toHashTree=Q.rootHashFromPath=Q.MAX_TAPTREE_DEPTH=Q.LEAF_VERSION_TAPSCRIPT=void 0;var Qt=di(),Fs=bS(Vr()),Qd=Wd(),OS=Ie(),vS=jd();Q.LEAF_VERSION_TAPSCRIPT=192;Q.MAX_TAPTREE_DEPTH=128;var PS=r=>"left"in r&&"right"in r;function kS(r,e){if(r.length<33)throw new TypeError(`The control-block length is too small. Got ${r.length}, expected min 33.`);let t=(r.length-33)/32,o=e;for(let n=0;n<t;n++){let i=r.slice(33+32*n,65+32*n);o.compare(i)<0?o=Ds(o,i):o=Ds(i,o)}return o}Q.rootHashFromPath=kS;function Ns(r){if((0,OS.isTapleaf)(r))return{hash:Kd(r)};let e=[Ns(r[0]),Ns(r[1])];e.sort((n,i)=>n.hash.compare(i.hash));let[t,o]=e;return{hash:Ds(t.hash,o.hash),left:t,right:o}}Q.toHashTree=Ns;function Ms(r,e){if(PS(r)){let t=Ms(r.left,e);if(t!==void 0)return[...t,r.right.hash];let o=Ms(r.right,e);if(o!==void 0)return[...o,r.left.hash]}else if(r.hash.equals(e))return[]}Q.findScriptPath=Ms;function Kd(r){let e=r.version||Q.LEAF_VERSION_TAPSCRIPT;return Fs.taggedHash("TapLeaf",Qt.Buffer.concat([Qt.Buffer.from([e]),NS(r.output)]))}Q.tapleafHash=Kd;function RS(r,e){return Fs.taggedHash("TapTweak",Qt.Buffer.concat(e?[r,e]:[r]))}Q.tapTweakHash=RS;function LS(r,e){if(!Qt.Buffer.isBuffer(r)||r.length!==32||e&&e.length!==32)return null;let t=(0,vS.taprootTweakPubkey)(r,e);return{parity:t[1],x:Qt.Buffer.from(t[0])}}Q.tweakKey=LS;function Ds(r,e){return Fs.taggedHash("TapBranch",Qt.Buffer.concat([r,e]))}function NS(r){let e=Qd.varuint.encodingLength(r.length),t=Qt.Buffer.allocUnsafe(e);return Qd.varuint.encode(r.length,t),Qt.Buffer.concat([t,r])}});var Zd=K(st=>{"use strict";u();l();var MS=st&&st.__createBinding||(Object.create?function(r,e,t,o){o===void 0&&(o=t);var n=Object.getOwnPropertyDescriptor(e,t);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,o,n)}:function(r,e,t,o){o===void 0&&(o=t),r[o]=e[t]}),DS=st&&st.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),zd=st&&st.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&MS(e,r,t);return DS(e,r),e};Object.defineProperty(st,"__esModule",{value:!0});st.p2tr=void 0;var Qn=di(),FS=He(),xs=zd(ze()),D=Ie(),Ce=$d(),Ue=zd(ft()),Kn=ht(),Yd=xs.OPS,Xd=1,xS=80;function BS(r,e){if(!r.address&&!r.output&&!r.pubkey&&!r.internalPubkey&&!(r.witness&&r.witness.length>1))throw new TypeError("Not enough data");e=Object.assign({validate:!0},e||{}),(0,D.typeforce)({address:D.typeforce.maybe(D.typeforce.String),input:D.typeforce.maybe(D.typeforce.BufferN(0)),network:D.typeforce.maybe(D.typeforce.Object),output:D.typeforce.maybe(D.typeforce.BufferN(34)),internalPubkey:D.typeforce.maybe(D.typeforce.BufferN(32)),hash:D.typeforce.maybe(D.typeforce.BufferN(32)),pubkey:D.typeforce.maybe(D.typeforce.BufferN(32)),witness:D.typeforce.maybe(D.typeforce.arrayOf(D.typeforce.Buffer)),scriptTree:D.typeforce.maybe(D.isTaptree),redeem:D.typeforce.maybe({output:D.typeforce.maybe(D.typeforce.Buffer),redeemVersion:D.typeforce.maybe(D.typeforce.Number),witness:D.typeforce.maybe(D.typeforce.arrayOf(D.typeforce.Buffer))}),redeemVersion:D.typeforce.maybe(D.typeforce.Number)},r);let t=Ue.value(()=>{let c=Kn.base.bech32m.decode(r.address),p=c.words.shift(),d=Kn.base.bech32m.fromWords(c.words);return{version:p,prefix:c.prefix,data:Qn.Buffer.from(d)}}),o=Ue.value(()=>{if(!(!r.witness||!r.witness.length))return r.witness.length>=2&&r.witness[r.witness.length-1][0]===xS?r.witness.slice(0,-1):r.witness.slice()}),n=Ue.value(()=>{if(r.scriptTree)return(0,Ce.toHashTree)(r.scriptTree);if(r.hash)return{hash:r.hash}}),i=r.network||FS.bitcoin,a={name:"p2tr",network:i};if(Ue.prop(a,"address",()=>{if(!a.pubkey)return;let c=Kn.base.bech32m.toWords(a.pubkey);return c.unshift(Xd),Kn.base.bech32m.encode(i.bech32,c)}),Ue.prop(a,"hash",()=>{let c=n();if(c)return c.hash;let p=o();if(p&&p.length>1){let d=p[p.length-1],h=d[0]&D.TAPLEAF_VERSION_MASK,m=p[p.length-2],g=(0,Ce.tapleafHash)({output:m,version:h});return(0,Ce.rootHashFromPath)(d,g)}return null}),Ue.prop(a,"output",()=>{if(!!a.pubkey)return xs.compile([Yd.OP_1,a.pubkey])}),Ue.prop(a,"redeemVersion",()=>r.redeemVersion?r.redeemVersion:r.redeem&&r.redeem.redeemVersion!==void 0&&r.redeem.redeemVersion!==null?r.redeem.redeemVersion:Ce.LEAF_VERSION_TAPSCRIPT),Ue.prop(a,"redeem",()=>{let c=o();if(!(!c||c.length<2))return{output:c[c.length-2],witness:c.slice(0,-2),redeemVersion:c[c.length-1][0]&D.TAPLEAF_VERSION_MASK}}),Ue.prop(a,"pubkey",()=>{if(r.pubkey)return r.pubkey;if(r.output)return r.output.slice(2);if(r.address)return t().data;if(a.internalPubkey){let c=(0,Ce.tweakKey)(a.internalPubkey,a.hash);if(c)return c.x}}),Ue.prop(a,"internalPubkey",()=>{if(r.internalPubkey)return r.internalPubkey;let c=o();if(c&&c.length>1)return c[c.length-1].slice(1,33)}),Ue.prop(a,"signature",()=>{if(r.signature)return r.signature;let c=o();if(!(!c||c.length!==1))return c[0]}),Ue.prop(a,"witness",()=>{if(r.witness)return r.witness;let c=n();if(c&&r.redeem&&r.redeem.output&&r.internalPubkey){let p=(0,Ce.tapleafHash)({output:r.redeem.output,version:a.redeemVersion}),d=(0,Ce.findScriptPath)(c,p);if(!d)return;let h=(0,Ce.tweakKey)(r.internalPubkey,c.hash);if(!h)return;let m=Qn.Buffer.concat([Qn.Buffer.from([a.redeemVersion|h.parity]),r.internalPubkey].concat(d));return[r.redeem.output,m]}if(r.signature)return[r.signature]}),e.validate){let c=Qn.Buffer.from([]);if(r.address){if(i&&i.bech32!==t().prefix)throw new TypeError("Invalid prefix or Network mismatch");if(t().version!==Xd)throw new TypeError("Invalid address version");if(t().data.length!==32)throw new TypeError("Invalid address data");c=t().data}if(r.pubkey){if(c.length>0&&!c.equals(r.pubkey))throw new TypeError("Pubkey mismatch");c=r.pubkey}if(r.output){if(r.output.length!==34||r.output[0]!==Yd.OP_1||r.output[1]!==32)throw new TypeError("Output is invalid");if(c.length>0&&!c.equals(r.output.slice(2)))throw new TypeError("Pubkey mismatch");c=r.output.slice(2)}if(r.internalPubkey){let h=(0,Ce.tweakKey)(r.internalPubkey,a.hash);if(c.length>0&&!c.equals(h.x))throw new TypeError("Pubkey mismatch");c=h.x}if(c&&c.length&&c.length!==32)throw new TypeError("Invalid pubkey for p2tr");let p=n();if(r.hash&&p&&!r.hash.equals(p.hash))throw new TypeError("Hash mismatch");if(r.redeem&&r.redeem.output&&p){let h=(0,Ce.tapleafHash)({output:r.redeem.output,version:a.redeemVersion});if(!(0,Ce.findScriptPath)(p,h))throw new TypeError("Redeem script not in tree")}let d=o();if(r.redeem&&a.redeem){if(r.redeem.redeemVersion&&r.redeem.redeemVersion!==a.redeem.redeemVersion)throw new TypeError("Redeem.redeemVersion and witness mismatch");if(r.redeem.output){if(xs.decompile(r.redeem.output).length===0)throw new TypeError("Redeem.output is invalid");if(a.redeem.output&&!r.redeem.output.equals(a.redeem.output))throw new TypeError("Redeem.output and witness mismatch")}if(r.redeem.witness&&a.redeem.witness&&!US(r.redeem.witness,a.redeem.witness))throw new TypeError("Redeem.witness and witness mismatch")}if(d&&d.length)if(d.length===1){if(r.signature&&!r.signature.equals(d[0]))throw new TypeError("Signature mismatch")}else{let h=d[d.length-1];if(h.length<33)throw new TypeError(`The control-block length is too small. Got ${h.length}, expected min 33.`);if((h.length-33)%32!==0)throw new TypeError(`The control-block length of ${h.length} is incorrect!`);let m=(h.length-33)/32;if(m>128)throw new TypeError(`The script path is too long. Got ${m}, expected max 128.`);let g=h.slice(1,33);if(r.internalPubkey&&!r.internalPubkey.equals(g))throw new TypeError("Internal pubkey mismatch");if(g.length!==32)throw new TypeError("Invalid internalPubkey for p2tr witness");let T=h[0]&D.TAPLEAF_VERSION_MASK,y=d[d.length-2],C=(0,Ce.tapleafHash)({output:y,version:T}),b=(0,Ce.rootHashFromPath)(h,C),L=(0,Ce.tweakKey)(g,b);if(!L)throw new TypeError("Invalid outputKey for p2tr witness");if(c.length&&!c.equals(L.x))throw new TypeError("Pubkey mismatch for p2tr witness");if(L.parity!==(h[0]&1))throw new Error("Incorrect parity")}}return Object.assign(a,r)}st.p2tr=BS;function US(r,e){return r.length!==e.length?!1:r.every((t,o)=>t.equals(e[o]))}});var Jd=K(ae=>{"use strict";u();l();Object.defineProperty(ae,"__esModule",{value:!0});ae.p2tr=ae.p2wsh=ae.p2wpkh=ae.p2sh=ae.p2pkh=ae.p2pk=ae.p2ms=ae.embed=void 0;var qS=md();Object.defineProperty(ae,"embed",{enumerable:!0,get:function(){return qS.p2data}});var VS=Td();Object.defineProperty(ae,"p2ms",{enumerable:!0,get:function(){return VS.p2ms}});var WS=Id();Object.defineProperty(ae,"p2pk",{enumerable:!0,get:function(){return WS.p2pk}});var GS=Ad();Object.defineProperty(ae,"p2pkh",{enumerable:!0,get:function(){return GS.p2pkh}});var HS=vd();Object.defineProperty(ae,"p2sh",{enumerable:!0,get:function(){return HS.p2sh}});var jS=kd();Object.defineProperty(ae,"p2wpkh",{enumerable:!0,get:function(){return jS.p2wpkh}});var QS=Nd();Object.defineProperty(ae,"p2wsh",{enumerable:!0,get:function(){return QS.p2wsh}});var KS=Zd();Object.defineProperty(ae,"p2tr",{enumerable:!0,get:function(){return KS.p2tr}})});var ph=K(te=>{"use strict";u();l();var $S=te&&te.__createBinding||(Object.create?function(r,e,t,o){o===void 0&&(o=t);var n=Object.getOwnPropertyDescriptor(e,t);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,o,n)}:function(r,e,t,o){o===void 0&&(o=t),r[o]=e[t]}),YS=te&&te.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Yn=te&&te.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&$S(e,r,t);return YS(e,r),e};Object.defineProperty(te,"__esModule",{value:!0});te.toOutputScript=te.fromOutputScript=te.toBech32=te.toBase58Check=te.fromBech32=te.fromBase58Check=void 0;var eh=Yn(He()),at=Yn(Jd()),th=Yn(ze()),$n=Yn(Ie()),Kt=ht(),{typeforce:XS}=$n,rh=40,oh=2,nh=16,ih=2,sh=80,ah="WARNING: Sending to a future segwit version address can lead to loss of funds. End users MUST be warned carefully in the GUI and asked if they wish to proceed with caution. Wallets should verify the segwit version from the output of fromBech32, then decide when it is safe to use which version of segwit.";function zS(r,e){let t=r.slice(2);if(t.length<oh||t.length>rh)throw new TypeError("Invalid program length for segwit address");let o=r[0]-sh;if(o<ih||o>nh)throw new TypeError("Invalid version for segwit address");if(r[1]!==t.length)throw new TypeError("Invalid script for segwit address");return console.warn(ah),lh(t,o,e.bech32)}function ch(r){let e=Kt.base.fromBase58Check(r);if(e.length<21)throw new TypeError(r+" is too short");if(e.length>21)throw new TypeError(r+" is too long");let t=e.readUInt8(0),o=e.slice(1);return{version:t,hash:o}}te.fromBase58Check=ch;function uh(r){let e,t;try{e=Kt.base.bech32.decode(r)}catch{}if(e){if(t=e.words[0],t!==0)throw new TypeError(r+" uses wrong encoding")}else if(e=Kt.base.bech32m.decode(r),t=e.words[0],t===0)throw new TypeError(r+" uses wrong encoding");let o=Kt.base.bech32.fromWords(e.words.slice(1));return{version:t,prefix:e.prefix,data:f.Buffer.from(o)}}te.fromBech32=uh;function ZS(r,e){XS($n.tuple($n.Hash160bit,$n.UInt8),arguments);let t=f.Buffer.allocUnsafe(21);return t.writeUInt8(e,0),r.copy(t,1),Kt.base.toBase58Check(t)}te.toBase58Check=ZS;function lh(r,e,t){let o=Kt.base.bech32.toWords(r);return o.unshift(e),e===0?Kt.base.bech32.encode(t,o):Kt.base.bech32m.encode(t,o)}te.toBech32=lh;function JS(r,e){e=e||eh.bitcoin;try{return at.p2pkh({output:r,network:e}).address}catch{}try{return at.p2sh({output:r,network:e}).address}catch{}try{return at.p2wpkh({output:r,network:e}).address}catch{}try{return at.p2wsh({output:r,network:e}).address}catch{}try{return at.p2tr({output:r,network:e}).address}catch{}try{return zS(r,e)}catch{}throw new Error(th.toASM(r)+" has no matching Address")}te.fromOutputScript=JS;function eg(r,e){e=e||eh.bitcoin;let t,o;try{t=ch(r)}catch{}if(t){if(t.version===e.pubKeyHash)return at.p2pkh({hash:t.hash}).output;if(t.version===e.scriptHash)return at.p2sh({hash:t.hash}).output}else{try{o=uh(r)}catch{}if(o){if(o.prefix!==e.bech32)throw new Error(r+" has an invalid prefix");if(o.version===0){if(o.data.length===20)return at.p2wpkh({hash:o.data}).output;if(o.data.length===32)return at.p2wsh({hash:o.data}).output}else if(o.version===1){if(o.data.length===32)return at.p2tr({pubkey:o.data}).output}else if(o.version>=ih&&o.version<=nh&&o.data.length>=oh&&o.data.length<=rh)return console.warn(ah),th.compile([o.version+sh,o.data])}}throw new Error(r+" has no matching Script")}te.toOutputScript=eg});u();l();var ui=w(V()),ct=w(Ra());u();l();var ci=w(V()),Bh=w(It());u();l();var Kl=w(V());u();l();var Cn=w(V());var Ql=({children:r,rootStore:e})=>{let t=hc(e),o=(0,Cn.useMemo)(()=>(e.commonStore.rootStore=e,e.accountStore.rootStore=e,e),[e]);return Cn.default.createElement(t.Provider,{value:o},r)};var $l=Ke(({swapRootStore:r,bridgeRootStore:e,children:t,initTab:o})=>{let{commonStore:{currentTab:n}}=r.getInstance(),i=o||n,a=r.getInstance();return i===O.BRIDGE&&(a=e.getInstance()),Kl.default.createElement(Ql,{rootStore:a},t)});u();l();var Xl=w(V());var Yl={fetchConfig:{site:"okx",project:"okx_web_metax_defi"},MFfetchConfig:{site:"okx",project:"okx_web_metax_defi",MFProject:"universe-swap"}};function es({children:r,...e}){return Xl.default.createElement(wc,{fetchConfig:Yl.fetchConfig,...e},r)}u();l();u();l();u();l();u();l();var kn=w(V());u();l();var An=w(V());u();l();var wn=w(mf());async function Ef(r,e){let{devid:t}=await r.get("devid");return(o,n)=>{wn.setDeviceId(t);let i=wn.newInstance({site:"okex",product:o});return i.setApiEndpoint(`${e}/amplitude`),i.setCommonParams(Ou()),n(i),i}}async function ts(r,e){(await Ef(r,e))("web3_trade",vu)}var Cf=()=>{let[r,e]=(0,An.useState)(!1);return(0,An.useEffect)(()=>{let{getApiHostname:t}=R.global;ts(R.localStore,t()).then(()=>e(!0)).catch(()=>{})},[]),{initialized:r}},zl=Cf;u();l();u();l();var fo=w(V());var Zl=r=>{let{params:e,replace:t}=Rr(),{autoSwitch:o}=e,[n,i]=(0,fo.useState)(""),[a,c]=(0,fo.useState)(!0);return(0,fo.useEffect)(()=>{r&&(async()=>{if(r===O.SWAP&&o===qu.BRIDGE){let d=await nr.judgeTabTypeByParams(e==null?void 0:e.from,e==null?void 0:e.to);d===O.BRIDGE&&t({pathname:Pe,params:{...e,autoSwitch:void 0}}),i(d),c(!1)}else i(r),c(!1)})().catch(()=>{})},[r]),{tabType:n,autoSwitching:a}};u();l();var bn=w(V()),Jl=w(It());var ep=()=>{let{pathname:r}=(0,Jl.useLocation)(),[e,t]=(0,bn.useState)("");return(0,bn.useEffect)(()=>{switch(r){case cn:case Me:t(O.SWAP);break;case Pe:t(O.BRIDGE);break;default:break}},[r]),e};u();l();var rs=w(V());var tp=(r,e)=>{let{accountStore:t}=ie(),{params:o}=Rr(),{btcAddressType:n}=o;(0,rs.useEffect)(()=>{t.setBtcAddressType(n)},[]);let i=Vu();(0,rs.useEffect)(()=>{async function a(){let{hasFrom:c,hasTo:p}=nr.checkTokenParams(o==null?void 0:o.from,o==null?void 0:o.to),d=!c&&p||c&&!p,h=new nr(r,o,{useCrossTokenCheck:d}),{from:m,to:g,tab:T,inputAmount:y,error:C}=await h.initTokenPair(e);C||i(m,g,y,T)}r&&a().catch(()=>{})},[r])};u();l();var rp=w(V()),op=w(It());var np=r=>{let{fromToStore:e}=ie(),{from:t,to:o}=e,{params:n,replace:i}=Rr(),{pathname:a}=(0,op.useLocation)(),c=Wu();(0,rp.useEffect)(()=>{let p=c(t,o);p&&r&&[Me,Pe].includes(a)&&(new nr(r).writeTabInfoToLocalStorage(p),i({params:{...p,feeConfig:n.feeConfig}}))},[t==null?void 0:t.chainId,t==null?void 0:t.tokenContractAddress,o==null?void 0:o.chainId,o==null?void 0:o.tokenContractAddress,r,a])};var wf=r=>{let e=ep(),{tabType:t}=Zl(e);tp(t,r),np(t)},ip=wf;u();l();var cp=w(V());u();l();function Af(r){return new Promise(e=>setTimeout(e,r))}async function sp(r,e=3,t=0){let o;for(let n=0;n<e;n++)try{return await r()}catch(i){o=i,t&&n<e-1&&await Af(t)}throw o}function bf(r,e,t){let o=Ge();return{promise:r(e,{...t,signal:o.signal}),cancel:()=>o.abort()}}function Of(r,e,t){if(me())return bf(r,e,t);let o=new AbortController,n=o.signal;return{promise:r(e,{...t,signal:n}),cancel:()=>o.abort()}}function ap(r,e){return Of(P.get,r,e)}function up(){let{accountStore:r,fromToStore:e}=ie(),{address:t,setUserForbiddenBridge:o}=r,{receiveAddrObj:n}=e,{specifiedAddress:i}=n||{};(0,cp.useEffect)(()=>{let a=()=>{};if(t){let{promise:c,cancel:p}=ap(su,{params:{userWalletAddress:t,receiveWalletAddress:i}});a=p,c.then(d=>{o((d==null?void 0:d.data.blackListTypes)||tr)}).catch(()=>{o(tr)})}else o(tr);return a},[t,o,i])}u();l();var lp=w(V());function os(){let{accountStore:{address:r}}=ie();(0,lp.useEffect)(()=>{k.setTags({address:r})},[r])}u();l();var pp=w(V());var vf=()=>{let r=da(),{commonStore:e}=ie();(0,pp.useEffect)(()=>{e.setCurrentTheme(r)},[r,e])},dp=vf;u();l();var hp=w(V());var Pf=()=>{let{accountStore:r,fromToStore:e,approveStore:t,recentTransactionStore:o,tokenModalStore:n}=ie();(0,hp.useEffect)(()=>{let{computedAccountWalletAddresses:i}=r;return i&&(Rt.addListen("error",()=>{t.onSocketError(),o.onSocketError()}),Rt.addListen(zi.DEX_PUSH_ENGINE,a=>{o.onSocket(a),t.onSocket(a)}),Rt.addListen(zi.WALLET_ASSET,a=>{a&&(n.updateAllTokenList(a),e.updateFromBalancePush(a))}),Rt.init(i)),()=>{Rt.removeAll(),Rt.wsInstance&&i&&Rt.logout(i)}},[r.computedAccountWalletAddresses,o.onSocket,n.updateAllTokenList,e.updateFromBalancePush,r,o,n])},fp=Pf;u();l();var Nt=w(V()),mp=w(It());var kf=({currency:r,currentWallet:e,walletInfo:t,keyringIdentityTypeEnum:o,addressBookList:n,walletList:i,t:a,dispatch:c,currentTab:p})=>{let{commonStore:d,accountStore:h,recentTransactionStore:m,reset:g}=ie(),T=(0,mp.useHistory)();(0,Nt.useEffect)(()=>{R.setRuntimeContext({history:T,toLocale:a,dispatch:c,walletInfo:t})},[a,T,c,t]),(0,Nt.useEffect)(()=>{e&&h.setWalletConfig(e)},[e]),(0,Nt.useEffect)(()=>(d.getUserUnit(r),d.fetchChainList({businessLine:1,currentTab:p}).catch(()=>{d.setChainListLoadError(!0)}),()=>{g()}),[]),(0,Nt.useEffect)(()=>{h.setAddressBookList(n)},[n]),(0,Nt.useEffect)(()=>{h.setWalletList(i)},[i]),(0,Nt.useEffect)(()=>{h.setKeyringIdentityTypeEnum(o)},[o]),(0,Nt.useEffect)(()=>{e.walletId?m.updatePendingOrders(e.walletId):m.setPendingOrders([])},[e.walletId,p]),Gu()},Sp=kf;u();l();var ke=w(V()),Mt=w(It());u();l();var mo=w(V()),Pn=w(It()),wp=w(Tf());u();l();var gp=w(V());var Rf=({visible:r,onBack:e=()=>{},params:t})=>{let{useCoin:o}=R.hooks,{coinId:n,receiveOnly:i,chainId:a,tokenContractAddress:c}=t,p=o(a,c);return gp.default.createElement(R.components.SupplyGas,{visible:r,closeCallback:e,coinId:n||p.coinId,receiveOnly:i})},Tp=Rf;u();l();var On=w(V()),Ep=w(It());u();l();var yp=w(V());var Lf=()=>{let{components:{Mev:r}}=R,{quoteStore:{quote:e},mevStore:t}=ie(),{bestRoute:o}=e||{},{fromToken:n,toToken:i}=o||{},a=o==null?void 0:o.isEnableMev,{computedIsMevOpen:c,setMevUserSwitchOpen:p,setMevInfo:d}=t,h=!c&&Number(a)===Ar.ON;return yp.default.createElement(r,{isMev:c,chainId:n==null?void 0:n.chainId,toChainId:i==null?void 0:i.chainId,isShowBlockSwapMevTooltip:h,onMevChange:(m,g)=>{p(m),d(g)}})},_p=Ke(Lf);var Nf=[Ne,lt],Ip={[Me]:"swaptrade_card_swap_title_swap",[Pe]:"swaptrade_card_swap_title_swap",[lt]:"",[Ne]:"swaptrade_extension_cinteraction_contract_interaction",[oo]:"swaptrade_recent_transaction_detail_dialog_title"},Mf=r=>{let e="",t=null,o=!1,n=r.pathname,{type:i}=Au(r.search),a=i===fe.INTENT_SWAP,c=d=>S(Ip[d]),p=Nf.find(d=>n.startsWith(d));return p===r.pathname?e=c(p):p===lt&&p!==r.pathname?e=S(Ip[oo]):e=c(n),(n===Me||n===Pe)&&(o=!0),n===Ne&&!a&&(t=On.default.createElement(_p,null)),{title:e,rightIcon:t,settingIcon:o}},Df=()=>{let r=(0,Ep.useLocation)();return(0,On.useMemo)(()=>Mf(r),[r])},Cp=Df;u();l();var vn={wrapper:"_wrapper_bmqyn_1",container:"_container_bmqyn_5"};var Ff=({children:r,onBack:e})=>{let{title:t,isGray:o,rightIcon:n,settingIcon:i}=Cp(),a=(0,Pn.useLocation)(),c=(0,Pn.useHistory)(),{fromToStore:p,swapStore:d,tradeModeStore:h}=ie(),{visibleAddFunds:m,addFundsParams:g,closeAddFunds:T}=p,{walletSnapSwitchVisible:y,setWalletSnapSwitchVisible:C}=h,b=()=>{C(!y)},L=()=>{a.pathname===Ne&&kr({...d.getSaveOrderMonitorData(),button_name:"back"}),e?e(c.goBack):c.goBack()};return mo.default.createElement("div",{className:(0,wp.default)("universe-swap background-base-primary",vn.wrapper,{[vn.grey]:o})},mo.default.createElement(Hu,{title:t,onBack:L,rightIcon:n,settingIcon:i,settingIconClick:b}),mo.default.createElement("div",{className:vn.container},r),mo.default.createElement(Tp,{visible:m,params:g,onBack:T}))},Ap=Ke(Ff);var xf=(0,ke.lazy)(()=>import("./Swap-EFBTMMYW.js")),Bf=(0,ke.lazy)(()=>import("./Bridge-57VTRZTQ.js")),Uf=(0,ke.lazy)(()=>import("./OrderDetail-PH7R26QB.js")),qf=(0,ke.lazy)(()=>import("./Contract-BMZHCSGG.js")),Vf=({onBack:r})=>{let e=(0,Mt.useLocation)();return ke.default.createElement(Ap,{onBack:r},ke.default.createElement(ke.Suspense,null,ke.default.createElement(Mt.Switch,null,[{path:Me,component:xf,exact:!0},{path:Pe,component:Bf,exact:!0},{path:oo,component:Uf,exact:!0},{path:Ne,component:qf,exact:!0}].map((o,n)=>ke.default.createElement(Mt.Route,{key:n,path:o.path,component:o.component,exact:o.exact})),ke.default.createElement(Mt.Redirect,{from:cn,to:{pathname:Me,search:e.search},strict:!0,exact:!0}))))},bp=Vf;var Wf=({currency:r,currentWallet:e,keyringIdentityTypeEnum:t,addressBookList:o,walletList:n,walletInfo:i,onBack:a,t:c,dispatch:p,currentTab:d=O.SWAP})=>{ip(i.chainId),dp(),Sp({currency:r,currentWallet:e,walletInfo:i,keyringIdentityTypeEnum:t,addressBookList:o,walletList:n,t:c,dispatch:p,currentTab:d}),up(),fp(),os();let{initialized:h}=zl();return h?kn.default.createElement(bp,{onBack:a}):null},Op=(0,kn.memo)(Ke(Wf));u();l();u();l();u();l();u();l();u();l();var vp=(r,e)=>{let t=r.split(".").map(Number),o=e.split(".").map(Number),n=Math.max(t.length,o.length);for(let i=0;i<n;i++){let a=t[i]||0,c=o[i]||0;if(a>c)return 1;if(a<c)return-1}return 0};var So=class{constructor(){s(this,"btcAddressType","");s(this,"setBtcAddressType",e=>{this.btcAddressType=e});s(this,"commonStore",null);s(this,"scanAppType",{});s(this,"walletType",{});s(this,"initWalletConstants",async()=>{let e=await this.getWalletConstants();this.scanAppType=e.SCANING_APP_TYPE,this.walletType=e.WALLET_TYPE});s(this,"userForbiddenWithBridge",tr);s(this,"setUserForbiddenBridge",e=>{this.userForbiddenWithBridge=e});s(this,"defaultWalletConfig",Rc);s(this,"walletConfig",this.defaultWalletConfig);s(this,"hasInitWalletInfo",!1);s(this,"chainId",Lt);s(this,"setChainId",e=>{this.chainId=e});s(this,"fromChainId",Lt);s(this,"setFromChainId",e=>{this.fromChainId=e});s(this,"walletSupportMev",!1);s(this,"setWalletSupportMev",e=>{this.walletSupportMev=e});s(this,"checkOkxVersion",async()=>{var o;let e="2.82.31",t=this.walletConfig.isOkxWallet;if(this.isConnectedWallet&&t&&((o=window==null?void 0:window.okxwallet)==null?void 0:o.getVersion)){let n=await window.okxwallet.getVersion(),a=vp(n,e)>=0;this.setWalletSupportMev(a)}else this.setWalletSupportMev(!1)});this.initWalletConstants().catch(()=>{})}getDeviceId(){}getChainId(){}getWalletConstants(){}get address(){return Lt}get computedForbiddenBridge(){let{computedIsCrossChain:e}=this.rootStore.fromToStore;return e?this.userForbiddenWithBridge:tr}get computedAccountId(){let{walletConfig:e}=this;return e.walletId}setWalletConfig(e={}){this.walletConfig=e}getAddressByChainId(){}get isConnectedWallet(){return!!this.walletConfig.walletId}get computedNonsupportChain(){return!this.isConnectedWallet||!$(this.fromChainId)?!1:!this.address}get computedAccountWalletAddresses(){return vr(A(this,"walletConfig.address",[])).join(",")||this.address}get computedAccountWalletAddressesArray(){return vr(A(this,"walletConfig.address",[]))||[this.address]}get computedSpecialWalletAddress(){return this.getAddressByChainId(W.BTC_MAINNET)}};u();l();u();l();function Re(r=[],e=[]){let t={};r.forEach(n=>{t[n]=Xr});let o={};return e.forEach(n=>{o[n]=pc}),{...t,...o}}var Pp=Re(["scanAppType","walletType","walletConfig","chainId","hasInitWalletInfo","fromChainId","btcAddressType"],["computedAccountId","isConnectedWallet","computedNonsupportChain","computedAccountWalletAddresses","computedAccountWalletAddressesArray","address","computedSpecialWalletAddress"]);var ns=class extends So{constructor(t){super();s(this,"formatWalletType",()=>{let{walletInfo:t}=R,{isHARDWARE:o,isMNEMONIC:n,isMPC:i,isPRIVATE:a}=(t==null?void 0:t.walletType)||{};return o?bt.HARDWARE:n?bt.MNEMONIC:i?bt.MPC:a?bt.PRIVATE_KEY:null});s(this,"formatWalletAccount",t=>{let o=Object.values(t.account);return{...t,OKXWalletType:this.formatWalletType(),address:o}});s(this,"keyringIdentityTypeEnum",{});s(this,"walletList",[]);s(this,"addressBookList",[]);s(this,"hasInitWalletInfo",!1);s(this,"getAddressByChainId",t=>{var n;if(!$(t))return Lt;let o=this.getWalletChainName(t);return((n=this.walletConfig.account)==null?void 0:n[o])||Lt});this.rootStore=t,this.commonStore=t.commonStore,Te(this,Pp)}async getDeviceId(){let{devid:t}=await R.localStore.get("devid");return t}getCurrentChainAddress(t){var i;let o=(i=this.rootStore)==null?void 0:i.fromToStore.from.chainId;if(!$(o))return Lt;let n=this.getWalletChainName(o);return t.account[n]}getWalletConstants(){return{SCANING_APP_TYPE:"1",WALLET_TYPE:"2"}}getWalletChainName(t){return R.getNetWorkName(t)}replaceBtcAddressByType(t){var o,n,i;if(this.btcAddressType){let a=this.getWalletChainName(W.BTC_MAINNET);if((o=t.account)!=null&&o[a]){let c=(n=t.accountsMap)==null?void 0:n.bitcoin,p=(i=c==null?void 0:c[this.btcAddressType])==null?void 0:i.address;if(p)return{...t,account:{...t.account,[a]:p}}}}return t}setWalletConfig(t){this.walletConfig=this.formatWalletAccount(this.replaceBtcAddressByType(t)),this.hasInitWalletInfo=!0}webSwapHistoryDetailViewMore(){}setAddressBookList(t){this.addressBookList=t}setWalletList(t){this.walletList=t.map(o=>o.walletId===this.computedAccountId?this.replaceBtcAddressByType(o):o)}setKeyringIdentityTypeEnum(t){this.keyringIdentityTypeEnum=t}get address(){return this.getAddressByChainId(this.fromChainId)}},kp=ns;u();l();u();l();u();l();var De={COLLECT_LIST:"COLLECT_LIST",ALL_NETWORK:"ALL_NETWORK",CHAIN_LIST:"CHAIN_LIST",SEARCH:"SEARCH"},Gf={[De.COLLECT_LIST]:{[O.SWAP]:Xc,[O.LIMIT_ORDER]:Wi,[O.BRIDGE]:Wi},[De.ALL_NETWORK]:{[O.SWAP]:Yc,[O.LIMIT_ORDER]:Vi,[O.BRIDGE]:Vi},[De.SEARCH]:{[O.SWAP]:zc,[O.LIMIT_ORDER]:Gi,[O.BRIDGE]:Gi},[De.CHAIN_LIST]:{[O.SWAP]:Wc,[O.LIMIT_ORDER]:Gc,[O.BRIDGE]:Vc}},Dt=(r,e)=>{var t,o;return(o=(t=Gf[r])==null?void 0:t[e])!=null?o:""};u();l();var is=r=>!!((r==null?void 0:r.isNativeToken)===fc.TRUE||(r==null?void 0:r.isBaseCoin)),Rn=r=>r?$(r.chainId)&&r.tokenContractAddress:!1;var{BigNumber:Hf}=I,go=class{constructor(e){s(this,"rootStore",null);s(this,"userUniqueId",Bu());s(this,"chainList",[]);s(this,"setChainList",e=>{this.chainList=e});s(this,"transactionLoading",!1);s(this,"setTransactionLoading",e=>{this.transactionLoading=e});s(this,"nowCurrencyUnit",{});s(this,"tokenModalVisible",!1);s(this,"safemoonSlippage",0);s(this,"fetchChainList",async({businessLine:e=1,isLimit:t=!1,isHistory:o=!1,currentTab:n})=>{if(Cc())return[];let i=Dt(De.CHAIN_LIST,this.currentTab||n),a=await P.get(i,{params:{businessLine:t?pt.LIMIT_ORDER:e}});return!o&&this.setChainList(a==null?void 0:a.data),this.setCurrentTabChainList({[t?O.LIMIT_ORDER:O.SWAP]:a==null?void 0:a.data}),a==null?void 0:a.data});s(this,"currentTabChainList",{});s(this,"setCurrentTabChainList",e=>{this.currentTabChainList={...this.currentTabChainList,...e}});s(this,"getTradeType",()=>{var e,t;return(t=(e=this.rootStore)==null?void 0:e.fromToStore)!=null&&t.computedIsCrossChain?qi.MULTI:qi.SINGLE});s(this,"globalMessages",null);s(this,"setGlobalMessage",e=>{this.globalMessages=e});s(this,"cleanGlobalMessage",()=>{this.globalMessages=null});s(this,"socketStatus",!1);s(this,"balancePushSocketStatus",!1);s(this,"resetFromToByTabChange",!1);s(this,"setResetFromToByTabChange",e=>{this.resetFromToByTabChange=e});s(this,"portal",Ve.DEX);s(this,"setPortal",e=>{this.portal=e});s(this,"currencyConversion",e=>{let{usdToThisRate:t}=this.nowCurrencyUnit,o=new I.BigNumber(e);return!t||o.isNaN()?"":o.multipliedBy(t)});s(this,"isSensitiveChain",e=>this.computedSensitiveChainIds.some(t=>String(t)===String(e)));s(this,"getTokenAddress",e=>{let t=this.isSensitiveChain(e==null?void 0:e.chainId),o=(e==null?void 0:e.tokenContractAddress)||(e==null?void 0:e.tokenAddress);return t?o:dt(o)});s(this,"equalsToken",(e,t)=>{let o=e!==null&&String(e==null?void 0:e.chainId)===String(t==null?void 0:t.chainId);return is(e)&&is(t)?o:o&&this.getTokenAddress(e)===this.getTokenAddress(t)});s(this,"fromFillToken",!1);s(this,"currentTab","");s(this,"setCurrentTab",(e,t)=>{var o,n;this.currentTab!==e&&(this.setResetFromToByTabChange(!0),(n=(o=this.rootStore)==null?void 0:o.fromToStore)==null||n.clearFromTo()),this.currentTab=e,this.fromFillToken=!!t});s(this,"marketWsIsConnected",!1);s(this,"setMarketWsIsConnected",e=>{this.marketWsIsConnected=e});s(this,"forceUpdateFromToByHash",0);s(this,"forceUpdateFromTo",()=>{this.forceUpdateFromToByHash+=1});s(this,"currentTheme","");s(this,"setCurrentTheme",e=>{this.currentTheme=e});this.rootStore=e,Lr&&this.setPortal(Ve.LEDGER)}setChainType(){}get computedReserveGas(){let{chainList:e}=this,t=this.rootStore.fromToStore.from.chainId,o=e.find(n=>Number(n.chainId)===Number(t));return(o==null?void 0:o.reserveGas)||""}getChainByID(e){return this.chainList.find(t=>(this.computedCurrentTabIsLimit||t.chainUsed)&&t.chainId===Number(e))}getUserUnit(){}get computedRealSlippageValue(){return A(this,"rootStore.slippageStore",{}).computedRealSlippageValue||0}setSocketStatus(e){this.socketStatus=e}setBalanceSocketStatus(e){this.balancePushSocketStatus=e}get computedIsWalletEnv(){return this.portal===Ve.OKX_WALLET_EXTENSION}get computedIsWalletDashBoard(){return this.portal===Ve.WALLET_DASHBOARD}get computedIsMarket(){return this.portal===Ve.MARKET}get computedNotThirdBiz(){return this.portal===Ve.OKX_WALLET_EXTENSION||this.portal===Ve.DEX||this.portal===Ve.MARKET}get computedNowCurrencySymbol(){return this.nowCurrencyUnit.symbol||""}get computedSensitiveChainIds(){return this.chainList.map(e=>Number(e.isSensitive)===yc.YES?e.chainId:null).filter(Boolean)}get computedCurrentTabIsLimit(){return this.currentTab===O.LIMIT_ORDER}get computedIsUrlFillSwap(){return this.computedIsWalletDashBoard||this.computedIsWalletEnv}toBaseFormatUSD(e,t){var a;let o=this.computedNowCurrencySymbol,n=(a=this.nowCurrencyUnit)==null?void 0:a.usdToThisRate,i=Hf(e).multipliedBy(n).toString();return he(i,o,{needPlaceholder:!0,...t})}};u();l();var Rp=Re(["userUniqueId","chainList","transactionLoading","nowCurrencyUnit","tokenModalVisible","safemoonSlippage","globalMessages","socketStatus","balancePushSocketStatus","portal","currentTab","currentTabChainList","forceUpdateFromToByHash","marketWsIsConnected","currentTheme"],["computedReserveGas","computedNowCurrencySymbol","computedSensitiveChainIds","computedIsWalletEnv","computedCurrentTabIsLimit"]);var To=class extends go{constructor(t){super(t);s(this,"swapCollapse",!1);s(this,"setSwapCollapse",t=>{this.swapCollapse=t});s(this,"chainListLoadError",!1);s(this,"setChainListLoadError",t=>{this.chainListLoadError=t});Te(this,{...Rp,swapCollapse:Xr,chainListLoadError:Xr}),this.setPortal(vc)}getUserUnit(t){this.nowCurrencyUnit=t}};u();l();var yo=class{constructor(){s(this,"snapModeSwitch",!1);s(this,"setSnapModeSwitch",e=>{this.snapModeSwitch=e,this.resetTradingModeBySwitch(e)});s(this,"isSupportSnapChain",!1);s(this,"isMetSnap",rn.NOT_SUPPORT);s(this,"tradingModeType","");s(this,"walletSnapSwitchVisible",!1);s(this,"setWalletSnapSwitchVisible",e=>{this.walletSnapSwitchVisible=e});s(this,"bestPriceTag",Ri.NO_COMPARE);s(this,"setBestPriceTag",e=>{this.bestPriceTag=e});H(this,{},{autoBind:!0})}resetTradingModeBySwitch(e,t){t&&!this.tradingModeType||(this.setTradingModeType(e?Ot.COMPARE_MODE:Ot.AUTO),this.setBestPriceTag(Ri.NO_COMPARE))}setIsSupportSnapChain(e){this.isSupportSnapChain=e}setIsMetSnap(e){this.isMetSnap=e}setTradingModeType(e){this.tradingModeType=e}get computedIsSnapType(){return this.tradingModeType===Ot.SNAP_MODE}};u();l();var _o=class{constructor(e){s(this,"showLimitDialog",!1);s(this,"setShowLimitDialog",e=>{this.showLimitDialog=e});s(this,"cancelRef",null);s(this,"callbackList",[]);s(this,"addToCallbackList",e=>{this.callbackList.push(e)});s(this,"removeFromCallbackList",e=>{this.callbackList=this.callbackList.filter(t=>t!==e)});s(this,"updateTokenCollectStatus",async({tokenInfo:e,callBack:t})=>{let{isConnectedWallet:o}=this.accountStore;if(!o){this.walletWarnInterceptor();return}this.cancelRef&&this.cancelRef.abort(),this.cancelRef=Ge();let n={tokenContractAddress:e==null?void 0:e.tokenContractAddress,chainId:Number(e==null?void 0:e.chainId),symbol:e==null?void 0:e.tokenSymbol,decimal:e==null?void 0:e.decimals,walletAddress:this.accountStore.getAddressByChainId(Number(e==null?void 0:e.chainId))||this.accountStore.computedAccountWalletAddresses,userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,mnemonicWallet:this.accountStore.computedAccountWalletAddresses,isCustomToken:(e==null?void 0:e.isCustomToken)||(e==null?void 0:e.isSubscribe)},[i,a]=await N(P.post(an,n,{signal:this.cancelRef.signal}));if(!kt(i)&&i)F.error(S("swaptrade_pricechart_no_connection_desc"));else if(a){if((a==null?void 0:a.data)===-1)this.setShowLimitDialog(!0);else if((a==null?void 0:a.data)===0)F.success({title:S("swaptrade_selecttoken_toast_removed_from_favorite"),duration:qe}),t({selected:!1,tokenInfo:e}),this.callbackList.forEach(c=>{c({selected:!1,tokenInfo:e})});else if((a==null?void 0:a.data)===1){let c=Mu(),{isMarketHomeUrl:p}=Du();!p&&fn({business_type:c?Di.LIMIT_ORDER:Di.SWAP}),F.success({title:S("swaptrade_selecttoken_toast_added_to_favorite"),duration:qe}),t({selected:!0,tokenInfo:e}),this.callbackList.forEach(d=>{d({selected:!0,tokenInfo:e})})}}});s(this,"debounceUpdateTokenCollectStatus",ln(this.updateTokenCollectStatus,500));s(this,"walletWarnInterceptor",()=>{F.error({title:S("swaptrade_selecttoken_toast_connect_wallet"),duration:qe})});this.rootStore=e,this.commonStore=e.commonStore,this.accountStore=e.accountStore,H(this,{},{autoBind:!0})}};var ir=class{constructor(){ir.instance?(this.commonStore=ir.instance.commonStore,this.accountStore=ir.instance.accountStore,this.updateCollectionStore=ir.instance.updateCollectionStore):(this.commonStore=new To(this),this.accountStore=new kp(this),this.updateCollectionStore=new _o(this),ir.instance=this),this.tradeModeStore=new yo(this)}},sr=ir;s(sr,"instance",null);u();l();u();l();u();l();function Ln(r){return[vt.USER_DENIED,vt.WC2Denied].includes(r==null?void 0:r.code)}var{BigNumber:Qf}=I,ss=class{constructor(e){s(this,"approveTokenDefaultConfig",{status:B.Unknown,approvedAmount:"0"});s(this,"approveTokensConfig",{});s(this,"getApproveTokenMapKey",(e,t)=>{let o=this.commonStore.getTokenAddress(e);return`${e.chainId}_${o}_${t}`});s(this,"registerApproveToken",(e,t)=>{let o=this.getApproveTokenMapKey(e,t),n=A(this.approveTokensConfig,o);se(n)&&(this.approveTokensConfig[o]={...this.approveTokenDefaultConfig})});s(this,"registerCurrentApproveToken",()=>{let{token:e,tradeModeCode:t}=this.computedTokenAndTradeModeCode;this.registerApproveToken(e,t)});s(this,"updateApproveTokenConfig",(e,t,o)=>{let n=this.getApproveTokenMapKey(e,t),i=A(this.approveTokensConfig,n);se(i)?k.stuff("if you want to update approve token config, you should register it first."):this.approveTokensConfig[n]={...i,...o}});s(this,"removeApproveTokenConfig",(e,t)=>{let o=this.getApproveTokenMapKey(e,t);delete this.approveTokensConfig[o]});s(this,"updateCurrentApproveTokenConfig",e=>{let{token:t,tradeModeCode:o}=this.computedTokenAndTradeModeCode;this.updateApproveTokenConfig(t,o,e)});s(this,"getApproveTokenConfig",(e,t)=>{let o=this.getApproveTokenMapKey(e,t);return A(this.approveTokensConfig,o,this.approveTokenDefaultConfig)});s(this,"clearNonApprovingTokensConfig",()=>{let e=Tu(this.approveTokensConfig,t=>[B.Approving,B.CancelApproving].includes(t.status));this.approveTokensConfig={...e}});s(this,"isApprovalCheckRequired",()=>{let{computedIsSolanaChain:e,computedIsAptosChain:t}=this.fromToStore,{quote:{bestRoute:o}}=this.rootStore.quoteStore,n=this.commonStore.computedCurrentTabIsLimit,{token:i}=this.computedTokenAndTradeModeCode,{isNativeToken:a}=i;return(n?!0:(o==null?void 0:o.needApprove)==="1")&&!a&&!e&&!t});s(this,"validApproveAmountLessSwapAmount",e=>{let{token:t}=this.computedTokenAndTradeModeCode;return Qf(e).isLessThan(t.amount||"0")});s(this,"isValidApprovalStatus",(e,t)=>{let o=We(e),n=this.validApproveAmountLessSwapAmount(e);return o?B.UnApproved:n&&t?B.CancelApprove:n?B.UnApproved:B.Approved});s(this,"generateApproveRequestParams",e=>{let{address:t}=this.accountStore,{token:o,tradeModeCode:n}=this.computedTokenAndTradeModeCode,{tokenContractAddress:i,chainId:a}=o,{computedIsDexQuote:c}=this.rootStore.quoteStore;return{userWalletAddress:t,tokenContractAddress:i,chainId:a,cancelApproveTag:e,...c?{}:{intentCode:n}}});s(this,"fetchApproveAllowance",()=>P.get(Qc,{params:this.generateApproveRequestParams()}).then(e=>e==null?void 0:e.data));s(this,"fetchApproveData",e=>{let t=this.generateApproveRequestParams(e);return P.get(Kc,{params:t}).then(o=>{let{id:n,data:i,from:a,to:c,unsignedTx:p}=(o==null?void 0:o.data)||{},d={data:i,from:a,to:c};return k.info(M.APPROVE_DATA,{id:n,data:i,from:a,to:c,unsignedTx:p,cancelApproveTag:e}),gn(t.chainId)&&(d=JSON.parse(p)),{transactionPayload:d,id:n}})});s(this,"approveStatusIsPending",()=>[B.Approving,B.CancelApproving].includes(this.computedApprovalStatus));s(this,"isPendingNeedCheck",async()=>{this.approveStatusIsPending()&&this.checkApprove().catch(()=>{})});s(this,"isPendingNotCheck",async()=>{this.approveStatusIsPending()||this.checkApprove().catch(()=>{})});s(this,"checkApprove",async()=>{let{token:e,tradeModeCode:t}=this.computedTokenAndTradeModeCode;if(this.registerApproveToken(e,t),!this.isApprovalCheckRequired()){this.updateApproveTokenConfig(e,t,{status:B.Approved});return}let{tokenContractAddress:o,decimals:n}=e,{address:i}=this.accountStore;if(o&&i){let[,a]=await N(this.fetchApproveAllowance());if(!a){this.updateApproveTokenConfig(e,t,{status:B.Unknown});return}let c=Number(a.status)===B.Approved?a.amount:"0",p=Pr(c,n)||"0",d=a==null?void 0:a.needCancelApproveToken,h=this.isValidApprovalStatus(p,d);this.updateApproveTokenConfig(e,t,{status:h,approvedAmount:p})}});s(this,"fetchApproveDataErrorTips",(e,t)=>{this.updateCurrentApproveTokenConfig({status:B.UnApproved});let o=q(e==null?void 0:e.tokenSymbol);yn({title:t?S("swaptrade_transfer_notification_title_ccy_unrevoked",{ccy:o}):S("swaptrade_toast_approve_fail",{tokenSymbol:o})})});s(this,"approveErrorTips",({error:e,chainId:t,transactionPayload:o,token:n,tradeModeCode:i,cancelApproveTag:a})=>{k.error(M.APPROVE_TOKEN_ERROR,{chainId:t,transactionPayload:o,error:e,token:n,tradeModeCode:i}),Ln(e)||yr.error({title:S("swaptrade_home_toast_broadcast_failed")}),this.updateApproveTokenConfig(n,i,{status:this.isCancelApprove(a)?B.CancelApprove:B.UnApproved})});s(this,"isCancelApprove",e=>e===Ir.CANCEL_APPROVE);s(this,"setApprove",async e=>{let{token:t,tradeModeCode:o}=this.computedTokenAndTradeModeCode,{chainId:n}=t;this.updateApproveTokenConfig(t,o,{status:this.isCancelApprove(e)?B.CancelApproving:B.Approving});try{let{id:i,transactionPayload:a}=await this.fetchApproveData(e);await this.approveToken({chainId:n,transactionPayload:a}).then(({result:c})=>this.saveApprove({id:i,chainId:n,transactionHash:c,cancelApproveTag:e})).catch(c=>{this.approveErrorTips({error:c,chainId:n,transactionPayload:a,token:t,tradeModeCode:o,cancelApproveTag:e})})}catch{this.fetchApproveDataErrorTips(t,e)}});s(this,"saveApprove",async({id:e,chainId:t,transactionHash:o,cancelApproveTag:n})=>{if(!o)return;let{address:i}=this.accountStore;k.info(M.SAVE_APPROVE,{id:e,transactionHash:o,chainId:t,userWalletAddress:i,cancelApproveTag:n});try{await P.post($c,{id:e,transactionHash:o,chainId:t,userWalletAddress:i,cancelApproveTag:n})}catch(a){k.info(M.SAVE_APPROVE_ERROR,{error:a==null?void 0:a.message,id:e,transactionHash:o,chainId:t,userWalletAddress:i,cancelApproveTag:n})}});s(this,"onSocket",async e=>{if((e==null?void 0:e.type)==="1"&&(e==null?void 0:e.dexData)&&e.dexData.type==="approve"){let t=e.dexData,{status:o,transactionHash:n,fromTokenSymbol:i,fromTokenAddress:a,exploreUrl:c,solanaToast:p,intentCode:d=on}=t,h=me();if(p==="1"){if(h)return;let b=o===Er.CANCEL_APPROVE_SUBMITTED?"swaptrade_transfer_toast_ccy_unrevoke_submit":"swaptrade_transfer_notification_approval_submit";Tn({title:S(b,{ccy:q(i)})});return}let{token:m,tradeModeCode:g}=this.computedTokenAndTradeModeCode,T={chainId:t.chainId,tokenContractAddress:a},y=this.commonStore.equalsToken(m,T),C=String(g)===String(d);if(y&&C&&await this.isPendingNeedCheck(),(!y||y&&!C)&&this.removeApproveTokenConfig(T,d),o===Er.APPROVE_SUCCESS){let b=S("swaptrade_toast_approve_success",{tokenSymbol:q(i)});!h&&Tn({title:b,exploreUrl:c}),ho.emit(po.APPROVE,{data:n,status:0,message:b})}else if(o===Er.APPROVE_FAILED&&!h){let b=S("swaptrade_toast_approve_fail",{tokenSymbol:q(i)});yn(b,c)}else if(o===Er.CANCEL_APPROVE_SUCCESS&&!h){let b=S("swaptrade_transfer_notification_title_ccy_revoked",{ccy:q(i)});Tn(b,c)}else if(o===Er.CANCEL_APPROVE_FAILED&&!h){let b=S("swaptrade_transfer_notification_title_ccy_unrevoked",{ccy:q(i)});yn({title:b,exploreUrl:c})}}});s(this,"onSocketError",()=>{this.isPendingNeedCheck().catch(()=>{})});this.rootStore=e,this.accountStore=e.accountStore,this.commonStore=e.commonStore,this.fromToStore=e.fromToStore}get computedApprovalStatus(){let{token:e,tradeModeCode:t}=this.computedTokenAndTradeModeCode;return this.getApproveTokenConfig(e,t).status}get computedTokenAndTradeModeCode(){let{from:e}=this.fromToStore,{tradingModeType:t}=this.rootStore.tradeModeStore;return{token:e,tradeModeCode:t}}get computedIsCancelApproveStatus(){return[B.CancelApprove,B.CancelApproving].includes(this.computedApprovalStatus)}approveToken(){}},Lp=ss;u();l();var Np=Symbol(),Mp=Object.prototype,Kf=(r,e,t)=>{if(dc(r))throw new Error("Target must not be observable");let o=r[Np];if(o){let n={};for(let i in r)o[i]&&(n[i]=o[i]);o=n}else{o={};let n=r;for(;n&&n!==Mp;)Reflect.ownKeys(n).forEach(a=>{a===lc||a==="constructor"||(o[a]=e&&a in e?e[a]:!0)}),n=Object.getPrototypeOf(n);let i=Object.getPrototypeOf(r);i&&i!==Mp&&Object.defineProperty(i,Np,{value:o})}return Te(r,o,t)},Ft=Kf;var ar=class extends Lp{constructor(t){super(t);s(this,"visibleApprove",!1);s(this,"setVisibilityApprove",t=>{this.visibleApprove=t});s(this,"approveInfo",{});s(this,"setApproveInfo",t=>{this.approveInfo=t});s(this,"setApprove",async(t=Ir.APPROVE)=>{let{token:o,tradeModeCode:n}=this.computedTokenAndTradeModeCode,{chainId:i}=o;this.updateApproveTokenConfig(o,n,{status:this.isCancelApprove(t)?B.CancelApproving:B.Approving});try{let{id:a,transactionPayload:c}=await this.fetchApproveData(t);this.setApproveInfo({chainId:i,id:a,transactionPayload:c,token:o,tradeModeCode:n,cancelApproveTag:t}),this.setVisibilityApprove(!0)}catch{this.fetchApproveDataErrorTips(o,t)}});s(this,"approveCancel",()=>{let t=this.approveInfo.cancelApproveTag;this.setApproveInfo({}),this.setVisibilityApprove(!1),this.updateCurrentApproveTokenConfig({status:this.isCancelApprove(t)?B.CancelApprove:B.UnApproved})});s(this,"approveConfirm",async({txHash:t,error:o})=>{if(o){this.approveErrorTips({error:o,...this.approveInfo}),this.approveCancel();return}let{id:n,chainId:i,cancelApproveTag:a}=this.approveInfo;await this.saveApprove({id:n,chainId:i,transactionHash:t,cancelApproveTag:a}),this.setVisibilityApprove(!1),this.setApproveInfo({})});Ft(this)}};u();l();u();l();var{BigNumber:$f}=I,cr=()=>{let{fromToStore:r,gasDropStore:e,receiveAddressStore:t,outerStore:o,quoteStore:n,accountStore:i,tradeModeStore:a,liquidityChooseStore:c}=wt(),{from:p,to:d}=r,{receiveAddrObj:h}=t,{computedForbiddenBridge:m,address:g}=i,{tradingModeType:T}=a,y=$f(r.computedTypedValue).toString(10),b={...{chainId:p.chainId,toChainId:d.chainId,toTokenAddress:d.tokenContractAddress,fromTokenAddress:p.tokenContractAddress,amount:y,userWalletAddress:g},...n.computedSlippage,pmm:"1",gasDropType:e!=null&&e.computedGasDropSelected?1:0,forbiddenBridgeTypes:Ki(m),dexIds:Ki(c==null?void 0:c.computedIds),receiveWalletAddress:h==null?void 0:h.specifiedAddress,tradingModeType:T};return o.extendFeeConfig(b)};u();l();u();l();u();l();var re=class{constructor({orderData:e,extParams:t},o){s(this,"walletNoNeedExtParams",!1);s(this,"differentiatedEnvironment",e=>me()&&e.length>1&&!this.walletNoNeedExtParams&&!e[0].params?[{...e[0],extParams:e[1]}]:e);this.orderData=e,this.calldataType=e.calldataType,this.extParams=t||{},this.swapStore=o}get isTransferType(){return this.calldataType===Ic.TRANSFER}};var Io=class extends re{constructor(){super(...arguments);s(this,"formatContractPayload",()=>{var o;let{orderData:t}=this;return{...JSON.parse((o=t==null?void 0:t.callData)==null?void 0:o.data)}});s(this,"formatTransferPayload",()=>{});s(this,"getSendTransactionParams",async()=>{let t=this.formatContractPayload();return this.differentiatedEnvironment([{...t,extParams:this.extParams}])});s(this,"preExecution",async()=>({payload:this.formatContractPayload()}))}};u();l();var Eo=class extends re{constructor(t,o,n){super(t,o);s(this,"makeSendBtcCallParams",async t=>{let{preDataForSendBtc:o}=this.swapStore.rootStore.walletContractStore;if(!o)throw Error("preDataForSendBtc is not ready");let{satBytes:n,coinAmount:i,dustSize:a,fetchUtxoList:c,serviceCharge:p}=o,d=await c();return{...t,utxoList:d,satBytes:n,dustSize:a,coinAmount:i,serviceCharge:p}});s(this,"formatContractPayload",()=>{});s(this,"formatTransferPayload",async()=>{let{orderData:t}=this;return this.swapStore.transferBtcPayload(t.callData)});s(this,"extendExtParams",t=>({...t,extParams:this.extParams}));s(this,"getSendTransactionParams",async()=>{if(!this.token.isNativeToken)throw new Error("btc token is not native token");let t;if(this.isTransferType){let o=await this.formatTransferPayload();t=this.extendExtParams(o),me()&&(t=await this.makeSendBtcCallParams(t))}else throw Error("Not support contract call");return this.differentiatedEnvironment([t])});s(this,"preExecution",async()=>{if(!this.token.isNativeToken)throw new Error("btc token is not native token");let t;if(this.isTransferType)t=await this.formatTransferPayload();else throw Error("Not support contract call");return{payload:t}});this.token=n}};u();l();var as=class extends re{constructor(){super(...arguments);s(this,"valueToHex",t=>new I.BigNumber(t).toString(16));s(this,"formatContractPayload",()=>{let{orderData:t}=this,{priorityFee:o,maxFeePerGas:n,maxPriorityFeePerGas:i,gasPrice:a,gas:c,...p}=(t==null?void 0:t.callData)||{};return p});s(this,"formatTransferPayload",()=>{let{orderData:t}=this;return t.callData});s(this,"getSendTransactionParams",async()=>{let{payload:t}=await this.preExecution();return Lr&&t.value&&(t.value=this.valueToHex(t.value)),this.differentiatedEnvironment([t])});s(this,"preExecution",async()=>{let t;this.isTransferType?t=this.formatTransferPayload():t=this.formatContractPayload();let{extendEvmParams:o,extendsGas:n}=this.swapStore;return t.extParams=this.extParams,n&&(t=n(t)),t=o(t),{payload:t}})}},cs=as;u();l();var{BigNumber:Dp}=I,Co=class extends re{constructor(){super(...arguments);s(this,"importSolana",async()=>{let t=await import("./index.browser.esm-LIT27GMB.js"),{default:o}=await import("./bs58-LOQCN74J.js");return{SolanaWeb3:t,bs58:o}});s(this,"deserialize",async t=>{let o,{SolanaWeb3:n,bs58:i}=await this.importSolana();try{o=n.Transaction.from(i.decode(t))}catch{o=n.VersionedTransaction.deserialize(i.decode(t))}return o});s(this,"rentReserve",t=>{if(!t)return"0";let o=Dp("365.25").div(2).multipliedBy(2);return Dp("19.055441478439427").multipliedBy(t).multipliedBy(o).div(10**9).toFixed(9)});s(this,"formatContractPayload",async()=>{let{orderData:t}=this,{bizType:o,bizId:n,data:i,accountLength:a}=JSON.parse(t.unsignedTx),c=await this.deserialize(i);return{payload:{bizType:o,bizId:n,transaction:c},rent:this.rentReserve(a)}});s(this,"formatTransferPayload",async()=>{let{orderData:t}=this,{unsignedTx:o}=t,n=JSON.parse(o),{data:i,accountLength:a}=n;return{payload:{transaction:await this.deserialize(i)},rent:this.rentReserve(a)}});s(this,"getSendTransactionParams",async()=>{let{payload:t}=await this.preExecution();return this.differentiatedEnvironment([t,this.extParams])});s(this,"preExecution",async()=>{let t;return this.isTransferType?t=await this.formatTransferPayload():t=await this.formatContractPayload(),t})}};u();l();var wo=class extends re{constructor(){super(...arguments);s(this,"formatContractPayload",()=>{let{orderData:t}=this,{data:o,from:n}=t.callData,i=JSON.parse(o);return{...i,functionArgs:i.functionArgsEncode,txType:"contract_call",stxAddress:n}});s(this,"formatTransferPayload",()=>{});s(this,"getSendTransactionParams",async()=>this.differentiatedEnvironment([this.formatContractPayload(),this.extParams]));s(this,"preExecution",async()=>({payload:this.formatContractPayload()}))}};u();l();var Ao=class extends re{constructor(){super(...arguments);s(this,"walletNoNeedExtParams",!0);s(this,"formatContractPayload",()=>{let{orderData:t}=this,o=JSON.parse(t.unsignedTx),{executionRequest:n}=JSON.parse(o.data);return n.calls});s(this,"formatTransferPayload",()=>{});s(this,"getSendTransactionParams",async()=>this.differentiatedEnvironment([this.formatContractPayload()]));s(this,"preExecution",()=>({payload:this.formatContractPayload()}))}};u();l();var us=class extends re{constructor(){super(...arguments);s(this,"formatContractPayload",()=>{let{orderData:t}=this,{txBytes:o}=JSON.parse(t.unsignedTx);return{transactionBlock:o}});s(this,"getSendTransactionParams",async()=>this.differentiatedEnvironment([this.formatContractPayload(),this.extParams]));s(this,"preExecution",async()=>({payload:this.formatContractPayload()}))}},Fp=us;u();l();var bo=class extends re{constructor(){super(...arguments);s(this,"formatContractPayload",()=>{let{orderData:t}=this;return JSON.parse(t.unsignedTx)});s(this,"formatTransferPayload",()=>{});s(this,"getSendTransactionParams",async()=>{let t=this.formatContractPayload();return this.differentiatedEnvironment([{...t,extParams:this.extParams}])});s(this,"preExecution",async()=>({payload:this.formatContractPayload()}))}};var Yf={[W.BTC_MAINNET]:Eo,[W.ETHEREUM_MAINNET]:cs,[W.SOLANA_MAINNET]:Co,[W.APTOS_MAINNET]:Io,[W.SUI_MAINNET]:Fp,[W.TRON_MAINNET]:bo,[W.STACKS_MAINNET]:wo,[W.STARKNET_MAINNET]:Ao},Xf=(r,e,t)=>{let{chainId:o}=r,n=Yf[o]||cs;return new n(e,t,r)},Nn=Xf;u();l();function zf({selector:r}){let e=document.querySelector(r);e&&e.scrollTo({top:0,behavior:"smooth"})}var ls=zf;var xp=20,xt={CONFIRM:"confirm",UPDATE:"update",FILL_UP:"fill_up",SNAP_UPDATE:"snap_update"},ps=class{constructor(e){s(this,"quoteData",null);s(this,"preDataForSendBtc",null);s(this,"setPreDataForSendBtc",e=>{this.preDataForSendBtc=e});s(this,"setQuoteData",e=>{this.quoteData=e});s(this,"quoteParams",()=>{var a;let{accountStore:e,fromToStore:t,receiveAddressStore:o}=this.rootStore,i={...cr(),userWalletAddress:e.address};return t.computedDiffCrossChain&&(i.receiveWalletAddress=(a=o.receiveAddrObj)==null?void 0:a.specifiedAddress),i});s(this,"updating",!1);s(this,"updateQuoteData",async()=>{var c,p,d;let{quoteStore:{quote:e}}=this.rootStore,t=cr();this.updating=!0;let[o,n]=await N(P.post(tu,{...t,bridgeId:(p=(c=e==null?void 0:e.bestRoute)==null?void 0:c.bridge)==null?void 0:p.bridgeId}));if(this.updating=!1,ls({selector:"#wallet_scroll"}),o){F.error({title:((d=o==null?void 0:o.data)==null?void 0:d.msg)||S("swaptrade_top_notif_data_failed")});return}let{callDataResult:i,quoteResult:a}=(n==null?void 0:n.data)||{};if(a&&this.rootStore.quoteStore.handleUpdateQuote({data:a}),i){let h=await this.getPreExecutionPayload(i);Ae(()=>{this.transactionPayload=h})}this.initCountDown(),this.startCountdown()});s(this,"updateSnapQuoteData",async()=>{var p;let e=cr();this.updating=!0;let[t,o]=await N(P.get(au,{params:e}));if(this.updating=!1,ls({selector:"#wallet_scroll"}),t){F.error({title:((p=t==null?void 0:t.data)==null?void 0:p.msg)||S("swaptrade_trading_mode_error_no_update")});return}let{quote:n,quoteResult:i,tradingModeType:a,unsignedTx:c}=(o==null?void 0:o.data)||{};i&&this.rootStore.quoteStore.handleUpdateQuote({data:i}),this.rootStore.intentSwapStore.setCallDataInfo({quote:n,tradingModeType:a,unsignedTx:c}),this.initCountDown(),this.startCountdown()});s(this,"timer",null);s(this,"countdown",xp);s(this,"initCountDown",()=>{this.countdown=xp});s(this,"startCountdown",()=>{this.timer=setTimeout(()=>{let e=this.countdown;if(e===0){this.clearTimer();return}this.countdown=e-1,this.startCountdown()},1e3)});s(this,"clearTimer",()=>{this.timer&&clearTimeout(this.timer)});s(this,"initGasInfo",()=>({gasType:"normal",gasLimit:"0",gasPrice:"0",maxFeePerGas:"0",maxPriorityFeePerGas:"0",supportEip1559:!1,isNetworkFeeLoading:!0,isGasLimitLoading:!0}));s(this,"gasInfo",this.initGasInfo());s(this,"setGasInfo",e=>{this.gasInfo=e});s(this,"gasFee",0);s(this,"setGasFee",e=>{this.gasFee=e});s(this,"orderInfo",{});s(this,"transactionPayload",null);s(this,"solonaRent","");s(this,"getPreExecutionPayload",async e=>{var d;let{swapStore:t,quoteStore:o}=this.rootStore,n=((d=o==null?void 0:o.quote)==null?void 0:d.bestRoute)||{},{fromToken:i}=n,a=Nn(i,{orderData:e},t),{payload:c,rent:p}=await a.preExecution();return i.chainId===W.SOLANA_MAINNET&&p&&(this.solonaRent=p),c});s(this,"setTransactionPayload",e=>{this.transactionPayload=e});s(this,"fetchCallData",async()=>{var i;let e=this.rootStore.swapStore.saveOrderParams(),[t,o]=await N(P.post(eu,e));if(t){let a=(t==null?void 0:t.code)===90002?t==null?void 0:t.error_message:(i=t==null?void 0:t.data)==null?void 0:i.msg;return F.error({title:a||S("swaptrade_top_notif_data_failed")}),!0}let n=await this.getPreExecutionPayload((o==null?void 0:o.data)||{});return this.transactionPayload=n,!1});s(this,"nativeCoin",null);s(this,"setNativeCoin",e=>{this.nativeCoin={...e}});s(this,"calcNativeCoinAmount",()=>{let{coinAmountInt:e,decimals:t}=this.nativeCoin,{from:o,computedIsFromBtcCoin:n}=this.rootStore.fromToStore;return I.BigNumber(n?o.availableBalance:Pr(e,t))});s(this,"calcNativeCoinAmountChange",()=>{let e;if(this.type===fe.SWAP){let{fromToStore:o}=this.rootStore;e=o.from}else{let{fromToken:o,fromTokenAmount:n}=this.rootStore.facetStore.facetOrderDetail;e={...o,amount:n}}let t=I.BigNumber(this.gasFee).isNaN()?"0":this.gasFee;return e.isNativeToken?I.BigNumber(e.amount).plus(t):I.BigNumber(t)});s(this,"gasFeeLoading",!0);s(this,"setGasFeeLoading",e=>{this.gasFeeLoading=e});s(this,"gasLimitError",null);s(this,"setGasLimitError",e=>{this.gasLimitError=e});s(this,"activityId",null);s(this,"setActivityId",e=>{this.activityId=e});s(this,"type",fe.SWAP);s(this,"setSwapType",e=>{this.type=e});s(this,"reset",()=>{this.gasInfo=this.initGasInfo(),this.setGasFeeLoading(!1),this.nativeCoin=null,this.transactionPayload=null,this.gasFee=0,this.setGasLimitError(null),this.setStarknetRegisterStatus(""),this.setVisibleStarknetRegister(!1),this.setActivityId(null),this.setSwapType(fe.SWAP),this.clearTimer(),this.solonaRent=""});s(this,"starknetRegisterStatus","");s(this,"setStarknetRegisterStatus",e=>{this.starknetRegisterStatus=e});s(this,"visibleStarknetRegister",!1);s(this,"setVisibleStarknetRegister",e=>{this.visibleStarknetRegister=e});s(this,"onSwap",()=>{kr({...this.rootStore.swapStore.getSaveOrderMonitorData(),button_name:"confirm"}),this.rootStore.swapStore.onSwap()});s(this,"onRedeem",()=>{this.rootStore.facetStore.walletSendRedeem()});s(this,"onIntentSwap",()=>{this.rootStore.intentSwapStore.onIntentSwap()});s(this,"confirmSwapMap",{[fe.SWAP]:this.onSwap,[fe.REDEEM]:this.onRedeem,[fe.INTENT_SWAP]:this.onIntentSwap});s(this,"onConfirm",e=>{var t,o;(o=(t=this.confirmSwapMap)[e])==null||o.call(t)});s(this,"getBtnProps",e=>{let{fromToStore:t}=this.rootStore,{symbol:o,coinId:n,chainId:i}=this.nativeCoin||{};return{[xt.CONFIRM]:{disabled:this.computedConfirmBtnDisabled,onClick:c=>{this.onConfirm(c)},text:S("swaptrade_card_swap_btn_confirm_swap"),loading:this.computedIsConfirming},[xt.UPDATE]:{onClick:()=>{kr({...this.rootStore.swapStore.getSaveOrderMonitorData(),button_name:"update"}),this.updateQuoteData().catch(()=>{})},loading:this.updating,text:S("swaptrade_confirmswap_btn_update_price")},[xt.SNAP_UPDATE]:{onClick:()=>{kr({...this.rootStore.swapStore.getSaveOrderMonitorData(),button_name:"update"}),this.updateSnapQuoteData().catch(()=>{})},loading:this.updating,text:S("swaptrade_confirmswap_btn_update_price")},[xt.FILL_UP]:{onClick:()=>{Ru({wallet_address:this.rootStore.accountStore.address,button_name:"fill_up"}),t.baseAddFunds({coinId:n,chainId:i,receiveOnly:!1})},text:S("swaptrade_dialog_btn_supplement",{token:o})}}[e]});H(this),this.rootStore=e}get computedFormatTime(){return Cu(this.countdown)}get computedPriceUpdate(){return this.countdown===0}get computedIsSufficientGas(){if(!this.nativeCoin)return!0;let e=this.calcNativeCoinAmount(),t=this.calcNativeCoinAmountChange();return e.gte(t)}get computedSolonaNativeTokenSufficientRent(){var a;let{quoteStore:e}=this.rootStore,t=((a=e==null?void 0:e.quote)==null?void 0:a.bestRoute)||{},{fromToken:o}=t||{};if((o==null?void 0:o.chainId)!==W.SOLANA_MAINNET||!this.nativeCoin||!this.solonaRent)return!0;let n=this.calcNativeCoinAmount(),i=this.calcNativeCoinAmountChange();return n.gte(i.plus(this.solonaRent))}get walletSendParams(){let{toLocale:e,dispatch:t}=R;return!e||!t?null:{t:e,dispatch:t}}get computedIsIntentSwap(){return this.type===fe.INTENT_SWAP}get computedConfirmBtnDisabled(){var a,c,p;let{RegisterLocalStatusEnum:e}=R.global,{computedIsStarknetChain:t,computedIsFromBtcCoin:o,computedIsEvmChain:n}=this.rootStore.fromToStore;if(this.computedIsIntentSwap)return!1;if(t&&this.starknetRegisterStatus!==(e==null?void 0:e.COMPLETED))return!0;let i=this.computedPriceUpdate||!this.computedIsSufficientGas||!this.computedSolonaNativeTokenSufficientRent||this.gasFeeLoading||this.gasLimitError;return o||!n?i:i||((a=this.gasInfo)==null?void 0:a.isGasLimitLoading)||((p=(c=this.gasInfo)==null?void 0:c.gasLimitInfo)==null?void 0:p.queryGasLimitErrorUseDefault)}get computedIsConfirming(){let{swapStore:e,intentSwapStore:t}=this.rootStore;return this.computedIsIntentSwap?!!t.isConfirmLoading:e.isConfirmLoading}get computedBtnProps(){let e=xt.CONFIRM;return!this.computedIsSufficientGas||!this.computedSolonaNativeTokenSufficientRent?e=xt.FILL_UP:this.computedPriceUpdate&&(e=this.computedIsIntentSwap?xt.SNAP_UPDATE:xt.UPDATE),this.getBtnProps(e)}get computedMonitorGasType(){var e,t;return(e=this.gasInfo)!=null&&e.gasType?{network_fee_details:{gas_level:(t=this.gasInfo)==null?void 0:t.gasType}}:{}}},Mn=ps;u();l();u();l();u();l();var Up=(r,e)=>r.filter(({networks:t})=>t.findIndex(n=>n.name===e)>-1),qp=(r,e)=>r.filter(({account:t})=>t[e]),Vp=({recentAddrData:r,addressBookData:e,walletListData:t,chainName:o})=>{let n=[];if(r.length>0){let i=r.map(({specifiedAddress:a,...c})=>({specifiedAddress:a,...c}));n.push({group:S("swaptrade_extension_wallet_address_recent_address"),list:i})}if(e.length>0){let i=e.map(a=>({...a,specifiedAddress:a.address}));n.push({group:S("swaptrade_extension_wallet_address_connected_wallets"),list:i})}if(t.length){let i=t.map(c=>({specifiedAddress:c.account[o],group:c.keyringName,name:c.walletName,walletId:c.walletId}));Object.entries(hu(i,"group")).forEach(([c,p])=>{n.push({group:c,list:p})})}return n},Bp=r=>String(A(r,"isLeveraged"))==="1",Wp=(r,e)=>{let t=[null,null];return Bp(r)&&(t[0]=r),Bp(e)&&(t[1]=e),t};var{BigNumber:X,sub:Zf,div:Jf}=I,Oo=class{constructor(e){s(this,"defaultToken",{amount:"",prevAmount:"",balance:"",logoURI:"",coinId:"",decimals:"",usdPrice:"",tokenName:"",baseCoinId:"",tokenSymbol:"",tokenLogoUrl:"",isNativeToken:0,tokenContractAddress:"",isSafeMoonToken:"",isHoneypot:"",buyTaxes:"0",sellTaxes:"0",reverseReceiveAmount:""});s(this,"from",{...this.defaultToken,amount:"1"});s(this,"to",this.defaultToken);s(this,"fromBalanceState",ye.BALANCE_NOT_SHOW);s(this,"toBalanceState",ye.BALANCE_NOT_SHOW);s(this,"fromBalanceRequestError",!1);s(this,"toBalanceRequestError",!1);s(this,"isBalanceLoading",!1);s(this,"visibleAddFunds",!1);s(this,"setFrom",e=>{this.from=e});s(this,"setTo",e=>{this.to=e});s(this,"maxDialogType",to.enough);s(this,"setMaxDialogType",e=>{this.maxDialogType=e});s(this,"checkMaxDialogTypeIsEnough",e=>to.enough===e);s(this,"typedValue","1");s(this,"fromMax",!1);s(this,"independentField",_.FROM);s(this,"singleTypedValue","1");s(this,"singleFromMax",!1);s(this,"advanceSetTypedValue",(e,t,o="")=>{(o||this.commonStore.currentTab)===O.SWAP?(this.singleTypedValue=e,this.singleFromMax=t):this.setTypeInput(e,t)});s(this,"needCrossChainDoubleConfirm",!1);s(this,"setNeedCrossChainDoubleConfirm",e=>{this.needCrossChainDoubleConfirm=e});s(this,"updateBtcFromBalance",async()=>this.computedIsFromBtcCoin?(await this.getTokenBalanceByAccount(_.FROM,U(this.from)),!this.fromBalanceRequestError):!this.fromBalanceRequestError);s(this,"onClickMax",async()=>{hn({button_name:"max"});let{isNativeToken:e}=this.from;this.setField(_.FROM);let t="",o="";if(e===1){let[n,i]=await Promise.all([this.rootStore.quoteStore.fetchGasTokenFee(),this.updateBtcFromBalance()]);if(!i)return;let{balance:a,availableBalance:c}=this.from,p=(this.computedIsFromBtcCoin?c:a)||"0";if(n===-1)return;o=X(p).minus(n);let d=o.isNegative();this.setMaxDialogType(d?to.insufficient:to.enough),d&&this.setShowAddFund(!0),this.showMaxDialog(),this.setShowMaxIcon(!0),t=d?"":o.toString()}else t=this.from.balance;this.advanceSetTypedValue(t,!0)});s(this,"setTypeInput",(e,t)=>{this.typedValue=e,this.fromMax=!!t});s(this,"setField",e=>{this.independentField=e});s(this,"quoteUpdateFromTo",e=>{let{receiveAmount:t="",fromTokenPrice:o="",toTokenPrice:n="",payAmount:i="",inputToTokenPrice:a=""}=e||{};!this.computedIsExactIn&&t?(this.from.amount=i,this.to.amount=this.computedTypedValue,this.to.prevAmount=this.computedTypedValue,this.from.currentTime=new Date().getTime(),this.to.usdPrice=a):this.computedIsExactIn&&(this.from.amount=this.computedTypedValue,this.to.amount=t,this.from.prevAmount=this.computedTypedValue,this.to.currentTime=new Date().getTime(),this.to.usdPrice=n),this.to.reverseReceiveAmount=t,this.from.usdPrice=o});s(this,"checkAndGetTokenInfo",async({chainId:e,tokenContractAddress:t})=>{let[o,n]=await this.getTokenInfoAndBalance(e,t);return o?null:n.data});s(this,"getDexMultiDefaultTokenInfo",e=>{var n,i;let{chainList:t}=this.commonStore,o=U(t).find(a=>Number(a.chainId)===Number(e!=null?e:no))||{};return{fromDexMultiTokenInfoVO:{...(n=o.dexDefaultFromToTokenShowVO)==null?void 0:n.fromDexMultiTokenInfoVO,reserveGas:o.reserveGas},toDexMultiTokenInfoVO:((i=o.dexDefaultFromToTokenShowVO)==null?void 0:i.toDexMultiTokenInfoVO)||{}}});s(this,"addressReplaceSymbol",e=>{let{fromDexMultiTokenInfoVO:t}=this.getDexMultiDefaultTokenInfo(e.chainId),{tokenSymbol:o,isNativeToken:n}=t;return n&&this.commonStore.getTokenAddress(e)===this.commonStore.getTokenAddress(t)?o:e==null?void 0:e.tokenContractAddress});s(this,"symbolReplaceAddress",e=>this.tokenReplaceMainToken(e).tokenContractAddress);s(this,"validTokens",{});s(this,"fetchTokenInfo",async e=>{if(e.tokenContractAddress){let t=await this.checkAndGetTokenInfo(e);if(t!=null&&t.tokenContractAddress){let n={...t,balance:t.amountNum,amount:e.amount||""},i=`${t.chainId}_${this.commonStore.getTokenAddress(t)}`;return this.validTokens[i]=!0,n}let o=`${e.chainId}_${this.commonStore.getTokenAddress(e)}`;return this.validTokens[o]=e.tokenContractAddress==Pc,null}return null});s(this,"checkQueryToken",async(e,t=!0)=>{if(!$(e.chainId))return null;let o=e;if(Uu(this.commonStore.chainList,Number(e.chainId))){let{from:i}=this.getInitializedValue(e.chainId);if(this.commonStore.getTokenAddress(e)===this.commonStore.getTokenAddress(i)&&t){let c=`${i==null?void 0:i.chainId}_${this.commonStore.getTokenAddress(i)}`;return this.validTokens[c]=!0,i}let a=await this.fetchTokenInfo({chainId:Number(e.chainId),tokenContractAddress:e.tokenContractAddress});t?o=a||i:o=a}else o=null;return o});s(this,"updateFrom",e=>{(!this.commonStore.equalsToken(e,this.from)||this.from.balance!==e.balance)&&(this.setShowMaxIcon(!1),this.setShowAddFund(!1)),this.from={...U(this.from),...e}});s(this,"updateFromAmount",e=>{this.from.amount=e,e||(this.from.usdPrice="0"),this.from.prevAmount||(this.from.prevAmount=e)});s(this,"updateTo",e=>{this.to={...U(this.to),...e}});s(this,"hideMaxDialog",!!v.get(Bi));s(this,"hideMaxDialogLessGas",!!v.get(Ui));s(this,"setStorageShowMaxDialog",e=>{if(e){let t=this.checkMaxDialogTypeIsEnough(this.maxDialogType);v.set(t?Bi:Ui,"1"),t?this.hideMaxDialog=!0:this.hideMaxDialogLessGas=!0}this.visibleMaxDialog=!1});s(this,"visibleMaxDialog",!1);s(this,"showMaxDialog",()=>{let e=this.checkMaxDialogTypeIsEnough(this.maxDialogType);e&&this.hideMaxDialog||!e&&this.hideMaxDialogLessGas||(this.visibleMaxDialog=!0)});s(this,"showMaxIcon",!1);s(this,"setShowMaxIcon",e=>{this.showMaxIcon=e});s(this,"showAddFund",!1);s(this,"setShowAddFund",e=>{this.showAddFund=e});s(this,"setFromBalanceRequestError",e=>{this.fromBalanceRequestError=e});s(this,"setToBalanceRequestError",e=>{this.toBalanceRequestError=e});s(this,"onSwitchFromTo",async()=>{var e,t;if(!this.isBalanceLoading){this.rootStore.quoteStore.isFirstQuote=!0,this.rootStore.quoteStore.quoteScope=null,this.setShowMaxIcon(!1),this.setShowAddFund(!1);let[o,n]=[U(this.from),U(this.to)];[this.fromBalanceRequestError,this.toBalanceRequestError]=[this.toBalanceRequestError,this.fromBalanceRequestError];let i={amount:(e=this.computedTypedValue)!=null?e:"",prevAmount:(t=this.computedTypedValue)!=null?t:"",usdPrice:""},a={amount:"",prevAmount:"",usdPrice:""};this.setNeedCrossChainDoubleConfirm(!0),this.setField(_.FROM),this.computedIsSingleChain?this.setFrom({...n,...i}):(this.rootStore.quoteStore.setQuoteNumber(this.computedTypedValue?0:2),this.setFrom({...n,amount:n.amount||"",prevAmount:n.amount||"",usdPrice:""})),this.setTo({...o,...a}),this.advanceSetTypedValue(n.amount),this.rootStore.receiveAddressStore.clearReceiveAddressValue()}});s(this,"getChainInfo",e=>{let{chainList:t}=this.commonStore;return U(t).find(n=>Number(n.chainId)===Number(e))||{}});s(this,"getInitializedValue",(e=no)=>{let t=this.getChainInfo(e),{fromDexMultiTokenInfoVO:o,toDexMultiTokenInfoVO:n}=(t==null?void 0:t.dexDefaultFromToTokenShowVO)||{fromDexMultiTokenInfoVO:{},toDexMultiTokenInfoVO:{}},i={...U(o),balance:"",reserveGas:t==null?void 0:t.reserveGas},a={...U(n),balance:""};return{from:i,to:a}});s(this,"resetFromTo",async e=>{let{chainList:t,currentTab:o}=this.commonStore,n=o===O.BRIDGE;if(Number(e)!==Number(this.from.chainId)){let i=U(t).find(h=>Number(h.chainId)===Number(e)),{fromDexMultiTokenInfoVO:a,toDexMultiTokenInfoVO:c,toCrossDexMultiTokenInfoVO:p}=(i==null?void 0:i.dexDefaultFromToTokenShowVO)||{fromDexMultiTokenInfoVO:{},toDexMultiTokenInfoVO:{}};this.from={...U(a),balance:"",reserveGas:i==null?void 0:i.reserveGas};let d=n&&p||c;this.to={...U(d),balance:""}}});s(this,"clearFromTo",()=>{this.from={},this.to={}});s(this,"updateBalanceIfNativeToken",(e,t)=>{t.isNativeToken?this.getTokenBalanceByAccount(e,t,!1).catch(lu):(this.setFromBalanceRequestError(!1),this.setBalance(e,t.amountNum))});s(this,"getSwapTokenBalance",(e=!1)=>{this.getTokenBalanceByAccount(_.FROM,U(this.from),e).catch(()=>{}),this.getTokenBalanceByAccount(_.TO,U(this.to),e).catch(()=>{})});s(this,"getTokenInfoAndBalance",async(e,t)=>{let o=this.accountStore.getAddressByChainId(e),n={chainId:e,tokenAddress:t,userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,userWalletAddress:o,businessType:this.commonStore.computedCurrentTabIsLimit?xi.LIMIT_ORDER:xi.SWAP_ORDER};return N(P.get(jc,{params:n}))});s(this,"getTokenBalanceByAccount",async(e,t,o)=>{var c;let n=e===_.FROM,{chainId:i,tokenContractAddress:a}=t;if($(i)&&a&&this.accountStore.computedAccountId){this.isBalanceLoading=!0;let p=await this.getTokenInfoAndBalance(i,a);if(this.isBalanceLoading=!1,!this.commonStore.equalsToken(t,n?this.from:this.to))return;if(p[0]){if(o){this.fromBalanceRequestError=!1,this.toBalanceRequestError=!1;return}n?(this.fromBalanceRequestError=!0,this.fromBalanceState=ye.BALANCE_REQUEST_FAILED):(this.toBalanceRequestError=!0,this.toBalanceState=ye.BALANCE_REQUEST_FAILED),this.setBalance(e,"0","0");return}n?this.fromBalanceRequestError=!1:this.toBalanceRequestError=!1;let{amountNum:d,availableAmountNum:h}=(c=p[1])==null?void 0:c.data;this.setBalance(e,d,h)}});s(this,"setBalance",(e,t="",o="")=>{let n=e===_.TO,i={balance:t,availableBalance:o};n?this.updateTo({...this.to,...i}):this.updateFrom({...this.from,...i})});s(this,"setBalanceState",e=>{let{amount:t,address:o,from:n,to:i}=e;Boolean(o)&&Boolean(n.tokenContractAddress)?this.fromBalanceRequestError===!0?this.fromBalanceState=ye.BALANCE_REQUEST_FAILED:X(n.balance||"0").lt(t||"0")?this.fromBalanceState=ye.BALANCE_INSUFFICIENT:this.fromBalanceState=ye.COMMON:this.fromBalanceState=ye.BALANCE_NOT_SHOW,!(Boolean(o)&&Boolean(i.tokenContractAddress))||!this.computedIsToAddressEqualsCurrentToAddress&&this.computedDiffCrossChain?this.toBalanceState=ye.BALANCE_NOT_SHOW:this.toBalanceRequestError===!0?this.toBalanceState=ye.BALANCE_REQUEST_FAILED:this.toBalanceState=ye.COMMON});s(this,"updateFromBalancePush",e=>{let{coinAmountOriginalDec:t,availableAmountNum:o}=e;this.commonStore.equalsToken(this.from,e)?this.setBalance(_.FROM,t,o):this.commonStore.equalsToken(this.to,e)&&this.setBalance(_.TO,t,o)});s(this,"tokenReplaceMainToken",e=>{let t=e,{fromDexMultiTokenInfoVO:o}=this.getDexMultiDefaultTokenInfo(e==null?void 0:e.chainId),{tokenSymbol:n,chainId:i}=o;return $(e==null?void 0:e.chainId)&&(e==null?void 0:e.tokenContractAddress)&&(this.commonStore.getTokenAddress(e)===(this.commonStore.isSensitiveChain(i)?n:dt(n))||this.commonStore.getTokenAddress(e)===this.commonStore.getTokenAddress(o))&&(t={...o,amount:e.amount}),t});s(this,"onClickAddFunds",()=>{let{tokenSymbol:e,chainName:t}=this.from,{address:o}=this.accountStore,n={currency:e,network:t,address:o};this.getDeposit(n)});s(this,"calOrderUpdateFromTo",e=>{let{fromTokenUsd:t,toTokenUsd:o,fromAmount:n,toAmount:i}=e||{};co(n)||(this.from.amount=n),co(t)||(this.from.usdPrice=t),co(i)||(this.to.amount=i),co(o)||(this.to.usdPrice=o)});s(this,"isEvmChain",e=>{if($(e)){let t=this.commonStore.getChainByID(e);return(t==null?void 0:t.chainType)!==mc.NO_EVM_CHAIN}return!0});s(this,"isTronChain",e=>e===W.TRON_MAINNET);s(this,"getFormatFromToToken",async({from:e,to:t},o)=>{let[n,i]=await Promise.all([this.checkQueryToken(e,o),this.checkQueryToken(t,o)]),a=n,c=i,p=d=>`${d==null?void 0:d.chainId}-${d==null?void 0:d.tokenContractAddress}`;if(n){let d=this.getInitializedValue(n==null?void 0:n.chainId),h=ao(ji([n,i,d.from,d.to],p));a=h[0],c=h[1]}else if(i){let d=this.getInitializedValue(i.chainId),h=ao(ji([i,d.from,d.to],p));a=h[1],c=h[0]}return{token1:a,token2:c}});s(this,"orderContinueStatus",ue.DEFAULT);s(this,"setOrderContinueStatus",e=>{this.orderContinueStatus=e});s(this,"fillSwapFromTo",async({apiRequestParams:e,locationParams:t})=>{let{closeModal:o}=this.rootStore.recentTransactionStore;!await this.beforeCheckAndGetTokenInfo(e,t)||(o(),this.setSwapAndLimitTypeValue(t.inputAmount))});s(this,"beforeCheckAndGetTokenInfo",async(e,t)=>{let{orderCheckContinue:o}=this.rootStore.oneMoreOrderStore;if(this.setOrderContinueStatus(ue.LOADING),e&&!await o(e))return this.setOrderContinueStatus(ue.ERROR),!1;let{token1:n,token2:i}=await this.getFormatFromToToken(t,!1);return!n||!i?(F.error({title:S("swaptrade_history_toast_setup_error"),duration:qe}),this.setOrderContinueStatus(ue.ERROR),!1):(this.setOrderContinueStatus(ue.READY),this.updateFromAndToInfo(n,i),!0)});s(this,"beforeCheckUrl",async e=>{this.setOrderContinueStatus(ue.LOADING);let{orderCheckContinue:t}=this.rootStore.oneMoreOrderStore;return await t(e)?(this.setOrderContinueStatus(ue.READY),!0):(this.setOrderContinueStatus(ue.ERROR),!1)});s(this,"updateFromAndToInfo",(e,t)=>{this.updateFrom(e),this.updateTo(t),this.rootStore.tokenModalStore.setUserChainIdCache(e.chainId)});this.rootStore=e,this.accountStore=e.accountStore,this.commonStore=e.commonStore}get computedTypedValue(){return this.commonStore.currentTab===O.SWAP?this.singleTypedValue:this.typedValue}get computedFromMax(){return this.commonStore.currentTab===O.SWAP?this.singleFromMax:this.fromMax}get computedNeedCrossChainDoubleConfirm(){return this.computedIsSingleChain?!1:!this.needCrossChainDoubleConfirm}get dependentField(){return this.independentField===_.FROM?_.TO:_.FROM}get computedIsExactIn(){return this.independentField===_.FROM}get computedIsSingleChain(){var t;return $(this.from.chainId)&&$(this.to.chainId)&&Number(this.from.chainId)===Number((t=this.to)==null?void 0:t.chainId)}get computedSwapAmount(){return{[this.independentField]:this.computedFromMax?so(this.computedTypedValue,{noNeedThousandth:!0}):this.computedTypedValue,[this.dependentField]:this.computedCalAmount[this.dependentField]}}get computedCalAmount(){var e,t,o,n;return{[_.FROM]:(t=so((e=this.from)==null?void 0:e.amount,{noNeedThousandth:!0}))!=null?t:"",[_.TO]:(n=so((o=this.to)==null?void 0:o.amount,{noNeedThousandth:!0}))!=null?n:""}}get computedIfQuote(){return!!(this.computedTypedValueIsValid&&this.from&&this.to)}get computedTypedValueIsValid(){return!X(this.computedTypedValue).isZero()&&!X(this.computedTypedValue).isNaN()}get computedFromAmountIsValid(){let{amount:e}=this.from;return $e(e)}get computedFromLocalCostByUsd(){let{usdPrice:e}=this.from;if(!this.computedFromAmountIsValid)return"";let{nowCurrencyUnit:t}=this.commonStore,{symbol:o,usdToThisRate:n}=t,i=X(e);if(o&&e&&n&&!i.isNaN()){let c=i.multipliedBy(n).toString();return he(c,o)}return""}get computedToLocalCostByUsd(){let{usdPrice:e}=this.to,{nowCurrencyUnit:t}=this.commonStore,{symbol:o,usdToThisRate:n}=t,i=X(e);if(o&&e&&n&&this.to.amount&&!i.isNaN()&&$e(this.from.amount)){let c=i.multipliedBy(n).toString();return he(c,o)}return""}get computedRate(){var d;let{from:e,to:t,computedIsExactIn:o}=this,{quoteStore:n,gasDropStore:i}=this.rootStore,a=A(n,"quote.bestRoute.gasDropFromAmount",""),c=a&&((d=i==null?void 0:i.gasDropConfig)==null?void 0:d.gasDrop)?X(e==null?void 0:e.amount).minus(a):X(e==null?void 0:e.amount),p=(t==null?void 0:t.reverseReceiveAmount)&&o||!o&&(e==null?void 0:e.amount);return c&&p?ee(X(t==null?void 0:t.reverseReceiveAmount).div(c).toString(10)):""}get computedToFromRate(){var d;let{from:e,to:t,computedIsExactIn:o}=this,{quoteStore:n,gasDropStore:i}=this.rootStore,a=A(n,"quote.bestRoute.gasDropFromAmount",""),c=a&&((d=i==null?void 0:i.gasDropConfig)==null?void 0:d.gasDrop)?X(e==null?void 0:e.amount).minus(a):X(e==null?void 0:e.amount),p=(t==null?void 0:t.reverseReceiveAmount)&&o||!o&&(e==null?void 0:e.amount);return c&&p?ee(X(c).div(t==null?void 0:t.reverseReceiveAmount).toString(10)):""}get computedIsToAddressEqualsCurrentToAddress(){let e=this.accountStore.getAddressByChainId(this.to.chainId);return e&&this.rootStore.receiveAddressStore.computedReceiveAddr===e}get computedValueDifference(){let{tradeModeStore:e,quoteStore:t}=this.rootStore,{usdPrice:o}=this.from,{usdPrice:n,currentTime:i}=this.to,{computedIsSnapType:a}=e,c=A(t,"quote.bestRoute.gasDropFromAmount",""),p=A(t,"quote.bestRoute.fromTokenAmount",""),d=We(o),h=io(o),m=We(n),g=io(n);if(d||h||m||g)return{isUp:!1,diff:"",isOver:!1,nowTime:new Date().getTime()};let T=c?X(o).div(X(p))*X(c):"";o=c?o-T:o;let y=X(n).minus(o).div(o).multipliedBy(100),C=X(y.toFixed(2,1));if(C.gt(-.1)&&C.lt(.1))return null;let L=y.isNegative()?"":"+",G="";return y.gt(100)?G=`>${L}${Ye(100,{needZero:!1})}`:y.lt(-100)?G=`<${L}${Ye(100,{needZero:!1})}`:G=`${L}${Ye(C.toString(10),{needZero:!1})}`,{isUp:a?!1:!y.lt(0),diff:G,isOver:a?!1:y.lte(-10),currentTime:i,specialValueRangePrompt:y.gt(-10)&&y.lt(10),value:`${X(y.toFixed(2,1)).toString(10).replace(/\+|-/,"")}`}}get computedMinimumReceived(){let{quoteStore:e}=this.rootStore,t=A(e,"quote.bestRoute.minimumReceived"),o=A(e,"quote.bestRoute.toToken.tokenSymbol","");return`${ee(t)||"--"} ${o}`}get computedMinimumReceivedIsOrange(){var n;let{quoteStore:e}=this.rootStore,t=X(A(e,"quote.bestRoute.minimumReceived")),o=X((n=this.to)==null?void 0:n.amount);return!o.isZero()&&!o.isNaN()&&Jf(Zf(o,t),o)>=.1}get computedIsCrossChain(){var t;return $(this.from.chainId)&&$(this.to.chainId)&&Number(this.from.chainId)!==Number((t=this.to)==null?void 0:t.chainId)}get computedIsBridge(){let{from:e,to:t}=this;return this.computedIsCrossChain&&e.tokenSymbol===t.tokenSymbol}getDeposit(){}get computedDiffCrossChain(){let e=!!this.accountStore.address,t=this.commonStore.getChainByID(this.from.chainId),o=this.commonStore.getChainByID(this.to.chainId),n=String(this.from.isHoneypot),i=String(this.to.isHoneypot),{computedNonsupportChain:a}=this.accountStore,c=(t==null?void 0:t.crossChainType)||"",p=(o==null?void 0:o.crossChainType)||"";return e&&!a&&n!=="1"&&i!=="1"&&c&&p&&c!==p}get computedMaxTipsText(){let{from:e,maxDialogType:t}=this,{cacheNativeGasFee:o}=this.rootStore.quoteStore;if(!e.isNativeToken||!o||!e.tokenSymbol)return S("wallet_swap_toast_reserve_mainnet_token");let n={value:ee(o),tokenSymbol:e.tokenSymbol};if(this.checkMaxDialogTypeIsEnough(t)){if(this.computedIsFromBtcCoin&&I.gt(this.computedUnavailableBalance,0)){let i=ee(this.computedUnavailableBalance);return S("swaptrade_dialog_pay_card_reserved_from_wallet",{symbol:n.tokenSymbol,value:n.value,unablevalue:i})}return S("swaptrade_dialog_desc_reserved_netfee",n)}return S("swaptrade_dialog_desc_please_reserve",n)}get computedShowAddFund(){let{accountStore:e,swapBtnStore:t}=this.rootStore,{from:o}=this;return!e.computedNonsupportChain&&(this.independentField===_.FROM&&X(this.computedTypedValue||0).gt(X(o.balance||0))||t.computedTooBalance)||this.showAddFund&&!this.checkMaxDialogTypeIsEnough(this.maxDialogType)}get computedIsEvmChain(){return this.isEvmChain(this.from.chainId)}get computedDefaultAutoSlippageInfo(){var t,o;let e=this.commonStore.getChainByID(this.from.chainId);return{autoSlippage:(t=e==null?void 0:e.toleranceSlippage)==null?void 0:t.selectItem,autoTotalSlippage:(o=e==null?void 0:e.crossToleranceSlippage)==null?void 0:o.selectItem}}get computedIsSolanaChain(){return zu(this.from.chainId)}get computedIsAptosChain(){return Zu(this.from.chainId)}get computedIsTronChain(){return gn(this.from.chainId)}get computedIsSuiChain(){return $u(this.from.chainId)}get computedIsStacksChain(){return Yu(this.from.chainId)}get computedIsStarknetChain(){return Xu(this.from.chainId)}get computedHasToSwap(){let e=A(this.rootStore.quoteStore,"quote.bestRoute.toSwapFeeUsd");return this.computedIsCrossChain&&e>0}setSwapAndLimitTypeValue(e){var n;let{computedCurrentTabIsLimit:t}=this.commonStore,{clearSellAndReceive:o}=((n=this.rootStore)==null?void 0:n.limitOrderControlStore)||{};t?o==null||o():$e(e)?(this.setField(_.FROM),this.advanceSetTypedValue(e)):this.advanceSetTypedValue("")}get computedLeverageTokenPair(){return Wp(this.from,this.to)}get computedFormToTokenIsLeverageToken(){let[e,t]=this.computedLeverageTokenPair;return!!e||!!t}get computedIsFromBtcChain(){return Ku(this.from.chainId)}get computedIsFromBtcCoin(){return this.computedIsFromBtcChain&&this.from.isNativeToken}get computedUnavailableBalance(){return X(this.from.balance).minus(this.from.availableBalance).toString()}get computedIsFacetToken(){let{from:e,to:t}=this;return Number(e.tokenType)===wr.FACET||Number(t.tokenType)===wr.FACET}get computedNonsupportFacetToken(){let{address:e,walletConfig:{OKXWalletType:t,walletType:o}}=this.accountStore;return e?this.computedIsFacetToken&&!($(t)&&[bt.MNEMONIC,bt.PRIVATE_KEY].includes(t)||o===br.METAMASK):!1}};var ur=class extends Oo{constructor(t){super(t);s(this,"getDeposit",()=>()=>{});s(this,"addFundsParams",{});s(this,"closeAddFunds",()=>{this.visibleAddFunds=!1});s(this,"onClickAddFunds",()=>{let{tokenSymbol:t,chainName:o,tokenLogoUrl:n,chainId:i,isNativeToken:a,tokenContractAddress:c}=this.from;this.visibleAddFunds=!0;let p={currency:t,network:o,iconUrl:n,chainId:i,isNativeToken:a,tokenContractAddress:a?"":c,receiveOnly:!0};this.baseAddFunds(p)});s(this,"baseAddFunds",t=>{this.visibleAddFunds=!0,this.addFundsParams={...t}});s(this,"tokenReplaceMainToken",(t,o)=>{let n=t,i=!Rn(t),{fromDexMultiTokenInfoVO:a}=this.getDexMultiDefaultTokenInfo(i?o:t.chainId),{tokenSymbol:c,chainId:p}=a;return!i&&(this.commonStore.getTokenAddress(t)===(this.commonStore.isSensitiveChain(p)?c:dt(c))||this.commonStore.getTokenAddress(t)===this.commonStore.getTokenAddress(a))&&(n={...a,amount:t.amount}),n});Ft(this),Le(()=>{let{computedDiffCrossChain:o,to:n}=this;return{computedDiffCrossChain:o,toChainId:n==null?void 0:n.chainId}},({computedDiffCrossChain:o,toChainId:n})=>{this.cacheToChainId!==n&&this.rootStore.receiveAddressStore.saveReceiveAddressValue({}),this.rootStore.receiveAddressStore.setCacheToChainId(o&&n?n:-1)},{equals:Et.shallow})}};u();l();u();l();var ds=class{constructor(e){s(this,"callDataInfo",null);s(this,"setCallDataInfo",({quote:e,tradingModeType:t,unsignedTx:o})=>{this.callDataInfo={quote:e,tradingModeType:t,unsignedTx:o}});s(this,"signIntentSwap",async()=>[]);s(this,"createIntentOrder",async(e,t,o)=>{var c,p;let n={intentCode:t,signature:o,quote:e,userWalletAddress:(p=(c=this.rootStore)==null?void 0:c.accountStore)==null?void 0:p.address},[i,a]=await N(P.post(cu,{...n}));return i&&(k.error(M.INTENT_ORDER_CREATE_ERROR,{error:i}),F.error({title:(i==null?void 0:i.error_message)||S("swaptrade_trading_mode_alert_order_fail")})),[i,a]});this.rootStore=e}},Gp=ds;u();l();var Hp=Re(["isConfirmLoading"],[]);var hs=class extends Gp{constructor(t){super(t);s(this,"isConfirmLoading",!1);s(this,"setIsConfirmLoading",t=>{this.isConfirmLoading=t});s(this,"signIntentSwap",async(t,o)=>{let{signTransaction:n}=this.rootStore.sendTransactionStore,[i,a]=await n(t,o);return i&&(k.error(M.INTENT_SWAP_SIGN_ERROR,{error:i,msg:{chainId:t,unsignedTx:o}}),F.error({title:S("swaptrade_trading_mode_alert_order_fail")})),[i,a]});s(this,"onIntentSwap",async()=>{var i;this.setIsConfirmLoading(!0),k.keepLive();let{swapStore:t,quoteStore:o}=this.rootStore,n=A(o,"quote.bestRoute.fromToken.chainId");try{let{quote:a,tradingModeType:c,unsignedTx:p}=this.callDataInfo||{},[d,h]=await this.signIntentSwap(n,p);if(d)return;let[m,g]=await this.createIntentOrder(a,c,h);if(m)return;t.afterTransaction((i=g.data)==null?void 0:i.orderId)}catch(a){k.error(M.INTENT_SWAP_PROCESS_ERROR,{error:a})}finally{this.setIsConfirmLoading(!1),k.removeKeep()}});Te(this,Hp)}},Dn=hs;u();l();u();l();u();l();var dh=w(ph()),hh=w(He());u();l();function Mo(r){return r.default||r}async function Bs(r){if(lo(r,W.SOLANA_MAINNET)){let o=await import("./SolWallet-6SXYMAIB.js"),{SolWallet:n}=Mo(o);return new n}else if(lo(r,W.STARKNET_MAINNET)){let o=await import("./StarknetWallet-YAEAXXDX.js"),{StarknetWallet:n}=Mo(o);return new n}else if(lo(r,W.SUI_MAINNET)){let o=await import("./SuiWallet-OICMUPDB.js"),{SuiWallet:n}=Mo(o);return new n}else if(lo(r,W.TRON_MAINNET)){let o=await import("./TrxWallet-OP5A2I54.js"),{TrxWallet:n}=Mo(o);return new n}let e=await import("./EthWallet-PILT4OZZ.js"),{EthWallet:t}=Mo(e);return new t}function tg(r){let e=!1;try{(0,dh.toOutputScript)(r,hh.bitcoin)&&(e=!0)}catch{e=!1}return e}async function Us(r,e){return W.BTC_MAINNET===r?tg(e):(await(await Bs(r)).validAddress({address:e})).isValid}var qs=class{constructor(e){s(this,"receiveAddrStatus",Cr.NORMAL);s(this,"receiveAddrObj",{});s(this,"saveReceiveAddressValue",e=>{var o;let t=this.receiveAddrObj.specifiedAddress;this.receiveAddrObj=this.filterReceiveWalletInfo(e),this.initCheckAddrStatus(),((o=this.rootStore.quoteStore.quote)==null?void 0:o.bestRoute)&&e.specifiedAddress!==t&&this.rootStore.quoteStore.clearQuote()});s(this,"clearReceiveAddressValue",()=>{this.receiveAddrObj={},this.initCheckAddrStatus(),this.walletAddrInWeb3=[],this.getLinkedWalletAddrInWeb3().catch(()=>{})});s(this,"checkReceiveAddressLoading",!1);s(this,"filterReceiveAddress",(e,t,o=!0)=>{var i;let n=(t==null?void 0:t.specifiedAddress)||((i=this.receiveAddrObj)==null?void 0:i.specifiedAddress)||"";return n?e.filter(({specifiedAddress:a})=>o?a.includes(n):a===n):e});s(this,"filterReceiveWalletInfo",e=>{if(!e.specifiedAddress||e.walletId)return e;let t=this.filterReceiveAddress(this.initWalletAddrListFromChain,e,!1);return t.length?t[0]:e});s(this,"initCheckAddrStatus",()=>{this.checkReceiveAddressLoading=!1,this.receiveAddrStatus=Cr.NORMAL});s(this,"checkReceiveAddr",async e=>{if(e||this.receiveAddrObj.specifiedAddress){this.checkReceiveAddressLoading=!0;let{to:t}=this.rootStore.fromToStore;try{if(await Us(t==null?void 0:t.chainId,e||this.computedReceiveAddr)){let{data:n}=await P.get(Zc,{params:{address:e||this.receiveAddrObj.specifiedAddress,chainId:t==null?void 0:t.chainId}});Ae(()=>{this.receiveAddrStatus=n.status})}else Ae(()=>{this.receiveAddrStatus=Cr.ILLEGALITY})}catch(o){k.stuff(o),this.receiveAddrStatus=Cr.ILLEGALITY}finally{this.checkReceiveAddressLoading=!1}}else this.initCheckAddrStatus()});s(this,"getSpecifiedChainWalletList",async e=>{let t=await this.getSpecifiedChainWalletListByWeb3(e),o={};return t==null||t.forEach(n=>{var d,h;let{specifiedAddress:i,walletType:a,createTime:c}=n,p=a===br.OKEXCHAIN;o[i]&&((d=o[i])==null?void 0:d.has)&&p?o[i].walletInfo.createTime<c&&(o[i].walletInfo=n):(!((h=o[i])!=null&&h.has)||p)&&(o[i]={walletInfo:n,has:p})}),Object.keys(o).map(n=>o[n].walletInfo)});s(this,"walletAddrInWeb3",[]);s(this,"getLinkedWalletAddrInWeb3",async()=>{let{computedDiffCrossChain:e,to:t}=this.rootStore.fromToStore,{computedAccountId:o}=this.rootStore.accountStore;if(!e)return;let[n,i]=await N(this.getSpecifiedChainWalletList({chainId:t.chainId,walletIds:[o]}));n||Ae(()=>{this.walletAddrInWeb3=i})});s(this,"initWalletAddrListFromChain",[]);s(this,"initWalletAddrListInStorage",[]);s(this,"filterWalletAddrListFromChain",[]);s(this,"filterWalletAddrListInStorage",[]);s(this,"getWalletList",async()=>{let{to:e}=this.rootStore.fromToStore,t=await this.getSpecifiedChainWalletList({chainId:e.chainId});Ae(()=>{this.initWalletAddrListFromChain=t,this.filterWalletAddrListFromChain=t;let o=v.get(ro);if(o){let n=o[e.chainId]||[];this.initWalletAddrListInStorage=n,this.filterWalletAddrListInStorage=n}})});s(this,"getFilteredAddrList",e=>{this.filterWalletAddrListFromChain=this.filterReceiveAddress(this.initWalletAddrListFromChain,e),this.filterWalletAddrListInStorage=this.filterReceiveAddress(this.initWalletAddrListInStorage,e)});s(this,"saveWalletAddressToStorage",e=>{var t;(t=this.receiveAddrObj)!=null&&t.specifiedAddress&&v.set(ro,{[e.chainId]:[this.receiveAddrObj]})});s(this,"formatInputValue",e=>{let{specifiedAddress:t,deriveName:o,label:n}=e;if(t.length<=9)return t;let i=mn(e.specifiedAddress);return o&&(i=`(${i})`,n?i=`${o} - ${n} ${i}`:i=`${o} ${i}`),i});this.rootStore=e}get computedSwapHighLight(){var e;return this.receiveAddrStatus===Cr.NORMAL&&!!((e=this.receiveAddrObj)!=null&&e.specifiedAddress)}get computedFormatReceiveAddr(){var e;return(e=this.receiveAddrObj)!=null&&e.specifiedAddress?this.formatInputValue(this.receiveAddrObj):""}get computedReceiveAddr(){var e;return((e=this.receiveAddrObj)==null?void 0:e.specifiedAddress)||""}setReceiveAddress(e){this.receiveAddress=e}getReceiveAddress(){return this.receiveAddress}getSpecifiedChainWalletListByWeb3(){}get computedWalletAddrInWeb3(){return this.walletAddrInWeb3.length?this.walletAddrInWeb3[0]:null}},fh=qs;var Vs=class extends fh{constructor(t){super(t);s(this,"formatInputValueEx",(t,o)=>{let{keyringName:n,walletName:i}=t;if(o.length<=9)return o;let a=mn(o);return n&&(a=`(${a})`,i?a=`${n} - ${i} ${a}`:a=`${n} ${a}`),a});s(this,"cacheToChainId",-1);s(this,"setCacheToChainId",t=>{this.cacheToChainId=t});s(this,"addressListEx",[]);s(this,"getWalletListEx",()=>{let{accountStore:t,fromToStore:o}=this.rootStore,n=R.getNetWorkName(o.to.chainId),{walletList:i,addressBookList:a,keyringIdentityTypeEnum:c}=t,d=(v.get(ro)||{})[o.to.chainId]||[],h=Up(a,n),m=qp(i,n);this.addressListEx=Vp({recentAddrData:d,addressBookData:h,walletListData:m,chainName:n,keyringIdentityTypeEnum:c})});Ft(this)}get computedFormatReceiveAddrEx(){let{accountStore:t,fromToStore:o}=this.rootStore,{walletConfig:n}=t;if(this.receiveAddrObj.specifiedAddress)return this.formatInputValueEx(this.receiveAddrObj,this.receiveAddrObj.specifiedAddress);let i=R.getNetWorkName(o.to.chainId),a=n==null?void 0:n.account[i];return a?(this.receiveAddrObj={...n,specifiedAddress:a},this.formatInputValueEx(n,a)):""}},Xn=Vs;u();l();u();l();var Ws=class{constructor(e){s(this,"updateTxHash",e=>(k.info(M.UPDATE_HASH,{...e,tags:{orderId:e.orderId,status:(e==null?void 0:e.status)||1}}),P.post(qc,e).catch(t=>{k.info(M.UPDATE_HASH_ERROR,{...e,error:t,tags:{orderId:e.orderId}})})));s(this,"cancelOrder",e=>(k.info(M.CANCEL_ORDER,{tags:{orderId:e}}),P.get(ou,{params:{id:e}})));this.rootStore=e}},mh=Ws;var Gs=class extends mh{constructor(){super(...arguments);s(this,"sendTransaction",async(...t)=>{var o;return(o=R.global)==null?void 0:o.signAndSubmitTransaction(...t)});s(this,"sendTransactionEnhance",async(...t)=>this.sendTransaction(...t));s(this,"signTransaction",async(t,o)=>{let[n,i]=await N(R.global.signTypedDataV4(t,o));return[n,i]})}},zn=Gs;u();l();u();l();u();l();var{BigNumber:Do}=I,Hs=class{constructor(e){s(this,"rootStore");this.rootStore=e}checkZeroValue(){let e=null,o=this.rootStore.quoteStore.quote.bestRoute,{fromTokenPrice:n,toTokenPrice:i,fromToken:a,toToken:c}=o;return!Number(n)&&!Number(i)?e=a.tokenSymbol===c.tokenSymbol?J.ALIKE_TOKEN_SYMBOL_PRICE_UNKNOWN:J.ALL_TOKEN_PRICE_UNKNOWN:Number(n)?Number(i)||(e=J.TO_TOKEN_PRICE_UNKNOWN):e=J.FROM_TOKEN_PRICE_UNKNOWN,{errorType:e,continueToNextInterceptor:!1}}checkValueDifference(){let e=null,{fromToStore:t,tradeModeStore:o}=this.rootStore,{computedValueDifference:n,computedIsCrossChain:i}=t,{computedIsSnapType:a}=o;return a?null:(n!=null&&n.isOver&&(e=i?J.VALUE_DIFFERENCE_TOO_MUCH_CROSS:J.VALUE_DIFFERENCE_TOO_MUCH),{errorType:e,continueToNextInterceptor:!1})}checkMinReceive(){let e=null,t=this.rootStore.fromToStore,{computedIsSnapType:o}=this.rootStore.tradeModeStore;return o?null:(t.computedMinimumReceivedIsOrange&&(e=J.MIN_RECEIVED_TOO_SMALL),{errorType:e,continueToNextInterceptor:!1})}checkRepeatOrderWithEnoughBalance(){let e=null,o=this.rootStore.swapStore.repeatOrder;return(o==null?void 0:o.enoughFlag)===Pi.ENOUGH&&(e=J.REPEAT_ORDER),{errorType:e,continueToNextInterceptor:!1}}async checkBlockedRepeatOrder(){let e=null,t=this.rootStore.swapStore;await t.checkRepeatOrder();let o=t.repeatOrder;return o&&(o.repeatFlag===er.BTC_REPEAT?e=J.REPEAT_ORDER_BTC:o.repeatFlag===er.FACET_REPEAT?e=J.REPEAT_ORDER_FACET:o.enoughFlag!==Pi.ENOUGH&&(e=J.REPEAT_ORDER_NOT_ENOUGH)),{errorType:e,continueToNextInterceptor:!1}}checkFacetTokenCrossChainDetail(){let{fromToStore:e}=this.rootStore,{from:t,to:o,computedNonsupportFacetToken:n}=e;if(n||v.get(Oc))return null;let i=null;return t.tokenType!==o.tokenType&&(Number(t.tokenType)===wr.FACET||Number(o.tokenType)===wr.FACET)&&(i=J.FACET_SWAP_TIPS),{errorType:i,continueToNextInterceptor:!1}}checkCrossChain(){let e=null;return this.rootStore.fromToStore.computedNeedCrossChainDoubleConfirm&&!v.get(Tc)&&(e=J.CROSS_CHAIN_DOUBLE_CONFIRM),{errorType:e,continueToNextInterceptor:!1}}checkGasMoreThanReceive(){let e=null,{fromToStore:t,quoteStore:o}=this.rootStore,{computedIsCrossChain:n}=t,i=o.quote.bestRoute,{toTokenPrice:a,quoteNetWorkFeeOfMoney:c,fromSwapFeeUsd:p}=i;return(n?new Do(p):new Do(c)).gte(new Do(a))&&(e=J.GAS_MORE_THAN_RECEIVE_VALUE),{errorType:e,continueToNextInterceptor:!1}}checkToSwapThanGasFee(){let e=null,{fromToStore:t,quoteStore:o}=this.rootStore,{computedHasToSwap:n}=t,i=Number(t.to.chainId)===1;if(n&&i){let a=A(o,"quote.bestRoute.toSwapFeeUsd"),c=A(o,"quote.bestRoute.bridge.bridgeAmountOutUsd"),p=A(o,"quote.bestRoute.bridge.toRiskLimit");new Do(a).dividedBy(c).gte(p)&&(e=J.TO_SWAP_THAN_GAS_FEE)}return{errorType:e,continueToNextInterceptor:!1}}checkVolatilitySlippage(){var n;let e=null,o=(n=this.rootStore.slippageStore.computedVolatilityTips)==null?void 0:n.swapInterceptorType;return o&&(e=o),{errorType:e,continueToNextInterceptor:!0}}async checkBtcBalance(){let{fromToStore:e,safeMoonStore:t}=this.rootStore,{computedIsFromBtcCoin:o,from:n,updateBtcFromBalance:i}=e;if(o){if(!await i())throw Error("btc balance update failed");let c=t.computedInputVal,p=n.availableBalance;if(Do(c).gt(p))return{errorType:J.BTC_AVAILABLE_BALANCE_NOT_ENOUGH,continueToNextInterceptor:!1}}return null}checkSwapWithSwftBridge(){var n,i;if(v.get(gc))return null;let{quoteStore:e}=this.rootStore,{quote:t}=e;return((i=(n=t==null?void 0:t.bestRoute)==null?void 0:n.bridge)==null?void 0:i.bridgeId)==="8"?{errorType:J.SWAP_WITH_SWFT_BRIDGE,continueToNextInterceptor:!1}:null}makeCheckers(){return[this.checkVolatilitySlippage,this.checkBtcBalance,this.checkBlockedRepeatOrder,this.checkSwapWithSwftBridge,this.checkFacetTokenCrossChainDetail,this.checkZeroValue,this.checkToSwapThanGasFee,this.checkRepeatOrderWithEnoughBalance,this.checkValueDifference,this.checkMinReceive,this.checkCrossChain,this.checkGasMoreThanReceive]}async check(){let e=[],t=this.makeCheckers();for(let o=0;o<t.length;o++){let n=t[o],{errorType:i,continueToNextInterceptor:a}=await n.call(this)||{};if(i&&(e.push(i),!a))return e}return e}},Sh=Hs;var{BigNumber:js}=I,Fo=class{constructor(e){s(this,"swapBtnErrorTipsDialog",null);s(this,"swapInterceptor");s(this,"isInterceptionProcessing",!1);s(this,"defaultTipsDialogInfo",()=>({type:"",visible:!1,confirmCallBack:()=>{}}));s(this,"notShowAgainCrossChainConfirm",!1);s(this,"setNotShowAgainCrossChainConfirm",e=>{this.notShowAgainCrossChainConfirm=e});s(this,"tipsDialogInfo",this.defaultTipsDialogInfo());s(this,"swapBtnLoading",!1);s(this,"showErrorTips",(e,t)=>{this.tipsDialogInfo={type:e,visible:!0,confirmCallBack:t},this.setNotShowAgainCrossChainConfirm(!1)});s(this,"closeErrorTipsDialog",()=>{this.swapBtnLoading=!1,this.tipsDialogInfo.visible=!1});s(this,"openConfirmSwapDialog",(e,t)=>{let{swapStore:o,commonStore:n}=this,{receiveAddressStore:i}=this.rootStore;i.saveWalletAddressToStorage(t),o.setConfirmSwapVisible(!0),n.portal===Ve.MARKET&&Nu({token_symbol:t.tokenSymbol,token_chain:t.chainId,token_address:t.tokenContractAddress})});s(this,"connectWallet",()=>{});s(this,"approve",()=>{});s(this,"cancelApprove",()=>{});s(this,"swap",()=>{});s(this,"isQuoting",()=>{let{fromToStore:e,quoteStore:t,slippageStore:o}=this.rootStore,{isFetchQuoting:n,bestRoute:i,quoteError:a,quoteNull:c}=t.quote,{from:p,to:d,computedTypedValue:h}=e,{tokenContractAddress:m}=p,{computedRealSlippageValue:g}=o;return c||!i&&a&&!n||!h||!d.tokenContractAddress||!m||g>50||g<0?be:null});s(this,"noAmountOrIsHoneypotOrOverLimit",()=>{var n,i,a,c;let{fromToStore:e}=this,{overLimit:t}=((i=(n=this.rootStore)==null?void 0:n.safeMoonStore)==null?void 0:i.computedSlippageTips)||{},{computedTypedValue:o}=e;return Number(o)===0||((c=(a=this.rootStore)==null?void 0:a.safeMoonStore)==null?void 0:c.computedHoneypot)||t?be:null});s(this,"hasFeeConfigErrorTips",()=>this.outerStore.computedFeeConfigErrorTips?be:null);s(this,"uninitializedWalletInfo",()=>{let{accountStore:{hasInitWalletInfo:e}}=this;return e?null:be});s(this,"unConnectedWallet",()=>{let{accountStore:{isConnectedWallet:e}}=this;return e?null:zr});s(this,"nonsupportChain",()=>{let{accountStore:{computedNonsupportChain:e}}=this;return e?be:null});s(this,"nonsupportFacetToken",()=>{let{fromToStore:{computedNonsupportFacetToken:e}}=this;return e?be:null});s(this,"checkReceiveAddressStatus",()=>{let{fromToStore:{computedDiffCrossChain:e}}=this,{receiveAddressStore:{checkReceiveAddressLoading:t,computedSwapHighLight:o}}=this.rootStore;return e&&!o||t?be:null});s(this,"interceptionProcessing",()=>{let{fromToStore:e}=this;return!this.isInterceptionProcessing&&e.isBalanceLoading||e.fromBalanceState===ye.BALANCE_REQUEST_FAILED?be:null});s(this,"balanceLessThenInputAmount",()=>this.computedTooBalance?Zr:null);s(this,"approveStatus",()=>{let{approveStore:{computedApprovalStatus:e}}=this;return _c[e]||null});s(this,"isValidAmount",()=>{let{fromToStore:e}=this,{from:t,to:o}=e;return o.amount&&t.amount?eo:null});s(this,"getBtnStatus",()=>{let e=[this.hasFeeConfigErrorTips,this.uninitializedWalletInfo,this.unConnectedWallet,this.nonsupportChain,this.nonsupportFacetToken,this.checkReceiveAddressStatus,this.noAmountOrIsHoneypotOrOverLimit,this.interceptionProcessing,this.balanceLessThenInputAmount,this.isQuoting,this.approveStatus,this.isValidAmount],t;for(let o of e){let n=o();if(n){t=n;break}}return t||(t=be),t});s(this,"checkIsCurrentQuote",()=>(this.computedIsCurrentQuote||F.warn({title:S("swaptrade_mid_toast_tryagain_with_newquote")}),this.computedIsCurrentQuote));let{accountStore:t,fromToStore:o,swapStore:n,commonStore:i,quoteStore:a,approveStore:c,tradeModeStore:p}=e;this.rootStore=e,this.accountStore=t,this.fromToStore=o,this.swapStore=n,this.commonStore=i,this.quoteStore=a,this.approveStore=c,this.tradeModeStore=p,this.swapInterceptor=new Sh(e),Object.assign(this,e)}async runSwapInterceptor(e){this.isInterceptionProcessing=!0;let[t,o]=await N(this.swapInterceptor.check());if(this.isInterceptionProcessing=!1,t){k.error(M.UPDATE_BTC_BALANCE_ERROR_BEFORE_SWAP,{error:t});return}if(o.length===0){e();return}let n=-1,i=()=>{n++;let a=n===o.length-1;this.showErrorTips(o[n],a?e:i)};i()}getBtnAllStatus({from:e,computedIsSingleChain:t}){return{[zr]:{statusType:zr,disabled:!1,toLocaleText:()=>S(zr),onClick:this.connectWallet},[Zr]:{statusType:Zr,disabled:!0,toLocaleText:()=>S(Zr,{tokenSymbol:q(e.tokenSymbol)}),symbol:e.tokenSymbol},[Zo]:{statusType:Zo,disabled:!1,toLocaleText:()=>S(Zo,{tokenSymbol:q(e.tokenSymbol)}),onClick:this.approve,icon:"okx-defi-dex-authorization",iconType:mi.ICON_POSITION.leading},[Jr]:{statusType:Jr,loading:!0,disabled:!0,toLocaleText:()=>S(Jr)},[Oi]:{statusType:Jr,disabled:!1,toLocaleText:()=>S(Oi,{ccy:e.tokenSymbol}),onClick:this.cancelApprove,icon:"okx-defi-dex-authorization",iconType:mi.ICON_POSITION.leading},[Jo]:{statusType:Jo,loading:!0,disabled:!0,toLocaleText:()=>S(Jo)},[be]:{statusType:be,disabled:!0,toLocaleText:()=>S(t?be:vi)},[eo]:{statusType:eo,disabled:!1,loading:this.swapBtnLoading,toLocaleText:()=>S(t?eo:vi),onClick:this.swap}}}get needToCrossChainDoubleCheck(){return!0}get computedTooBalance(){let{rootStore:e,fromToStore:t,accountStore:o}=this,{isConnectedWallet:n}=o,i=t.from.balance,a=e.safeMoonStore.computedInputVal;return n?new js(i||0).isLessThan(a):!1}get computedBtnStatus(){let{fromToStore:e}=this,t=this.getBtnStatus();return this.getBtnAllStatus(e)[t]}get computedIsCurrentQuote(){let{fromToStore:e,quoteStore:t}=this,{computedIsExactIn:o,computedTypedValue:n}=e,{quote:i,getGasTokenFeeLoading:a}=t,{fromTokenAmount:c="",inputToTokenAmount:p=""}=(i==null?void 0:i.bestRoute)||{},d=!!n,h=d&&o&&js(n).isEqualTo(c),m=d&&!o&&js(n).isEqualTo(p);return!a&&(h||m)}};u();l();var gh=Re(["tipsDialogInfo","notShowAgainCrossChainConfirm","isInterceptionProcessing","swapBtnLoading"],["computedTooBalance","computedBtnStatus","computedIsCurrentQuote"]);var pr=class extends Fo{constructor(t){super(t);s(this,"handleSwap",async()=>{var a,c;let{quote:t,computedIsDexQuote:o}=this.quoteStore,{receiveAddressStore:n}=this.rootStore;if(this.swapBtnLoading=!0,this.walletContractStore.setQuoteData(t.bestRoute),o){let p=await this.walletContractStore.fetchCallData();if(this.swapBtnLoading=!1,p)return}this.swapBtnLoading=!1;let i=o?fe.SWAP:fe.INTENT_SWAP;n.saveWalletAddressToStorage((a=this.fromToStore)==null?void 0:a.to),(c=R.history)==null||c.push({pathname:Ne,search:`needUpdate=${tn.on}&type=${i}`})});s(this,"swap",async()=>{let t=this.checkIsCurrentQuote();ku({wallet_address:this.accountStore.address,button_name:"confirm",...this.quoteStore.computedMonitorSwapSaveOrderParams}),t&&(this.swapBtnLoading=!0,this.runSwapInterceptor(this.handleSwap))});s(this,"approve",async()=>{let{accountStore:t}=this;this.approveStore.updateCurrentApproveTokenConfig({status:B.Approving});let o=await R.checkMpcAccountIfNecessary();if(Xi({wallet_address:t.address}),!o){this.approveStore.updateCurrentApproveTokenConfig({status:B.UnApproved});return}this.approveStore.setApprove()});s(this,"cancelApprove",async()=>{let{accountStore:t}=this;this.approveStore.updateCurrentApproveTokenConfig({status:B.CancelApproving});let o=await R.checkMpcAccountIfNecessary();if(Xi({wallet_address:t.address}),!o){this.approveStore.updateCurrentApproveTokenConfig({status:B.CancelApprove});return}this.approveStore.setApprove(Ir.CANCEL_APPROVE)});this.walletContractStore=t.walletContractStore,Te(this,gh)}};u();l();u();l();u();l();u();l();var Th=function(){return new Promise(function(e){setTimeout(e,1)})};u();l();var Hr=w(V());u();l();var rg=/\s/,yh=r=>!(!fu(r)||rg.test(r)||r.length<10);u();l();u();l();var $t={AUTO:1,CUSTOM:2,DEFAULT:3};var sg=I.mul(.5,100),ag=I.mul(.1,100),Qs=r=>{let e=A(r,"quoteStore.quote.bestRoute.autoSlippageInfo",{}),{computedDefaultAutoSlippageInfo:t}=r.fromToStore;return{...t,...e}},xo=({isSingleChain:r,autoSlippageInfo:e})=>{let{autoSlippage:t,autoTotalSlippage:o}=e||{};return r?t||.01:o||.03},Jn=r=>{let e=r.fromToStore.computedIsSingleChain,t=Qs(r),o=xo({isSingleChain:e,autoSlippageInfo:t});return I.mul(I.ceilTruncate(o,3,!1),100)},cg=r=>{let e=Pt(r);if(e.indexOf(".")>-1){let t=e.split("."),o=t[0],n=t[1];n&&n.length>1&&(n=n.slice(0,1)),e=`${o}.${n}`}return le(e)},ei=({inputSlippageParams:r,computedSafeMoonTips:e,minSlippageShow:t,maxSlippageShow:o=sg,autoSlippageValue:n=0,isSingleChain:i=!0})=>{let{safeMoonSlippage:a=0,overLimit:c,equalLimit:p}=e||{};if(r===""&&!e)return{slippage:0,inputValue:"",notice:"",isError:!1};let d=cg(r),h="",m=!1,g=!1;return e!=null&&e.safeMoonSlippage?c||p||I.BigNumber(d).isZero()?h="":t>d?(h=S("swaptrade_settings_errortip_minimum_slippage",{cross:Ye(t,{needZero:!1})}),m=!0,d=a):a>d?(h=S("swaptrade_settings_errortip_lowslippage_failed",{auto:Ye(a,{needZero:!1})}),g=!0):d>o&&(h=S("swaptrade_card_swap_advance_options_exceeding_desc",{num:Ye(o,{needZero:!1})}),m=!0,d=a):or(d)?(d="",m=!0):d<t?(h=S(i?"swaptrade_dialog_modal_singlechain_limit":"swaptrade_dialog_modal_crosschain_limit",{value:I.thousandFormat(t)}),m=!0):d<n?(h=S("swaptrade_dialog_modal_transaction_failure"),m=!1):d>=ag&&d<=o?(h=S("swaptrade_adjustslip_modalhint_actual_amount_less",{value:Ye(d,{needZero:!1})}),m=!1):d>o&&(d=o,h=S("swaptrade_card_swap_advance_options_exceeding_desc",{num:Ye(o,{needZero:!1})}),m=!0),{slippage:d,inputValue:r!==""?Pt(d):"",notice:h,isError:m,isWarning:g}},_h=({slippageInfo:r,isSingleChain:e})=>{let{autoSlippageInfo:t,customSlippage:o}=r,n={};return e?o||(n=uo(t,["autoSlippage"])):n=uo(t,["autoFromSlippage","autoToSlippage","autoTotalSlippage"]),Object.keys(n).forEach(a=>{let c=n[a],p=I.ceilTruncate(c,3,!1);n[a]=I.toPlainString(Number(p))}),{customSlippage:o,autoSlippageInfo:n}};u();l();function Ih({error:r,walletType:e}){let t=!0;return br.METAMASK===e&&(r==null?void 0:r.code)===vt.INTERNAL_ERROR&&(t=!1),{hasCancelOrder:t}}var{BigNumber:Eh}=I;var Bo=class{constructor(e){s(this,"defaultGasFee","--");s(this,"isWalletConfirm",!1);s(this,"setWalletConfirm",e=>{this.isWalletConfirm=e});s(this,"isConfirmLoading",!1);s(this,"txInfo",{});s(this,"resetTxInfo",()=>{this.txInfo={}});s(this,"showRecentTransactionModal",e=>{this.confirmSwapVisible=!1,this.rootStore.recentTransactionStore.showModal(e)});s(this,"saveOrderParamsExtendSlippageAndGasPrice",e=>{let t={...e},{computedQuote:o,fromToStore:n}=this,{computedIsSingleChain:i,computedDefaultAutoSlippageInfo:a}=n,{autoSlippageInfo:c}=o.bestRoute||{},p=xo({isSingleChain:i,autoSlippageInfo:a}),d={autoSlippageInfo:c||{}},h=A(this,"rootStore.slippageStore");return h&&(p=h.computedRealSlippageValue,d=h.getOrderSlippageInfo()),Object.assign(t,{slippage:String(p),..._h({slippageInfo:d,isSingleChain:i})})});s(this,"baseSaveOrderParams",()=>{let{accountStore:e,computedQuote:t,fromToStore:o,quoteStore:n,gasDropStore:i}=this,{from:a,to:c}=o,{estimateGasFee:p,minimumReceived:d,gasDropAmount:h}=t.bestRoute||{},m={chainId:a.chainId,fromAmount:Eh(n==null?void 0:n.computedQuoteAmount).toString(10),fromTokenAddress:a.tokenContractAddress,fromTokenDecimal:String(a.decimals),toAmount:c.reverseReceiveAmount,toTokenAddress:c.tokenContractAddress,toTokenDecimal:String(c.decimals),userWalletAddress:e.address,estimateGasFee:p,pmm:"1",gasDropType:i!=null&&i.computedGasDropSelected?1:0,gasDropAmount:h,minimumReceived:d},g=this.rootStore.outerStore.extendFeeConfig(m);return this.saveOrderParamsExtendSlippageAndGasPrice(g)});s(this,"saveOrderSingleChainParams",e=>{let{computedQuote:t}=this,{originDexRouterList:o,dexRouterList:n}=t.bestRoute||{};return{...e,dexRouterList:n,originDexRouterList:o}});s(this,"saveOrderCrossChainParams",e=>{let{computedQuote:t,fromToStore:o}=this,{receiveAddressStore:n}=this.rootStore,{to:i,computedDiffCrossChain:a}=o,{receiveAddrObj:c}=n,{fromDexRouterList:p,bridge:d,toDexRouterToList:h,originFromDexRouterList:m}=t.bestRoute||{};return{...e,toChainId:i.chainId,crossChainDexRouter:{fromDexRouterList:p,toDexRouterToList:h,bridge:d,originFromDexRouterList:m},...a?{receiveWalletAddress:c==null?void 0:c.specifiedAddress}:{}}});s(this,"saveOrderParams",()=>{let{fromToStore:e}=this,{computedIsSingleChain:t}=e,o=this.baseSaveOrderParams();return t?this.saveOrderSingleChainParams(o):this.saveOrderCrossChainParams(o)});s(this,"resetFromToAmount",()=>{this.fromToStore.updateFrom({amount:"",currentTime:"",prevAmount:"",usdPrice:""}),this.fromToStore.updateTo({amount:"",prevAmount:"",usdPrice:"",currentTime:""}),this.fromToStore.advanceSetTypedValue("")});s(this,"transferBtcPayload",e=>{let t={...e},{from:o}=this.fromToStore;return t.value=Pr(t.value,o.decimals),t});s(this,"getExtParams",e=>{let{computedIsSingleChain:t,to:o,from:n,computedDiffCrossChain:i}=this.fromToStore,{receiveAddrObj:a}=this.rootStore.receiveAddressStore,c=i?a==null?void 0:a.specifiedAddress:o.tokenContractAddress;return{txSource:3,orderId:e,toTokenAddress:c,crossChain:t?0:1,chainId:n.chainId,tokenAddress:n.tokenContractAddress,amount:n.amount,toChainId:o.chainId}});s(this,"confirmSwapVisible",!1);s(this,"setConfirmSwapVisible",e=>{this.confirmSwapVisible=e});s(this,"repeatOrder",null);s(this,"checkRepeatOrder",async()=>{let{accountStore:e,fromToStore:t,quoteStore:o}=this,{from:n,to:i,computedIsCrossChain:a}=t;this.repeatOrder=null;let c=A(this.computedQuote.bestRoute,a?"fromSwapFeeUsd":"quoteNetWorkFeeOfMoney"),p={chainId:n.chainId,fromTokenAddress:n.tokenContractAddress,amount:o==null?void 0:o.computedQuoteAmount,toTokenAddress:i.tokenContractAddress,userWalletAddress:e.address,accountId:e.computedAccountId,fromSwapFeeUsd:c},[d,h]=await N(P.get(Hc,{params:p}));!d&&[er.COMMON_REPEAT,er.BTC_REPEAT,er.FACET_REPEAT].includes(h==null?void 0:h.data.repeatFlag)&&Ae(()=>{var T;let{orderId:m,enoughFlag:g}=(T=h==null?void 0:h.data)!=null?T:{};this.repeatOrder={enoughFlag:g,repeatFlag:h==null?void 0:h.data.repeatFlag,id:m}})});s(this,"selectTokenHandle",async e=>{let t=this.commonStore.getChainByID(Number(e==null?void 0:e.chainId));if(await Th(),!t)return;let{tokenModalStore:o,quoteStore:n}=this.rootStore,{from:i,updateFrom:a,updateTo:c,setBalance:p,setFromBalanceRequestError:d,setToBalanceRequestError:h,to:m,computedIsExactIn:g,needCrossChainDoubleConfirm:T,setNeedCrossChainDoubleConfirm:y}=this.fromToStore,{clearReceiveAddressValue:C}=this.rootStore.receiveAddressStore;o.setUserChainIdCache(e==null?void 0:e.chainId),o.setCommonlyUsedChain([e==null?void 0:e.chainId]),this.quoteStore.isFirstQuote=!0;let b=o.tokenModalFromState===_.FROM,L=()=>{d(!1),p(_.FROM,e.balance)},G=()=>{h(!1),p(_.TO,e.balance)};if(e.selected){b?G():L(),this.fromToStore.onSwitchFromTo();return}if(b?L():G(),b){if(!this.commonStore.equalsToken(e,i)){let{amount:ge}=i;n.setQuoteNumber(2),a({...e,amount:ge});let{toToken:ce,isChanged:ut}=o.checkFromToLegal(e,m);c(ce),ut&&(T||y(!0),this.fromToStore.getTokenBalanceByAccount("to",U(ce))),g&&this.fromToStore.advanceSetTypedValue("")}}else this.commonStore.equalsToken(e,m)||(T||y(!0),n.setQuoteNumber(0),c({...e,amount:""}),g||this.fromToStore.advanceSetTypedValue(""));C()});this.rootStore=e,this.commonStore=e.commonStore,this.accountStore=e.accountStore,this.fromToStore=e.fromToStore,this.tokenModalStore=e.tokenModalStore,this.quoteStore=e.quoteStore,this.gasDropStore=e.gasDropStore}get computedEstimateGasFee(){let e=this.defaultGasFee,t=this.commonStore.nowCurrencyUnit,o=A(this.computedQuote.bestRoute,"quoteNetWorkFeeOfMoney"),n=Eh(o).multipliedBy(A(t,"usdToThisRate"));return!se(t)&&!n.isNaN()&&(e=he(n.toJSON(),t==null?void 0:t.symbol)),e}get computedCrossChainFromFee(){let e=A(this.computedQuote.bestRoute,"fromSwapFeeUsd");if(!e||or(Number(e)))return"--";let{computedNowCurrencySymbol:t,currencyConversion:o}=this.commonStore,n=o(e).toString();return`${he(n,t)}`}updateTxHash(e){this.rootStore.sendTransactionStore.updateTxHash(e)}cancelOrder(e){return this.rootStore.sendTransactionStore.cancelOrder(e)}saveOrderUrl(){return sn}onSaveOrder(){let e=this.saveOrderParams();return k.info(M.SAVE_ORDER_PARAMS,{data:e}),P.post(this.saveOrderUrl(),e)}saveOrderErr(e){var i;let{error_code:t,error_message:o=""}=e,n=((i=e==null?void 0:e.data)==null?void 0:i.code)||t||"";return k.error(M.SAVE_ORDER_ERROR,{error:e,tags:{errorCode:t||n,error_msg:`${M.SAVE_ORDER_ERROR}_${n}`}}),t==="10014"?yr.error({title:S("swaptrade_toast_trade_not_available")}):yr.error({title:o||S("swaptrade_toast_save_order_fail")})}getSaveOrderMonitorData(){}async onSwap(e){var i,a;this.isConfirmLoading=!0,k.keepLive();let[t,o]=await N(this.onSaveOrder());if(t){this.saveOrderErr(t),this.isConfirmLoading=!1,k.removeKeep();return}k.info(M.SAVE_ORDER,{data:o==null?void 0:o.data,tags:{orderId:o==null?void 0:o.data.orderId}}),Lu({...this.getSaveOrderMonitorData(),order_id:o==null?void 0:o.data.orderId,wallet_type:(i=this.accountStore.walletConfig)==null?void 0:i.walletType});let[n]=await N(this.onChainTransaction((o==null?void 0:o.data)||{},e));n&&this.onWalletFail(n,(a=o==null?void 0:o.data)==null?void 0:a.orderId),this.isConfirmLoading=!1,k.removeKeep()}walletErrorMessage(e){let t=null;try{t=JSON.parse(e==null?void 0:e.message)}catch{t={}}return t}walletErrToast(e,t){let o,n=this.walletErrorMessage(e);return k.error(M.SEND_ERROR,{error:e,tags:{orderId:t}}),(n==null?void 0:n.code)===vt.SLIPPAGE_LOW?o=S("swaptrade_home_toast_slippage_too_low"):(n==null?void 0:n.code)===vt.SEND_TX_ERROR_CODE&&(o=n==null?void 0:n.message),yr.error({title:o||S("swaptrade_home_toast_broadcast_failed")})}onWalletFail(e,t){var o;if(Ln(e))this.cancelOrder(t);else if((e==null?void 0:e.code)!==kc.RECEIPT_ERROR){let{hasCancelOrder:n}=Ih({error:e,walletType:(o=this.accountStore.walletConfig)==null?void 0:o.walletType});n&&this.cancelOrder(t),ho.emit(po.FAIL,{data:{orderId:t},status:-2,message:Ni("transaction fail")}),this.walletErrToast(e,t)}k.error(M.ON_WALLET_FAIL,{error:e,tags:{orderId:t}})}extendEvmParams(e){return e}isOkxWallet(){}async getTransactionPayload(e,t){let{from:o}=this.fromToStore;return Nn(o,{orderData:e,extParams:this.getExtParams(t)},this).getSendTransactionParams()}sendTransactionEnhance(...e){return this.rootStore.sendTransactionStore.sendTransaction(...e)}getTransaction(){}async onChainTransaction(e,t){let{callData:o,orderId:n}=e,i=await this.getTransactionPayload(e,n),{computedIsEvmChain:a}=this.fromToStore;if(k.info(M.PAYLOAD,{payload:i,tags:{orderId:n}}),t)try{await t(...i)}catch(c){return k.error(M.BEFORE_SEND_TRANSACTION_ERROR,{error:c}),!1}return this.sendTransactionEnhance(...i).then(({result:c,nonce:p})=>{if(!yh(c))throw new Error(`hash format is invalid: ${c}`);return this.txInfo={...o,txHash:c},I.BigNumber(p).isNaN()?(this.updateTxHash({orderId:n,transactionHash:c}),a&&this.getTransaction(c,this.fromToStore.from.chainId).then(d=>{k.info(M.UPDATE_NONCE,{nonce:d.nonce,tags:{orderId:n}}),this.updateTxHash({orderId:n,transactionHash:c,nonce:d.nonce})}).catch(d=>{k.error(M.UPDATE_NONCE_FAIL,{error:d})})):this.updateTxHash({orderId:n,transactionHash:c,nonce:p}),this.afterTransaction(n),!0})}afterTransaction(e){this.setWalletConfirm(!0),this.resetFromToAmount(),this.showRecentTransactionModal(e),ho.emit(po.TXHASH,{status:0,data:U(this.txInfo),message:Ni("Transaction hash has been generated")})}get computedQuote(){return this.quoteStore.quote}checkRepeatOrderDetail(){this.repeatOrder&&this.rootStore.recentTransactionStore.showModal(this.repeatOrder.id)}};u();l();var Ch=Re(["isWalletConfirm","isConfirmLoading","txInfo","confirmSwapVisible","repeatOrder"],["computedEstimateGasFee","computedCrossChainFromFee","computedQuote"]);var dr=class extends Bo{constructor(t){super(t);s(this,"sendTransactionEnhance",t=>{var g,T;let{computedIsSolanaChain:o,computedIsTronChain:n,computedIsAptosChain:i,computedIsSuiChain:a,computedIsStacksChain:c,computedIsStarknetChain:p,computedIsFromBtcCoin:d}=(g=this.rootStore)==null?void 0:g.fromToStore,{from:h}=(T=this.rootStore)==null?void 0:T.fromToStore,{walletSendParams:m}=this.rootStore.walletContractStore;return this.rootStore.sendTransactionStore.sendTransaction(h.chainId,t,m).then(y=>{let C,b;if(o)C=y.signature;else if(n){let{transaction:L}=y;C=L==null?void 0:L.txID}else if(i)C=y;else if(a)C=y;else if(c)C=y.txHash;else if(p)C=y.transaction_hash;else if(d)C=y;else{let{hash:L,nonce:G}=y;C=L,b=G}return{result:C,nonce:b}})});s(this,"showRecentTransactionModal",t=>{this.isConfirmLoading=!1,this.confirmSwapVisible=!1,R.history.replace(`${lt}/${t}`)});s(this,"extendsGas",t=>{let o={...t},{gasInfo:n}=this.rootStore.walletContractStore,{gasLimitInfo:i,isGasLimitLoading:a,gasType:c,...p}=n;return o.extParams.gasType=c,{...o,gasInfo:p}});s(this,"extendEvmParams",t=>{var p,d;let o=super.extendEvmParams(t),{activityId:n}=this.rootStore.walletContractStore,i=(d=(p=this.rootStore.quoteStore.quote)==null?void 0:p.bestRoute)==null?void 0:d.isEnableMev;n&&(o.extParams.activityId=n);let{computedIsMevOpen:a,mevInfo:c}=this.rootStore.mevStore;return a&&(o.extParams.isMev=!0,o.extParams.mevInfo=c),!a&&Number(i)===Ar.ON&&(o.extParams.isShowBlockSwapMevTooltip=!0),o});s(this,"onWalletFail",(t,o)=>{var n,i;this.isConfirmLoading=!1,!((i=t==null?void 0:t.message)!=null&&i.includes((n=R.global)==null?void 0:n.HARDWALLETERROR))&&super.onWalletFail(t,o)});s(this,"checkRepeatOrderDetail",()=>{this.repeatOrder&&R.history.push(`${lt}/${this.repeatOrder.id}`)});s(this,"checkUtxoBeforePublish",async t=>{let{utxoList:o}=t,{preDataForSendBtc:n}=this.rootStore.walletContractStore,{checkUtxoBeforePublish:i}=n;await i(o)});s(this,"onSwap",async(...t)=>{var a,c;this.isConfirmLoading=!0;let o=await R.checkMpcAccountIfNecessary();if(this.isConfirmLoading=!1,!o)return;let{computedIsDexQuote:n}=this.rootStore.quoteStore,{computedIsFromBtcCoin:i}=(a=this.rootStore)==null?void 0:a.fromToStore;n?await super.onSwap(i?this.checkUtxoBeforePublish:null):await((c=this.rootStore.intentSwapStore)==null?void 0:c.onIntentSwap(...t))});s(this,"getSaveOrderMonitorData",()=>({...this.quoteStore.computedMonitorSwapSaveOrderParams,...this.rootStore.walletContractStore.computedMonitorGasType}));Te(this,Ch)}isOkxWallet(){return!0}getTransaction(){}walletErrorMessage(t){return t}};u();l();u();l();u();l();u();l();var ug={[O.SWAP]:"swap_used_chain_cache",[O.LIMIT_ORDER]:"limit_used_chain_cache",[O.BRIDGE]:"bridge_used_chain_cache"},wh=(r,e,t)=>{let o=ug[t],n=v.get(o)||[];if(n.length===0&&(n=e.slice(0,4).map(a=>a.chainId)),r.forEach(i=>{n.includes(i)||n.unshift(i)}),n=n.filter(i=>e.find(a=>a.chainId===i)),n.length<4)for(let i=0;i<e.length&&n.length<4;i++)n.includes(e[i].chainId)||n.push(e[i].chainId);return n.length>4&&(n=n.slice(0,4)),v.set(o,n),n};u();l();var{BigNumber:lg}=I,Uo=class{constructor(e,t){s(this,"id",1);s(this,"tokenSymbol","--");s(this,"tokenName","--");s(this,"decimals",6);s(this,"tokenContractAddress","");s(this,"tokenLogoUrl","");s(this,"type","");s(this,"amountNum",0);s(this,"currencyAmount",0);H(this),Object.assign(this,e),this.tokenModalStore=t}get computedPrice(){let{nowCurrencyUnit:e}=this.tokenModalStore.commonStore,{symbol:t,usdToThisRate:o}=e,n=new lg(this.currencyAmount);return io(n)||We(n)?`${t||""}0.00`:t&&o&&!n.isNaN()&&!We(n)?he(n.multipliedBy(o).toJSON(),t):"0"}get computedIsSelect(){let{equalsToken:e}=this.tokenModalStore.commonStore,{from:t,to:o}=this.tokenModalStore.fromToStore;return this.tokenModalStore.tokenModalFromState===_.FROM?e(this,o):e(this,t)}get computedIsSelectOrigin(){let{from:e,to:t}=this.tokenModalStore.fromToStore,{equalsToken:o}=this.tokenModalStore.commonStore;return this.tokenModalStore.tokenModalFromState===_.FROM?o(this,e):o(this,t)}get computedAmountNum(){return this.amountNumBigDecimal!==""?this.amountNum:0}toJSON(){return U(this)}};u();l();var qo=(r={})=>({...ve,logoUrl:ve.logoUrl(),chainName:S(ve.localKey),...r}),ti=(r={},e)=>({..._e,get logoUrl(){return e===pa.dark?_e.darkLogoUrl():_e.logoUrl()},chainName:S(_e.localKey),...r});var Ah="hide_collect_cancel_dialog",bh="hideTokenGuide",hr=class{constructor(e){s(this,"searchValue","");s(this,"fromTokenList",new Map);s(this,"toTokenList",new Map);s(this,"searchTokenList",{});s(this,"error",!1);s(this,"tokenModalVisible",!1);s(this,"tokenModalFromState",_.FROM);s(this,"loading",{[_.FROM]:{},[_.TO]:{}});s(this,"importTokenInfo",{});s(this,"setImportTokenInfo",e=>{this.importTokenInfo={...e}});s(this,"toSelectedChainId","");s(this,"fromSelectedChainId","");s(this,"userChainIdCache","");s(this,"setUserChainIdCache",e=>{this.userChainIdCache=e});s(this,"extendTokenList",(e=[],t=!0)=>{if(se(e))return e;let o=[];return e.forEach(n=>{if(this.commonStore.getChainByID(le(n.chainId))){let i=new Uo(n,this),a={balance:i.computedAmountNum,selected:i.computedIsSelect,selectedOrigin:t?i.computedIsSelectOrigin:!1,price:i.computedPrice};o.push({...n,...a})}}),o});s(this,"importUserToken",Ct(function*(t,o=!0){let n=t.map(c=>{let{chainId:p,tokenContractAddress:d,tokenSymbol:h,decimals:m}=c;return{chainId:p,contractAddress:d,tokenSymbol:h,precision:m}}),i={userUniqueId:this.commonStore.userUniqueId,tokenDetailList:n},a=[];try{a=(yield P.post(Mc,i)).data}catch(c){throw F.error(S("swaptrade_pricechart_no_connection_desc")),c}return o&&(this.searchValue="",this.changeTokenModalVisible(!1)),a}));s(this,"orderTokenList",e=>this.computedIsCollectChain?e:yu(e,[t=>Number(t.topPlacement),t=>Number(t.currencyAmount),t=>Number(t.amountNum),t=>Number(t.isCollectToken),t=>Number(t.collectTime)],["desc","desc","desc","desc","desc"]));s(this,"formatTokenList",(e,t)=>{let o=e;e.length>100&&t!==ve.chainId&&(o=e.slice(0,100));let n=this.extendTokenList(o,!0);return this.orderTokenList(n)});s(this,"getTokenListByChainId",async()=>{let e=this.tokenModalFromState===_.FROM,t={};if(this.tokenModalFromState===_.FROM?t={fromChainId:this.fromSelectedChainId}:this.tokenModalFromState===_.TO&&(t={fromChainId:this.fromToStore.from.chainId,toChainId:this.toSelectedChainId}),this.tokenModalFromState===_.FROM&&Number(this.fromSelectedChainId)===_e.chainId){this.getFromAllNetworksTokens();return}if(this.tokenModalFromState===_.TO&&Number(this.toSelectedChainId)===_e.chainId){this.getToAllNetworksTokens(t.fromChainId);return}if(this.tokenModalFromState===_.FROM&&Number(this.fromSelectedChainId)===ve.chainId){this.getFromCollectedTokens();return}if(this.tokenModalFromState===_.TO&&Number(this.toSelectedChainId)===ve.chainId){this.getToCollectedTokens(t.fromChainId);return}e?this.getTokenList(_.FROM,t.fromChainId):this.getTokenList(_.TO,t.toChainId,t.fromChainId)});s(this,"setTokenList",(e,t,o)=>{let n=this.formatTokenList(t,e);this[`${o}TokenList`].set(e,n)});s(this,"handleTokenList",Ct(function*(t,o,n,i){this.setError(!1),this[`${t}TokenList`].get(o)||this.setLoading(t,o,!0);try{let{data:a}=yield P.get(n,{params:i}),c=this.toLowerCaseContractAddress(a);return this.setTokenList(o,c,t),this.setLoading(t,o,!1),{data:c}}catch(a){return this.setTokenList(o,[],t),this.setLoading(t,o,!1),this.setError(!0),a}}).bind(this));s(this,"getTokenList",Ct(function*(t,o,n){var c;let i={fromChainId:n,chainId:o,userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,userWalletAddress:this.accountStore.computedSpecialWalletAddress};(c=this.commonStore)!=null&&c.computedCurrentTabIsLimit&&(i={...i,businessLine:pt.LIMIT_ORDER});let a=le(o);return this.computedIsNotSupportToChain?(this.setTokenList(a,[],t),{data:[]}):yield this.handleTokenList(t,a,Nc,i)}));s(this,"getFromCollectedTokens",Ct(function*(){var n;let t={userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,fromChainId:"",userWalletAddress:this.accountStore.computedSpecialWalletAddress};(n=this.commonStore)!=null&&n.computedCurrentTabIsLimit&&(t={...t,businessLine:pt.LIMIT_ORDER});let o=Dt(De.COLLECT_LIST,this.commonStore.currentTab);return yield this.handleTokenList(_.FROM,ve.chainId,o,t)}));s(this,"getToCollectedTokens",Ct(function*(t){var i;let o={userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,fromChainId:t,chainId:t,userWalletAddress:this.accountStore.computedSpecialWalletAddress};(i=this.commonStore)!=null&&i.computedCurrentTabIsLimit&&(o={...o,businessLine:pt.LIMIT_ORDER});let n=Dt(De.COLLECT_LIST,this.commonStore.currentTab);return yield this.handleTokenList(_.TO,ve.chainId,n,o)}));s(this,"getFromAllNetworksTokens",Ct(function*(){var n;let t={userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,fromChainId:"",userWalletAddress:this.accountStore.computedSpecialWalletAddress};(n=this.commonStore)!=null&&n.computedCurrentTabIsLimit&&(t={...t,businessLine:pt.LIMIT_ORDER});let o=Dt(De.ALL_NETWORK,this.commonStore.currentTab);return yield this.handleTokenList(_.FROM,_e.chainId,o,t)}));s(this,"getToAllNetworksTokens",Ct(function*(t){var i;let o={userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,fromChainId:t,userWalletAddress:this.accountStore.computedSpecialWalletAddress};(i=this.commonStore)!=null&&i.computedCurrentTabIsLimit&&(o={...o,businessLine:pt.LIMIT_ORDER});let n=Dt(De.ALL_NETWORK,this.commonStore.currentTab);return yield this.handleTokenList(_.TO,_e.chainId,n,o)}));s(this,"cancelSearchRef",null);s(this,"getSearchTokenList",async()=>{var h,m;if(this.searchValue==="")return;if(this.cancelSearchRef&&this.cancelSearchRef.abort(),this.computedIsNotSupportToChain){this.setSearchTokenList({}),this.setLoading(this.tokenModalFromState,"search",!1);return}this.cancelSearchRef=Ge(),this.setLoading(this.tokenModalFromState,"search",!0),this.setError(!1);let e=Hi(this.searchValue),t=en.SINGLE;this.computedCurrentChainId===_e.chainId&&(t=en.ALL_NETWORK),this.computedCurrentChainId===ve.chainId&&(t=en.COLLECT);let o={userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,chainType:t,searchType:t,userWalletAddress:this.accountStore.computedSpecialWalletAddress};(h=this.commonStore)!=null&&h.computedCurrentTabIsLimit&&(o={...o,businessLine:pt.LIMIT_ORDER});let n={},i={},a=g=>[_e.chainId,ve.chainId].includes(le(g));this.tokenModalFromState===_.FROM?(n={inputContent:e,fromChainId:this.fromSelectedChainId,chainId:this.fromSelectedChainId,toChainId:this.fromSelectedChainId},a(this.fromSelectedChainId)&&(delete n.fromChainId,delete n.toChainId,delete n.chainId)):this.tokenModalFromState===_.TO&&(i={inputContent:e,fromChainId:this.fromToStore.from.chainId,chainId:this.fromToStore.from.chainId,toChainId:this.toSelectedChainId,fromTokenAddress:this.fromToStore.from.tokenContractAddress||""},a(this.toSelectedChainId)&&(delete i.toChainId,delete n.chainId)),Pu({keyword:e});let c=Dt(De.SEARCH,this.commonStore.currentTab),[p,d]=await N(P.get(c,{params:{...o,...n,...i},signal:(m=this.cancelSearchRef)==null?void 0:m.signal}));if(p&&!this.isCancel(p)&&(this.setError(!0),this.setSearchTokenList({}),this.setLoading(this.tokenModalFromState,"search",!1)),d){let{systemList:g,thirdPartyList:T}=d.data;this.setSearchTokenList({systemList:g,thirdPartyList:T}),this.setLoading(this.tokenModalFromState,"search",!1)}});s(this,"resetTokenModal",()=>{this.resetTokenData()});s(this,"resetTokenData",()=>{this.searchTokenList={},this.searchValue=""});s(this,"balancePushSort",(e,t)=>{let o=[...e],{currencyAmount:n,coinAmountOriginalDec:i}=t;for(let a=0;a<o.length;a++)if(this.commonStore.equalsToken(o[a],t)){o[a].amountNum=i,o[a].currencyAmount=n;break}return o});s(this,"updateAllTokenList",e=>{let{chainId:t}=e,o=le(t),n=this.fromTokenList.get(o);n&&this.setTokenList(o,this.balancePushSort(U(n),e),_.FROM);let i=this.toTokenList.get(o);i&&this.setTokenList(o,this.balancePushSort(U(i),e),_.TO)});s(this,"checkFromToLegal",(e,t)=>{var i;let{currentTab:o}=this.commonStore,n={toToken:{...t,amount:""},isChanged:!1};if(Number(e.chainId)!==Number(t.chainId)){if((i=this.computedToChain)!=null&&i.some(g=>g.chainId===t.chainId&&!g.disabled))return n;let{dexDefaultFromToTokenShowVO:a}=this.commonStore.getChainByID(this.fromToStore.from.chainId),{fromDexMultiTokenInfoVO:c,toDexMultiTokenInfoVO:p,toCrossDexMultiTokenInfoVO:d}=a,h=o===O.BRIDGE,m;return h&&d?m=d:this.commonStore.equalsToken(e,p)?m=c:m=p,{toToken:m,isChanged:!0}}return n});s(this,"calcCurToChainIdIsInSupList",e=>{let t=!1;return U(this.computedToChain).forEach(o=>{Number(o.chainId)===Number(e)&&!o.disabled&&(t=!0)}),t});s(this,"updateTokenCollected",async(e,t=!1)=>{let{isConnectedWallet:o}=this.accountStore;if(!o){F.error(S("swaptrade_selecttoken_toast_connect_wallet"));return}let n=un({},{tokenContractAddress:(e==null?void 0:e.tokenContractAddress)||this.rootStore.klineStore.chooseTokenContractAddress,chainId:Number(e==null?void 0:e.chainId),symbol:e==null?void 0:e.tokenSymbol,decimal:e==null?void 0:e.decimals,isCustomToken:(e==null?void 0:e.isCustomToken)||(e==null?void 0:e.isSubscribe),walletAddress:this.accountStore.address||this.accountStore.computedAccountWalletAddressesArray[0],userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId}),[i,a]=await N(P.post(an,n));this.updateTokenCollectedLocal(e),i?(F.error(S("swaptrade_pricechart_no_connection_desc")),this.updateTokenCollectedLocal(un({},e,{isCollectToken:e!=null&&e.tokenInfo?0:1}))):(a==null?void 0:a.data)===-1?t?F.error({title:S("swaptrade_selecttoken_modal_favorite_limitreached"),duration:.5}):this.setShowCollectOverLimitDialog(!0):(a==null?void 0:a.data)===0?(F.success({title:S("swaptrade_selecttoken_toast_removed_from_favorite"),duration:.5}),this.rootStore.marketInfoStore.setIsCollected(!1)):(a==null?void 0:a.data)===1&&(fn(),F.success({title:S("swaptrade_selecttoken_toast_added_to_favorite"),duration:.5}),this.rootStore.marketInfoStore.setIsCollected(!0))});s(this,"hideCollectCancelConfirm",v.get(Ah));s(this,"showCollectOverLimitDialog",!1);s(this,"setShowCollectOverLimitDialog",e=>{this.showCollectOverLimitDialog=e});s(this,"handleOpenSelectToken",async(e,t)=>{t&&hn({button_name:`select_${e}_${t.currentTarget.getAttribute("data-monitor")}`});let{from:o,to:n}=this.fromToStore,{chainList:i}=this.commonStore;if(this.changeTokenModalVisible(!0),this.changeTokenModalFromState(e),this.initLoading(),this.setSearchValue(""),this.setToSelectedChainId(""),e===_.FROM){let c=$i(this.userChainIdCache,o.chainId,_e.chainId);this.setFromSelectedChainId(c)}else if(e===_.TO){let c=$i(n.chainId,this.userChainIdCache,this.computedCurrentToChainId);this.setToSelectedChainId(c)}let a=this.setCommonlyUsedChain();a=a.map(c=>i.find(p=>p.chainId===c)),this.setTokenPageChainList(a),await this.getTokenListByChainId()});s(this,"setCommonlyUsedChain",e=>{let{from:t,to:o}=this.fromToStore,{chainList:n,currentTab:i}=this.commonStore,a=e&&e.length>0?e:[t.chainId,o.chainId];return wh(a,n,i)});s(this,"tokenPageChainList",[]);s(this,"setTokenPageChainList",e=>{this.tokenPageChainList=e});s(this,"getCurrentToChainInfo",()=>this.computedToChain.find(t=>le(t.chainId)===le(this.toSelectedChainId)));s(this,"changeTokenPageChainList",async e=>{if(this.tokenPageChainList.findIndex(o=>le(o.chainId)===le(e))===-1){let o=this.commonStore.chainList.find(i=>le(i.chainId)===le(e)),n=[...this.tokenPageChainList];n.unshift(o),n.length>4&&n.pop(),this.setTokenPageChainList(n)}this.tokenModalFromState===_.FROM?this.setFromSelectedChainId(e):this.setToSelectedChainId(e),await this.getTokenListByChainId()});s(this,"searchChainKeywords","");s(this,"setSearchChainKeywords",e=>{this.searchChainKeywords=e});s(this,"filterChains",e=>ao(e,t=>{let o=dt(Hi(this.searchChainKeywords));return dt(t.chainName).includes(o)}));s(this,"dialogIndex",Fi.TOKEN_LIST);s(this,"setDialogIndex",e=>{this.dialogIndex=e});s(this,"hideTokenGuide",!!v.get(bh));s(this,"setHideTokenGuide",()=>{this.hideTokenGuide=!0,v.set(bh,"1")});s(this,"importToken",async(e,t)=>{let n=(await this.importUserToken(Array.isArray(e)?e:[e]))[0]||{};t&&t(n),Rn(n)&&await this.fromToStore.getTokenBalanceByAccount(this.tokenModalFromState,n),this.setImportTokenInfo({}),this.setDialogIndex(Fi.TOKEN_LIST)});this.rootStore=e,this.commonStore=e.commonStore,this.swapStore=e.swapStore,this.accountStore=e.accountStore,this.fromToStore=e.fromToStore}setSearchValue(e){this.searchValue=e}get computedIsSearching(){return!!this.searchValue}setSearchTokenList(e){this.searchTokenList=e}setError(e){this.error=e}changeTokenModalFromState(e){this.tokenModalFromState=e}setLoading(e,t,o){this.loading[e][t]=o}initLoading(){this.loading={[_.FROM]:{},[_.TO]:{}}}setToSelectedChainId(e){this.toSelectedChainId=e}setFromSelectedChainId(e){this.fromSelectedChainId=e}get computedTokenList(){return this.tokenModalFromState===_.FROM?this.fromTokenList.get(this.fromSelectedChainId):this.toTokenList.get(this.toSelectedChainId)}get computedSearchTokenList(){var t,o;let e={};return se(this.searchTokenList)||(e={systemList:this.extendTokenList((t=this.searchTokenList)==null?void 0:t.systemList,!1),thirdPartyList:this.extendTokenList((o=this.searchTokenList)==null?void 0:o.thirdPartyList,!1)}),e}changeTokenModalVisible(e){this.tokenModalVisible=e}toLowerCaseContractAddress(e){let t=[];return Array.isArray(e)&&e.forEach(o=>{t.push({...o,tokenContractAddress:this.commonStore.getTokenAddress(o)})}),t}isCancel(e){return kt(e)}get computedFromChain(){let e=qo(),t=ti({},this.commonStore.currentTheme);return[e,t,...U(this.tokenPageChainList)]}get computedToChain(){let e=qo();if($(this.fromToStore.from.chainId)){let t=this.tokenPageChainList.filter(o=>(o==null?void 0:o.chainId)===this.fromToStore.from.chainId);return[e,...t]}return[e]}get computedCurrentToChainId(){return this.toSelectedChainId?this.toSelectedChainId:$(this.fromToStore.to.chainId)?this.calcCurToChainIdIsInSupList(this.fromToStore.to.chainId)?this.fromToStore.to.chainId:this.fromToStore.from.chainId:this.computedToChain.length>1?_e.chainId:no}reassignTokenInfo(e,t,o){if(this.commonStore.equalsToken(e,t)){let n=t==null?void 0:t.isCollectToken;return un({},t,{isCollectToken:n?0:1,collectTime:n?"":Date.now().toString(),isCustomToken:o?1:t==null?void 0:t.isCustomToken})}return e}filterCollectToken(e){let t=!e.isCustomToken||e.balance;return!!(!this.computedIsCollectChain&&t||this.searchValue||e.isCollectToken)}updateTokenCollectedLocal(e){let t=(o=[],n)=>o.map(i=>this.reassignTokenInfo(i,e,n)).filter(i=>this.filterCollectToken(i));if(this.searchValue){let{systemList:o,thirdPartyList:n}=this.searchTokenList;this.setSearchTokenList({systemList:t(o),thirdPartyList:t(n,!0)})}else this.updateTokenList(t)}updateTokenList(e){if(this.tokenModalFromState===_.FROM){let t=e(this.fromTokenList.get(this.fromSelectedChainId));this.fromTokenList.set(this.fromSelectedChainId,t)}else if(this.tokenModalFromState===_.TO){let t=e(this.toTokenList.get(this.toSelectedChainId));this.toTokenList.set(this.toSelectedChainId,t)}}get computedCurrentChainId(){return le(this.tokenModalFromState===_.FROM?this.fromSelectedChainId:this.toSelectedChainId)}get computedIsCollectChain(){return this.computedCurrentChainId===ve.chainId}setShowCollectCancelConfirm(e){v.set(Ah,e),this.hideCollectCancelConfirm=e}get computedIsNotSupportToChain(){let e=this.getCurrentToChainInfo();return this.tokenModalFromState===_.TO&&e&&e.disabled}get computedSelectedChainId(){return this.tokenModalFromState===_.FROM?this.fromSelectedChainId||this.fromToStore.from.chainId:this.tokenModalFromState===_.TO?this.toSelectedChainId||this.fromToStore.to.chainId:""}get computedAllChainList(){let e=this.commonStore.chainList;return this.tokenModalFromState===_.FROM?{supported:e,unsupported:[]}:this.tokenModalFromState===_.TO?this.computedToChainList:{supported:[],unsupported:[]}}get computedToChainList(){let e=this.commonStore.chainList,t=pn(U(e),{chainId:Number(this.fromToStore.to.chainId)});return{supported:t?[t]:[],unsupported:[]}}get computedIsSearchChainStatus(){return!!this.searchChainKeywords}get computedSearchedChainList(){if(!this.computedIsSearchChainStatus)return{supported:[],unsupported:[]};let{supported:e,unsupported:t}=this.computedAllChainList;return{supported:this.filterChains(e),unsupported:this.filterChains(t)}}get computedTokenGuideVisible(){return!1}};var Vo=class extends hr{constructor(e){super(e),this.removeToken().catch(()=>{})}async removeTokenByChainId(e){let t={},o=v.get(e)||[];return o.length>0&&(t=await this.importUserToken(o),v.set(e,[])),t.data||[]}removeToken(){let e=[];return Object.values(W).forEach(t=>{e.push(this.removeTokenByChainId(t))}),Promise.all(e)}};var ri=class extends Vo{constructor(t){super(t);s(this,"showChainTab",!0);s(this,"generateToChainMap",()=>{let t=this.commonStore.chainList,o=pn(U(t),{chainId:Number(this.fromToStore.from.chainId)}),n=(o==null?void 0:o.bridgeSupportChainInfoList)||[];return Su((o==null?void 0:o.supportSwapType)===Ec.CROSS_CHAIN?[...n]:[o,...n],"chainId")});Ft(this)}get computedTokenGuideVisible(){let{tokenModalFromState:t,hideTokenGuide:o}=this;return t===_.TO&&!o}get computedToChainList(){let t=this.commonStore.chainList,o=[],n=[],i=this.generateToChainMap();return t.forEach(a=>{let c={...a};c.disabled=!i[a.chainId],c.disabled?n.push(c):o.push(c)}),{supported:o,unsupported:n}}get computedToChain(){let t=qo(),o=ti({},this.commonStore.currentTheme);if($(this.fromToStore.from.chainId)){let n=this.generateToChainMap(),i=[];return U(this.tokenPageChainList).forEach(a=>{i.push({...a,disabled:!n[a.chainId]})}),[t,o,...i]}return[t]}};u();l();var Ks=class{constructor(e){s(this,"sendTransactionParams",{});s(this,"waitingHandleOrderList",[]);s(this,"needIntercept",!1);s(this,"updateHistoryOrderList",e=>{var a,c;let t=me(),o=[],n=[],i=this.rootStore.recentTransactionStore;i.pendingOrders.forEach(p=>{let d=p;p.orderId===e&&(d={...p,status:_n.PendingRedeeming}),o.push(d)}),!t&&((c=(a=i.history)==null?void 0:a.list)==null||c.forEach(p=>{let d=p;p.orderId===e&&(d={...p,status:_n.PendingRedeeming}),n.push(d)})),i.setPendingOrders(o),!t&&i.setHistory({...i.history,list:n})});s(this,"sendTransactionEnhance",async({callData:e,chainId:t,redeemOrderIdPre:o,redeemOrderId:n,bizType:i},a)=>{var h,m;let c=me(),p=`${o}:${n}`;if(!c&&this.setWaitingHandleList(p),this.needIntercept)return;let d;if(me()){let g=this.rootStore.swapStore.extendsGas(e);d=this.sendTransactionStore.sendTransactionEnhance(t,g,(m=(h=this.rootStore)==null?void 0:h.walletContractStore)==null?void 0:m.walletSendParams)}else{if(!await this.rootStore.commonStore.connectAndSwitchNetwork(t))return;d=this.sendTransactionStore.sendTransactionEnhance(e)}d.then(({result:g,hash:T,nonce:y})=>{!c&&this.setWaitingHandleList(p,!0),this.sendTransactionStore.updateTxHash({orderId:n,transactionHash:c?T:g,bizType:i,nonce:y}),wu(a),this.updateHistoryOrderList(o),c||this.sendTransactionStore.getTransaction(g,t).then(C=>{k.info(M.UPDATE_NONCE,{nonce:C.nonce,tags:{orderId:n}}),this.sendTransactionStore.updateTxHash({orderId:n,transactionHash:g,nonce:C.nonce,bizType:i})}).catch(C=>{k.error(M.UPDATE_NONCE_FAIL,{error:C,transactionHash:g,tags:{orderId:n}})})}).catch(g=>{!c&&this.setWaitingHandleList(p,!0),k.error(M.REDEEM_ORDER_ERROR,{error:g,tags:{orderId:n}})})});s(this,"walletSendRedeem",()=>{this.sendTransactionEnhance(this.sendTransactionParams,()=>{var e;(e=R.history)==null||e.goBack()})});s(this,"facetOrderDetail",{});this.rootStore=e,this.sendTransactionStore=e.sendTransactionStore,H(this,{},{autoBind:!0})}setSendTransactionParams(e){this.sendTransactionParams=e}async launchFacetSwap(e){var ge,ce;let t=me(),{data:o}=this.rootStore.recentTransactionStore.detail,n=e?e.orderId:o==null?void 0:o.orderId,i=e?e.chainId:o==null?void 0:o.fromChainId,a=e?e.toTokenAddress:o==null?void 0:o.toTokenAddress,c=e?e.fromTokenAddress:o==null?void 0:o.fromTokenAddress,p={orderId:n,chainId:i,userWalletAddress:this.rootStore.accountStore.getAddressByChainId(i)};if(t&&(e==null?void 0:e.goOrderDetail)){(ge=R.history)==null||ge.push(`${lt}/${n}`);return}let[d,h]=await N(P.post(ru,p));if(d){k.error(M.REDEEM_ORDER_CALL_DATA_ERROR,{error:d,tags:{orderId:n}}),Number(d==null?void 0:d.code)===100002&&this.rootStore.recentTransactionStore.removePendingOrder(n),F.error({title:(d==null?void 0:d.msg)||S("swaptrade_top_notif_data_failed")});return}let{redeemSignatureVo:m,redeemDetailInfo:g,redeemOrderId:T,bizType:y}=(h==null?void 0:h.data)||{},{unsignedTx:C,...b}=m||{},L={...b,extParams:{toTokenAddress:a,crossChain:0,tokenAddress:c,amount:g.fromTokenAmount,toChainId:i,...p}},G={callData:L,chainId:i,redeemOrderIdPre:n,redeemOrderId:T,bizType:y};if(this.setSendTransactionParams(G),k.info(M.REDEEM_ORDER,{callData:L,tags:{orderId:T}}),t){this.setFacetOrderDetail({...g}),this.rootStore.walletContractStore.setTransactionPayload(L),(ce=R.history)==null||ce.push({pathname:Ne,search:`needUpdate=${tn.off}&type=${fe.REDEEM}`});return}await this.sendTransactionEnhance(G)}setWaitingHandleList(e,t){this.waitingHandleOrderList.find(n=>n===e)?t?(this.waitingHandleOrderList=this.waitingHandleOrderList.filter(n=>n!==e),this.needIntercept=!1):(F.warn({title:S("swaptrade_history_notification_desc_wallet_confirm")}),this.needIntercept=!0):(this.waitingHandleOrderList=[...this.waitingHandleOrderList,e],this.needIntercept=!1)}getFacetExploreUrl(e){var i,a;let{data:t}=this.rootStore.recentTransactionStore.detail,o=[(i=t==null?void 0:t.fromChildOrderDetailVo)==null?void 0:i.exploreUrl,(a=t==null?void 0:t.relativeTransaction)==null?void 0:a.exploreUrl];return this.computedIsFacetTradeType&&(o==null?void 0:o[e])||""}get computedIsFacetTradeType(){let{data:{specialOrderType:e}}=this.rootStore.recentTransactionStore.detail;return e===Ju.FromIsEthChainFacetCoin}get computedShowFacetTip(){return this.rootStore.recentTransactionStore.detail.data.status===_n.PendingCanRedeem}setFacetOrderDetail(e){this.facetOrderDetail=e}get computedFacetOrderToFromRate(){let{price:e}=this.facetOrderDetail;return e&&!We(e)&&e!=="-1"?ee(e):""}get computedFacetOrderFromToRate(){let{price:e}=this.facetOrderDetail;return e&&!We(e)&&e!=="-1"?ee(I.BigNumber("1").div(e).toString(10)):""}get computedFacetOrderTokens(){let{fromToken:e,toToken:t,fromTokenAmount:o,toTokenAmount:n}=this.facetOrderDetail;return{fromToken:{...e,amount:o},toToken:{...t,amount:n}}}get computedFacetOrderMinimumReceived(){return this.facetOrderDetail.minimumReceived}get computedFacetTipParams(){var t,o,n;let e=(t=this.rootStore.recentTransactionStore.detail)==null?void 0:t.data;return{amount:ee((o=e==null?void 0:e.fromChildOrderDetailVo)==null?void 0:o.toAmountOut,{needBillionMillionUnit:!1}),token:(n=e==null?void 0:e.fromChildOrderDetailVo)==null?void 0:n.toTokenSymbol}}},oi=Ks;u();l();var fr=class{constructor(e){s(this,"liquidityModelVisible",!1);s(this,"dataStatus",ue.DEFAULT);s(this,"setDataStatus",e=>{this.dataStatus=e});s(this,"rawData",[]);s(this,"LiquidityCancelRef",null);s(this,"fetchLiquidityData",async()=>{var n;this.resetAllLiquidityData(),this.setDataStatus(ue.LOADING);let{from:e}=this.fromToStore;this.LiquidityCancelRef&&this.LiquidityCancelRef.abort(),this.LiquidityCancelRef=Ge();let[t,o]=await N(P.get(nu,{params:{chainId:e.chainId},signal:(n=this.LiquidityCancelRef)==null?void 0:n.signal,isolate:!0}));if(t)this.setDataStatus(ue.ERROR);else{let i=A(o,"data");se(i)?this.setDataStatus(ue.NULL):(this.initAllLiquidityData(i),this.setDataStatus(ue.READY))}});s(this,"selectedListIds",[]);s(this,"setSelectedListIds",e=>{this.selectedListIds=e});s(this,"confirmIds",null);s(this,"setConfirmIds",e=>{this.confirmIds=e});s(this,"filterSelectedListIds",(e,t)=>{let o;t?o=Qi(this.selectedListIds,e):o=pu(this.selectedListIds,e),this.setSelectedListIds(vr(o))});s(this,"searchLiquidityValue","");s(this,"setLiquiditySearchValue",e=>{this.searchLiquidityValue=e});this.rootStore=e,this.fromToStore=this.rootStore.fromToStore,H(this,{},{autoBind:!0})}setLiquidityModelVisible(e){this.liquidityModelVisible=e}setData(e){this.rawData=e}resetAllLiquidityData(){this.setData([]),this.setSelectedListIds([]),this.setConfirmIds(null)}initAllLiquidityData(e){this.setData(e);let t=dn(e,"id");this.setSelectedListIds(t);let o=this.fromToStore.from.chainId;$(o)&&this.setConfirmIds(_u({},o,t))}get computedListCheckedAll(){return this.computedSearchStatus?this.computedSearchIfAllChecked:this.selectedListIds.length===this.rawData.length}get computedCheckedAllDisabled(){return this.computedSearchStatus&&se(this.computedSearchData)}get computedLiquidityNum(){let{from:e}=this.rootStore.fromToStore,t="--",{dataStatus:o,rawData:n,confirmIds:i}=this;if(o===ue.NULL)t="0 / 0";else if(o===ue.READY){let a=A(i,e.chainId);t=`${!a||a&&a.length===0?n.length:a.length} / ${n.length}`}return t}get computedClearAll(){return se(this.selectedListIds)}checkAllBtn(){let e="",t=this.computedSearchStatus?this.computedSearchData:this.rawData,o=dn(t,"id");this.computedListCheckedAll?e=Qi(this.selectedListIds,...o):e=Iu(this.selectedListIds,o),this.setSelectedListIds(vr(e))}get computedCheckedData(){return dn(this.rawData,t=>({...t,isChecked:!!mu(this.selectedListIds,t.id)}))}get computedSortListData(){return Fu(this.computedCheckedData)}get computedSearchStatus(){return!!this.searchLiquidityValue}get computedSearchDataIsNull(){return this.computedSearchStatus&&se(this.computedSearchData)}get computedSearchData(){return xu(this.computedCheckedData,this.searchLiquidityValue)}get computedSearchIfAllChecked(){let e=du(this.computedSearchData,t=>t==null?void 0:t.isChecked);return!se(this.computedSearchData)&&e}get computedShowData(){return this.searchLiquidityValue?this.computedSearchData:this.computedSortListData}get computedIds(){var t,o;return A((t=this.rootStore.liquidityChooseStore)==null?void 0:t.confirmIds,(o=this.rootStore.fromToStore)==null?void 0:o.from.chainId)}get computedIsCustomLiquidity(){return(this.computedIds||[]).length<this.rawData.length}get computedMonitorLiquidSelectType(){let{computedIds:e=[],rawData:t}=this;return!e.length||e.length===(t==null?void 0:t.length)?"all":e.length>1?"custom_>1":e.length===1?"custom_=1":""}};u();l();var $s=class{constructor(e){s(this,"orderCheckContinue",async e=>{let[t,o]=await N(P.get(iu,{params:e}));if(t)return F.error({title:S("swaptrade_history_toast_setup_error"),duration:qe}),!1;let n=A(o,"data"),i=String(n==null?void 0:n.checkCode);return i===Or.SUCCESS?!0:(i===Or.SINGLE_ERROR||i===Or.LIMIT_SINGLE_ERROR?F.error({title:S("swaptrade_history_toast_chain_unsupported",{chain:n==null?void 0:n.fromChainName}),duration:qe}):i===Or.CROSS_ERRORL||i===Or.LIMIT_CROSS_ERRORL?F.error({title:S("swaptrade_history_toast_both_unsupported",{fromChain:n==null?void 0:n.fromChainName,toChain:n==null?void 0:n.toChainName}),duration:qe}):F.error({title:S("swaptrade_history_toast_setup_error"),duration:qe}),!1)});this.rootStore=e,H(this,{},{autoBind:!0})}},ni=$s;u();l();var{BigNumber:Oh}=I,Ys="safemoon_slippage",Xs="safemoon_is_changed",vh=50,zs={NeedIncreaseSlip:0,AdviseGivenSlip:1,NotAvailableGivenSlip:2,AdviseSlip:3},mr=class{constructor(e){s(this,"isChanged",!1);s(this,"getSafemoonIsChangedLocal",()=>!!v.get(`${Xs}_${this.computedSlippageTokenPair}`));s(this,"cacheSlippage",0);H(this),this.rootStore=e,this.commonStore=e.commonStore,this.fromToStore=e.fromToStore,Le(()=>this.computedSlippageTokenPair,()=>{this.setSafeMoonIsChanged(v.get(`${Xs}_${this.computedSlippageTokenPair}`)),this.setCacheSlippage(v.get(`${Ys}_${this.computedSlippageTokenPair}`))}),Le(()=>({slippage:this.computedPairSlippage}),()=>{this.cacheSlippage>0&&this.computedPairSlippage>this.cacheSlippage&&this.setSafeMoonIsChanged(!1),this.setCacheSlippage(v.get(`${Ys}_${this.computedSlippageTokenPair}`))}),Le(()=>this.computedSlippage,t=>{this.commonStore.safemoonSlippage=t})}setSafeMoonIsChanged(e){this.isChanged=e,v.set(`${Xs}_${this.computedSlippageTokenPair}`,e)}checkIsChanged(e){let t=new Oh(e),o=t.gte(this.computedPairSlippage)&&t.lte(50);o&&this.setSafeMoonIsChanged(o)}setSafeMoonPairSlippage(e){!this.isAccessSlippage(e)||(this.setCacheSlippage(e),v.set(`${Ys}_${this.computedSlippageTokenPair}`,e))}isAccessSlippage(e){let t=new Oh(e);return this.computedPairSlippage>0&&t.gte(this.computedPairSlippage)&&t.lte(50)}get computedAutoSlippage(){return Jn(this.rootStore)}get computedSafeMoonToken(){let{from:e,to:t}=this.fromToStore;return this.checkIsSafeMoon(e)?e:this.checkIsSafeMoon(t)?t:null}get computedHoneypot(){let{from:e,to:t}=this.fromToStore;return this.checkIsHoneypot(e)?e:this.checkIsHoneypot(t)?t:null}setCacheSlippage(e){this.cacheSlippage=e}get computedPairSlippage(){return this.computedSafeMoonToken?1.1:0}get computedSlippage(){return this.cacheSlippage>this.computedPairSlippage?this.cacheSlippage:this.computedPairSlippage}get computedOverLimit(){return this.computedSlippage>50}get computedSlippageTokenPair(){let{from:e,to:t}=this.fromToStore;return`${this.checkIsSafeMoon(e)?e.tokenContractAddress:""}_${this.checkIsSafeMoon(t)?t.tokenContractAddress:""}`}get computedSlippageTips(){let e=A(this,"rootStore.quoteStore.quote.bestRoute"),t=Number(this.computedAutoSlippage),{tokenSymbol:o}=this.computedSafeMoonToken||{};return(e==null?void 0:e.isSafeMoonToken)!=="1"||(e==null?void 0:e.isHoneypot)==="1"?null:t===vh?{type:zs.AdviseGivenSlip,safeMoonSlippage:t,equalLimit:!0,tip:S("swaptrade_card_errortip_autoadjust_to_50",{tokenSymbol:o,slippageTolerance:t}),tipEquation:S("swaptrade_card_errortip_autoadjust_to_50",{tokenSymbol:q(o),slippageTolerance:t}),inputWarning:S("swaptrade_adjustslip_modal_advise_givenslip")}:t>vh?{type:zs.NotAvailableGivenSlip,overLimit:!0,safeMoonSlippage:t,tip:S("wallet_swap_adjustslip_modal_slip_notsupported",{tokenSymbol:o}),tipEquation:S("wallet_swap_adjustslip_modal_slip_notsupported",{tokenSymbol:q(o)})}:{type:zs.AdviseSlip,safeMoonSlippage:t,tip:S("swaptrade_card_errortip_autoadjust_to_less50",{slippageTolerance:t,tokenSymbol:o}),tipEquation:S("swaptrade_card_errortip_autoadjust_to_less50",{slippageTolerance:t,tokenSymbol:q(o)}),inputWarning:S("swaptrade_modal_errortip_adjust_to_suggested_range",{slippageTolerance:t})}}checkIsSafeMoon(e){return A(e,"isSafeMoonToken")===1}checkIsHoneypot(e){return A(e,"isHoneypot")===1}get computedInputVal(){let{computedIsExactIn:e,computedSwapAmount:t}=this.fromToStore;return!e&&this.computedHoneypot?"":t[_.FROM]}get computedInputFiatVal(){let{computedIsExactIn:e,computedFromLocalCostByUsd:t}=this.fromToStore;return!e&&this.computedHoneypot?"":t}get computedOutputVal(){let{computedIsExactIn:e,computedSwapAmount:t}=this.fromToStore;return e&&this.computedHoneypot?"":t[_.TO]}get computedOutputFiatVal(){let{computedIsExactIn:e,computedToLocalCostByUsd:t}=this.fromToStore;return e&&this.computedHoneypot?"":t}get computedOutputPopVal(){let{computedSwapAmount:e}=this.fromToStore;return this.computedHoneypot?"":e[_.TO]}};u();l();var ii=class{constructor(){s(this,"gasDropConfig",{gasDropShow:!1,gasDropSwitch:v.get(Li)===Sc.OPEN,chainName:"",chainId:"",deduction:"",gasDrop:"",tokenLogoUrl:"",tokenSymbol:""});s(this,"setGasDropInfo",e=>{this.gasDropConfig={...this.gasDropConfig,...e}});s(this,"setGasDropSwitch",e=>{this.setGasDropInfo({gasDropSwitch:e}),v.set(Li,`${Number(e)}`)});s(this,"resetGasDrop",()=>{this.setGasDropInfo({gasDropShow:!1})});H(this)}get computedGasDropSelected(){let{gasDropShow:e,gasDropSwitch:t}=this.gasDropConfig;return e&&t}};u();l();var Zs=class{constructor(e){s(this,"isShowMev",!1);s(this,"setShowMev",e=>{this.isShowMev=e});s(this,"isMevUserSwitchOpen",rr.DEFAULT);s(this,"setMevUserSwitchOpen",e=>{this.isMevUserSwitchOpen=e});s(this,"mevInfo",{});s(this,"setMevInfo",e=>{this.mevInfo=e});this.rootStore=e,this.quoteStore=this.rootStore.quoteStore,this.fromToStore=this.rootStore.fromToStore,H(this,{},{autoBind:!0})}get computedIsMevOpen(){var o;let e=(o=this.quoteStore.quote)==null?void 0:o.bestRoute,t=Number(e==null?void 0:e.isEnableMev)===Ar.ON;return!this.isShowMev&&this.isMevUserSwitchOpen!==rr.ON?!1:!!(this.isMevUserSwitchOpen===rr.ON||this.isMevUserSwitchOpen===rr.DEFAULT&&t)}},si=Zs;u();l();var{BigNumber:Js}=I,ea=class{constructor(e){s(this,"feeConfig",{});s(this,"setFeeConfig",e=>{if(!this.isIframe)return;if(!se(e)){this.feeConfig=e,v.session.set("feeConfig",e);return}let t=v.session.get("feeConfig"),o=uo(t,["referrerAddress","feePercent"]);se(o)?(this.feeConfig={},v.session.remove("feeConfig")):this.feeConfig=o});s(this,"receiveQuoteUrl",()=>this.isIframe?Fc:Bc);s(this,"saveOrderUrl",()=>this.isIframe?Uc:sn);s(this,"extendFeeConfig",e=>{if(!this.computedHasFeeConfig)return e;let t=se(this.feeConfig)?v.session.get("feeConfig"):this.feeConfig;return{...e,...t}});H(this),this.rootStore=e,this.isIframe=!me()&&bu()&&!Lr}get computedHasFeeConfig(){var e,t;return!!((e=this.feeConfig)!=null&&e.referrerAddress)&&!!((t=this.feeConfig)!=null&&t.feePercent)&&this.isIframe}get computedFeeConfigErrorTips(){var e,t,o;return this.computedHasFeeConfig?!!(Js((e=this.feeConfig)==null?void 0:e.feePercent).isNaN()||Js((t=this.feeConfig)==null?void 0:t.feePercent).gt(bc)||Js((o=this.feeConfig)==null?void 0:o.feePercent).lt(0)):!1}},ai=ea;u();l();u();l();var Ph=()=>{let{swapStore:r,intentSwapStore:e,tradeModeStore:t}=wt();return!(r.isConfirmLoading||e.isConfirmLoading||!t.tradingModeType)};u();l();u();l();var kh=r=>{let{fromToStore:e,quoteStore:t}=wt(),{commonDexInfo:o,pathSelectionRouterList:n,singleChainSwapInfo:i}=r,{computedIsSingleChain:a}=e,c=Number(o==null?void 0:o.code)===At.CROSS_CHAIN_INTERVAL,p=c?{crossMaxAmount:o==null?void 0:o.crossMaxAmount,crossMiniAmount:o==null?void 0:o.crossMiniAmount}:null;return t.setQuoteScope(p),{isAutoError:c||(a?!i:!(n!=null&&n.length))}};var pg=({quoteStore:r,fromToStore:e})=>{r.setQuoteNumber(r.quoteNumber+1),r.quoteNumber===1&&r.checkQuoteScopeLtMin(r.quoteScope,e.from.amount)&&e.advanceSetTypedValue("")},dg=(r,{fromToStore:e,quoteStore:t})=>{let{commonDexInfo:o,pathSelectionRouterList:n,singleChainSwapInfo:i,swapType:a,intentCode:c,tradingModeType:p,supportSnapMode:d}=r,h={intentCode:c,tradingModeType:p,supportSnapMode:d,swapType:a},m=n==null?void 0:n.map(T=>({...o,...T,...h}));return{bestRoute:e.computedIsSingleChain?{...o,...i,...h,intentInfo:(r==null?void 0:r.intentInfo)||{}}:t.pickBestRouterAccordingBridgeId(m)||{...o,...h},combineSelectionRouterList:m}},hg=({bestRoute:r,combineSelectionRouterList:e,isAutoError:t},{fromToStore:o,quoteStore:n})=>{n.updateSlippageInfoFetched(r),n.setQuote({...n.quote,bestRoute:r,quoteNull:t,quoteError:null,isFetchQuoting:!1}),o.quoteUpdateFromTo(r),o.computedIsSingleChain||n.setPathSelectionRouterList(e||[])},fg=({isAutoError:r},{approveStore:e})=>{if(!r){e.isPendingNotCheck().catch(()=>{})}},mg=({isAutoError:r},{quoteStore:e})=>{r&&(e.handleReverseQuoteErrorAndNull(),Ae(()=>{e.updateQuoteStatus(e.quoteScope?2:3)}))},Sg=({snapModeQuote:r,tradingModeType:e,supportSnapMode:t},{intentSwapStore:o,tradeModeStore:n})=>{o.setCallDataInfo(r?{quote:r.quote,tradingModeType:e,unsignedTx:r.unsignedTx}:{}),n.tradingModeType===Ot.COMPARE_MODE&&t===rn.SUPPORT&&n.setBestPriceTag(e),n.tradingModeType===Ot.SNAP_MODE&&e===Ot.AUTO&&el({title:S("swaptrade_trading_mode_toast_snap_quote_switch")}),n.setTradingModeType(e),n.setIsMetSnap(t)},Rh=r=>{let{fromToStore:e,quoteStore:t,approveStore:o,intentSwapStore:n,tradeModeStore:i}=wt(),{isAutoError:a}=kh(r);pg({quoteStore:t,fromToStore:e});let{bestRoute:c,combineSelectionRouterList:p}=dg(r,{fromToStore:e,quoteStore:t});hg({bestRoute:c,combineSelectionRouterList:p,isAutoError:a},{fromToStore:e,quoteStore:t,approveStore:o}),Sg(r,{intentSwapStore:n,tradeModeStore:i}),fg({isAutoError:a},{approveStore:o}),mg({isAutoError:a},{quoteStore:t})};u();l();var{BigNumber:Lh}=I,Wo=class{constructor(e){s(this,"allTimerAndQuoteState",{[de.DEFAULT]:{isShowLoadingCpt:!1,quoteText:()=>""},[de.QUOTING]:{isShowLoadingCpt:!0,quoteText:()=>S(Xo)},[de.TIMER]:{isShowLoadingCpt:!0,quoteText:()=>S(Xo)},[de.QUOTE_IS_HONEYPOT]:{isShowLoadingCpt:!1,quoteText:()=>S(zo)},[de.QUOTE_NULL]:{isShowLoadingCpt:!0,quoteText:()=>S(zo)},[de.QUOTE_NULL_AND_SECTION]:{isShowLoadingCpt:!0,quoteText:()=>S(Xo)},[de.QUOTE_ERROR]:{isShowLoadingCpt:!1,quoteText:()=>S(zo)}});Object.assign(this,e)}isValidRange(e){if(typeof e!="string")return!1;let{from:t}=this.fromToStore,o=e.split("-");return o.length!==2?!1:Lh(t.amount).lt(o[0])||Lh(t.amount).gt(o[1])}getCurrentTimerQuoteState(){var c;let{quoteNull:e,isFetchQuoting:t,quoteError:o,bestRoute:n}=this.quote,i=(c=this.fromToStore)==null?void 0:c.computedIfQuote,a=o!==null;return i?a?this.allTimerAndQuoteState[de.QUOTE_ERROR]:this.rootStore.safeMoonStore.computedHoneypot?this.allTimerAndQuoteState[de.QUOTE_IS_HONEYPOT]:e?(n==null?void 0:n.msg)&&(t||this.isValidRange(n.msg))?this.allTimerAndQuoteState[de.QUOTE_NULL_AND_SECTION]:this.allTimerAndQuoteState[de.QUOTE_NULL]:t?t?this.allTimerAndQuoteState[de.QUOTING]:this.allTimerAndQuoteState[de.DEFAULT]:this.allTimerAndQuoteState[de.TIMER]:this.allTimerAndQuoteState[de.DEFAULT]}};var{BigNumber:yt}=I,{FACET_TOKEN_ERROR_ONE:gg,FACET_TOKEN_ERROR_TWO:Tg,FACET_TOKEN_ERROR_THREE:yg}=At,Sr=class{constructor(e){s(this,"dialogCloseFlag",!1);s(this,"slippageInfoFetched",!1);s(this,"setDialogCloseFlag",e=>{this.dialogCloseFlag=e});s(this,"dialogShowQuotationComparison",!1);s(this,"setDialogShowQuotationComparison",e=>{this.dialogShowQuotationComparison=e});s(this,"quoteNumber",0);s(this,"setQuoteNumber",e=>{this.quoteNumber=e});s(this,"isDialog",!1);s(this,"setIsDialog",e=>{this.isDialog=e});s(this,"initQuote",{bestRoute:null,quoteError:null,quoteNull:!1,isFetchQuoting:!1});s(this,"isFirstQuote",!0);s(this,"setIsFirstQuote",e=>{this.isFirstQuote=e});s(this,"isPickRouterFromWallet",!1);s(this,"setIsPickRouterFromWallet",e=>{this.isPickRouterFromWallet=e});s(this,"quoteScope",null);s(this,"setQuoteScope",e=>{this.quoteScope=e});s(this,"fetchQuoteStatus",0);s(this,"quote",{...this.initQuote});s(this,"setQuote",e=>{this.quote=e});s(this,"pathSelectionRouterList",[]);s(this,"setPathSelectionRouterList",e=>{this.pathSelectionRouterList=e});s(this,"pickRouter",{});s(this,"setPickRouter",(e,t)=>{var o;this.pickRouter=e,t&&(this.setNoCurrentPathTipInfo({bridgeName:(o=e==null?void 0:e.bridge)==null?void 0:o.bridgeName}),this.updateBestRoute(e))});s(this,"showChainListModel",!1);s(this,"setShowChainListModel",e=>{this.showChainListModel=e});s(this,"noCurrentPathTipInfo",{visible:!1,bridgeName:""});s(this,"setNoCurrentPathTipInfo",e=>{this.noCurrentPathTipInfo={...this.noCurrentPathTipInfo,...e}});s(this,"currentBridgeId","");s(this,"setCurrentBridgeId",e=>{this.currentBridgeId=e});s(this,"updateBestRoute",e=>{var t;this.setQuote({...this.quote,bestRoute:e}),this.rootStore.mevStore.setMevUserSwitchOpen(rr.DEFAULT),(t=this.rootStore.fromToStore)==null||t.quoteUpdateFromTo(e)});s(this,"pickBestRouterAccordingBridgeId",e=>{let{smartRouterStore:{showXRouteModal:t}}=this.rootStore;if(!e||e.length===0)return null;let o=e.find(n=>{var i;return((i=n==null?void 0:n.bridge)==null?void 0:i.bridgeId)===this.currentBridgeId});return this.currentBridgeId&&!o&&(this.setCurrentBridgeId(""),!this.showChainListModel&&t!==Lc.ROUTER_SELECT&&this.setNoCurrentPathTipInfo({visible:!0})),o||(e==null?void 0:e[0])});s(this,"quoteTimer",null);s(this,"clearQuote",()=>{var e;this.cleanQuoteTimer(),this.setQuote(this.initQuote),this.setIsFirstQuote(!0),(e=this.rootStore.fromToStore)==null||e.quoteUpdateFromTo(null),this.quotePending=!1});s(this,"cancelRef",null);s(this,"cleanQuoteTimer",()=>{clearTimeout(this.quoteTimer),this.quoteTimer=null,this.cancelRef&&this.cancelRef.abort()});s(this,"isClearQuote",()=>{let{currentTab:e}=this.commonStore,{computedTypedValue:t,from:o,to:n,computedIsSingleChain:i,computedIsExactIn:a}=this.fromToStore;return e===O.LIMIT_ORDER||!$e(t)||!(n!=null&&n.tokenContractAddress)||!(o!=null&&o.tokenContractAddress)||!a&&!i});s(this,"getQuoteData",e=>{let t=cr();return N(sp(()=>P.get(this.outerStore.receiveQuoteUrl(),{params:t,signal:e}),ki.NUM,ki.TIMER))});s(this,"handleUpdateQuote",e=>{if(e){let{data:t}=e;Rh(t)}});s(this,"fetchQuote",async()=>{if(!Ph())return this.quoteTimer=setTimeout(()=>{this.fetchQuote().catch(()=>{})},Mi),Promise.resolve(!1);if(this.isClearQuote())return this.quoteScope=null,this.clearQuote(),Promise.resolve(!1);if(this.cleanQuoteTimer(),this.rootStore.outerStore.computedFeeConfigErrorTips)return this.handleQuoteError(),Promise.resolve(!1);this.setQuote({...this.quote,isFetchQuoting:!0}),this.cancelRef=Ge();let[e,t]=await this.getQuoteData(this.cancelRef.signal);return this.quotePending=!1,!kt(e)&&e&&this.handleQuoteError(e),this.handleUpdateQuote(t),this.setIsPickRouterFromWallet(!1),this.commonStore.setResetFromToByTabChange(!1),this.setIsFirstQuote(!1),!kt(e)&&!this.dialogCloseFlag&&Ae(()=>{this.quoteTimer=setTimeout(()=>{this.fetchQuote().catch(()=>{})},Mi)}),Promise.resolve(!0)});s(this,"quotePending",!1);s(this,"debounceQuote",ln(this.fetchQuote,Ac));s(this,"fetchQuoteDebounce",async()=>{let{computedIsCrossChain:e,computedIfQuote:t}=this.fromToStore;this.quotePending=!0,t&&e?await this.debounceQuote():t&&!e?this.debounceQuote():this.clearQuote()});s(this,"handleQuoteError",e=>{this.setQuote({...this.initQuote,quoteError:e}),this.handleReverseQuoteErrorAndNull()});s(this,"getGasTokenFeeLoading",!1);s(this,"getGasTokenFeeCancelRef",null);s(this,"cancelGasTokenGeeRequest",()=>{this.getGasTokenFeeCancelRef&&(this.getGasTokenFeeCancelRef.abort(),this.getGasTokenFeeCancelRef=null)});s(this,"cacheNativeGasFee","");s(this,"setCacheNativeGasFee",e=>{this.cacheNativeGasFee=e});s(this,"fetchGasTokenFee",async()=>{var m;let{from:e}=this.rootStore.fromToStore,{computedReserveGas:t}=this.rootStore.commonStore,{decimals:o,balance:n}=e||{},i=gu(cr(),["dexIds"]);this.getGasTokenFeeCancelRef=Ge();let a=(m=this.rootStore.fromToStore)!=null&&m.computedIsExactIn?Dc:xc;this.getGasTokenFeeLoading=!0;let c=this.getGasTokenFeeCancelRef.signal,p=t,[d,h]=await N(P.get(a,{params:{...i,amount:Eu(n,o)},signal:c}));if(this.getGasTokenFeeLoading=!1,!kt(d)&&d)return-1;if(!d){let{data:g}=h||{},{commonDexInfo:T}=g||{};Number(T==null?void 0:T.code)===0&&(T==null?void 0:T.estimateReserveGasTokenFee)!==""&&(p=T.estimateReserveGasTokenFee)}return this.setCacheNativeGasFee(p),p});s(this,"transactionDetailExpanded",!1);s(this,"setTransactionDetailExpanded",e=>{this.transactionDetailExpanded=e});H(this,{},{autoBind:!0}),Object.assign(this,e),this.rootStore=e}initQuoteStatus(){this.fetchQuoteStatus=0}updateQuoteStatus(e){this.fetchQuoteStatus=e}get computedIsIntentType(){return this.rootStore.tradeModeStore.computedIsSnapType}get computedSlippage(){let{computedIsSingleChain:e,computedDefaultAutoSlippageInfo:t}=this.fromToStore,o=this.rootStore.slippageStore,n=xo({isSingleChain:e,autoSlippageInfo:t}),i=$t.AUTO;return o&&(n=o.computedRealSlippageValue,i=o.getSlippageType()),!this.slippageInfoFetched&&i===$t.AUTO&&(i=$t.DEFAULT),{slippage:n,slippageType:i}}handleReverseQuoteErrorAndNull(){let{updateFromAmount:e,computedIsExactIn:t,updateTo:o}=this.fromToStore;t?o({amount:""}):e({amount:""})}getQuoteError(e){let{commonDexInfo:t,pathSelectionRouterList:o,singleChainSwapInfo:n}=e,{computedIsSingleChain:i}=this.fromToStore,a=Number(t==null?void 0:t.code)===At.CROSS_CHAIN_INTERVAL,c=a?{crossMaxAmount:t==null?void 0:t.crossMaxAmount,crossMiniAmount:t==null?void 0:t.crossMiniAmount}:null;return this.setQuoteScope(c),{isAutoError:a||(i?!n:!(o!=null&&o.length))}}updateSlippageInfoFetched(e){let{autoSlippage:t,autoTotalSlippage:o}=(e==null?void 0:e.autoSlippageInfo)||{};(t||o)&&(this.slippageInfoFetched=!0)}checkQuoteScopeLtMin(e,t){if(!e||!t)return!1;let{crossMiniAmount:o}=this.quoteScope||{};return!!yt(t).lt(yt(o))}get computedCurrentTimerQuoteState(){return new Wo(this).getCurrentTimerQuoteState()}get computedRouterForSmartRouterStore(){var e,t;return this.computedMediaForChangeSmartRouterData&&!((e=this.fromToStore)!=null&&e.computedIsSingleChain)?this.pickRouter:(t=this.quote)==null?void 0:t.bestRoute}get computedMediaForChangeSmartRouterData(){var t;return((t=la())==null?void 0:t.media)==="sm"||this.isDialog}get computedQuoteAmount(){var t,o,n,i;let{computedIsExactIn:e}=this.fromToStore;return e?(o=(t=this.quote)==null?void 0:t.bestRoute)==null?void 0:o.fromTokenAmount:(i=(n=this.quote)==null?void 0:n.bestRoute)==null?void 0:i.payAmount}get computedQuoteIntervalIsEmpty(){return this.computedQuoteInterval.type===Oe.EMPTY}get computedQuoteInterval(){var h;let{safeMoonStore:e,fromToStore:t,approveStore:o,swapBtnStore:n}=this.rootStore;if(e.computedHoneypot||t.computedFormToTokenIsLeverageToken)return{type:Oe.EMPTY};let i=ju.handleQuoteErrorState({quote:this.quote,honeypotToken:A(this,"rootStore.safeMoonStore.computedHoneypot",!1)})||this.accountStore.computedNonsupportChain,{from:a,computedNonsupportFacetToken:c}=this.fromToStore;if(i||c)return{type:Oe.EMPTY};if(this.computedNotSupportBtcAddress&&this.accountStore.isConnectedWallet)return{type:Oe.NOT_SUPPORT_BTC_ADDRESS_TYPE,text:(h=this.quote.bestRoute)==null?void 0:h.errorMsg};if((!this.quoteScope||!t.computedIfQuote)&&this.fetchQuoteStatus!==3&&!o.computedIsCancelApproveStatus)return{type:Oe.EMPTY};if(this.computedCrossAccuracyLimit)return{type:Oe.CROSS_CHAIN_ACCURACY,text:S("swaptrade_card_tooltips_adjust_pay_token_decimal",{fromToken:a.tokenSymbol,value:this.computedCrossAccuracyLimit}),equation:S("swaptrade_card_tooltips_adjust_pay_token_decimal",{fromToken:q(a.tokenSymbol),value:this.computedCrossAccuracyLimit})};if(this.computedFacetTokenTips)return{type:Oe.FACET_TOKEN_SWAP_ERROR,text:this.computedFacetTokenTips};let{crossMiniAmount:p,crossMaxAmount:d}=this.quoteScope||{};if(yt(a.amount).lt(yt(p))){let m=ee(p,{cutPriceText:!0,isFloor:!1});return{type:Oe.CROSS_CHAIN_MIN,text:S("swaptrade_bridge_toast_min_amout_crosschain_swap",{value:m,symbol:a.tokenSymbol}),equation:S("swaptrade_bridge_toast_min_amout_crosschain_swap",{value:m,symbol:q(a.tokenSymbol)})}}if(yt(a.amount).gt(yt(d))){let m=ee(d,{cutPriceText:!0});return{type:Oe.CROSS_CHAIN_MAX,text:S("swaptrade_bridge_toast_max_amout_crosschain_swap",{value:m,symbol:a.tokenSymbol}),equation:S("swaptrade_bridge_toast_max_amout_crosschain_swap",{value:m,symbol:q(a.tokenSymbol)})}}return this.computedIsNoLiquidity?{type:Oe.NOT_LIQUIDITY}:o.computedIsCancelApproveStatus&&!n.computedTooBalance?{type:Oe.CANCEL_APPROVE_TIPS}:{type:Oe.EMPTY}}get computedNotSupportFromBtcAddressType(){var t,o;let e=(o=(t=this.quote)==null?void 0:t.bestRoute)==null?void 0:o.code;return Number(e)===At.NOT_SUPPORT_FROM_BTC_ADDRESS}get computedNotSupportToBtcAddressType(){var t,o;let e=(o=(t=this.quote)==null?void 0:t.bestRoute)==null?void 0:o.code;return Number(e)===At.NOT_SUPPORT_TO_BTC_ADDRESS}get computedNotSupportBtcAddress(){return this.computedNotSupportFromBtcAddressType||this.computedNotSupportToBtcAddressType}get computedIsNoLiquidity(){let{from:e}=this.fromToStore,{crossMiniAmount:t,crossMaxAmount:o}=this.quoteScope||{};return this.fetchQuoteStatus===3&&this.quote.quoteNull||yt(e.amount).lte(o)&&yt(e.amount).gte(t)}get computedCrossAccuracyLimit(){let{crossAccuracyLimit:e,code:t}=this.quote.bestRoute||{};return Number(t)===At.CROSS_CHAIN_ACCURACY?e:""}get computedFacetTokenTips(){let{errorMsg:e,code:t}=this.quote.bestRoute||{};return[gg,Tg,yg].includes(Number(t))&&e?e:""}get computedYouSaveVisible(){var G;let{computedNowCurrencySymbol:e,currencyConversion:t,computedIsWalletEnv:o}=this.commonStore,{computedIsExactIn:n,computedIsCrossChain:i}=this.rootStore.fromToStore,{quoteError:a,quoteNull:c,bestRoute:p}=this.quote;if(!n||a||c||!(p!=null&&p.youSaveDTO)||i)return{visible:!1};let{youSaveDTO:d,fromToken:h,toToken:m}=p,{topTenDexInfoList:g,youSaveMoney:T}=d,y=Number(T)>=.1&&(g==null?void 0:g.length)>0&&!h.isHoneypot&&!m.isHoneypot,C=t(T).toString(),b=y?he(C,e,{isFloor:!1}):"",L=y?(G=g==null?void 0:g[1])==null?void 0:G.dexName:"";return o&&(!i&&this.computedTopTenDexInfoList.length>0?y=!0:y=!1),{visible:y,youSaveStr:b,dexName:L}}get computedHasYouSave(){var t,o;let{computedIsCrossChain:e}=this.rootStore.fromToStore;return!!((o=(t=this.quote)==null?void 0:t.bestRoute)!=null&&o.youSaveDTO)||e}get computedTopTenDexInfoList(){var o,n,i,a,c,p;if(!((o=this.rootStore.fromToStore)!=null&&o.computedIsExactIn)||!this.computedHasYouSave)return[];let{computedNowCurrencySymbol:e,currencyConversion:t}=this.commonStore;return(p=(c=(a=(i=(n=this.quote)==null?void 0:n.bestRoute)==null?void 0:i.youSaveDTO)==null?void 0:a.topTenDexInfoList)==null?void 0:c.map(({logoUrl:d,dexName:h,comparePercent:m,price:g,dexAmountOut:T,amountOutOfMoney:y,gasOfMoney:C,isOkxDex:b})=>{var ge,ce;let L=(ge=t(y))==null?void 0:ge.toString(),G=(ce=t(C))==null?void 0:ce.toString();return{logoUrl:d,dexName:h,comparePercent:m,price:g,isOkxDex:b,formatPrice:ee(g),dexAmountOut:yt(T).toString(),formatDexAmountOut:ee(T),amountOutOfMoney:L,formatAmountOutOfMoney:he(L,e,{needBillionMillionUnit:!1}),gasOfMoney:he(G,e),symbol:e||""}}))!=null?p:[]}get computedReferredFee(){let{bestRoute:e}=this.quote,{referredNetWorkFee:t,referredAmount:o}=e||{};if(!o||!t)return"";let{computedNowCurrencySymbol:n,currencyConversion:i}=this.commonStore,{from:a}=this.fromToStore;return S("swaptrade_modal_desc_crosschain_valuediff_variavle",{price:`${ee(o)} ${a.tokenSymbol}`,fee:`${he(i(t).toString(),n)}`})}get computedMonitorSwapSaveOrderParams(){let{accountStore:e,liquidityChooseStore:t}=this.rootStore,{bestRoute:o}=this.quote;if(!o)return{};let{slippage:n,slippageType:i}=this.computedSlippage,{fromToken:a,fromTokenAmount:c,fromTokenPrice:p,toTokenPrice:d,receiveAmount:h,toToken:m,swapType:g,routerLabel:T}=o,y=Number(g)===0,C=y?{liquidity_source:t.computedMonitorLiquidSelectType}:{},b=y?{}:{bridge_selection:T!=null&&T.includes(Qu)?"overall best":"custom"};return{wallet_address:e.address,from_token_address:a==null?void 0:a.tokenContractAddress,from_token_amount:c,from_amount_usdt:p,to_token_address:m==null?void 0:m.tokenContractAddress,to_token_amount:h,to_amount_usdt:d,from_chain:a==null?void 0:a.chainName,to_chain:m==null?void 0:m.chainName,swap_type:y?"swap":"cross_chain_swap",slippage:{type:i===$t.AUTO?"auto":"custom",amount:n},trading_mode:this.computedIsIntentType?"intent_mode":"auto_mode",...C,...b}}get computedIsUsingCentralizedBridge(){var o,n;let e=["8"],t=String((n=(o=this.quote.bestRoute)==null?void 0:o.bridge)==null?void 0:n.bridgeId);return e.includes(t)}get computedIsNoQuote(){var e;return this.quote.quoteError||this.quote.quoteNull||!this.quote.bestRoute||((e=this.rootStore.safeMoonStore)==null?void 0:e.computedHoneypot)||this.fromToStore.computedFormToTokenIsLeverageToken||this.rootStore.outerStore.computedFeeConfigErrorTips||!this.fromToStore.computedTypedValueIsValid}get computedIsDexQuote(){let{bestRoute:e}=this.quote,{tradingModeType:t}=e||{};return String(t)===on}};u();l();var Cg="1",wg="2",Nh={minValue:.01,maxValue:.5},Mh={minValue:.03,maxValue:.5},gr=class{constructor(e){s(this,"slippageSetting",{autoIsSelected:!1,inputSlippage:""});s(this,"configSingle",Nh);s(this,"configCross",Mh);s(this,"inputValue","");s(this,"inputCache","");s(this,"inputSlippageFocus",!1);s(this,"slippageNotice","");s(this,"hasSlippageError",!1);s(this,"hasSafeMoonWarning",!1);s(this,"isFrozen",!1);s(this,"frozenTooltip","");s(this,"clearNoticeAndError",()=>{this.slippageNotice="",this.hasSlippageError=!1});s(this,"setFrozenInfo",({computedSafeMoonNotSupport:e,isCrossBridgeOnly:t})=>{this.isFrozen=e||t,e?this.frozenTooltip=S("swaptrade_dialog_modal_current_notsupport"):t?this.frozenTooltip=S("swaptrade_dialog_modal_crosschain_notsupport"):this.frozenTooltip=""});s(this,"refreshInfo",()=>{let{inputSlippage:e}=this.slippageSetting;if(this.inputValue=e||"",this.computedSafeMoonTips||e!==""&&e!==void 0){let{computedSafeMoonTips:t,minSlippageShow:o,maxSlippageShow:n,computedAutoSlippage:i}=this,a=this.rootStore.fromToStore.computedIsSingleChain,{notice:c,isError:p,isWarning:d}=ei({inputSlippageParams:this.computedSlippageValue,computedSafeMoonTips:t,minSlippageShow:o,maxSlippageShow:n,autoSlippageValue:i,isSingleChain:a});this.slippageNotice=c,this.hasSlippageError=p,this.hasSafeMoonWarning=d}});s(this,"onFocus",()=>{this.inputSlippageFocus=!0,this.hasSafeMoonWarning=!1,this.inputCache&&(this.onInput(null,this.inputCache),this.inputCache="")});s(this,"onInput",(e,t="")=>{let o=e||t;this.templeAutoSelected=!1;let{computedSafeMoonTips:n,minSlippageShow:i,maxSlippageShow:a,computedAutoSlippage:c}=this,p=this.rootStore.fromToStore.computedIsSingleChain,{notice:d,isError:h,isWarning:m}=ei({inputSlippageParams:o,computedSafeMoonTips:n,minSlippageShow:i,maxSlippageShow:a,autoSlippageValue:c,isSingleChain:p});if(!or(le(o))){let T=/^0{2,}/gm;o=o.replace(T,"0"),this.inputValue=o}let g=o||this.computedSafeMoonTips;this.slippageNotice=g?d:"",this.hasSlippageError=h,this.hasSafeMoonWarning=m});s(this,"onBlur",()=>{this.inputSlippageFocus=!1});s(this,"onSelectCustom",()=>{let e=this.inputValue,{computedSafeMoonTips:t,minSlippageShow:o,maxSlippageShow:n,computedAutoSlippage:i}=this,a=this.rootStore.fromToStore.computedIsSingleChain,{slippage:c,inputValue:p,notice:d,isError:h}=ei({inputSlippageParams:e,computedSafeMoonTips:t,minSlippageShow:o,maxSlippageShow:n,autoSlippageValue:i,isSingleChain:a}),m=this.getSafeMoonStore();if(m.checkIsChanged&&m.checkIsChanged(e),t?this.inputValue=Pt(c):this.inputValue&&(this.inputValue=Pt(c),this.slippageNotice=d,this.hasSlippageError=h,this.hasSafeMoonWarning=!!t),(Number(e)===0||or(e))&&(this.slippageNotice=""),h){this.onSelectAuto(),this.inputSlippageFocus=!1;return}Yi({custom_or_auto:p?"custom":"auto"}),this.setSlippageSetting({autoIsSelected:!p,inputSlippage:p}),this.rootStore.quoteStore.fetchQuoteDebounce()});s(this,"onReset",()=>{let{inputSlippage:e}=this.slippageSetting;this.inputValue=e,this.clearNoticeAndError(),this.inputSlippageFocus=!1});this.rootStore=e,this.commonStore=e.commonStore,this.fromToStore=e.fromToStore,this.smartRouterStore=e.smartRouterStore,H(this,{},{autoBind:!0})}getSafeMoonStore(){return this.rootStore.safeMoonStore}getOrderSlippageInfo(){let{autoIsSelected:e}=this.slippageSetting,t=Qs(this.rootStore);return e||this.isFrozen?{autoSlippageInfo:t}:{customSlippage:String(this.computedRealSlippageValue),autoSlippageInfo:t}}get minSlippage(){let e=this.rootStore.fromToStore.computedIsSingleChain,{computedSafeMoonToken:t}=this.getSafeMoonStore();if(t){let o=I.BigNumber.max(this.configCross.minValue,this.configSingle.minValue);return o.isNaN()?.011:o.toString()}return e?this.configSingle.minValue:this.configCross.minValue}get maxSlippage(){return this.rootStore.fromToStore.computedIsSingleChain?this.configSingle.maxValue:this.configCross.maxValue}get minSlippageShow(){return I.mul(this.minSlippage,100)}get maxSlippageShow(){return I.mul(this.maxSlippage,100)}get computedAutoSlippage(){let{computedHoneypot:e}=this.getSafeMoonStore();if(e){let t=A(this,"rootStore.quoteStore.quote.bestRoute.realSlippage",0);return I.mul(t,100)}return Jn(this.rootStore)}get computedSafeMoonNotSupport(){let{computedHoneypot:e,computedSlippageTips:t}=this.getSafeMoonStore();return!!(e||(t==null?void 0:t.overLimit)||(t==null?void 0:t.equalLimit))}get computedSafeMoonSlippage(){return this.getSafeMoonStore().computedSlippage}get computedSafeMoonTips(){return this.getSafeMoonStore().computedSlippageTips}get computedSafeMoonTip(){var e;return(e=this.getSafeMoonStore().computedSlippageTips)==null?void 0:e.tip}get computedSafeMoonPairSlippage(){return this.getSafeMoonStore().computedPairSlippage}get computedSlippageValue(){return this.getSlippageValue()}get computedRealSlippageValue(){let e=this.getSlippageValue();return Number(I.div(e,100))||0}isValidVolatilityTip(){if(Number(this.computedSlippageValue)>this.computedAutoSlippage)return!1;let e=this.getSafeMoonStore(),t=this.smartRouterStore;return e.computedSafeMoonToken===null&&!(t!=null&&t.isCrossBridgeOnly)}get computedVolatilityTips(){var ge,ce,ut;if(!this.isValidVolatilityTip())return null;let{computedAutoSlippage:e}=this,t=((ut=(ce=(ge=this.rootStore)==null?void 0:ge.quoteStore)==null?void 0:ce.quote)==null?void 0:ut.bestRoute)||{},{priceFluctuationMonitorTime:o,priceFluctuationThreshold:n,fromPriceFluctuation:i,toPriceFluctuation:a,rateFluctuationThreshold:c,slippageFluctuationhold:p,rateFluctuation:d}=t,{from:h,to:m}=this.fromToStore,g=(m==null?void 0:m.tokenSymbol)||"",T=(h==null?void 0:h.tokenSymbol)||"",y=I.mul(p,100),C=I.mul(n,100),b=I.mul(c,100),L=Number(d),G=Number(c);if(e>y){if(L<G)return null;let _t=this.slippageSetting.autoIsSelected;return{tip:S("swaptrade_settings_alert_both_exchange_tips",{payToken:T,receiveToken:g,value:b,min:o}),tipEquation:S("swaptrade_settings_alert_both_exchange_tips",{payToken:q(T),receiveToken:q(g),value:b,min:o}),swapInterceptorType:_t?J.VOLATILITY_SLIPPAGE:null}}else if(e===y){let _t=Math.abs(i),pe=Math.abs(a),$r=Number(n);if(_t>$r&&pe>$r)return{tip:S("swaptrade_placeorder_alert_both_volatility",{payToken:T,receiveToken:g,value:C,min:o}),tipEquation:S("swaptrade_placeorder_alert_both_volatility",{payToken:q(T),receiveToken:q(g),value:C,min:o})};if(_t>$r)return{tip:S("swaptrade_placeorder_alert_pay_receive_volatility",{token:T,value:C,min:o}),tipEquation:S("swaptrade_placeorder_alert_pay_receive_volatility",{token:q(T),value:C,min:o})};if(pe>$r)return{tip:S("swaptrade_placeorder_alert_pay_receive_volatility",{token:g,value:C,min:o}),tipEquation:S("swaptrade_placeorder_alert_pay_receive_volatility",{token:q(g),value:C,min:o})};if(L>=G)return{tip:S("swaptrade_settings_alert_both_exchange",{payToken:T,receiveToken:g,value:b,min:o}),tipEquation:S("swaptrade_settings_alert_both_exchange",{payToken:q(T),receiveToken:q(g),value:b,min:o})}}return null}getDefaultSetting(){let e={inputSlippage:"",autoIsSelected:!0},t=this.getSafeMoonStore();if(t.computedSafeMoonToken){let o=t.computedSlippage,n=Pt(o);t.isChanged&&n&&(e.inputSlippage=n,e.autoIsSelected=!1)}return e}getSlippageType(){return this.slippageSetting.autoIsSelected||this.isFrozen?$t.AUTO:$t.CUSTOM}getSlippageValue(e){let{autoIsSelected:t,inputSlippage:o}=e||this.slippageSetting;return t||this.isFrozen?this.computedAutoSlippage:o||this.computedAutoSlippage}setSlippageSetting(e){let t={...e},o=this.getSafeMoonStore(),{computedSafeMoonToken:n}=o;if(!n){this.slippageSetting=t;return}let i=this.getSlippageValue(t);if(i===this.getSlippageValue(this.slippageSetting)||o.isAccessSlippage(i)||!o.getSafemoonIsChangedLocal()){t.inputSlippage="",t.autoIsSelected=!0;let a=Pt(i);o.isChanged&&a&&(t.inputSlippage=a,t.autoIsSelected=!1),o.setSafeMoonPairSlippage(i),this.slippageSetting=t}}async initSlippageConfigs(){try{let{data:e}=await P.get(Jc),t=e==null?void 0:e.find(({configId:n})=>Cg===n),o=e==null?void 0:e.find(({configId:n})=>wg===n);t&&(this.configSingle=t),o&&(this.configCross=o)}catch{this.configSingle=Nh,this.configCross=Mh}}initSlippageSetting(){let e=this.getDefaultSetting(),t;e?t={...e}:t={autoIsSelected:!0,inputSlippage:""},this.setSlippageSetting(t)}initReactions(){Le(()=>{let{from:e,to:t}=this.fromToStore;return{chainId:e.chainId,toChainId:t.chainId,fromTokenAddress:e.tokenContractAddress,toTokenAddress:t.tokenContractAddress}},({fromTokenAddress:e,toTokenAddress:t})=>e&&t?(this.rootStore.quoteStore.slippageInfoFetched=!1,this.clearNoticeAndError(),this.initSlippageSetting()):!1,{equals:Et.shallow}),Le(()=>{let e=this.fromToStore.from.chainId,{computedSafeMoonSlippage:t}=this;return{fromId:e,computedSafeMoonSlippage:t}},this.clearNoticeAndError,{equals:Et.shallow}),Le(()=>{let{computedSafeMoonPairSlippage:e}=this;return{computedSafeMoonPairSlippage:e}},()=>{this.initSlippageSetting()},{equals:Et.shallow}),Le(()=>{let{isCrossBridgeOnly:e}=this.smartRouterStore,{computedSafeMoonNotSupport:t}=this;return{computedSafeMoonNotSupport:t,isCrossBridgeOnly:e}},this.setFrozenInfo,{equals:Et.shallow}),Le(()=>{let{slippageSetting:e,isFrozen:t,computedSafeMoonTip:o}=this;return{slippageSetting:e,isFrozen:t,computedSafeMoonTip:o}},this.refreshInfo,{equals:Et.shallow})}onSelectAuto(e){Yi({custom_or_auto:"auto"}),!this.hasSlippageError&&!this.hasSafeMoonWarning&&this.inputValue?this.inputCache=this.inputValue:this.inputCache="";let t={autoIsSelected:!0,inputSlippage:""};if(this.inputValue="",this.slippageNotice="",this.hasSlippageError=!1,this.hasSafeMoonWarning=!1,!e){let o=this.getSafeMoonStore();o.computedSafeMoonToken&&o.setSafeMoonIsChanged(!1),this.setSlippageSetting(t),this.rootStore.quoteStore.fetchQuoteDebounce()}}get computedMinimumNum(){var p,d,h,m,g;let{quote:e}=this.rootStore.quoteStore,t=(p=e==null?void 0:e.bestRoute)==null?void 0:p.receiveAmount,o=(d=e==null?void 0:e.bestRoute)==null?void 0:d.minimumReceived,n=(h=this.fromToStore.to)==null?void 0:h.tokenSymbol,{computedIsSnapType:i}=this.rootStore.tradeModeStore,a=this.inputValue?I.div(this.inputValue,100):this.computedRealSlippageValue;if(this.hasSlippageError||!$e((g=(m=this.rootStore.quoteStore.quote)==null?void 0:m.bestRoute)==null?void 0:g.receiveAmount)||!$e(a)||!$e(t))return"--";let c=i?o:I.mul(t,1-a);return{text:`${ee(c)} ${n}`,equation:`${ee(c)} ${q(n)}`}}};var jr=class extends sr{constructor(){v.init({project:nn});super();s(this,"reset",()=>{this.receiveAddressStore=new Xn(this),this.outerStore=new ai(this),this.fromToStore=new ur(this),this.approveStore=new ar(this),this.quoteStore=new Sr(this),this.tokenModalStore=new ri(this),this.safeMoonStore=new mr(this),this.walletContractStore=new Mn(this),this.sendTransactionStore=new zn(this),this.intentSwapStore=new Dn(this),this.swapStore=new dr(this),this.swapBtnStore=new pr(this),this.mevStore=new si(this),this.recentTransactionStore=new In(this),this.facetStore=new oi(this),this.smartRouterStore=new Sn(this),this.slippageStore=new gr(this),this.liquidityChooseStore=new fr(this),this.oneMoreOrderStore=new ni(this),this.gasDropStore=new ii});this.reset()}},Go=jr;s(Go,"instance",null),s(Go,"getInstance",()=>(jr.instance||(jr.instance=new jr),jr.instance));var Dh=Go;u();l();u();l();u();l();var Fh=Re(["searchValue","fromTokenList","toTokenList","searchTokenList","error","tokenModalVisible","tokenModalFromState","loading","importTokenInfo","toSelectedChainId","fromSelectedChainId","hideCollectCancelConfirm","userChainIdCache","hideTokenGuide","tokenPageChainList","searchChainKeywords","dialogIndex"],["computedTokenList","computedSearchTokenList","computedFromChain","computedToChain","computedCurrentToChainId","computedCurrentChainId","computedIsCollectChain","computedTokenGuideVisible","computedIsNotSupportToChain","computedAllChainList","computedIsSearchChainStatus","computedSearchedChainList"]);var Ho=class extends hr{constructor(e){super(e),Te(this,{...Fh})}};var Qr=class extends sr{constructor(){v.init({project:nn});super();s(this,"reset",()=>{this.receiveAddressStore=new Xn(this),this.outerStore=new ai(this),this.fromToStore=new ur(this),this.approveStore=new ar(this),this.quoteStore=new Sr(this),this.tokenModalStore=new Ho(this),this.safeMoonStore=new mr(this),this.walletContractStore=new Mn(this),this.sendTransactionStore=new zn(this),this.intentSwapStore=new Dn(this),this.swapStore=new dr(this),this.swapBtnStore=new pr(this),this.mevStore=new si(this),this.recentTransactionStore=new In(this),this.facetStore=new oi(this),this.smartRouterStore=new Sn(this),this.slippageStore=new gr(this),this.liquidityChooseStore=new fr(this),this.oneMoreOrderStore=new ni(this)});this.reset()}},jo=Qr;s(jo,"instance",null),s(jo,"getInstance",()=>(Qr.instance||(Qr.instance=new Qr),Qr.instance));var xh=jo;var Ag=({localeData:r,...e})=>{let t=(0,Bh.useLocation)(),o;return t.pathname.includes(Pe)?o=O.BRIDGE:t.pathname.includes(uu)?o=O.LIMIT_ORDER:t.pathname===Me&&(o=O.SWAP),ci.default.createElement(es,{localeData:r,isDev:!0,noRemoteData:!0},ci.default.createElement($l,{swapRootStore:xh,bridgeRootStore:Dh,initTab:o},ci.default.createElement(Op,{currentTab:o,...e})))};var Uh=Ke(Ag);af();pf();Ia();uf();ff();var li=w(It());var pi=w(fi());Zt();hi();u();l();var qh=w(V()),Vh=w(xl());Zt();Si();var Wh=w(fi());var bg=({walletId:r,txParams:e,onConfirm:t,onCancel:o})=>{let n=ic(r),i=cl(Qe,n==null?void 0:n.walletId),a=Ol({coinAmount:0,localType:Qe,coinId:ya,fromAddr:i,walletId:n==null?void 0:n.walletId,txSource:Da.DAPP}),c={localType:Qe,params:{transaction:e},walletId:n==null?void 0:n.walletId},p=rc(async({networkFee:d})=>{let{raw_data:h,raw_data_hex:m,txID:g,visible:T}=e||{};try{let y=await we().signCommonMessage(i,{type:"protobuf",message:JSON.stringify({txID:g,visible:T,raw_data:h,raw_data_hex:m})},Qe),C=Vh.default.address.fromHex((0,Wh.get)(h,"contract[0].parameter.value.contract_address",i)),b=await ul(Qe,y);await a(y,{toAdr:C,txHash:b,serviceCharge:d}),t==null||t({txHash:b})}catch(y){t({error:y})}});return qh.default.createElement(Ul,{unapproved:c,onCancel:o,onConfirm:p})},Gh=bg;u();l();var ta=w(V());hi();Zt();var Hh=({visible:r,onClose:e,onChange:t,walletId:o})=>ta.default.createElement(Ji,{visible:r,onClose:e,onChange:t,coinId:ga,walletId:o},ta.default.createElement(Ji.Header,{title:Xt("extension_defi_top_header_title_select_address_type"),subTitle:Xt("extension_defi_popup_desc_new_address_default")}));u();l();var ef=w(Ra()),Yt=w(V());var tf=w(gf());hi();Si();u();l();var jh=w(V());var ra=w(cf());Zt();var Og=async(r={})=>{let{contractAddress:e,contractName:t,functionName:o,functionArgs:n}=r,{getRawTransaction:i}=await Ii(),a={data:{type:Ei.CONTRACT_CALL,data:{contract:e,contractName:t,functionName:o,functionArgs:n}}};return await i(ra.Currency.Stx,a)},vg=async(r={})=>{let{recipient:e,amount:t,memo:o}=r,{getRawTransaction:n}=await Ii(),i={data:{type:Ei.TRANSFER,data:{to:e,amount:t,memo:o}}};return await n(ra.Currency.Stx,i)},Pg=async(r={})=>r.txType===Ci.CONTRACT_CALL?Og(r):r.txType===Ci.STX_TRANSFER?vg(r):"",Qh=async({transaction:r={},fromAddress:e,value:t})=>{let o=await Pg(r),n=await Wl({coinId:_a,fromAddress:e,value:t,inputData:o});return(n==null?void 0:n.gasLimit)||"0"};u();l();var kg=w(V());var Kh=w(yf());Zt();Si();async function $h(r,e){let t=async()=>await rl({coinId:Ti,address:r},{fromAddr:r,toAddr:""}),o=async p=>{let d=(0,Kh.default)(p,"info.nonce",0),h={type:xa.MULTI_CONTRACT_CALL,nonce:d,maxFee:0,chainId:yl.StarknetChainId.SN_MAIN,multiContractCallData:{from:r,calls:e}},m=await we().signTransaction(h,r,Qo);return m==null?void 0:m.signature},n=async p=>{let{data:d}=await En({coinId:Ti,address:r,inputData:p});return d==null?void 0:d.gasLimit},i=await t(),a=await o(i);return await n(a)}va();Zt();hf();df();u();l();var na=w(fi()),oa=w(Sf()),Yh=w(_f());var Xh=w(xl());Ia();Zt();va();function zh(r,e){return Xh.default.address.fromHex((0,na.get)(r,"raw_data.contract[0].parameter.value.contract_address",e))}function Zh(r){return(0,na.get)(r,"raw_data.contract[0].parameter.value.data","")}async function Rg(){var o;let r="https://api.mainnet.solana.com",e=(o=_r({localType:zt}))==null?void 0:o.rpcUrl;return new Xa(e||r)}async function Lg(r,e,t){let{transaction:o,bizType:n,bizId:i=[],notReplaceBlockhash:a=!1}=r,c=null,p=()=>typeof(r==null?void 0:r.toJSON)=="function"?r:r==null?void 0:r.instruction,d=await e.getLatestBlockhash(),h=d==null?void 0:d.blockhash,m=d==null?void 0:d.lastValidBlockHeight,g=p();return g?c=new wi({feePayer:t,blockhash:h,lastValidBlockHeight:m}).add(g):o&&(a||(o instanceof Ai?o.message.recentBlockhash=h:(o.signatures=[],o.recentBlockhash=h),o.lastValidBlockHeight=m,i.forEach(T=>{let y=(0,Yh.mnemonicToSeed)(n,T),C=za.fromSeed(y.slice(0,32));o.partialSign(C)})),c=o),c}async function Jh(r){let e=await Rg(),t=await Lg(r,e,r.transaction.feePayer);if(t instanceof wi)return oa.default.encode(t.serialize({requireAllSignatures:!1,verifySignatures:!1}));if(t instanceof Ai)return oa.default.encode(t.serialize());throw new Error("tx should be Transaction or VersionedTransaction instance of solanaWeb3")}function Kr(r){let e=_r({netWorkId:String(r)}),t=(e==null?void 0:e.baseChain)||"",o=(e==null?void 0:e.localType)||"",n=(e==null?void 0:e.coinId)||3,i=e==null?void 0:e.realChainIdHex;return{baseCoinId:n,networkType:o,chainId:i,baseChain:t}}async function ia({networkId:r,address:e,data:t,tokenAddress:o}){let n={},{baseCoinId:i}=Kr(r),a={coinId:i,address:e},c={fromAddr:e,value:"0"},p={address:e,inputData:t,coinId:i,value:"0",tokenAddress:o},{data:d}=await En(p),{gasLimit:h}=d,{data:{info:m}}=await tl(a,c),g=(m==null?void 0:m.needExtFee)||!1,T=(m==null?void 0:m.gasPrice)||{},{normal:y,proposePriorityFee:C,supportEip1559:b}=T;if(!g)return n={maxFeePerGas:y,maxPriorityFeePerGas:C,gasPrice:y,gasLimit:h,supportEip1559:b,networkFee:Yr(y,h)},n;let L={from:e,to:o,data:t,value:Yo(0),gasPrice:Yo(y),gasLimit:Yo(h)},G=ka(L),ge=hl(G),ce=await ol({coinId:i},{inputData:ge}),ut=Ko(Yr(y,h),ce);return n.networkFee=ut,n.extFee=ce,n}function Tr(r,e){return Oa(Aa(r,10**e))}var Ng=-42412,Mg=-42418,Dg=(0,tf.default)(Sl,500);function rf(r,e){let{baseCoinId:t}=Kr(r),o=il(e?void 0:t,void 0,e?{chainId:+r,address:e}:void 0),n={coinAmount:0,coinAmountInt:0,currencyAmount:0};return sl(o==null?void 0:o.coinId)||n}async function Fg({coinId:r=3},{gasInfo:e={},calldata:t}){let{networkFee:o,isNetworkFeeLoading:n,isGasLimitLoading:i}=e,a=n||i,{minGasFee:c}=fl(e),p=ba(c),d=ml({...e,isNetworkFeeLoading:!1},"swap"),h=await Dg(r,t);return{fee:p,feeInt:c,maxFeeInt:o,loading:a,error:d||h}}async function xg(r,{decimals:e},{calldata:t}){let{transaction:o}=t,{fee:n}=await nl({coinId:Ta,address:r}),i;if(o){let d=Hl(o);i=Gl(o,d)}let a=await jl([i]),c=Ko(n,a);return{fee:Tr(c,e),feeInt:c}}async function Bg(r,{decimals:e},{calldata:t}){let o=await Vl({address:r,transaction:t});return{fee:Tr(o,e),feeInt:o}}async function Ug(r,{decimals:e},{calldata:t}){let o=await Bl({address:r,inputData:Zh(t),toAddr:zh(t,r)});return{fee:Tr(o,e),feeInt:o}}async function qg(r,{decimals:e},{calldata:t}){var a,c;let o=ql.from(t.transactionBlock);o.setSenderIfNotSet(r);let n=((c=(a=o==null?void 0:o.blockData)==null?void 0:a.gasConfig)==null?void 0:c.budget)||"0";return{fee:Tr(n,e),feeInt:n}}async function Vg(r,{decimals:e},{calldata:t}){let o=await Qh({transaction:t,fromAddress:r,value:"0"});return{fee:Tr(o,e),feeInt:o}}async function Wg(r,{decimals:e},{calldata:t}){let o=await $h(r,t);return{fee:Tr(o,e),feeInt:o}}function of(r,e){var ce,ut;let{baseChain:t,baseCoinId:o}=Kr(r),{baseCoin:n}=al(o,!0),i=Zi(t),{symbol:a}=(0,ef.useSelector)($o),p=pl([o])[o]||0,[d,h]=(0,Yt.useState)(0),[m,g]=(0,Yt.useState)(0),[T,y]=(0,Yt.useState)(0),[C,b]=(0,Yt.useState)(!1),[L,G]=(0,Yt.useState)(!1),ge=(0,Yt.useMemo)(()=>{let _t=Yr(d,p);return{estimatedGasFeeInt:m,maxGasFeeInt:T,decimals:n==null?void 0:n.decimals,currencyAmount:_t,currencySymbol:a,coinSymbol:n==null?void 0:n.symbol,loading:C,error:L}},[n.decimals,n.symbol,a,L,m,T,C,p,r,e,(ce=e==null?void 0:e.gasInfo)==null?void 0:ce.isNetworkFeeLoading,(ut=e==null?void 0:e.gasInfo)==null?void 0:ut.isGasLimitLoading]);return nc(()=>{async function _t(){let pe={fee:0,feeInt:0};b(!0),G(!1);try{t===gi?pe=await Fg(n,e):t===zt?pe=await xg(i,n,e):t===fa?pe=await Bg(i,n,e):t===ma?pe=await qg(i,n,e):t===Qe?pe=await Ug(i,n,e):t===Sa?pe=await Vg(i,n,e):t===Qo&&(pe=await Wg(i,n,e)),h(pe.fee),g(pe.feeInt),y(pe.maxFeeInt||pe.feeInt)}catch{h(0),g(0),G(Xt("wallet_extension_toast_text_unknown_error"))}finally{b(!!pe.loading),G(pe.error)}}_t()},[r,e]),ge}async function Gg({networkId:r,tx:e,hardwareExtParams:t,checkTxBeforePublish:o}){let n=e,{baseChain:i}=Kr(r);if(i===zt)return n.transaction=await Jh(e),n;if(i===gi){let a=n.value||n.amount||0,c=Kr(r).baseCoinId;n={...n,...n.gasInfo};let p=await o({...n,userGasInfo:n.gasInfo,coinId:c,amount:a,baseCoinAmountUse:a}),{nonce:d,updateGasInfo:h={}}=p||{};n.nonce=d,n.maxFeePerGas=h.maxFeePerGas||n.maxFeePerGas,n.maxPriorityFeePerGas=h.maxPriorityFeePerGas||n.maxPriorityFeePerGas,n.gasPrice=h.gasPrice||n.gasPrice;let m=await we().getSelectedWallet(),g=await we().generateFormatedTxParams(r,n),{dispatch:T}=t||{};return T&&(await T(Za({txParams:g,walletId:m})),n.result=g.result,n.walletId=m),n}if(i===ha){let a=await we().getSelectedWallet(),c=await we().generateFormatedTxParams(r,n),p=await Ja(c,c.address,i,a);n.result=p,n.walletId=a}return n}async function sa({networkId:r,tx:e,hardwareExtParams:t,checkTxBeforePublish:o}){var i,a,c;if(!e)throw new Error("tx is required");let n=e;try{return n=await Gg({networkId:r,tx:e,hardwareExtParams:t,checkTxBeforePublish:o}),await we().dexSignAndSubmitTransaction(r,n)}catch(p){throw(i=p==null?void 0:p.data)!=null&&i.originalError?(p.message=(c=(a=p==null?void 0:p.data)==null?void 0:a.originalError)==null?void 0:c.error_message,p.code=Ng):p.code=Mg,p}finally{_i()===yi&&we().focusLastOkPopupWithCache()}}async function nf(r,e){let t=e;try{return typeof e=="string"&&(t=JSON.parse(e)),await we().dexSignTypedDataV4(r,t)}finally{_i()===yi&&we().focusLastOkPopupWithCache()}}var sf=r=>{let e=Ua(r),t=bi(r).some(d=>$a(d.coinId)),o=t?ja(r):bi(r),n;t?n=o.find(d=>d.realChainIdHex===e)||{}:n=o[0]||{};let i=Number(t?n.netWorkId:n.chainId),a=qa(r),c=Wa(r);return{walletType:{isMNEMONIC:c[a].keyringIdentityType===Jt.MNEMONIC,isPRIVATE:c[a].keyringIdentityType===Jt.PRIVATE_KEY,isHARDWARE:c[a].keyringIdentityType===Jt.HARDWARE,isMPC:c[a].keyringIdentityType===Jt.MPC},chainId:i}};R.initSentry(ua,ca,process.env.APP_VERSION);R.setGlobal({HARDWALLETERROR:Ka,getApiHostname:Ea,getStaticHostname:Ca,LocalStore:aa,interceptorHeaders:wa,urlConfig:Pa,FeeTypeEnum:Ba,netWorkIdToLocalType:new Proxy({},{get(r,e){var t;return(t=_r({netWorkId:String(e)}))==null?void 0:t.localType}}),localTypeToBaseCoinId:new Proxy({},{get(r,e){var t;return(t=_r({localType:e}))==null?void 0:t.coinId}}),KeyringIdentityTypeEnum:Jt,RegisterLocalStatusEnum:Fa,hexToDecimal:Ya,signAndSubmitTransaction:sa,signTypedDataV4:nf,getGasPrice:ia,checkMPCStatus:El,hooks:{useCoin:rf,useUtxoListFn:vl,useFeeDisplay:of,useRegisterStatus:_l,useGasReturnActivity:dl,useSignInfo:bl,useUtxoEstimateFee:kl,useUtxoCheckBeforePublishFn:Pl,useUtxoSignAndPublishTransactionFn:Rl},components:{EvmConfirm:Fl,TronConfirm:Gh,EthereumNetworkFee:gl,SupplyGas:ll,StarknetRegister:Al,Affix:uc,InteractiveAddress:ac,NetworkFeeEnter:Cl,ViewData:Ml,SectionWrap:cc,ModuleWrap:sc,TipMessage:wl,CoinSummary:Il,UtxoNetworkFeePanel:Nl,Mev:Dl,Layout:Ma,SwitchAddress:Hh}});var Hg=()=>{let r=(0,li.useHistory)(),{pathname:e}=(0,li.useLocation)(),t=(0,ct.useSelector)(Ha);return(0,ui.useCallback)(o=>{if(t&&e===`${tc}/swap`){r.replace(ec);return}o()},[t,e])},$D=()=>{let r=(0,ct.useDispatch)(),e=(0,ct.useSelector)($o),t=(0,ct.useSelector)(Ga),o=(0,ct.useSelector)(La),n=Tl(),i=(0,ct.useSelector)(Va),a=(0,ct.useSelector)(Na),c=(0,ct.useSelector)(sf),p=i.map(m=>{if(Qa(m.initialType)){m=(0,pi.cloneDeep)(m);try{delete m.account[zt],delete m.account[Qe]}catch{(0,pi.noop)()}}return m}),d=Hg(),h=Ll();return oc(()=>{R.updateGlobal({signAndSubmitTransaction:async(m,g,T)=>await sa({networkId:m,tx:g,hardwareExtParams:T,checkTxBeforePublish:h})})}),ui.default.createElement(Uh,{t:Xt,dispatch:r,onBack:d,currency:e,currentWallet:t,localeData:o,addressBookList:n,walletList:p,locale:a,walletInfo:c})};export{$D as default};
//! todo daiwei confirm it

window.inOKXExtension = true;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=dex-CD2VQFM2.js.map
