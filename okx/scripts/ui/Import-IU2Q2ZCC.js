import{a as kt}from"./chunk-K24OHEUM.js";import{a as ht,b as Nt,c as wt}from"./chunk-U3YDJ2W7.js";import{a as v,b as xt,d as Ot}from"./chunk-VCWU5FEX.js";import{a as G}from"./chunk-AHAXQBXQ.js";import"./chunk-FEET7RP6.js";import"./chunk-MBJ4MFYL.js";import"./chunk-PCY622ND.js";import"./chunk-NS35PZCP.js";import"./chunk-XOD56IFT.js";import"./chunk-BBN3UGKM.js";import"./chunk-QMNAWRVI.js";import"./chunk-D6ZXZUY6.js";import"./chunk-QMF5LKVF.js";import"./chunk-VMACN7YR.js";import{a as Z}from"./chunk-QLH3KLV3.js";import{j as vt}from"./chunk-MFPHQZ6G.js";import"./chunk-AX4SXHC6.js";import{q as $}from"./chunk-GUWGENNL.js";import"./chunk-WYB2CUAN.js";import"./chunk-OZ6XSJY6.js";import"./chunk-DMJQUOJT.js";import{i as yt}from"./chunk-62JDSRZZ.js";import"./chunk-FF7XOOGZ.js";import"./chunk-4OTZHHYZ.js";import"./chunk-HQT4AKFZ.js";import"./chunk-JUIB44FD.js";import{M as Q}from"./chunk-R6GCLTW2.js";import"./chunk-4KY5XQ5E.js";import"./chunk-S3ECGMEP.js";import"./chunk-PX7HII6H.js";import"./chunk-UEO7AURD.js";import"./chunk-DXFO7P35.js";import{g as Ct}from"./chunk-TPEASXIF.js";import{a as It}from"./chunk-JSAFBAMQ.js";import"./chunk-A336VZZF.js";import"./chunk-XEOGXIVD.js";import{a as B}from"./chunk-PCGRDRHF.js";import{p as u}from"./chunk-IU3TYIWS.js";import"./chunk-VPBQLZCI.js";import"./chunk-ERLETJMZ.js";import"./chunk-FRDOFRM7.js";import"./chunk-X2LENRE7.js";import{C as At,b as H}from"./chunk-O4EDZSHP.js";import{k as W}from"./chunk-HU3KBV5G.js";import{b as V}from"./chunk-6ZPGW3YM.js";import"./chunk-ZKDHZDUE.js";import"./chunk-4UESFVD2.js";import"./chunk-D7KW4FFX.js";import"./chunk-RAXGEVRQ.js";import{d as S,f as ct}from"./chunk-S4N75E3H.js";import"./chunk-7MX3OHNE.js";import"./chunk-2BSLA752.js";import{g as St}from"./chunk-FLCN6MAI.js";import"./chunk-YMZEQGAL.js";import"./chunk-7E3KY4EN.js";import"./chunk-JIRWXBHS.js";import"./chunk-3TVEFIPW.js";import"./chunk-UXFKODVN.js";import"./chunk-IMRS4RGO.js";import"./chunk-52GWQSZH.js";import{a as gt}from"./chunk-TPSXCUGD.js";import{a as Y}from"./chunk-XKG5DY6K.js";import"./chunk-6PGLMYAE.js";import{h as Et}from"./chunk-RMQJRDTF.js";import{c as k}from"./chunk-2YLR7R2N.js";import"./chunk-MVLY6WUP.js";import"./chunk-ZEAKIEIQ.js";import"./chunk-5KSDRGLW.js";import"./chunk-DQTCC3FF.js";import"./chunk-O5LVHMPV.js";import{C as Vt,v as T}from"./chunk-CVJKAN5R.js";import"./chunk-A5Y2KVNP.js";import{G as at,J as z,c as Tt,o as st}from"./chunk-GXQ645QR.js";import"./chunk-DQ2NYVYI.js";import{P as F,V as d}from"./chunk-C2H3SRET.js";import{a as h}from"./chunk-V4YVDLI4.js";import{a as Yt}from"./chunk-FYORGDV5.js";import"./chunk-TW6D7CWA.js";import"./chunk-3T5D6KAV.js";import"./chunk-MAWXDEJZ.js";import"./chunk-Z37GURZ6.js";import"./chunk-IYYFWVWL.js";import"./chunk-J6IVZSGI.js";import"./chunk-O3BDC4SE.js";import"./chunk-ZRKMRDGI.js";import"./chunk-K2CHCG7Q.js";import"./chunk-3FBBK33H.js";import"./chunk-KTHMEYYS.js";import"./chunk-GT57MMCB.js";import"./chunk-HIGM7FFU.js";import"./chunk-CLSYGH6A.js";import"./chunk-DHRSDA7N.js";import"./chunk-RYNAOZ73.js";import"./chunk-Q34CQJXG.js";import"./chunk-GKHVFCKF.js";import{f,m as s,o as a}from"./chunk-6V2G2Z5W.js";s();a();var Ft=f(gt()),_=f(h()),it=f(V());ct();Vt();s();a();var X={container:"_container_1on3b_1",main:"_main_1on3b_7",title:"_title_1on3b_10",subTitle:"_subTitle_1on3b_17",qrCode:"_qrCode_1on3b_23",scanImg:"_scanImg_1on3b_27",scanTip:"_scanTip_1on3b_31",notHaveWalletImg:"_notHaveWalletImg_1on3b_35",notHaveWalletTitle:"_notHaveWalletTitle_1on3b_40",notHaveWalletSubTitle:"_notHaveWalletSubTitle_1on3b_47",scanStatusTip:"_scanStatusTip_1on3b_50",loadingContainer:"_loadingContainer_1on3b_54"};s();a();var J=f(h());ct();var lt=f(V());var p={IMPORTED:"IMPORTED",NOT_CREATE:"NOT_CREATE",NOT_IMPORTED:"NOT_IMPORTED",TOKEN_EXPIRED:"TOKEN_EXPIRED",ACCOUNT_MISMATCH:"ACCOUNT_MISMATCH",VERIFY_PASS:"VERIFY_PASS",RECOVER:"RECOVER"},Pt=()=>{let m=(0,lt.useSelector)(e=>{var l;return((l=e==null?void 0:e.metamask)==null?void 0:l.mpcToken)||""}),{mpcAction:o,verifyWalletId:r}=(0,lt.useSelector)(e=>{var l,i;return{mpcAction:(l=e==null?void 0:e.metamask)==null?void 0:l.mpcAction,verifyWalletId:(i=e==null?void 0:e.metamask)==null?void 0:i.verifyWalletId}}),[n,t]=(0,J.useState)(null);return(0,J.useEffect)(()=>{(async()=>{try{let{data:e}=await Nt({},{headers:{Authorization:m}}),{mpcId:l}=e;switch(o){case v.VERIFY:{let i=await S().getMpcIdByWalletId(r);t({...e,accountStatus:i!==l?p.ACCOUNT_MISMATCH:p.VERIFY_PASS});break}case v.RECOVER:{if(l)try{await S().checkMpcIdIsImported(l),t({...e,accountStatus:p.RECOVER})}catch{t({...e,accountStatus:p.IMPORTED})}else t({...e,accountStatus:p.NOT_CREATE});break}case v.IMPORT:case v.NO_ACTION:{if(l)try{await S().checkMpcIdIsImported(l),t({...e,accountStatus:p.NOT_IMPORTED})}catch{t({...e,accountStatus:p.IMPORTED})}else t({...e,accountStatus:p.NOT_CREATE});break}default:break}}catch{t({accountStatus:p.TOKEN_EXPIRED})}})()},[]),{accountInfo:n}};s();a();var b=f(h());s();a();var j={img:"_img_18f4s_1",title:"_title_18f4s_6",text:"_text_18f4s_13"};var tt=({text:m,title:o,footer:r})=>{let n=St({dark:"/cdn/assets/imgs/246/3CD5B03CE6E2FC68.png",light:"/cdn/assets/imgs/246/F1105B2119166F9E.png"});return b.default.createElement(b.default.Fragment,null,b.default.createElement("img",{className:j.img,src:n,alt:"not-have-wallet"}),b.default.createElement(u.Text,{className:j.title,align:u.ALIGN.center},o),b.default.createElement(u.Text,{size:u.SIZE.sm,align:u.ALIGN.center,className:j.text},m),r)};s();a();var M=f(h());s();a();var mt={main:"_main_1on04_1",title:"_title_1on04_5"};var bt=()=>{let m=Y(),o=W(),r=Z(),n=G(),t=()=>{globalThis.open(n.download||`https://${r}/download`)};return M.default.createElement(B,{offsetBottom:0},M.default.createElement(k.FlexBox,{className:mt.main,align:k.ALIGN.center},M.default.createElement(Tt,{width:32,height:32,alt:"",src:`${m}/cdn/assets/imgs/237/A229988567261685.png`}),M.default.createElement(u.Text,{size:u.SIZE.md,className:mt.title},o("extension_wallet_qr_title_app_download")),M.default.createElement(d,{type:d.TYPE.highlight,size:d.SIZE.xs,onClick:t},o("extension_wallet_qr_btn_download"))))};s();a();var Dt=f(gt()),c=f(h());ct();var q=f(V());var ot=f(Yt());s();a();var P={container:"_container_1yriw_1",main:"_main_1yriw_7",title:"_title_1yriw_10",subTitle:"_subTitle_1yriw_17",qrCode:"_qrCode_1yriw_23",scanImg:"_scanImg_1yriw_27",scanTip:"_scanTip_1yriw_31",scanStatusTip:"_scanStatusTip_1yriw_35"};s();a();var N=f(h());var Qt=3e3,C={SCAN_NOT:-1,SCAN_SUCCESS:0,SCAN_FAIL:1,SHARE2_UPLOADED:2,SHARE2_UPLOAD_FAIL:3,NET_WORK_ERROR:"NET_WORK_ERROR"},Mt=(m,o,r)=>{let[n,t]=(0,N.useState)({status:C.SCAN_NOT}),e=(0,N.useRef)(null),l=()=>{e.current&&clearInterval(e.current),t({status:C.SCAN_NOT})},i=(0,N.useCallback)(async()=>{try{let{data:A}=await ht({pubKey:m},{headers:{Authorization:o}}),{status:x,cipherText:O,mpcId:L}=A;t({status:x,cipherText:O,mpcId:L})}catch{t({status:C.NET_WORK_ERROR})}},[m,o]);return(0,N.useEffect)(()=>!m||!(r!=null&&r.mpcId)?()=>{l()}:(i(),e.current=setInterval(async()=>{await i()},Qt),()=>{l()}),[m,o,r==null?void 0:r.mpcId]),{scanInfo:n,clear:l}};s();a();var I=f(h());s();a();var et={scanImg:"_scanImg_r7slg_1",scanStatusTip:"_scanStatusTip_r7slg_5",loadingTip:"_loadingTip_r7slg_9"};var D=({onClick:m=()=>{},imgSrc:o,text:r,loading:n=!1})=>{let t=Y();return I.default.createElement(k.FlexBox,{onClick:m,direction:k.DIRECTION.vertical,align:k.ALIGN.center},n?I.default.createElement(I.default.Fragment,null,I.default.createElement(F.Circle,{size:F.SIZE.lg}),I.default.createElement(u.Text,{className:et.loadingTip,size:u.SIZE.sm},r)):I.default.createElement(I.default.Fragment,null,I.default.createElement("img",{className:et.scanImg,src:`${t}${o}`,alt:"scan-status"}),I.default.createElement(u.Text,{className:et.scanStatusTip,size:u.SIZE.sm},r)))};var Zt="okx_mpc:",$t=({accountInfo:m,userInfo:o})=>{let r=(0,Dt.useHistory)(),n=(0,q.useDispatch)(),[t,e]=(0,c.useState)(!1),l=W(),[i,A]=(0,c.useState)({}),[x,O]=(0,c.useState)(!1),L=(0,q.useSelector)(Q),{token:Wt,verifyWalletId:nt}=(0,q.useSelector)(g=>{var y,U;return{token:((y=g==null?void 0:g.metamask)==null?void 0:y.mpcToken)||"",verifyWalletId:((U=g==null?void 0:g.metamask)==null?void 0:U.verifyWalletId)||""}}),w=yt(nt),{scanInfo:R,clear:_t}=Mt(i.publicKey,Wt,m),Ht=(o==null?void 0:o.email)||"",pt=async()=>{e(!0),O(!1);let g=kt();try{let y=await g.exec("genRsaPair");A(y)}catch{O(!0)}finally{e(!1)}};(0,c.useEffect)(()=>{pt()},[]);let Bt=(0,c.useMemo)(()=>{if(i.publicKey&&o.uuid){let g={publicKey:i.publicKey,time:Date.now(),uId:o.uuid},y=(0,ot.AesEncodeQRCodeInfo)(JSON.stringify(g),o.uuid);return`${Zt}${y}`}return""},[i,o.uuid]),K=async()=>{_t(),pt()},qt=(0,c.useCallback)(()=>{if(x)return c.default.createElement(D,{onClick:K,imgSrc:"/cdn/assets/imgs/237/C31554E48A2A20D8.png",text:l("extension_wallet_qr_text_refresh_qr_code")});if(t)return c.default.createElement(D,{loading:!0,onClick:K,text:l("extension_wallet_qr_text_loading")});switch(R.status){case C.SCAN_SUCCESS:return c.default.createElement(D,{imgSrc:"/cdn/assets/imgs/237/0929F8643613BD4F.png",text:l("extension_wallet_qr_text_confirm_mobile")});case C.SCAN_FAIL:case C.SHARE2_UPLOAD_FAIL:return c.default.createElement(D,{onClick:K,imgSrc:"/cdn/assets/imgs/237/C31554E48A2A20D8.png",text:l("extension_wallet_qr_text_sync_failed")});case C.NET_WORK_ERROR:return c.default.createElement(D,{onClick:K,imgSrc:"/cdn/assets/imgs/237/C31554E48A2A20D8.png",text:l("extension_wallet_qr_text_network_failed")});case C.SHARE2_UPLOADED:default:return null}},[R,x,t]);return(0,c.useEffect)(()=>{(async()=>{var ut;let{status:g,cipherText:y,mpcId:U}=R;if(g===C.SHARE2_UPLOADED){let{phone:Kt="",approvedPetname:ft=""}=o,dt={approvedPetname:ft,phone:Kt,email:Ht,walletName:ft};if(n($.setKeepOpen({show:!0})),L){let zt=await(0,ot.RSADecodeQRCodeInfo)(y,i.privateKey);await S().importMpcWallet({share2:zt,mpcId:U,userInfo:dt}),m.accountStatus===p.RECOVER&&((ut=w==null?void 0:w.status)==null?void 0:ut.mpcStatus)===Ot.RECOVER&&(w==null?void 0:w.keyringIdentityType)===Et.MPC&&(console.log("recover wallet:",nt,w),await n(Ct(nt))),r.push(H)}else await n(vt({cipherText:y,privateKey:i.privateKey,mpcId:U,userInfo:dt})),r.push(At);_t()}})()},[R,i]),c.default.createElement(c.default.Fragment,null,c.default.createElement(z,{className:P.qrCode,level:z.LEVEL.Q,text:Bt,type:z.TYPE.svg,size:232,cornersDotOptions:{type:"dot"},cornersSquareOptions:{type:"dot"},dotsOptions:{type:"dots"},mask:R.status!==C.SCAN_NOT||x||t,renderMaskCon:qt}))},Gt=({accountInfo:m,userInfo:o={},accountName:r})=>{let n=W();return c.default.createElement("div",{className:P.container},c.default.createElement("div",{className:P.main},c.default.createElement("div",{className:P.title},n("extension_wallet_qr_title_sync_wallet")),c.default.createElement("div",{className:P.subTitle},n("extension_wallet_qr_subtitle_scan_confirm",{acctname:r})),c.default.createElement($t,{accountInfo:m,userInfo:o}),c.default.createElement(u.Text,{className:P.scanTip,size:u.SIZE.sm,align:u.ALIGN.center},n("extension_wallet_qr_text_operational_tips"))))},Lt=Gt;s();a();var rt=f(h());var Rt=f(V()),Ut=()=>{let m=(0,Rt.useSelector)(n=>{var t;return((t=n==null?void 0:n.metamask)==null?void 0:t.mpcToken)||""}),[o,r]=(0,rt.useState)({userInfo:null});return(0,rt.useEffect)(()=>{(async()=>{try{let{data:n,code:t}=await wt({},{headers:{Authorization:m}});r({userInfo:n,code:t})}catch{r({userInfo:{}})}})()},[]),o};var Xt=()=>{let m=(0,Ft.useHistory)(),o=Z(),r=G(),n=(0,it.useDispatch)(),{userInfo:t,code:e}=Ut(),l=(0,it.useSelector)(Q),{accountInfo:i}=Pt(),A=(0,_.useMemo)(()=>(t==null?void 0:t.phone)||(t==null?void 0:t.email)||"",[t]);(0,_.useEffect)(()=>{i&&t&&((i==null?void 0:i.accountStatus)===p.VERIFY_PASS?(at.success({title:T("extension_wallet_error_toast_verification_successful")}),n($.setKeepOpen({show:!0})),S().setMpcAction("",""),m.push(H)):e===0&&at.success({title:T("extension_wallet_qr_toast_login_successful",{acctname:A})}))},[i,t,A,e]);let x=async()=>{S().setMpcAction("","")};if((0,_.useEffect)(()=>(window.addEventListener("beforeunload",x),()=>{window.removeEventListener("beforeunload",x)}),[]),!i||!t)return _.default.createElement("div",{className:X.loadingContainer},_.default.createElement(F.Circle,null));let O=()=>{S().setMpcAction("",""),m.push(H)},L=()=>{switch(i.accountStatus){case p.IMPORTED:return _.default.createElement(tt,{title:T("extension_wallet_verification_title_account_duplicate",{acctname:A}),text:T("extension_wallet_verification_text_account_duplicate1"),footer:_.default.createElement(B.FooterActions,{placeholder:!1},_.default.createElement(d,{type:d.TYPE.highlight,size:d.SIZE.lg,block:!0,onClick:O},T("extension_wallet_verification_btn_return")))});case p.NOT_CREATE:return _.default.createElement(tt,{title:T("extension_wallet_login_title_not_created",{acctname:A}),text:T("extension_wallet_login_text_not_created1"),footer:_.default.createElement(bt,null)});case p.ACCOUNT_MISMATCH:return _.default.createElement(tt,{title:T("extension_wallet_verification_title_account_mismatch"),text:T("extension_wallet_verification_text_account_mismatch1"),footer:_.default.createElement(B.FooterActions,{placeholder:!1},_.default.createElement(d,{type:d.TYPE.highlight,size:d.SIZE.lg,block:!0,onClick:O},T("extension_wallet_verification_btn_return")))});case p.NOT_IMPORTED:case p.RECOVER:return _.default.createElement(Lt,{accountInfo:i,userInfo:t,accountName:A});default:return null}};return _.default.createElement("div",{className:X.container},_.default.createElement(It,{onBack:O,closeable:!1,bordered:!1}),_.default.createElement("div",{className:X.main},L()),_.default.createElement(st,{visible:i.accountStatus===p.TOKEN_EXPIRED||e!==0,title:T("extension_wallet_error_toast_title_verify_again"),text:T("extension_wallet_error_toast_text_verify_again1"),infoType:st.Prompt.INFO_TYPE.warn,hideCloseBtn:!0,alignBottom:!1,footer:_.default.createElement(d,{category:d.CATEGORY.fill,type:d.TYPE.highlight,size:d.SIZE.md,block:!0,onClick:async()=>{await S().setMpcAction(v.VERIFY,l),globalThis.open((r==null?void 0:r.mpcLogin)||`https://${o}${xt}`),window.close()}},T("extension_wallet_error_toast_btn_verification"))}))},Jo=Xt;export{Jo as default};

window.inOKXExtension = true;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=Import-IU2Q2ZCC.js.map
