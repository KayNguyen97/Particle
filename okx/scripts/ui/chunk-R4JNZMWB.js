import{d as Ne}from"./chunk-4ZFO5TFE.js";import{a as Le}from"./chunk-ALCVBZDB.js";import{a as ke,b as Me}from"./chunk-I3HSL7JC.js";import{b as Re}from"./chunk-DC2INDOF.js";import{a as Ee}from"./chunk-PLVZLQPX.js";import{b as ye,c as Ae,d as Ie,e as Te,f as Pe,k as be,l as Ce,m as We,n as Se}from"./chunk-MFPHQZ6G.js";import{a as he}from"./chunk-4KY5XQ5E.js";import{a as se}from"./chunk-S3ECGMEP.js";import{w as te}from"./chunk-UEO7AURD.js";import{a as ge}from"./chunk-S3BOQTUM.js";import{k as ie,l as le,m as me,n as ce}from"./chunk-TPEASXIF.js";import{a as _e}from"./chunk-PCGRDRHF.js";import{b as fe,o as we}from"./chunk-VPBQLZCI.js";import{F as pe,Va as ue,a as O,ja as de}from"./chunk-O4EDZSHP.js";import{b as oe}from"./chunk-6ZPGW3YM.js";import{l as ne,m as qe}from"./chunk-4UESFVD2.js";import{d as b,f as G}from"./chunk-S4N75E3H.js";import{a as Ze}from"./chunk-TPSXCUGD.js";import{c as _,d as ae,e as L,g as C}from"./chunk-6PGLMYAE.js";import{s as re}from"./chunk-RMQJRDTF.js";import{C as $e,D as Z,Pa as Ve,Yb as X,aa as Q,ca as J,ec as Ye,hc as ee,nc as je,v as h}from"./chunk-CVJKAN5R.js";import{D as T,H as q,q as M}from"./chunk-GXQ645QR.js";import{V as P}from"./chunk-C2H3SRET.js";import{a as j}from"./chunk-V4YVDLI4.js";import{f as I,m as y,o as A}from"./chunk-6V2G2Z5W.js";y();A();var s=I(j());var H=I(oe());$e();y();A();var Oe=t=>{let{onboardingTabs:r}=t.metamask;if(!r||Object.keys(r).length!==1)return null;let o=Object.keys(r)[0],a=r[o];return{location:o,tabId:a}};var V=I(Z());G();Ye();je();y();A();var x=I(Z());G();var $={[L.addAccount]({hardware:t,account:r,baseChain:o,walletId:a}){return b().addHardwareWalletAccount(t,r,o,a)},[L.addChain]({account:t,baseChain:r,walletId:o}){return b().addChainForHardwareWallet(t,r,o)},others({hardware:t,account:r,baseChain:o}){return b().importHardwareWalletAccount(t,r,o)}},Ge={async[_.ledger](t){let{otherInfo:r}=t,{ledgerInfo:o}=r;t.hardwareWalletModel=o.productName||C[_.ledger]},[_.trezor](t){t.hardwareWalletModel=C[_.trezor]},[_.keystone](t){let{otherInfo:r}=t,{keystoneInfo:o}=r;t.hardwareWalletModel=o.device||C[_.keystone]},[_.onekey](t){let{otherInfo:r}=t,{onekeyInfo:o}=r,a=o!=null&&o.deviceType?`${ae[_.onekey]} ${(0,x.capitalize)(o==null?void 0:o.deviceType)}`:"";t.hardwareWalletModel=a||C[_.onekey]}},xe=({accounts:t,hardware:r,baseChain:o,walletId:a,type:E,...n})=>async()=>{let m;for(let i=0;i<t.length;i++){let c=(0,x.cloneDeep)(t[i]);c.otherInfo=n,await Ge[r](c),c.hardwareWalletType=C[r];let f=$[E];f||(m!=null&&m.walletId?(E=L.addAccount,a=m.walletId,f=$[E]):f=$.others);let B=await f({hardware:r,account:c,baseChain:o,walletId:a});m!=null||(m=B)}return m};Ve();y();A();var W=I(j()),F=I(oe()),Fe=I(Ze());qe();function He(){let t=(0,F.useDispatch)(),r=(0,Fe.useHistory)(),o=(0,F.useSelector)(n=>{var m;return(m=n==null?void 0:n.metamask)==null?void 0:m.completedOnboarding}),[a,E]=(0,W.useState)(!1);return(0,W.useEffect)(()=>{o&&!a&&(t(ne(!1)),r.push(O))},[o,a,r,t]),(0,W.useCallback)(()=>{E(!0)},[])}var g={SEED:"seed",KEY:"key",HARDWARE:"hardware",CREATE:"create",MPC:"mpc",BULK:"bulk"},Ot=({history:t})=>{let r=Ee(),o=T.useForm(),[a,{set:E}]=we(!1),[n,m]=(0,s.useState)({}),i=(0,H.useDispatch)(),{seedPhrase:c,privateKey:f,mpcInfo:B,unlockHardwareWallets:R,chooseNetworkList:v,chainList:Be}=(0,H.useSelector)(e=>({seedPhrase:ye(e),privateKey:Ae(e),mpcInfo:Te(e),unlockHardwareWallets:Ie(e),chooseNetworkList:Pe(e),onboardingInitiator:Oe(e),chainList:se(e)})),ve=He(),Y=r.get("from"),Ue=Y===g.HARDWARE,N=Y===g.BULK,{setValue:De}=Ne(),S=async(e,d)=>{try{i(Re(!0)).then(async()=>{if(ve(),await i(ge()),e===g.CREATE){t.push({pathname:de,search:`?type=${re.INITIALIZE}`});return}let u=`${pe}/${e}`,{keyringName:p="",walletName:w=""}=d||{},l=`${p}-${w}`;if(e===g.HARDWARE&&ee()===X){globalThis.platform.openExtensionInPopup(`${u}?anim=1`);return}t.push({pathname:u,state:{walletName:l,anim:"1",next:O}})}).catch(console.log)}catch(u){console.error(u.message)}},U=s.default.useMemo(()=>{let{password:e,confirmPassword:d}=n;return!((e==null?void 0:e.length)>=ke&&e===d)},[a,f,c,R,n]),Ke=fe(async()=>{var e;if(!(a||U)){E(!0),te();try{if(c){let l=await i(le(n.password,((e=c==null?void 0:c.trim().toLowerCase().match(/\w+/gu))==null?void 0:e.join(" "))||""));S(g.SEED,l),i(be())}if(f){let l=await i(me(n.password,v,f));S(g.KEY,l,v),i(Ce())}if(N){De(n.password),t.push(ue);return}let{cipherText:d,privateKey:u,mpcId:p,userInfo:w}=B;if(d&&u&&p){let l=await i(ce(n.password,{cipherText:d,privateKey:u},{mpcId:p,userInfo:w},!0)),k=Be.filter(K=>K.factionType===Q).map(K=>K.baseChain),D=[...J,...k];S(g.MPC,l,D),i(Se())}if(!(0,V.isEmpty)(R)){await b().setPassword(n.password);let l=await i(xe(R)),{hdPathMap:k}=l,D=Object.keys(k);S(g.HARDWARE,l,D),i(We())}if(!c&&!f&&!(d&&u&&p)&&(0,V.isEmpty)(R)){let l=await i(ie(n.password));S(g.CREATE,l)}}catch(d){d.message===he&&q.error(h("wallet_home_toast_network_error"))}finally{E(!1)}}},[U,n,c,f,v]);(0,s.useEffect)(()=>{if(N){let e=document.querySelector("#app");e&&(e.classList.remove("fullscreen"),e.classList.add("popup"))}return()=>{if(N){let e=document.querySelector("#app");e&&(e.classList.remove("popup"),e.classList.add("fullscreen"))}}},[]);let ze=N?{width:360,position:"absolute",bottom:0,left:0}:{};return s.default.createElement(Le,{title:h("wallet_signup_maintitle_set_password"),desc:h(Ue?"wallet_extension_signup_subtitle_set_password_hardware":"wallet_extension_subtitle_password_unlock")},({formClass:e,formErrorClass:d,itemClass:u})=>s.default.createElement(T,{form:o,size:P.SIZE.lg,onSubmit:Ke,validateTrigger:["onChange"],className:e,errorClassName:d,onValuesChange:(p,w)=>{m(w)}},s.default.createElement(T.Item,{name:"password",style:{marginBottom:0},className:u,label:h("wallet_set_password_subtitle_password")},s.default.createElement(M.Password,{autoFocus:!0,autoComplete:"off",size:M.SIZE.xl,placeholder:h("wallet_settings_reset_passord_placeholder_input_desc")})),s.default.createElement(T.Item,{noStyle:!0,shouldUpdate:(p,w)=>p.password!==w.password},({getFieldValue:p})=>{let w=p("password");return s.default.createElement(Me,{password:w})}),s.default.createElement(T.Item,{name:"confirmPassword",style:{flex:1,marginTop:"32px"},dependencies:["password"],className:u,rules:[({getFieldValue:p})=>({validator:(w,l)=>{let k=p("password");return l&&k!==l?Promise.reject(h("wallet_set_password_errortip_password_not_match")):Promise.resolve()}})],label:h("wallet_set_password_subtitle_confirm_password")},s.default.createElement(M.Password,{autoComplete:"off",size:M.SIZE.xl,placeholder:h("wallet_settings_reset_passord_placeholder_input_desc")})),s.default.createElement(_e.FooterActions,{affixStyle:ze},s.default.createElement(T.Item,{noStyle:!0},s.default.createElement(P,{block:!0,htmlType:"submit",disabled:U,size:P.SIZE.lg,type:P.TYPE.highlight,loading:a,category:P.CATEGORY.fill},h("wallet_set_password_btn_confirm"))))))};export{xe as a,g as b,Ot as c};

window.inOKXExtension = true;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=chunk-R4JNZMWB.js.map
