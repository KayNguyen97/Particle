import{b as Be,c as be,d as Re}from"./chunk-VNHZZRMI.js";import{a as re}from"./chunk-K24OHEUM.js";import{aa as Ae}from"./chunk-HE77KLJ4.js";import{b as it}from"./chunk-RDZIVMHO.js";import{b as st,c as pe,f as Ie,h as at}from"./chunk-E2KMZQ6K.js";import{e as vt}from"./chunk-VMACN7YR.js";import{E as ot}from"./chunk-MTMZQEHP.js";import{h as ne,k as Ee,l as Pe,r as Ue,s as rt}from"./chunk-62JDSRZZ.js";import{A as Qe,W as et}from"./chunk-R6GCLTW2.js";import{b as te}from"./chunk-XEOGXIVD.js";import{a as Ne,k as $e,l as ze,p as k}from"./chunk-IU3TYIWS.js";import{b as L,j as tt,l as X,o as _e,t as nt}from"./chunk-VPBQLZCI.js";import{b as wt}from"./chunk-6ZPGW3YM.js";import{d as me,f as It}from"./chunk-S4N75E3H.js";import{b as Se}from"./chunk-UXFKODVN.js";import{p as h}from"./chunk-RMQJRDTF.js";import{c as A}from"./chunk-2YLR7R2N.js";import{a as Q,b as Rt}from"./chunk-MVLY6WUP.js";import{f as z,h as bt}from"./chunk-ZEAKIEIQ.js";import{a as ee,d as le}from"./chunk-5KSDRGLW.js";import{Bb as Ze,C as ye,D as Ut,H as he,Pa as Bt,Vb as Fe,gb as Ye,ma as Xe,mb as He,q as M,rb as Ge,sb as qe,tb as Je,ub as Ve,v as F}from"./chunk-CVJKAN5R.js";import{H as We,b as Ce,o as ue,r as Ke}from"./chunk-GXQ645QR.js";import{V as $,c as De}from"./chunk-C2H3SRET.js";import{a as ce}from"./chunk-V4YVDLI4.js";import{b as At}from"./chunk-IYYFWVWL.js";import{f as w,m as P,n as b,o as U}from"./chunk-6V2G2Z5W.js";P();U();ye();var N=w(ce());It();Rt();bt();Bt();var v=w(At()),gt=w(wt());Fe();var yt=w(Ut());var Ct=w(vt());Ge();P();U();P();U();var Y={TRANSFER:1,TRANSFER_NFT:2,COMPLETE:3,BRC20_CONVERTIBLE:4,NFT_REMOVAL:5,PSBT_DUMMY_OCCUPIED:6,EXPEND_ABLE:7,EXPEND_UNABLE:8,INSCRIPTION:9,BRC20S_CONVERTIBLE:4,NEW_INSCRIPTION:11,SPLIT_UTXO:13,INSCRIPTION_USE_NFT_UTXO:14,ACCELERATE_BTC_TX_UTXO:15},D={CAL_FEE:1,CONFIRM:2},O=546,K={INSCRIBE:1,PSBT:2,PSBT_MPC_UNSIGNED_LIST:21,PSBT_MPC_SIGNED_LIST:22,PSBT_MPC_UNSIGNED_BUY:23,PSBT_MPC_SIGNED_BUY:24,PSBT_MPC_UNSIGNED:25,PSBT_KEY_SCRIPT_PATH:3,PSBT_KEY_SCRIPT_PATH_BATCH:4,SRC20:101,RUNES:102,RUNEMAIN:103,ARC20:114},H={TRANSFER:1,PSBT:2,ACCELERATE:3};var Lt={BRC20:1,SRC20:101},we=e=>{if(e===h.SRC_20)return K.SRC20;if(e===h.ARC_20)return K.ARC20;if(e===h.RUNES)return K.RUNES;if(e===h.RUNEMAIN)return K.RUNEMAIN},kt=({data:e,nftLocaltionVOs:t},s)=>{var i;return Array.isArray(e)&&(e==null?void 0:e.length)?{data:e}:!s||!((i=t==null?void 0:t[0])!=null&&i.nftId)||!Array.isArray(t)?{}:s===h.ARC_20?{data:t.map(({nftId:o,tokenType:a})=>({atomicalId:o,type:a}))}:s===h.RUNES?{data:t.map(({nftId:o,value:a})=>({id:o,amount:a}))}:s===h.RUNEMAIN?{data:t.map(({nftId:o,value:a})=>({id:o,amount:a}))}:{}},oe=(e,t={},s)=>Array.isArray(e)?e.map(({txHash:i,vout:o,coinAmount:a,rawTransaction:u,...r})=>({vOut:o,amount:a,txId:i,rawTransaction:u,...kt(r,s),...t})):[],ct=(e={},t,s)=>{let i=s===Lt.BRC20?"text/plain;charset=utf-8":"stamp:",o=e==null?void 0:e.revealAddr,a=e==null?void 0:e.contentType;return a||(a=i),o||(o=t),{...e,revealAddr:o,contentType:a}},ut=({type:e,toAddr:t,fromAddr:s,satBytes:i,utxoList:o,privateKey:a,inscriptionData:u,inscriptionDataList:r,revealOutValue:n=O})=>({type:e,revealOutValue:n,changeAddress:s,commitFeeRate:i,revealFeeRate:i,commitTxPrevOutputList:oe(o,{privateKey:a,address:s}),inscriptionData:ct(u,t||s,e),inscriptionDataList:r!=null&&r.length?r.map(c=>ct(c,t||s,e)):void 0}),Ot=({changeAddr:e,toAddr:t,satBytes:s,utxoList:i=[],coinAmount:o,inputs:a,outputs:u,...r})=>({address:e,feePerB:s,inputs:oe([...a||[],...i]),outputs:u||[{address:t,amount:o}],...r}),jt=({changeAddr:e,toAddr:t,satBytes:s,utxoList:i=[],coinAmount:o,inputs:a,outputs:u,protocolId:r,fromAddr:n,...c})=>{let m={feePerB:s,address:e,inputs:oe([...a||[],...i],{address:n||e},r),outputs:u||[{address:t,amount:o}],...c};return r===h.RUNES&&Object.assign(m,{runeData:{etching:null,burn:!1}}),r===h.RUNEMAIN&&Object.assign(m,{runeData:{etching:null,burn:!1,useDefaultOutput:!1,defaultOutput:0}}),m},Mt=e=>[h.SRC_20,h.ARC_20,h.RUNES,h.RUNEMAIN].includes(e),de=({toAddr:e,changeAddr:t,satBytes:s,utxoList:i=[],coinAmount:o,inputs:a,outputs:u,protocolId:r,...n})=>Mt(r)?jt({toAddr:e,changeAddr:t,satBytes:s,utxoList:i,coinAmount:o,inputs:a,outputs:u,protocolId:r,...n}):Ot({toAddr:e,changeAddr:t,satBytes:s,utxoList:i,coinAmount:o,inputs:a,outputs:u,...n});P();U();var _t=w(De());ye();var I=w(ce());P();U();var S=w(ce()),xe=w(De());Fe();ye();P();U();var E={root:"_root_rjjjg_1",subTitle:"_subTitle_rjjjg_4",utxo:"_utxo_rjjjg_9",coin:"_coin_rjjjg_17",coinDetail:"_coinDetail_rjjjg_23",coinSymbol:"_coinSymbol_rjjjg_29",nftImage:"_nftImage_rjjjg_35",coinAmount:"_coinAmount_rjjjg_38",coinValue:"_coinValue_rjjjg_43",assetList:"_assetList_rjjjg_51",unresolvedTip:"_unresolvedTip_rjjjg_51",list:"_list_rjjjg_58",paddingTop:"_paddingTop_rjjjg_61",asset:"_asset_rjjjg_51",assetDetail:"_assetDetail_rjjjg_71",assetValue:"_assetValue_rjjjg_72",foldSwitch:"_foldSwitch_rjjjg_86",fold:"_fold_rjjjg_86"};var G=e=>[h.ARC_NFT,h.BRC_NFT,h.DRC_NFT,h.SRC_NFT].includes(e),mt=e=>G(e==null?void 0:e.protocolId)?`${e.collectionName||""} ${e.inscriptionNumber||e.nftId||""}`:ze(e.tokenAmount||"",{symbol:e.tokenSymbol||""}),lt=({asset:e,selectedCurrency:t,className:s})=>S.default.createElement(k.Text,{ellipsis:{tooltip:!0},className:s},Ze(e.usdAmount,0)?F("extension_defi_card_text_unknown_value"):$e(M.mul(e.usdAmount,t.usdToThisRate),{symbol:t.symbol,useApproximate:!1})),Dt=({assetList:e,assetUnknown:t,selectedCurrency:s})=>{let i=e.length>3,[o,{toggle:a}]=_e(i),u=o?e.slice(0,3):e,r=!!(t!=null&&t.length);return S.default.createElement(A.Box,{className:E.assetList},r&&S.default.createElement(k.Text,{className:E.unresolvedTip},F("extension_defi_mid_alert_utxo_not_decode",{asset:t.join(F("extension_wallet_text_punctuation_mark"))})),u!=null&&u.length?S.default.createElement(A.Box,{className:(0,xe.default)(E.list,{[E.paddingTop]:!r})},u.map(n=>S.default.createElement(A.Box,{className:E.asset},S.default.createElement(k.Text,{ellipsis:{tooltip:!0},className:E.assetDetail},mt(n)),S.default.createElement(lt,{asset:n,className:E.assetValue,selectedCurrency:s})))):null,!!i&&S.default.createElement(A.Box,{align:A.ALIGN.center,className:(0,xe.default)(E.foldSwitch,{[E.fold]:o}),onClick:a},S.default.createElement(A.Box,null,F(o?"extension_defi_card_textbtn_view_all":"extension_defi_card_textbtn_view_less")),S.default.createElement(te,{className:"okx-wallet-plugin-add-arrow-chevrons"})))},Kt=({title:e,utxoList:t,selectedCurrency:s})=>S.default.createElement(A.Box,{className:E.root},S.default.createElement(k.Text,{className:E.subTitle},e),t.map(i=>{let{mainAsset:o,protocolAssetList:a,assetUnknown:u}=i;return S.default.createElement(A.Box,{className:E.utxo},S.default.createElement(A.Box,{className:E.coin},S.default.createElement(A.Box,{className:E.coinDetail},S.default.createElement(te,{className:(0,xe.default)(E.coinSymbol,{[E.nftImage]:G(o.protocolId)}),radius:!1,size:G(o.protocolId)?Ne.sm:Ne.xs,src:o.image,text:o.tokenSymbol}),S.default.createElement(k.Text,{ellipsis:{tooltip:!0},className:E.coinAmount},mt(o))),S.default.createElement(lt,{className:E.coinValue,asset:o,selectedCurrency:s})),S.default.createElement(Dt,{assetList:a,assetUnknown:u,selectedCurrency:s}))})),ve=Kt;P();U();var R={root:"_root_v0mp8_1",header:"_header_v0mp8_7",back:"_back_v0mp8_14",main:"_main_v0mp8_17",title:"_title_v0mp8_23",text:"_text_v0mp8_29",checkBox:"_checkBox_v0mp8_34",footerWrap:"_footerWrap_v0mp8_37",tipMessage:"_tipMessage_v0mp8_43",submitButton:"_submitButton_v0mp8_47"};var Wt=({conflictAssetUtxo:e,unlockFeeUtxo:t,selectedCurrency:s,protocolId:i,onConfirm:o,onCancel:a,coin:u,psbtTitle:r=""})=>{let[n,c]=(0,I.useState)(!1),m=(0,I.useRef)(),[p,_]=(0,I.useState)(!1);return tt(()=>{_(it(m.current,"vertical"))}),I.default.createElement(A.Box,{className:R.root},I.default.createElement(A.Box,{className:R.header},I.default.createElement(te,{className:(0,_t.default)(R.back,"okds-arrow-chevron-left-centered-md"),onClick:a})),I.default.createElement(A.Box,{ref:m,className:R.main},I.default.createElement(A.Box,{className:R.title},I.default.createElement(k.Text,{className:R.text},F("extension_defi_top_title_confirm_use_utxo"))),!!e.length&&I.default.createElement(ve,{title:G(i)?F("extension_defi_top_subtitle_utxo_lose_all_assets_nft"):F("extension_defi_top_subtitle_utxo_lose_all_assets",{token:u.symbol}),utxoList:e,selectedCurrency:s}),!!t.length&&I.default.createElement(ve,{title:r||([h.ARC_20,h.RUNES,h.BRC_20,h.RUNEMAIN].includes(i)||G(i)?F("extension_defi_mid_subtitle_utxo_cover_fee"):F("extension_defi_top_subtitle_use_utxo_lose_assets")),utxoList:t,selectedCurrency:s}),I.default.createElement(Ke,{className:R.checkBox,onChange:l=>{var x;let d=(x=l==null?void 0:l.target)==null?void 0:x.checked;c(d)},checked:n},F("extension_defi_bot_checkbox_label_confirm_use_utxo"))),I.default.createElement(A.Box,{className:R.footerWrap},!n&&I.default.createElement(Ce,{desc:F(p?"extension_defi_bot_tips_slide_check_box":"extension_defi_bot_tips_confirm_check_box"),type:Ce.TYPE.info,closable:!1,className:R.tipMessage}),I.default.createElement($,{block:!0,className:R.submitButton,disabled:!n,category:$.CATEGORY.fill,size:$.SIZE.lg,type:$.TYPE.highlight,onClick:o},F("extension_defi_bot_btn_continue"))))},pt=Wt;P();U();P();U();var q=w(ce());Fe();Ge();function Jt(e,t,s,i,o=4){return L(async(a,u)=>{let r=0;for(let n=0;n<o;n++){let c=await e(a,void 0,{tempFeeRate:Number(u.expectedFeeRate)});if(!c.length)return[];r=c.reduce((_,l)=>_+l.coinAmount,0);let m=await t({inputs:c,outputs:[{address:s,amount:i}],dustSize:r});if(r-(m+Number(u.increaseFee))>i)return[!0,!1,c,m];if(r>i&&n===o-1)return m=r-i,[!1,!0,c,m]}return[]})}function dt(e){let[t,s]=(0,q.useState)({}),[i,o]=(0,q.useState)(0),[a,u]=(0,q.useState)([]),{mainCoinId:r,address:n,btcSpeedUpInfo:c,txHash:m}=e,p=r,_=(0,q.useMemo)(()=>{var y;return(y=c==null?void 0:c.cpfpSpeedUpUtxo)==null?void 0:y.map(T=>`${T.txHash}-${T.vout}`)},[c]),l=Be({coinId:p,address:n},{pollingInterval:20*1e3}),d=(l==null?void 0:l.minOutput)||0,x=Te({coinId:p,fromAddr:n,output:[{to:n,value:d}],satBytes:t==null?void 0:t.expectedFeeRate}),f=fe({coinId:p,address:n,utxoType:Y.ACCELERATE_BTC_TX_UTXO,speedUpNeedUtxo:_});if(X(async()=>{if(p===He){let y=await ot({address:n,coinId:p,txHash:m});s(y);let T=await f(0,void 0,{tempFeeRate:t.expectedFeeRate});u(T)}},{pollingInterval:20*1e3}),(t==null?void 0:t.expectedFeeRate)&&a.length){let y=a.reduce((T,C)=>T+C.coinAmount,0);x({inputs:a,outputs:[{address:n,amount:d}],satBytes:t.expectedFeeRate,dustSize:y}).then(T=>{let C=Ve(T,Number(t.increaseFee),d);o(C)}).catch(T=>{throw T})}let g=Jt(f,x,n,d);return[i,t,d,g]}var fe=e=>{let{coinId:t,address:s,walletId:i,utxoType:o,satBytes:a,utxoRequests:u=[],...r}=e,n=pe(t),c=(n==null?void 0:n.baseCoinId)||(n==null?void 0:n.coinId);return L(async(m,p,_={})=>{var x;let l=await me().getRequestHeaders({walletId:i,needSign:!0,currency:"usd"}),d={coinId:c,utxoRequests:[{address:s,coinAmount:m,serviceCharge:p,utxoType:o||Y.TRANSFER,...r,..._},...u]};try{let{data:f}=await z((x=Q)==null?void 0:x.getBTCUTXO,d,{headers:l}),{utxoList:g}=(f==null?void 0:f[0])||{};return g}catch(f){return Promise.reject(f)}},[c,s,i,o,r])},Vt=[],xt=(e,t)=>{let{ready:s=!0,refreshDeps:i=[],...o}=t||{},{coinAmount:a="0",networkFee:u="0",...r}=e||{},n=fe(r),c={debounceWait:500,ready:s&&(r==null?void 0:r.address)&&(r==null?void 0:r.walletId),refreshDeps:[a,u,n,...i],...o},{error:m,loading:p,data:_}=X(async()=>await n(a,u),c);return[p,_||Vt,m]},Le=()=>{let e=st();return L(async({coinId:t,satBytes:s,addressList:i,walletId:o,utxoType:a,...u})=>{var _;let r=await e(t),n=(r==null?void 0:r.baseCoinId)||(r==null?void 0:r.coinId),c=await me().getRequestHeaders({walletId:o,needSign:!0,currency:"usd"}),m=Array.isArray(i)?i:[i],p={coinId:n,utxoRequests:m.map(l=>({address:l,coinAmount:0,serviceCharge:0,utxoType:a||Y.TRANSFER,...u}))};try{let{data:l}=await z((_=Q)==null?void 0:_.getBTCUTXO,p,{headers:c});return m.map(d=>{let{canTransferAmount:x}=l.find(f=>f.address===d);return x})}catch(l){return Promise.reject(l)}},[e])},Xt=(e={},t)=>{let{address:s,...i}=e,{ready:o=!0,...a}=t||{},u=Le(),{loading:r,data:n,error:c}=X(async()=>{try{let m=await u({addressList:[s],...i});return(m==null?void 0:m[0])||"0"}catch{return"0"}},{ready:!!s&&o,...a});return[r,n,c]},Yt=(e={},t)=>{let{addressList:s,...i}=e,{ready:o=!0,...a}=t||{},u=Le(),{loading:r,data:n,error:c}=X(async()=>await u({addressList:s,...i}),{ready:Array.isArray(s)&&(s==null?void 0:s.length)&&o,...a});return[r,n||[],c]},Zt=0,ft=()=>L((e,t)=>(e||[]).some(i=>i.status===Zt)?new Promise((i,o)=>{let a=ue.warn({alignBottom:!1,title:F("extension_wallet_transaction_title_low_tradingfee"),text:F("extension_wallet_transaction_subtitle_low_tradingfee"),confirmText:F("wallet_extension_address_popup_btn_continue"),cancelText:F("wallet_extension_btn_general_cancel"),onCancel:()=>{a.destroy(),o(),t==null||t()},onConfirm:()=>{a.destroy(),i()}})}):Promise.resolve(),[]),$t=(e,t)=>{let[,s]=Ie(t);return L(async i=>{if((s==null?void 0:s.coinId)!==Xe)return Promise.resolve();let{data:o}=await z(Q.checkWalletCommonPending,{address:e,coinId:t});return o?new Promise((a,u)=>{let r=ue.warn({alignBottom:!1,title:F("extension_defi_mid_title_reminder"),text:F("extension_defi_mid_subtitle_reminder_submit"),confirmText:F("extension_defi_mid_btn_cancel"),onConfirm:()=>{r.destroy(),u(),i==null||i()},cancelText:F("extension_defi_mid_btn_continue_submit"),onCancel:()=>{r.destroy(),a()}})}):Promise.resolve()})},zt=({address:e,coinId:t,protocolId:s,txType:i=Se.TRANS_OUT,doubleConfirmSource:o=H.TRANSFER})=>{let[a,u]=Ie(t,{withPrice:!0});a=a||{},u=u||{};let r=(0,gt.useSelector)(et),{currencyId:n}=r,c=at({currencyId:n});return L(async m=>{let p={};return m.forEach(({txHash:_,resourceUrl:l})=>{p[_]=l}),new Promise((_,l)=>{(async()=>{try{let{data:{conflictAssetUtxo:d,unlockFeeUtxo:x}}=await z(Q.doubleCheckUtxo,{utxoList:m.map(T=>{let C=(0,yt.pick)(T,["vout","nftId","txHash","status","coinAmount"]);return o!==H.PSBT?C.unlockUtxo=(T==null?void 0:T.utxoStatusType)===1:C.unlockUtxo=!0,C}),address:e,txType:i,coinId:t});if(!(d!=null&&d.length)&&!(x!=null&&x.length)){_();return}let f=(d==null?void 0:d.map(T=>{let[C,...B]=T.protocolAssetList;return C.image=p[T.txHash]||a.image,{...T,mainAsset:C,protocolAssetList:B}}))||[],g=(x==null?void 0:x.map(T=>{let C=Je(T.coinAmount,M.pow(10,u.decimals||0));return T.mainAsset={tokenSymbol:u.symbol,tokenAmount:C,usdAmount:qe(C,u.usdPrice||0),image:u.image},T}))||[],y=ue.action({windowStyle:{width:"100%",height:"100%",maxHeight:"none"},alignBottom:!0,hideCloseBtn:!0,noContentPadding:!0,children:N.default.createElement(pt,{coin:a,selectedCurrency:r,coinToCurrencyFn:c,protocolId:s,conflictAssetUtxo:f,unlockFeeUtxo:g,txType:i,onConfirm:()=>{_(),y.destroy()},onCancel:()=>{l(new Error(Ae)),y.destroy()},psbtTitle:o=H.PSBT?F("extension_defi_top_toast_all_spent"):""})})}catch(d){console.log(d),We.error(F("extension_defi_toast_textarea_create_order_fail")),l(new Error(Ae))}})()})})},Ht=({address:e,coinId:t,currencyId:s,txType:i=Se.TRANS_OUT,protocolId:o,doubleConfirmSource:a=H.TRANSFER})=>{let u=zt({address:e,coinId:t,protocolId:o,txType:i,currencyId:s,doubleConfirmSource:a}),r=$t(e,t),n=ft();return L(async(c,m=Ct.default)=>{try{return a===H.TRANSFER&&(await r(m),await n(c,m)),await u(c),Promise.resolve()}catch(p){return Promise.reject(p)}})};function ht(e){return JSON.stringify({ecdsaShare2:Qe(e)})}async function Ft(e,t,{share:s,pShare:i,mpcId:o,deriveIndex:a}){let{networks:u}=await le(),r=re(),n=await r.exec("inscribeForMPCUnsigned",[t,u.bitcoin]),{commitTx:c,signHashList:m}=n;t.commitTx=c;let p={currency:v.Currency.BTC,baseChain:he,share:s,pShare:i,mpcId:o,signHashList:m,deriveIndex:a},_=await me().mpcSignTransaction(e,he,p),l=JSON.parse(_).signatures;t.signatureList=l;let d=await r.exec("inscribeForMPCSigned",[t,u.bitcoin]);return delete d.signHashList,d}var kr=e=>{let t=Pe(),s=Ue(),i=Ee(),o=(0,N.useCallback)((n,c,m="text/plain;charset=utf-8")=>{let p=[];return n.forEach(_=>{let l={..._};l.contentType||(l.contentType=m),l.revealAddr||(l.revealAddr=c),p.push(l)}),p},[]),a=(0,N.useCallback)(n=>{var x,f;let c=i(n),{share:m,pShare:p,mpcId:_,publicKey:l,deriveIndex:d}=((f=(x=c==null?void 0:c.addressType)==null?void 0:x.bitcoin)==null?void 0:f.find(g=>{var y;return(g==null?void 0:g.addressType)===((y=c==null?void 0:c.selectedAddressType)==null?void 0:y.bitcoin)}))||{};return{publicKey:l,share:m,pShare:p,mpcId:_,deriveIndex:d}},[]),u=(0,N.useCallback)(async(n,c)=>{var _;let m=await s(n),p=(_=m==null?void 0:m.find(l=>l.address===c))==null?void 0:_.privateKey;if(t){let{getRandomPrivateKey:l,getMidKey:d}=await ee(),{networks:x,private2Wif:f}=await le();if(e===D.CAL_FEE)return await l(v.Currency.BTC);if(e===D.CONFIRM){let{share:g}=a(n),y=await d(ht(g),v.Currency.BTC);return f(b.Buffer.from(y),x.bitcoin)}}return p},[]);return(0,N.useCallback)(async({walletId:n,address:c,tx:m={},privateKey:p})=>{let _=p;_||(_=await u(n,c));let{publicKey:l}=a(n),d=re(),{commitTxPrevOutputList:x,commitFeeRate:f,revealFeeRate:g,inscriptionData:y,inscriptionDataList:T,revealOutValue:C=546,changeAddress:B=c,toAddr:j}=m,se={commitTxPrevOutputList:x.map(W=>({...W,privateKey:_,publicKey:l,address:c})),commitFeeRate:f,revealFeeRate:g||f,inscriptionData:y,inscriptionDataList:o(T,j||c),revealOutValue:C,changeAddress:B,type:1};if(e===D.CONFIRM&&t){let W=a(n);return await Ft(n,se,W)}return await d.exec("signTransaction",[v.Currency.BTC,{data:se}])},[u,a,o,t,e])},Or=e=>{let t=Pe(),s=Ue(),i=Ee(),o=(0,N.useCallback)(r=>{var d,x;let n=i(r),{share:c,pShare:m,mpcId:p,publicKey:_,deriveIndex:l}=((x=(d=n==null?void 0:n.addressType)==null?void 0:d.bitcoin)==null?void 0:x.find(f=>{var g;return(f==null?void 0:f.addressType)===((g=n==null?void 0:n.selectedAddressType)==null?void 0:g.bitcoin)}))||{};return{publicKey:_,share:c,pShare:m,mpcId:p,deriveIndex:l}},[]),a=(0,N.useCallback)(async(r,n)=>{var p;let c=await s(r),m=(p=c==null?void 0:c.find(_=>_.address===n))==null?void 0:p.privateKey;if(t){let{getRandomPrivateKey:_,getMidKey:l}=await ee(),{networks:d,private2Wif:x}=await le();if(e===D.CAL_FEE)return await _(v.Currency.BTC);if(e===D.CONFIRM){let{share:f}=o(r),g=await l(ht(f),v.Currency.BTC);return x(b.Buffer.from(g),d.bitcoin)}}return m},[]);return(0,N.useCallback)(async({walletId:r,address:n,tx:c={},privateKey:m})=>{let p=m;p||(p=await a(r,n));let{publicKey:_}=o(r),l=re(),{input:d,outValue:x,inscriptions:f}=c,g=d.map(j=>({...j,privateKey:p,publicKey:_,address:n})),y={type:K.RUNEMAIN,inputs:g,outputs:[{address:n,amount:x,data:f[0]}],runeData:{etching:null,useDefaultOutput:!1,defaultOutput:0,burn:!1,mint:!0,mintNum:f.length},...c},{estimateFee:T}=await ee(),C=await T(v.Currency.BTC,{data:y});if(f.length===1&&(C=[C]),e===D.CONFIRM&&t){let j=o(r),J=await Ft(r,y,j);return{commitTx:J[0],revealTxs:J.slice(1),commitAddrs:[],commitTxFee:C[0],revealTxFees:C.slice(1)}}let B=await l.exec("signTransaction",[v.Currency.BTC,{data:y,privateKey:p}]);return f.length===1&&(B=[B]),{commitTx:B[0],revealTxs:B.slice(1),commitAddrs:[],commitTxFee:C[0],revealTxFees:C.slice(1)}},[a,o,t,e])},Nt=({type:e,toAddr:t,fromAddr:s,walletId:i,satBytes:o,inscriptionData:a,inscriptionDataList:u,revealOutValue:r=790})=>{let n=ne(),m=rt(i||n),p=(0,N.useMemo)(()=>{var _;return(_=(m||[]).find(({address:l})=>l===s))==null?void 0:_.privateKey},[s,m]);return(0,N.useCallback)(async({utxoList:_})=>{let l=ut({type:e,toAddr:t,satBytes:o,fromAddr:s,utxoList:_,privateKey:p,revealOutValue:r,inscriptionData:a,inscriptionDataList:u});try{return await re().exec("signTransaction",[v.Currency.BTC,{data:l}])}catch{throw Error("sign error")}},[e,t,o,s,p,r,a,u])},Qt=({type:e,toAddr:t,fromAddr:s,walletId:i,satBytes:o,inscriptionData:a,inscriptionDataList:u,revealOutValue:r=O,onlyCommitTxFee:n})=>{let c=Nt({type:e,toAddr:t,fromAddr:s,walletId:i,satBytes:o,revealOutValue:r,inscriptionData:a,inscriptionDataList:u});return(0,N.useCallback)(async({utxoList:m,...p})=>{let{commitTxFee:_,revealTxFees:l=[]}=await c({utxoList:m,...p});return n?_:{commitTxFee:_,totalRevealTxFee:(l||[]).reduce((d,x)=>M.add(d,x),0)}},[n,c])},en=({type:e,coinId:t,fromAddr:s,toAddr:i,satBytes:o,coinAmount:a,protocolId:u})=>{let r=pe(t),n=(r==null?void 0:r.baseCoinId)||t;return(0,N.useCallback)(async({utxoList:c,...m})=>{if(!Number(o))return Promise.reject();let{estimateFee:p}=await ee(),_=de({type:e,toAddr:i,utxoList:c,satBytes:o,coinAmount:a,protocolId:u,changeAddr:s,...m}),l=Ye({coinId:+n}),d=l==null?void 0:l.coinType;try{return await p(d,{data:_})}catch(x){return Promise.reject(x)}},[n,a,s,u,o,i,e])},Te=({coinId:e,fromAddr:t,toAddr:s,satBytes:i,coinAmount:o,protocolId:a,revealOutValue:u,inscriptionData:r,inscriptionDataList:n,...c})=>{let m=we(a),p=en({coinId:e,satBytes:i,fromAddr:t,toAddr:s,coinAmount:o,protocolId:a,type:m,...c}),_=Qt({coinId:e,toAddr:s,fromAddr:t,satBytes:i,coinAmount:o,protocolId:a,revealOutValue:u,inscriptionData:r,inscriptionDataList:n,type:m,onlyCommitTxFee:!0,...c});return a===h.SRC_20?_:p},Gt=(e,t)=>{let{coinId:s,walletId:i,toAddr:o,fromAddr:a,satBytes:u,networkFee:r,coinAmount:n,canTransferAmount:c,utxoParams:m={},inscriptionData:p,protocolId:_,inscriptionDataList:l,revealOutValue:d=O,inputs:x,...f}=e,g=pe(s),y=(g==null?void 0:g.baseCoinId)===0,T=_||(g==null?void 0:g.protocolId),{ready:C=!0,refreshDeps:B}=t||{},[j,{setTrue:J,setFalse:se}]=_e(!1),[ke,W]=(0,N.useState)(),Oe=ne(),St=i||Oe,[ge,Et]=(0,N.useState)(r),je=Te({coinId:s,fromAddr:a,toAddr:o,satBytes:u,coinAmount:n,protocolId:T,revealOutValue:d,inscriptionData:p,inscriptionDataList:l}),Me={coinAmount:n,networkFee:ge||"0"};y&&c&&M.gt(M.add(n,ge),c)&&(Me={coinAmount:c,networkFee:0});let[Pt,ae]=xt({coinId:s,address:a,walletId:St,...Me,...m},{refreshDeps:B,ready:y&&!!c&&C||!y&&C}),V=(0,N.useMemo)(()=>[...x||[],...ae||[]],[x,ae]);return nt(()=>{!Array.isArray(V)||!(V!=null&&V.length)||(J(),je({utxoList:V,...f}).then(ie=>{var Z;W(!1),Et(ie),(Z=t==null?void 0:t.onSuccess)==null||Z.call(t,ie,ae)}).catch(ie=>{var Z;W(!0),(Z=t==null?void 0:t.onError)==null||Z.call(t,ie)}).finally(()=>{se()}))},[ae,f,je]),[j||Pt,ge,ke]},tn=({type:e,coinId:t,toAddr:s,walletId:i,fromAddr:o,changeAddr:a,satBytes:u,localType:r,coinAmount:n,networkFee:c,protocolId:m,dustSize:p=O,..._})=>{let l=ne(),x=be({fromAddr:o,localType:r,walletId:i||l});return(0,N.useCallback)(async({utxoList:f,...g})=>{let y=de({toAddr:s,satBytes:u,type:e,changeAddr:a||o,dustSize:p,coinAmount:n,utxoList:f,protocolId:m,..._});return await x({params:y,...g})},[a,n,p,o,m,_,u,x,s,e])},Tt=({coinId:e,toAddr:t,walletId:s,protocolId:i,fromAddr:o,changeAddr:a,satBytes:u,localType:r,coinAmount:n,networkFee:c,inscriptionData:m,inscriptionDataList:p,dustSize:_=O,...l})=>{let d=we(i),x=tn({coinId:e,toAddr:t,walletId:s,fromAddr:o,changeAddr:a,satBytes:u,localType:r,coinAmount:n,networkFee:c,dustSize:_,protocolId:i,type:d,...l}),f=Nt({toAddr:t,fromAddr:o,walletId:s,satBytes:u,protocolId:i,inscriptionData:m,inscriptionDataList:p,type:d,...l});return i===h.SRC_20?f:x},qt=({coinId:e,toAddr:t,txType:s,fromAddr:i,satBytes:o,walletId:a,localType:u,networkFee:r,coinAmount:n,protocolId:c,dustSize:m=O,extraPublishParams:p={},..._})=>{let l=ne(),d=a||l,x=Tt({coinId:e,toAddr:t,walletId:a,fromAddr:i,satBytes:o,localType:u,coinAmount:n,networkFee:r,dustSize:m,protocolId:c,..._}),f=Re({coinId:e,txType:s,coinAmount:n,fromAddr:i,toAddr:t,localType:u,networkFee:r,walletId:d,extJson:JSON.stringify({protocolId:c}),...p});return(0,N.useCallback)(async({utxoList:g,...y})=>{let T=await x({utxoList:g,...y}),C=T;return c===h.SRC_20&&(C=T==null?void 0:T.commitTx),await f(C)},[c,f,x])};export{Y as a,D as b,H as c,kt as d,oe as e,Mt as f,dt as g,fe as h,xt as i,Xt as j,Yt as k,Ht as l,kr as m,Or as n,Te as o,Gt as p,Tt as q,qt as r};

window.inOKXExtension = true;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=chunk-DPVVGFWQ.js.map
